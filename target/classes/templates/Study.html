<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Study - Cell Taxonomy - CNCB-NGDC</title>
    <link rel="icon" href="/celltaxonomy/static/img/CellTaxonomy v3.png">

    <link href="/celltaxonomy/static/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/celltaxonomy/static/css/ionicons.min.css">

    <script src="/celltaxonomy/static/js/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <script src="/celltaxonomy/static/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/celltaxonomy/static/css/bootstrap.min.css" >
    <link rel="stylesheet" href="/celltaxonomy/static/css/dataTables.bootstrap.min.css" >
    <script src="/celltaxonomy/static/js/jquery.dataTables.min.js"></script>
    <script src="/celltaxonomy/static/js/dataTables.buttons.min.js"></script>
    <script src="/celltaxonomy/static/js/dataTables.bootstrap.min.js"></script>
    <link href="/celltaxonomy/static/css/dataTables.colVis.css" rel="stylesheet">
    <link href="/celltaxonomy/static/css/select2.min.css" rel="stylesheet" />
    <script src="/celltaxonomy/static/js/select2.min.js"></script>
    <link href="/celltaxonomy/static/css/bow.ui.min.css" rel="stylesheet">
    <script type="text/javascript" src="/celltaxonomy/static/js/headerfooter-full.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/my/my.js"></script>

    <link rel="stylesheet" type="text/css" href="/celltaxonomy/static/css/my/my.css">

    <title>Title</title>
    <style>
        .celllink{
            color:#2487ce;
            cursor: pointer;
        }
        li{
            display: inline-block;
        }
        .tissue-remove{
            cursor: pointer;
        }
        .pagenumber{
            padding:0;
            margin: 0 7px 0 7px;
            font-size: 17px;
            cursor: pointer;
            width: 25px;
            text-align: center;
        }
        .pagenumber.active{
            border-bottom:1px solid #666 ;
        }
        .indexes{
            display: flex;
            padding: 10px;
            width: 100%;
            justify-content: center;
            margin:0 auto;
        }
        .index{
            padding:0 1.35% 0 1.35%;
            font-size: 17px;
            border-bottom: 1px solid #ddd;
        }
        .index.active{

            border: 1px solid #ddd;
            border-bottom-color: transparent;
            border-radius: 4px 4px 0 0;
        }
        .index a,.pagenumber a{
            color:#333;
            text-decoration: none;
        }
        .tissue-name{
            padding:0 15px 0 15px;
            font-size: 15px;
            text-transform: capitalize;
            width: 33%;
            cursor: pointer;

        }
        .tissue-name:hover{
            background: #eae9e9;
        }
        .tissue-name.active{
            background: #eae9e9;
        }
        .tissue-name a{
            color: #666;
            text-decoration: none;
        }
        .filter-title,#speciess{
            height: 35px;
            line-height: 35px;
            transition: 0.3s;
        }


        #filter-card-tissue{
            border-bottom: 1px solid rgb(246, 246, 246);
            -webkit-box-shadow:0 1px 10px rgb(18 18 18 / 10%);
            box-shadow:0 1px 10px rgb(18 18 18 / 10%);
        }
        .Browser{
            border-radius: 2px;
            -webkit-box-shadow:0 1px 10px rgb(18 18 18 / 10%);
            box-shadow:0 1px 10px rgb(18 18 18 / 10%);
            -webkit-box-sizing:border-box;
            box-sizing:border-box;
            background: #ffffff;
        }
        .study-card{
            padding: 20px 10px 10px 10px;
            border-bottom: 1px solid rgb(246, 246, 246);;
        }
        .library{
            /*border-radius: 10px;*/
            /*background: #c393a5;*/
            /*padding:5px 10px 5px 10px;*/
            /*color:white;*/
            /*font-weight: 700;*/

        }
        .journal{
            border-radius: 10px;
            background: #aec387;
            padding:5px 10px 5px 10px;
            color:white;
            font-weight: 600;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;


        }
        .tissue{
            /*border-radius: 10px;*/
            /*background: #84a3c3;*/
            /*padding:5px 10px 5px 10px;*/
            /*color:white;*/
            /*font-weight: 700;*/
        }
        .pmid{
            border-radius: 10px;
            background: #8aafc3;
            padding:5px 10px 5px 10px;
            color:white;
            font-weight: 600;
            cursor: pointer;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;

        }
        .years{
            border-radius: 10px;
            background: #b9a6c3;
            padding:5px 10px 5px 10px;
            color:white;
            font-weight: 600;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;

        }
        .species{
            /*border-radius: 10px;*/
            /*background: #61cbc5;*/
            /*padding:5px 10px 5px 10px;*/
            /*color:white;*/
            /*font-weight: 700;*/
        }
        .dataset{
            border-radius: 10px;
            background: #abad65;
            padding:5px 10px 5px 10px;
            color:white;
            font-weight: 600;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;

        }
        @media screen and (max-width: 1400px) and (min-width: 1024px) {
            .study-title{
                font-size: 17px;
            }
        }
        @media screen and (min-width: 1400px) {
            .study-title{
                font-size: 18px;
            }
        }
        .study-title{
            margin: 0 0 20px 1.25rem;
        }
        .Descriptions,.CellTypes{
            font-weight: 700;
            font-size:16px;
            margin:10px 0 15px 0;
        }
        #next{
            cursor: pointer;
        }
        .panel-body::-webkit-scrollbar{
            /*滚动条整体样式*/
            width : 15px;  /*高宽分别对应横竖滚动条的尺寸*/
            height: 12px;
        }
        .panel-body::-webkit-scrollbar-thumb{
            /*滚动条里面小方块*/
            border-radius   : 10px;
            background-color: #2487ce;
            background-image: -webkit-linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.2) 75%,
                    transparent 75%,
                    transparent
            );
        }
        .panel-body::-webkit-scrollbar-track {
            /*滚动条里面轨道*/
            box-shadow   : 0 0 1px rgba(0, 0, 0, 0.2);
            background   : #ededed;
            border-radius: 10px;
        }
        textarea{
            margin:0 !important
        }
        .select2-selection__rendered{
            margin:0 !important
        }
        .select2 {
            width: 90% !important;
        }
        input::placeholder {
            font-size: 10px;
        }
        .species_list,.tissue_list,.cell_list{
            padding: 5px;
            text-decoration: none;
        }
        .species_list.active,.tissue_list.active,.cell_list.active{
            background: #2487ce;
            color: white;
        }
        .table>tbody>tr>td, .table>thead>tr>th{
            background: transparent;
        }
        .filter-title{
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
        }
        .showmore{
            cursor: pointer;
        }
        table{
            table-layout: fixed;
        }
        table tr td:first-child{
            width:15%
        }
    </style>

    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6b352b313257516a97fd9d0db0276208";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body>
<header>
    <nav th:replace="common/topbar::topbar"></nav>
</header>
<!--    <div style="overflow: hidden;height:150px;width: 100%;background-image: url(/celltaxonomy/static/img/B1415360227.jpeg)">-->
<!--        <div class="col-lg-offset-1" style="display: flex;align-items: center;height: 100%;">-->
<!--            <h1 style="text-align: left;color: white;width:100%;font-size: 76px">Study Browser</h1>-->
<!--        </div>-->
<!--    </div>-->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/celltaxonomy/">Home</a></li>
        <li class="breadcrumb-item active">Browse</li>
        <li class="breadcrumb-item active" aria-current="page">Single-cell RNA-seq studies</li>
    </ol>
</nav>
    <div class="container" style="background: #f4f7f6;">

        <div class="page">
            <div class="col-lg-12 col-sm-12" style="margin-top: 3rem">
                <div class="panel-default">
                    <div class="panel-body" style="padding-right: 0;display: flex;justify-content: center">
                        <table class="table">
                            <tr>
                                <td>
                                    <h4 class="filter-title"  >Search</h4>
                                </td>
                                <td>
                                    <div style="display: flex;justify-content: center">
                                        <input style="margin:0;flex:0 0 auto;height: 45px" id="search" type="search" placeholder="Pubmed ID">
                                    </div>
                                </td>
                            </tr>
                            <tr style="border-bottom:1px solid rgba(34,36,38,.15)">
                                <td>
                                    <h4 class="filter-title"  id="species" >Species</h4>
                                </td>
                                <td>
                                    <ul id="speciess" style="margin:0"></ul>
                                </td>
                            </tr>
                            <tr>
                                <td >
                                    <h4 class="filter-title"  id="tissue">Tissue</h4>
                                </td>
                                <td>
                                    <ul id="tissuename" style="margin:0">
                                        <li><i class='icon ion-plus-round showmore'></i></li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%">
                                    <h4 class="filter-title" id="cell_type" >Cell type</h4>
                                </td>
                                <td >
                                    <ul id="celltypename" style="margin:0">
                                        <li><i class='icon ion-plus-round showmore'></i></li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-lg-12" style="padding-left: 20px">
                <div class="Browser"  style="margin-top: 10px">
                    <div id="filter-card-tissue" style="display: none;padding: 10px">

                        <ul class="page-change" style="top: 450px;position: absolute">

                        </ul>
                    </div>
                    <div class="study-cards">

                    </div>


                </div>
                <div style="text-align: center">
                    <i class="icon ion-chevron-down" id="next" style="font-size: 40px;line-height: 0;color: #666"></i>
                </div>
            </div>

        </div>
    </div>

    <script th:inline="javascript">
        function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; });
        }

        var list;
        var studypagenumber=0;


        $(document).ready(function(){

            $.ajax({
                url:"/celltaxonomy/static/file/marker_cell_type_list",
                type:'get',
                success:function(results){
                    list=results.replace(/\r/g,"").toLowerCase().split("\n");
                }
            });
            $.ajax({
                url: "/celltaxonomy/study_tissue_list",
                dataType: 'json',
                type: "post",
                success:function(result){

                    var n=1;
                        result["Tissue"].map(function (e) {
                            if(e!=null){

                                n+=1
                                if(n<10) {
                                    $("#tissuename").find(".icon").before(
                                        "<li style=\"margin-right:10px;display: inline-block\">" +
                                        "<a class='tissue_list'>" + e["Tissue"] + "</a>" +
                                        "</li>"
                                    )
                                }
                                else{
                                    $("#tissuename").find(".icon").before(
                                        "<li class='hidden_item' style=\"margin-right:10px;display: none\">" +
                                        "<a class='tissue_list'>" + e["Tissue"] + "</a>" +
                                        "</li>"
                                    )
                                }
                            }

                        })

                }

            })
            $.ajax({
                url: "/celltaxonomy/study_celltype_list",
                dataType: 'json',
                type: "post",
                success:function(result){
                    var n=1;
                    result["Cell_ID"].map(function(e){
                        n+=1
                        if(n<10){
                            $("#celltypename").find(".icon").before(
                                "<li style=\"margin-right:10px;display: inline-block\">"+
                                "<a class='cell_list' value='"+e["CT_ID"]+"'>"+e["Cell_standard"]+"</a>" +
                                "</li>"
                            )
                        }
                        else{
                            $("#celltypename").find(".icon").before(
                                "<li class='hidden_item' style=\"margin-right:10px;display: none\">"+
                                "<a class='cell_list' value='"+e["CT_ID"]+"'>"+e["Cell_standard"]+"</a>" +
                                "</li>"
                            )
                        }

                    })
                }
            })
            $.ajax({
                url: '/celltaxonomy/study_species_list',
                type: 'post',
                success:function(results){
                    results.map(function(d){
                        $("#speciess").append("<li  style='margin-right:10px;display: inline-block'><a class='species_list'>"+d["Species"]+"</a></li>")

                    })
                }
            })
            $.ajax({
                url:"/celltaxonomy/study_list",
                type:"post",
                data:{
                    "pagenumber":studypagenumber
                },
                success:function(results){
                    for (var i=0;i<results.length;i++){
                        makeStudyList(results[i])
                    }

                },
                error:function(){
                    console.log("error")
                }
            });
        });
        $("#next").click(function(){
            studypagenumber+=1;
            var species=$("#speciesname").val();
            var tissues=$("#tissuename").val();
            var journal=$("#journalname").val();
            $.ajax({
                url:'/celltaxonomy/study_list',
                type:'post',
                data:{
                    "pagenumber":studypagenumber,
                    "tissues":JSON.stringify(tissues),
                    "journal":JSON.stringify(journal),
                    "species":JSON.stringify(species)
                },
                success:function(results){
                    for (var i=0;i<results.length;i++){

                        makeStudyList(results[i])

                    }

                },
                error:function(){
                    console.log("error")
                }
            })
        });
        $(".js-example-basic-multiple").change(function(){
            $('#search').val("")
            studypagenumber=0;
            var species=$(".species_list.active").text()
            species.pop()
            var tissues=$("#tissuename").val();
            var celltype=$("#celltypename").val();
            var speciess2=""
            var tissuename2=""
            var celltype2=""
            if(species!=null){
                speciess2=species.toString()
            }
            if(tissues!=null){
                tissuename2=tissues.toString()
            }
            if(celltype!=null){
                celltype2=celltype.toString()
            }

            $("#celltypename").select2({
                ajax: {
                    url: "/celltaxonomy/study_celltype_list",
                    dataType: 'json',
                    type: "post",
                    data:function(params){
                        var search={
                            term:params.term,
                            tissue:tissuename2,
                            species:speciess2
                        }
                        return search
                    },
                    processResults: function (data) {
                        var res = data["Cell_ID"].map(function (item) {
                            return {id: item["Cell_ID"],text:item["Cell_standard"].replace(/"/g,"")};
                        });
                        return {
                            results: res
                        };
                    }
                }
            });

            if(species==null && tissues==null && celltype==null){
                $.ajax({
                    url:"/celltaxonomy/study_list",
                    type:"post",
                    data:{
                        "pagenumber":studypagenumber
                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){
                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                });

            }
            else{

                $.ajax({
                    url:'/celltaxonomy/study_list',
                    type:'post',
                    data:{
                        "pagenumber":studypagenumber,
                        "tissues":JSON.stringify(tissues),
                        "species":JSON.stringify(species),
                        "celltype":JSON.stringify(celltype)

                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){

                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                })
            }
        });


        $(".study-cards").on("click",".pmid",function(){
            var link=$(this).text().split(": ")[1];
            if($(this).text().indexOf("DOI")>=0){
                window.open("https://doi.org/"+link)
            }
            else{
                window.open("https://pubmed.ncbi.nlm.nih.gov/"+link+"/")
            }
        })
        $('#search').bind('input propertychange', function() {
            studypagenumber=0;
            $.ajax({
                url:'/celltaxonomy/study_list',
                type:'post',
                data:{
                    "pagenumber":studypagenumber,
                    "query":$('#search').val()
                },
                success:function(results){
                    if($(".js-example-basic-multiple").val()!=null){
                        $(".js-example-basic-multiple").val(null).trigger("change");
                    }
                    $(".species_list.active").removeClass("active")
                    $(".species_list").css("color","#2C75C9")

                    if(results.length<10){
                        $("#next").css("display","none")
                    }
                    else{
                        $("#next").css("display","block")
                    }
                    $(".study-cards").empty()
                    for (var i=0;i<results.length;i++){

                        makeStudyList(results[i])
                    }

                },
                error:function(){
                    console.log("error")
                }
            })

        });

        function post(URL,params) {
            var temp_form = document.createElement("form");
            temp_form .action = "/celltaxonomy"+URL;
            temp_form .target = "_blank";
            temp_form .method = "post";
            temp_form .style.display = "none";
            for (var x in params){
                var opt = document.createElement("textarea");
                opt.name = x;
                opt.value = params[x];
                temp_form .appendChild(opt);
            }


            document.body.appendChild(temp_form);
            temp_form .submit();
        };
        $(".study-cards").on("click",".celllink",function(){
            $.ajax({
                url:"/celltaxonomy/idcard",
                type:'post',
                data:{"id":$(this).text()},
                success:function(results){
                    window.open("/celltaxonomy/celltype/"+results[0].CT_ID)
                }
            })


        })
        $("#speciess").on("click",".species_list",function(){
            $('#search').val("")

            if($(this).hasClass("active")){
                $(this).removeClass("active")
                $(this).css("color","#2c75c9")
            }
            else{
                $(this).addClass("active")
                $(this).css("color","white")
            }


            var speciesname=[]
            $(".species_list.active").each(function(){
                speciesname.push($(this).text())
            })


            var tissuename=[]
            $(".tissue_list.active").each(function(){
                tissuename.push($(this).text())
            })
            var celltypename=[]
            $(".cell_list.active").each(function(){
                celltypename.push($(this).attr("value"))
            })


            if(speciess!=null){
                var speciess2=speciesname.toString()
            }
            if(tissuename!=null){
                var tissuename2=tissuename.toString()
            }
            if(celltypename!=null){
                var celltypename2=celltypename.toString()
            }
            $.ajax({
                url: "/celltaxonomy/study_tissue_list",
                dataType:'json',
                type:"post",
                data:{
                    species:speciess2,
                    celltype:celltypename2
                },
                success:function(result){
                    result=result["Tissue"]
                    var cells=unpack(result,"Tissue")
                    $(".tissue_list").each(function(){
                        if(cells.indexOf($(this).text())<0){
                            $(this).css("pointer-events","none")
                            $(this).css("color","grey")
                        }
                        else{
                            if(!$(this).hasClass("active")){
                                $(this).css("pointer-events","auto")
                                $(this).css("color","#2c75c9")
                            }
                        }
                    })
                }
            })
            $.ajax({
                url: "/celltaxonomy/study_celltype_list",
                dataType: 'json',
                type: "post",
                data:{
                    species:speciess2,
                    tissue:tissuename2
                },
                success:function(result){
                    result=result["Cell_ID"]
                    var cells=unpack(result,"Cell_standard")
                    $(".cell_list").each(function(){
                        if(cells.indexOf($(this).text())<0){
                            $(this).css("pointer-events","none")
                            $(this).css("color","grey")
                        }
                        else{
                            if(!$(this).hasClass("active")){
                                $(this).css("pointer-events","auto")
                                $(this).css("color","#2c75c9")
                            }
                        }
                    })
                }
            })

            if(speciess==null && tissuename==null && celltypename==null){
                $.ajax({
                    url:"/celltaxonomy/study_list",
                    type:"post",
                    data:{
                        "pagenumber":studypagenumber
                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){
                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                });

            }
            else{

                $.ajax({
                    url:'/celltaxonomy/study_list',
                    type:'post',
                    data:{
                        "pagenumber":studypagenumber,
                        "tissues":tissuename2,
                        "species":speciess2,
                        "celltype":celltypename2

                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){
                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                })
            }
        })
        $("#tissuename").on("click",".tissue_list",function(){
            $('#search').val("")

            if($(this).hasClass("active")){
                $(this).removeClass("active")
                $(this).css("color","#2c75c9")
            }
            else{
                $(this).addClass("active")
                $(this).css("color","white")
            }
            var speciess=$(".species_list.active").text()

            var tissuename=[]
            $(".tissue_list.active").each(function(){
                tissuename.push($(this).text())
            })
            var celltypename=[]
            $(".cell_list.active").each(function(){
                celltypename.push($(this).attr("value"))
            })

            if(speciess!=null){

                var speciess2=speciess.toString()
            }
            if(tissuename!=null){
                var tissuename2=tissuename.toString()
            }
            if(celltypename!=null){
                var celltypename2=celltypename.toString()
            }

            $.ajax({
                url: "/celltaxonomy/study_species_list",
                dataType:'json',
                type:"post",
                data:{
                    tissue:tissuename2,
                    celltype:celltypename2
                },
                success:function(result){
                    var cells=unpack(result,"Species")

                    $(".species_list").each(function(){
                        if(cells.indexOf($(this).text())<0){
                            $(this).css("pointer-events","none")
                            $(this).css("color","grey")
                        }
                        else{
                            if(!$(this).hasClass("active")){
                                $(this).css("pointer-events","auto")
                                $(this).css("color","#2c75c9")
                            }

                        }
                    })
                }
            })
            $.ajax({
                url: "/celltaxonomy/study_celltype_list",
                dataType: 'json',
                type: "post",
                data:{
                    species:speciess2,
                    tissue:tissuename2
                },
                success:function(result){
                    result=result["Cell_ID"]
                    var cells=unpack(result,"Cell_standard")
                    $(".cell_list").each(function(){
                        if(cells.indexOf($(this).text())<0){
                            $(this).css("pointer-events","none")
                            $(this).css("color","grey")
                        }
                        else{
                            if(!$(this).hasClass("active")){
                                $(this).css("pointer-events","auto")
                                $(this).css("color","#2c75c9")
                            }
                        }
                    })
                }
            })

            if(speciess==null && tissuename==null && celltypename==null){
                $.ajax({
                    url:"/celltaxonomy/study_list",
                    type:"post",
                    data:{
                        "pagenumber":studypagenumber
                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){

                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                });

            }
            else{

                $.ajax({
                    url:'/celltaxonomy/study_list',
                    type:'post',
                    data:{
                        "pagenumber":studypagenumber,
                        "tissues":tissuename2,
                        "species":speciess2,
                        "celltype":celltypename2

                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){
                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                })
            }
        })
        $("#celltypename").on("click",".cell_list",function(){
            $('#search').val("")
            if($(this).hasClass("active")){
                $(this).removeClass("active")
                $(this).css("color","#2c75c9")
            }
            else{
                $(this).addClass("active")
                $(this).css("color","white")
            }
            var speciess=$(".species_list.active").text()

            var tissuename=[]
            $(".tissue_list.active").each(function(){
                tissuename.push($(this).text())
            })
            var celltypename=[]
            $(".cell_list.active").each(function(){
                celltypename.push($(this).attr("value"))
            })
            if(speciess!=null){

                var speciess2=speciess.toString()
            }
            if(tissuename!=null){
                var tissuename2=tissuename.toString()
            }
            if(celltypename!=null){
                var celltypename2=celltypename.toString()
            }
            $.ajax({
                url: "/celltaxonomy/study_species_list",
                dataType:'json',
                type:"post",
                data:{
                    tissue:tissuename2,
                    celltype:celltypename2
                },
                success:function(result){
                    var cells=unpack(result,"Species")

                    $(".species_list").each(function(){
                        if(cells.indexOf($(this).text())<0){
                            $(this).css("pointer-events","none")
                            $(this).css("color","grey")
                        }
                        else{
                            if(!$(this).hasClass("active")){
                                $(this).css("pointer-events","auto")
                                $(this).css("color","#2c75c9")
                            }
                        }
                    })
                }
            })
            $.ajax({
                url: "/celltaxonomy/study_tissue_list",
                dataType: 'json',
                type: "post",
                data:{
                    species:speciess2,
                    celltype:celltypename2
                },
                success:function(result){

                    result=result["Tissue"]
                    var cells=unpack(result,"Tissue")
                    $(".tissue_list").each(function(){
                        if(cells.indexOf($(this).text())<0){
                            $(this).css("pointer-events","none")
                            $(this).css("color","grey")
                        }
                        else{
                            if(!$(this).hasClass("active")){
                                $(this).css("pointer-events","auto")
                                $(this).css("color","#2c75c9")
                            }
                        }
                    })
                }
            })

            if(speciess==null && tissuename==null && celltypename==null){
                $.ajax({
                    url:"/celltaxonomy/study_list",
                    type:"post",
                    data:{
                        "pagenumber":studypagenumber
                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){
                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                });

            }
            else{

                $.ajax({
                    url:'/celltaxonomy/study_list',
                    type:'post',
                    data:{
                        "pagenumber":studypagenumber,
                        "tissues":tissuename2,
                        "species":speciess2,
                        "celltype":celltypename2

                    },
                    success:function(results){
                        if(results.length<10){
                            $("#next").css("display","none")
                        }
                        else{
                            $("#next").css("display","block")
                        }
                        $(".study-cards").empty()
                        for (var i=0;i<results.length;i++){
                            makeStudyList(results[i])
                        }

                    },
                    error:function(){
                        console.log("error")
                    }
                })
            }
        })
        $(".showmore").click(function(){
            if($(this).hasClass("ion-plus-round")){
                $(this).removeClass("ion-plus-round")
                $(this).addClass("ion-minus-round")
                $(this).siblings(".hidden_item").css("display","inline-block")
            }
            else{
                $(this).removeClass("ion-minus-round")
                $(this).addClass("ion-plus-round")
                $(this).siblings(".hidden_item").css("display","none")
            }

        })

    </script>
</body>
</html>