<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SingleMarker - Cell Taxonomy - CNCB-NGDC</title>
    <link rel="icon" href="/celltaxonomy/static/img/CellTaxonomy v3.png">


    <link rel="stylesheet" href="/celltaxonomy/static/css/ionicons.min.css">

    <script src="/celltaxonomy/static/js/jquery.min.js"></script>


    <script src="/celltaxonomy/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/celltaxonomy/static/css/bootstrap.min.css" >
    <link rel="stylesheet" href="/celltaxonomy/static/css/dataTables.bootstrap.min.css" >
    <script src="/celltaxonomy/static/js/jquery.dataTables.min.js"></script>
    <script src="/celltaxonomy/static/js/dataTables.buttons.min.js"></script>
    <script src="/celltaxonomy/static/js/jszip.min.js"></script>
    <script src="/celltaxonomy/static/js/buttons.html5.min.js"></script>
    <script src="/celltaxonomy/static/js/buttons.bootstrap.min.js"></script>
    <script src="/celltaxonomy/static/js/dataTables.bootstrap.min.js"></script>
    <link href="/celltaxonomy/static/css/dataTables.colVis.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/celltaxonomy/static/css/page.min.css">
    <script type="text/javascript" src="/celltaxonomy/static/js/echarts.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/headerfooter-full.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/ecSimpleTransform.min.js"></script>

    <link href="/celltaxonomy/static/css/bow.ui.min.css" rel="stylesheet">
    <script type="text/javascript" src="/celltaxonomy/static/js/my/my.js"></script>

    <link rel="stylesheet" type="text/css" href="/celltaxonomy/static/css/my/my.css">
    <style>
        #table-marker select{
            height:20px;
            width:90%
        }
        .pagination{
            display: block;
        }
        .marker-detail ul li{
            display: block;
            margin: 10px 0 10px 0;
        }
        .marker-description{
            font-size: 40px;
            font-weight: 700;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
            color: #16507b;
        }
        .id-card-title{
            font-weight: 700;
        }
        .Browser::-webkit-scrollbar,.table-region::-webkit-scrollbar,div::-webkit-scrollbar {
            /*滚动条整体样式*/
            width : 15px;  /*高宽分别对应横竖滚动条的尺寸*/
            height: 12px;
        }
        .Browser::-webkit-scrollbar-thumb,.table-region::-webkit-scrollbar-thumb,div::-webkit-scrollbar-thumb{
            /*滚动条里面小方块*/
            border-radius   : 10px;
            background-color: #2487ce;
            background-image: -webkit-linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.2) 75%,
                    transparent 75%,
                    transparent
            );
        }
        .Browser::-webkit-scrollbar-track,.table-region::-webkit-scrollbar-track,div::-webkit-scrollbar-track {
            /*滚动条里面轨道*/
            box-shadow   : 0 0 1px rgba(0, 0, 0, 0.2);
            background   : #ededed;
            border-radius: 10px;
        }
        .figure-li{
            border:1px solid #2487ce;
            color: #2487ce;
            padding: 8px 20px 8px 20px;
            border-radius: 5px;
            transition: 0.3s;
            cursor: pointer;
        }
        .figure-li a{
            color:inherit;
            text-decoration: none;

        }
        .figure-li.active,.figure-li:hover{
            background: #2487ce;
            color: white;
        }
        /*.idlink{*/
        /*    padding-left: 30px;*/
        /*}*/
        .ytick text{
            text-transform: capitalize;
        }
        .xtick text{
            text-transform: capitalize;
        }
        .dataTables_paginate{
            float:right
        }
        #genecard>tbody>tr>td, #genecard>thead>tr>th{
            border:none
        }
        #genecard>thead>tr>th{
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
            font-size: 15px;
        }

        .ion-checkmark-round{
            color:#8bc6ec;
            margin-right: 5px;
        }
        .filter_search{
            height:30px;
            margin-top:5px;
            display: inline-block;
            width:55px;
            padding:5px 10px;
            text-align: center !important;
            font-size: 14px;
        }
        #confirm_button{
            color:white;
            font-weight: 600;
            border-radius: 5px;
            border:2px solid black;
            padding:8px 15px;
            display: block;
            text-decoration: none;
            background: black;
        }
        .affix{
            top:50px;
            width:270px;
        }
        .tooltiptext {
            visibility: hidden;
            width: 200px;
            top:90%;
            left: 50%;
            margin-left: -100px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px 5px;
            font-family: Arial,serif !important;
            font-size: 15px;
            font-weight: 100;
            /* 定位 */
            position: absolute;
            z-index: 1;
        }
    </style>

    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6b352b313257516a97fd9d0db0276208";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body>
<header>
    <nav th:replace="common/topbar::topbar"></nav>
</header>

<!--    <div style="overflow: hidden;height:150px;width: 100%;background-image: url(/celltaxonomy/static/img/B1415360227.jpeg)">-->
<!--        <div class="col-sm-offset-1 col-lg-offset-1" style="display: flex;align-items: center;height: 100%;">-->
<!--            <h1 style="text-align: left;color: white;width:100%;font-size: 76px">Marker Browser</h1>-->
<!--        </div>-->
<!--    </div>-->
<div class="container" style="background: #f4f7f6">
        <div class="row">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/celltaxonomy/">Home</a></li>
                    <li class="breadcrumb-item active">Browse</li>
                    <li class="breadcrumb-item" aria-current="page"><a href="/celltaxonomy/marker">Cell markers</a></li>
                    <li class="breadcrumb-item" th:text="${markername}"></li>
                </ol>
            </nav>
            <div class="col-lg-12" style="padding:0 ;" >
                <div id="nav_side_bar" class="col-lg-2 col-sm-3" style="background:transparent;padding:0;">
                    <div  data-spy="affix" data-offset-top="150">
                        <ul id="nav-side">
                            <li style="border-bottom: 1px solid rgb(226,226,226);pointer-events: none;padding:0 15px 10px 15px;font-weight: 500">
                                <span style="font-size: 22px"  th:text="${markername}"></span>
                            </li>
                        </ul>
                    </div>

                </div>
                <div class="col-lg-10" style="padding-left: 20px">
                    <div class="mypanel">
                        <div class="mypanel-body" id="basic" style="padding: 10px 20px 20px 20px">
                            <div>
                                <div>
                                    <div class="marker-detail" style="overflow: auto">
                                        <h4 style="color: #16507b;font-size: 28px;padding-left: 8px" th:text="${markername}"></h4>
                                        <div style="width: 95%">
                                            <table class="table table-hover" id="genecard" style="width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th>Species</th>
                                                        <th >Gene alias</th>
                                                        <th>ENTREZ ID</th>
                                                        <th>Ensembl ID</th>
                                                        <th>UniProt ID</th>
                                                        <th>Pfam ID</th>
                                                        <th>Orthologs</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="mic:${markeridcard}">
                                                        <td th:text="${mic.Species}"></td>
                                                        <td th:text="${mic.Gene_Alias}"></td>
                                                        <td id="entrezid"  th:text="${mic.Gene_ENTREZID}"></td>
                                                        <td id="geneensemblid" th:text="${mic.Gene_Ensembl_ID}"></td>
                                                        <td id="uniprot" th:text="${mic.Uniprot}"></td>
                                                        <td id="PFAM" th:text="${mic.PFAM}"></td>
                                                        <td id="HomoloGene" th:text="${mic.HomoloGene}"></td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="mypanel">
                        <div class="mypanel-body" id="detail10" style="margin-top:20px;padding: 10px 20px 20px 20px">

                            <div>
                                <div class="table-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#summary_region">
                                        <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                        <span style="font-size:20px;font-weight: 700;"  id="summary/">Summary</span>
                                    </a>
                                </div>
                                <div id="summary_region" class="collapse in">
                                    <ul style="margin-bottom: 0">
                                        <li class="summary" id="summary1"></li>
<!--                                        <li class="summary" id="summary2">-->
<!--                                            Among <span id="celltype_count"></span> cell types, <strong th:text="${markername}"></strong> is mostly reported as cell marker of <span id="most_reported_cell"></span> with <span id="publication_count"></span>.-->
<!--                                        </li>-->
                                        <li class="summary" id="summary3"></li>
                                        <li class="summary" id="summary4"></li>
                                        <li class="summary" id="summary5-1">The relevant cell types for <strong th:text="${markername}"></strong> are ranked by evaluation of supported literature, expression enrichment and conservation.</li>

                                        <li style="margin-top: 10px;list-style: none;" id="summary5">
                                            <div>
                                                <div>
                                                    <input type="checkbox" class="switch switch1">Show value
                                                </div>


                                            </div>
                                            <div style="padding:0 1.5rem;overflow: auto">
                                                <div style="width: 95%">
                                                    <table id="cell_recom" class="table table-striped table-hover" style="width:100%">
                                                        <thead>
                                                        <tr>
                                                            <th></th>
                                                            <th id="th1">
                                                                <div style="list-style: none;margin-top:5px">
                                                                    <span>No. of publications</br> >=</span>
                                                                    <input id="filter_search1" class="filter_search" type="search"  value="1" oninput = "value=value.replace(/[^\d]/g,'')*1">
                                                                </div>
                                                            </th>
                                                            <th id="th2">
                                                                <div style="list-style: none;margin-top:5px">
                                                                    <span style="display: inline">log2FC
                                                                        <div class="wrapper" style="height: 18px">
                                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                                                The median log2 fold-change of expression (FDR < 0.05) in a cell cluster to that in all other cells among the available scRNA-seq samples
                                                                            </span>
                                                                        </div>
                                                                        </br> >=
                                                                    </span>
                                                                    <input id="filter_search2" class="filter_search" type="search"  value="0.25" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                                </div>
                                                            </th>
                                                            <th id="th4">
                                                                <div style="list-style: none;margin-top:5px">
                                                                <span style="display: inline">Highly expressed ratio
                                                                    <div class="wrapper" style="height: 18px">
                                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                                            Number of samples in which genes are more highly expressed in this cell type compared to other cell types (log2FC > 0.25, FDR < 0.05) divided by number of total samples for the cell type
                                                                        </span>
                                                                    </div>

                                                                    </br>>=
                                                                </span>
                                                                    <input id="filter_search5" class="filter_search" type="search"  value="0.3" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                                </div>
                                                            </th>
                                                            <th id="th3">
                                                                <div style="list-style: none;margin-top:5px">
                                                                    <span style="display: inline">Specificity score

                                                                        <div class="wrapper" style="height: 18px">
                                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                                                The median cell specificity score (calculated by Jensen-Shannon divergence score, ranging from 0 to 1) among available scRNA-seq samples
                                                                            </span>
                                                                        </div>
                                                                        </br> >=</span>
                                                                    <input id="filter_search3" class="filter_search" type="search"  value="0.3" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                                </div>
                                                            </th>
                                                            <th >
                                                                <div style="list-style: none;margin-top:5px">
                                                                <span style="display: inline">Conservation score
                                                                    <div class="wrapper" style="height: 18px">
                                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                                            Number of ortholog genes which are also reported as cell markers for this cell type in other species
                                                                        </span>
                                                                    </div>
                                                                    </br> >=
                                                                </span>
                                                                    <input id="filter_search4" class="filter_search" type="search"  value="1" oninput = "value=value.replace(/[^\d]/g,'')*1">
                                                                </div>
                                                            </th>
                                                            <th>Total</th>
                                                        </tr>

                                                        </thead>
                                                        <tbody>
                                                        <tr>

                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>

                                            </div>

                                        </li>

                                    </ul>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div id="tissue" class="mypanel" style="margin-top: 20px">
                        <div class="mypanel-body" style="padding: 10px 20px 20px 20px">
                            <div class="Browser" id="width">
                                <div class="table-title" style="margin:0 0 20px 0;color:#2C75C9">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#cell_tissue_enrichment">

                                        <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                        <span style="font-size:20px;font-weight: 700;" id="cell_type/">Cell type</span>
                                        <div class="wrapper">
                                            <i class="icon ion-help-circled" style="line-height: 8px;font-size: 20px"></i>
                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                This panel shows the cell types of the cell marker in various tissues. Fisher’s exact test is performed to test if this cell marker is specifically associated with some cell type by publication number: *** for < 0.001, ** for [0.001, 0.01) and * for [0.01, 0.05).
                                            </span>
                                        </div>
                                    </a>
                                </div>

                                <div>
                                    <div id="cell_tissue_enrichment" style="margin-top: 20px">
                                        <div>
                                            <div>
                                                <label>Tissue</label>
                                                <select id="cell_tissue_enrichment_select" style="width: 200px">
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------"></optgroup>
                                                </select>
                                            </div>
                                            <div style="overflow: auto;">
                                                <div>
                                                    <div id="cell_enrichment_literature_support" style="height: 300px;margin:0 auto"></div>
                                                </div>
                                            </div>
                                            <div style="overflow: auto;">
                                                <div >
                                                    <div style="height: 600px;margin:0 auto;" id="cell_tissue_enrichment_LS_heatmap"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 30px">
                                        <a data-toggle="collapse" class="details" href="#table1" style="text-decoration: none">
                                            <i class="icon ion-plus-round" style="display: inline"></i>
                                            <span style="display: inline">Show details</span>
                                        </a>
                                    </div>
                                    <div id="table1"  class="collapse table-region" style="margin-top: 20px;overflow:auto" >
                                        <div style="width:95%">
                                            <table id="table-marker" class="table table-striped table-hover " style="width:100%;">
                                                <thead>
                                                <tr>
                                                    <th style="width: 10%">Cell Taxonomy ID</th>
                                                    <th>Cell type</th>
                                                    <th>Cell ID</th>
                                                    <th>Species</th>
                                                    <th>Tissue</th>
                                                    <th>Tissue ID</th>
                                                    <th>Condition</th>
                                                    <th>Disease ID</th>
                                                    <th style="width: 5%">Source</th>
                                                    <th style="width: 5%">PMID</th>

                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                    <th ></th>
                                                </tr>
                                                </tfoot>
                                            </table>

                                        </div>

                                    </div>


                                </div>

                            </div>
                        </div>

                    </div>
                    <div class="mypanel">
                        <div class="mypanel-body" id="detail8" style="margin-top:10px;padding: 10px 20px 20px 20px">

                            <div>
                                <div class="table-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#cell_markerDE">
                                        <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                        <span style="font-size:20px;font-weight: 700;" id="cell_marker_expression_enrichment/">Cell marker expression enrichment</span>
                                        <div class="wrapper" >
                                            <i class="icon ion-help-circled" style="line-height: 8px;font-size: 20px"></i>
                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the top cell types in which this marker is highly specifically expressed (with significant high fold change between this cell type and others in relevant scRNA-seq samples; FDR < 0.05).
                                        </span>
                                        </div>
                                    </a>
                                </div>
                                <div id="cell_markerDE" class="collapse in">
                                    <div>
                                        <!--                                        <div>-->
                                        <!--                                            <input type="checkbox" class="switch switch2" checked>-->
                                        <!--                                            <span>Show Publication-supported cell types</span>-->
                                        <!--                                            <div class="wrapper" style="height: 18px">-->
                                        <!--                                                <i class="icon ion-help-circled" style="line-height: 8px;font-size: 20px"></i>-->
                                        <!--                                                <span class="tooltiptext" style="display: block;white-space: normal">-->
                                        <!--                                                    This panel shows the top cell types in which this marker is highly specifically expressed (with significant high fold change between this cell type and others in relevant scRNA-seq datasets; FDR < 0.05).-->
                                        <!--                                                </span>-->
                                        <!--                                            </div>-->
                                        <!--                                        </div>-->
                                        <div >
                                            <div style="display: flex;justify-content: flex-start">
                                                <div >
                                                    <label>log2FC greater than</label>
                                                    <select id="cell_markerDE_barplot_threshold" style="width: 200px">
                                                        <option value="0.25">0.25</option>
                                                        <option value="0.5">0.5</option>
                                                        <option value="1">1</option>
                                                        <option value="1.5">1.5</option>
                                                        <option value="2">2</option>
                                                    </select>
                                                </div>

                                                <div style="display: none">
                                                    <label>FDR less than</label>
                                                    <select id="cell_markerDE_barplot_FDR" style="width:200px;">
                                                        <option value="0.001">0.001</option>
                                                        <option value="0.01">0.01</option>
                                                        <option value="0.05" selected>0.05</option>
                                                    </select>
                                                </div>
                                                <div style="margin-left: 20px;display: table">
                                                    <div style="display: table-cell;vertical-align: middle">
                                                        <input type="checkbox" class="switch switch4" style="margin-right: 10px">Rank by highly expressed ratio
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <div style="display: flex;justify-content: center;margin: 10px 0">
                                                    <p id="warn" style="display: none;font-size: 25px">No results</p>
                                                </div>
                                                <div>
                                                    <div id="cell_markerDE_barplot" style="height: 300px;margin:0 auto">

                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <a data-toggle="collapse" class="details" href="#DE_bar_table" style="text-decoration: none;">
                                                    <i style="display: inline" class="icon ion-plus-round"></i>
                                                    <span style="display: inline">Show details</span>
                                                </a>
                                            </div>
                                            <div id="DE_bar_table" class="collapse" style="margin-top: 20px;overflow: auto;">
                                                <div style="width: 95%;">
                                                    <table style="width:100%" class="table table-striped table-hover" id="cell_marker_DE_bar_table">
                                                        <thead>
                                                        <tr>
                                                            <th>Cell type</th>
                                                            <th>No. of total samples (E)</th>
                                                            <th>No. of highly expressed samples (HE, FDR<0.05)</th>
                                                            <th>Highly expressed ratio (HE/E)</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        </tbody>

                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="border-top: 1px solid rgba(34,36,38,.15);margin-top: 30px">
                                            <div style="margin-top: 15px">
                                                <div style="display: none">
                                                    <label>FDR less than</label>
                                                    <select id="cell_markerDE_fdr" style="width: 200px;">
                                                        <option value="0.05">0.05</option>
                                                        <option value="0.01">0.01</option>
                                                        <option value="0.001">0.001</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <div id="cell_markerDE_plot" style="height: 300px;margin:0 auto">

                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div>
                                            <a data-toggle="collapse" class="details" href="#DE_table" style="text-decoration: none;">
                                                <i style="display: inline" class="icon ion-plus-round"></i>
                                                <span style="display: inline">Show details</span>
                                            </a>
                                        </div>
                                        <div id="DE_table" class="collapse" style="margin-top: 20px;overflow: auto;">
                                            <div style="width: 95%;">
                                                <table style="width:100%" class="table table-striped table-hover" id="cell_marker_DE_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Species</th>

                                                        <th>Sample</th>
                                                        <th>Condition</th>
                                                        <th>Cell type</th>
                                                        <th>log2FC</th>
                                                        <th>
                                                            Pct.cell type
                                                            <div class="wrapper" style="height: 18px">
                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The expression percentage of this gene in this cell type
                                                    </span>
                                                            </div>
                                                        </th>
                                                        <th>
                                                            Pct.others
                                                            <div class="wrapper" style="height: 18px">
                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The expression percentage of this gene in other cell types
                                                    </span>
                                                            </div>
                                                        </th>
                                                        <th>P value</th>

                                                        <th>FDR</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                    <div style="border-top: 1px solid rgba(34,36,38,.15);margin-top: 30px">
                                        <div style="margin-top: 15px">

                                            <div>
                                                <div>
                                                    <p id="ss_tag" style="display: none">No results</p>
                                                </div>
                                                <div id="cell_marker_ss_plot" style="height: 300px;margin:0 auto">

                                                </div>
                                            </div>
                                        </div>

                                    </div>


                                    <div>
                                        <a data-toggle="collapse" class="details" href="#table2" style="text-decoration: none">
                                            <i class="icon ion-plus-round" style="display: inline"></i>
                                            <span style="display: inline">Show details</span>
                                        </a>
                                    </div>
                                    <div id="table2" class="collapse" style="margin-top: 20px;overflow: auto">
                                        <div style="width: 95%">
                                            <table style="width:100%" class="table table-hover table-striped" id="cell_marker_se_table">
                                                <thead>
                                                <tr>
                                                    <th>Species</th>
                                                    <th>Sample</th>
                                                    <th>Condition</th>
                                                    <th>Cell type</th>
                                                    <th>
                                                        Specificity score
                                                        <div class="wrapper" style="height: 18px">
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                            Jensen-Shannon (JS) divergence score (0-1) is calculated to quantify the cell type specificity of one cell marker (Cabili MN et al., 2011 ).
                                                        </span>
                                                        </div>
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>

                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="mypanel">
                        <div class="mypanel-body" id="detail9" style="margin-top:10px;padding: 10px 20px 20px 20px">

                            <div>
                                <div  class="table-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#cell_similarity_species">
                                        <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                        <span style="font-size:20px;font-weight: 700;" id="cell_marker_comparison_across_species/">Cell marker comparison across species</span>
                                        <div class="wrapper" >
                                            <i class="icon ion-help-circled" style="line-height: 8px;font-size: 20px"></i>
                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                This panel compares marker composition of cell types across species. The cell markers and their orthologous genes which are also reported as cell markers for the same cell type are shown.
                                            </span>
                                        </div>
                                    </a>
                                </div>
                                <div id="cell_similarity_species" class="collapse in" >
                                    <div>
                                        <div>
                                            <label>Tissue</label>
                                            <select  id="cell_similarity_species_tissue_select" style="width: 200px;">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>

                                    </div>

                                    <div style="padding:0 1.5rem;overflow: auto">
                                        <div style="width: 95%">
                                            <table id="common_table" class="table table-hover table-striped" style="table-layout: fixed" >
                                                <thead>
                                                <tr>
                                                    <th colspan="5" style="text-align: center;font-size: 15px">Ortholog</th>
                                                </tr>
                                                <tr>
                                                    <th>Species</th>
                                                    <th>Cell type</th>
                                                    <th>Cell marker</th>
                                                    <th>ENTREZ ID</th>
                                                    <th>No. of publications</th>
                                                </tr>
                                                </thead>
                                                <tbody>

                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mypanel">
                        <div class="mypanel-body" id="detail11" style="margin-top:10px;padding: 10px 20px 20px 20px">

                            <div>
                                <div  class="table-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#cell_surface_marker_region">
                                        <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                        <span style="font-size:20px;font-weight: 700;" id="cell_surface_marker/">Cell surface marker</span>
                                        <div class="wrapper" >
                                            <i class="icon ion-help-circled" style="line-height: 8px;font-size: 20px"></i>
                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the cell surface markers predicted to have a membrane-bound protein product.
                                        </span>
                                        </div>
                                    </a>
                                </div>
                                <div id="cell_surface_marker_region" class="collapse in" style="overflow: auto">

                                    <div style="width: 95%">
                                        <table id="cell_surface_marker_table" class="table table-hover table-striped" style="table-layout: fixed">
                                            <thead>
                                            <tr>
                                                <th>Species</th>
                                                <th>Evidence</th>
                                                <th>Antibody</th>
                                                <th>Protein class</th>
                                            </tr>

                                            </thead>
                                            <tbody>
                                            </tbody>

                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
        function sortORasc(a,b){
            return b.OR2-a.OR2
        }
        var barplot_ytick;

        function getbarplot(id,data,title,xtitle,ytitle,name,value){

            var plotwidth=$("#width").width();
            $("#"+id).css("width","900px")
            title=title.replace(/ [a-z][a-z] All/g,"")

            data=data.slice(0,30)

            if(name=="Tissue_standard"){
                barplot_ytick=unpack(data.sort(sortTELS),name)
            }
            else{
                barplot_ytick=unpack(data.sort(sortLS),name)
            }

            var xtick_length=0
            barplot_ytick.map(function(e){
                if(xtick_length<e.length){
                    xtick_length=e.length
                }
            })
            if(xtick_length>40){
                $("#"+id).css('height',"500px")
            }
            else if(xtick_length>30){
                $("#"+id).css('height',"400px")
            }
            else{
                $("#"+id).css('height',"300px")

            }

            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom,null,{renderer:'svg'});
            myChart.resize()
            var app = {};


            var datas=[];
            var a={}
            a.name="No. of publications"
            a.type="bar"
            a.markPoint={}
            a.markPoint.data=[]
            a.itemStyle={}
            a.itemStyle.borderRadius=[5,5,0,0]
            a.markPoint.silent=true
            a.markPoint.itemStyle={}
            a.markPoint.itemStyle.color="transparent"
            a.markPoint.label={}
            a.markPoint.label.color="black"
            a.markPoint.label.offset=[0,20]
            var tempdata= new Array(barplot_ytick.length)
            for (var j=0;j<data.length;j++){
                tempdata[$.inArray(data[j][name],barplot_ytick)]=data[j][value]*1
                if(data[j].FDR<0.001){
                    a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"***"})
                }
                else if(data[j].FDR<0.01 && data[j].FDR>0.001){
                    a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"**"})
                }
                else if(data[j].FDR<0.05 && data[j].FDR>0.01){
                    a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"*"})
                }
            }
            a.data=tempdata
            datas.push(a)


            var option;
            option = {
                color:{
                    type: 'linear',
                    x: 0,
                    y: 0,
                    x2: 0,
                    y2: 1,
                    colorStops: [{
                        offset: 0, color: '#8bc6ec' // 0% 处的颜色
                    }, {
                        offset: 1, color: '#9599e2' // 100% 处的颜色
                    }],
                    global: false // 缺省为 false
                },
                title:{
                    text:title,
                    left:'center',
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:15
                    }
                },
                toolbox:{
                    show:true,
                    feature:{
                        saveAsImage:{
                            type:'svg'
                        }
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name:xtitle,

                        nameTextStyle:{
                            fontWeight:'bold',
                            fontSize:12,
                            fontFamily:"Arial"
                        },
                        axisLabel:{
                            fontSize:11,
                            fontFamily:"Arial"
                        },
                        position: 'left',
                        minInterval: 1
                    }
                ],
                tooltip:{},
                grid:{
                    width:"85%",
                    height:"40%",
                    right:"8%",
                    top:"15%"
                },
                xAxis: {
                    type: 'category',
                    name:"Cell type",
                    data: barplot_ytick,
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"

                    },

                    axisLabel:{
                        rotate:45,
                        fontSize:11,
                        fontFamily:"Arial"

                    }
                },
                series: datas
            };
            if(xtick_length>40){
                option.grid.height='40%'
            }
            else if(xtick_length>30){
                option.grid.height='50%'
            }

            if(barplot_ytick.length<5){
                option.series[0].barWidth='10%'
            }
            else{
                option.series[0].barWidth='50%'

            }
            option && myChart.setOption(option);
        }
        function getboxplot(id,results){
            var plotwidth=$("#detail8").width();
            $("#"+id).css("width","900px")

            var xtick=unpack(results,"Cell_standard")

            var xtick_length=0
            xtick.map(function(e){
                if(xtick_length<e.length){
                    xtick_length=e.length
                }
            })
            if(xtick_length>30){
                $("#"+id).css('height',"450px")
            }
            else if(xtick_length>20){
                $("#"+id).css('height',"300px")
            }
            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom,null,{renderer:'svg'});
            var option;

            var datas=[
                ["Cell_standard","Score"]
            ]
            results.map(function(e){
                datas.push([e.Cell_standard,(e.avg_log2FC*1).toPrecision(2)])
            })

            echarts.registerTransform(window.ecSimpleTransform.aggregate);

            option = {
                color:["#9599e2"],
                dataset: [
                    {
                        id:"raw",
                        source:datas
                    },
                    {
                        id:"aggregate",
                        fromDatasetId:"raw",
                        transform:
                            [
                                {
                                    type: 'ecSimpleTransform:aggregate',
                                    config: {
                                        resultDimensions: [
                                            { name: 'Min', from: 'Score', method: 'min' },
                                            { name: 'Q1', from: 'Score', method: 'Q1' },
                                            { name: 'Median', from: 'Score', method: 'median' },
                                            { name: 'Q3', from: 'Score', method: 'Q3' },
                                            { name: 'Max', from: 'Score', method: 'max' },
                                            { name: 'Cell_standard', from: 'Cell_standard' }
                                        ],
                                        groupBy: 'Cell_standard'
                                    }
                                },
                                {
                                    type: 'sort',
                                    config: {
                                        dimension: 'Median',
                                        order: 'desc'
                                    }
                                }
                            ]
                    },
                ],
                toolbox:{
                    show:true,
                    feature:{
                        saveAsImage:{
                            type:'svg'
                        }
                    }
                },
                legend: {
                    show:false,
                    top: '10%'
                },
                title:{
                    text:"Expression fold-change of "+[[${markername}]]+" between one cell type and others across samples",
                    right:'center',
                    textStyle:{
                        fontFamily:'Arial',
                        fontSize:15
                    }
                },
                tooltip: {
                    trigger: 'item',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '6%',
                    right: '5%',
                    height:'40%'
                },
                xAxis: {
                    type: 'category',
                    axisLabel:{
                        interval:0,
                        rotate: 60,
                        fontFamily:'Arial',
                        fontSize:11

                    },
                    boundaryGap: true,

                    splitLine: {
                        show: false
                    }
                },
                dataZoom:{
                    type:"slider",
                    show:false,
                    endValue:19

                },
                yAxis: {
                    type: 'value',
                    name: 'log2FC',
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontFamily:"Arial"
                    },
                    splitArea: {
                        show: true,
                        areaStyle:{
                            color:["#ffffff","#f7fdff"]
                        }
                    },
                    splitLine:{
                        show:false
                    },
                },
                series: [
                    {
                        name: 'log2FC',
                        type: 'boxplot',
                        datasetId: "aggregate",
                        encode: {
                            y: ['Min', 'Q1', 'Median', 'Q3', 'Max'],
                            x: 'Tissue',
                            itemName: ['Tissue'],
                            tooltip: ['Max', 'Q3', 'Median', 'Q1', 'Min']
                        }
                    }
                ]
            };
            if($(window).width()>1400){
            }
            else if($(window).width()>1024){
                option.grid.left="10%"

            }
            else{

            }
            option && myChart.setOption(option);
        }
        function getboxplot2(id,results){
            var plotwidth=$("#detail8").width();
            $("#"+id).css("width","900px")

            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom);
            var option;

            var marker=$.unique(unpack(results,"Cell_standard").sort());
            var tissue=$.unique(unpack(results,"Tissue").sort());
            var title;
            if(id.indexOf("_SRS")>=0){
                title=id.split("_")[1]
            }
            else{
                title=id
            }
            function makeData() {
                var data = [];
                var datas=[];
                for(var t=0;t<tissue.length;t++){
                    data=[];

                    for (var i = 0; i < marker.length; i++) {

                        var result;
                        result=eval(results).filter(function(e){
                            return e.Cell_standard===marker[i]
                        });
                        result=eval(result).filter(function(e){
                            return e.Tissue===tissue[t]
                        });
                        if (result.length==0){
                            data.push([]);
                        }
                        else{
                            data.push([result[0].Max.toPrecision(2),result[0].Min.toPrecision(2),result[0].Q1.toPrecision(2),result[0].Q2.toPrecision(2),result[0].Q3.toPrecision(2)]);
                        }

                    }
                    datas.push(data);
                }
                return datas;
            }
            var datas = makeData();

            var dataset=[];
            var series=[];
            for (var i=0;i<datas.length;i++){
                dataset.push(
                    {
                        dimension:['Max','Min','Q1','Q2','Q3'],
                        source:datas[i]
                    }
                );
            }
            for(i=0;i<datas.length;i++){
                dataset.push({
                    fromDatasetIndex: i,
                    transform: [
                        {
                            type: 'boxplot',
                            config:{
                                itemNameFormatter:function(params){
                                    return marker[params.value]
                                }
                            }
                        },
                        {
                            type:'sort',
                            config:{dimension:'Q2',order:'desc'}
                        }
                    ]
                })
            }
            for(i=0;i<datas.length;i++){
                series.push(
                    {
                        name: tissue[i],
                        type: 'boxplot',
                        datasetIndex: i+datas.length
                    }
                )
            }



            option = {
                dataset: [],
                legend: {
                    top: '10%'
                },
                title:{
                    text:title,
                    right:'center',
                    fontFamily:'Arial'
                },
                tooltip: {
                    trigger: 'item',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter:function(params){
                        return `
                            Cell type: ${params.data[0]}<br/>
                            Max: ${params.data[5].toPrecision(2)}<br/>
                            Q3: ${params.data[4].toPrecision(2)}<br/>
                            Median: ${params.data[3].toPrecision(2)}<br/>
                            Q1: ${params.data[2].toPrecision(2)}<br/>
                            Min: ${params.data[1].toPrecision(2)}<br/>
                            `
                    }
                },
                grid: {
                    left: '10%',
                    top: '20%',
                    right: '10%',
                    bottom: '15%',
                    height:'60%'
                },
                xAxis: {
                    type: 'category',
                    axisLabel:{
                        interval:0,
                        rotate: 10,

                    },
                    name:'Cell type',
                    boundaryGap: true,
                    nameGap: 30,
                    splitArea: {
                        show: true
                    },
                    splitLine: {
                        show: false
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'TPM or CPM',
                    splitArea: {
                        show: false
                    }
                },

                series: []
            };
            option.dataset=dataset;
            option.series=series;

            option && myChart.setOption(option);
        }
        function getbarplotDE(id,data){
            var plotwidth=$("#detail8").width();
            var title=""

            $("#"+id).css("width","900px")
            var xtick=unpack(data["result"],"CT_ID")
            var cell_name=[]
            var xtick_length=0
            xtick.map(function(e){
                var temp=eval(data["total"]).filter(function(f){
                    return f.Cell_id==e
                })
                cell_name.push(temp[0].Cell_standard)

                if(xtick_length<temp[0].Cell_standard.length){
                    xtick_length=temp[0].Cell_standard.length
                }
            })
            if(xtick_length>30){
                $("#"+id).css('height',"500px")
            }
            else if(xtick_length>20){
                $("#"+id).css('height',"400px")
            }

            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom,null,{renderer:'svg'});

            var total=[]
            for(var i=0;i<xtick.length;i++){
                var temp=eval(data["total"]).filter(function(e){
                    return e.Cell_id==xtick[i]

                })
                total.push(
                    temp[0].counts
                )
            }

            var app = {};


            var ratio=[]
            var counts=unpack(data['result'],"counts")

            for(var i=0;i<xtick.length;i++){
                ratio.push((counts[i]/total[i]).toPrecision(2))
            }

            data=[]
            for(var i=0;i<xtick.length;i++){
                data.push(
                    {"total":total[i],"ratio":ratio[i],"counts":counts[i],"marker":cell_name[i],'Gene_id':xtick[i]}
                )
            }
            $("#cell_marker_DE_bar_table").DataTable({
                data:data,
                columns:
                    [
                        {
                            data:"marker",
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/celltype/"+row.Gene_id+"'>"+data+"</a>"
                            }
                        },
                        {data:"total"},
                        {data:"counts"},
                        {data:"ratio"}
                    ],
                destroy:true,
                iDisplayLength:5,
                dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                order:[2,"desc"]

            })


            var option;
            option = {
                color:["#8bc6ec",'#9599e2',"#FAC858"],
                title:{
                    text:"Highly expressed ratio of "+[[${markername}]],
                    left:'center',
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:15
                    }
                },
                toolbox:{
                    show:true,
                    feature:{
                        saveAsImage:{
                            type:'svg'
                        }
                    }
                },
                legend: {
                    right:'center',
                    top:'30',
                    data:["Highly expressed samples (HE, FDR less than 0.05)","Total samples (E)","Highly expressed ratio (HE/E)"],
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:11
                    },
                    width:"90%"
                },
                yAxis: [

                    {
                        type: 'value',
                        name:"Ratio",
                        axisLabel:{
                            fontFamily:"Arial",
                            fontSize:11
                        },
                        nameTextStyle:{
                            fontWeight:'bold',
                            fontSize:12,
                            fontFamily:"Arial",
                            align:"left"
                        },
                        min:0,
                        max:1
                    },
                    {
                        type: 'value',
                        name:"Number of samples",

                        nameTextStyle:{
                            fontWeight:'bold',
                            fontSize:12,
                            fontFamily:"Arial"
                        },
                        axisLabel:{
                            fontFamily:"Arial",
                            fontSize:11
                        },
                        alignTicks:true

                    }

                ],
                tooltip:{},
                grid:{
                    height:"40%",
                    right:"10%",
                    left:'6%',
                    top:'100'

                },
                xAxis: {
                    type: 'category',
                    // name:"Marker",
                    data: cell_name,
                    // nameTextStyle:{
                    //     fontWeight:'bold',
                    //     fontSize:11,
                    //     fontFamily:"Arial",
                    //
                    // },
                    // nameGap:30,
                    axisLabel:{
                        rotate:45,
                        fontFamily:"Arial",
                        fontSize:11
                    }
                },
                series: [
                    {
                        name:"Highly expressed samples (HE, FDR less than 0.05)",
                        type:"bar",
                        yAxisIndex:1,
                        data:unpack(data,"counts")


                    },
                    {
                        name:"Total samples (E)",
                        type:"bar",
                        yAxisIndex:1,
                        data:total
                    },
                    {
                        name:"Highly expressed ratio (HE/E)",
                        type:"scatter",
                        data:ratio
                    }
                ]
            };

            if($(window).width()>1400){
            }
            else if($(window).width()>1024){
                option.grid.left="10%"

            }
            else{

            }
            option && myChart.setOption(option);
        }
        function getbarplotDE2(id,data){
            var plotwidth=$("#detail8").width();
            var title=""

            $("#"+id).css("width","900px")
            var xtick=unpack(data["result"],"CT_ID")
            var cell_name=[]
            var xtick_length=0
            xtick.map(function(e){
                var temp=eval(data["total"]).filter(function(f){
                    return f.Cell_id==e
                })
                cell_name.push(temp[0].Cell_standard)

                if(xtick_length<temp[0].Cell_standard.length){
                    xtick_length=temp[0].Cell_standard.length
                }
            })
            if(xtick_length>30){
                $("#"+id).css('height',"500px")
            }
            else if(xtick_length>20){
                $("#"+id).css('height',"400px")
            }

            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom,null,{renderer:'svg'});

            var total=[]
            for(var i=0;i<xtick.length;i++){
                var temp=eval(data["total"]).filter(function(e){
                    return e.Cell_id==xtick[i]

                })
                total.push(
                    temp[0].counts
                )
            }

            var app = {};


            var ratio=[]
            var counts=unpack(data['result'],"counts")

            for(var i=0;i<xtick.length;i++){
                ratio.push((counts[i]/total[i]).toPrecision(2))
            }

            data=[]
            for(var i=0;i<xtick.length;i++){
                data.push(
                    {"total":total[i],"ratio":ratio[i],"counts":counts[i],"marker":cell_name[i],'Gene_id':xtick[i]}
                )
            }

            function sortDEratio(a,b){
                return b.ratio-a.ratio
            }
            data.sort(sortDEratio)

            $("#cell_marker_DE_bar_table").DataTable({
                data:data,
                columns:
                    [
                        {
                            data:"marker",
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/celltype/"+row.Gene_id+"'>"+data+"</a>"
                            }
                        },
                        {data:"total"},
                        {data:"counts"},
                        {data:"ratio"}
                    ],
                destroy:true,
                iDisplayLength:5,
                dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                order:[2,"desc"]

            })


            var option;
            option = {
                color:["#8bc6ec",'#9599e2',"#FAC858"],
                title:{
                    text:"Highly expressed ratio of "+[[${markername}]],
                    left:'center',
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:15
                    }
                },
                toolbox:{
                    show:true,
                    feature:{
                        saveAsImage:{
                            type:'svg'
                        }
                    }
                },
                legend: {
                    right:'center',
                    top:'30',
                    data:["Highly expressed samples (HE, FDR less than 0.05)","Total samples (E)","Highly expressed ratio (HE/E)"],
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:11
                    },
                    width:"90%"
                },
                yAxis: [

                    {
                        type: 'value',
                        name:"Ratio",
                        axisLabel:{
                            fontFamily:"Arial",
                            fontSize:11
                        },
                        nameTextStyle:{
                            fontWeight:'bold',
                            fontSize:12,
                            fontFamily:"Arial",
                            align:"left"
                        },
                        min:0,
                        max:1
                    },
                    {
                        type: 'value',
                        name:"Number of samples",

                        nameTextStyle:{
                            fontWeight:'bold',
                            fontSize:12,
                            fontFamily:"Arial"
                        },
                        axisLabel:{
                            fontFamily:"Arial",
                            fontSize:11
                        },
                        alignTicks:true

                    }

                ],
                tooltip:{},
                grid:{
                    height:"40%",
                    right:"10%",
                    left:'6%',
                    top:'100'

                },
                xAxis: {
                    type: 'category',
                    // name:"Marker",
                    data: unpack(data,"marker"),
                    // nameTextStyle:{
                    //     fontWeight:'bold',
                    //     fontSize:11,
                    //     fontFamily:"Arial",
                    //
                    // },
                    // nameGap:30,
                    axisLabel:{
                        rotate:45,
                        fontFamily:"Arial",
                        fontSize:11
                    }
                },
                series: [
                    {
                        name:"Highly expressed samples (HE, FDR less than 0.05)",
                        type:"bar",
                        yAxisIndex:1,
                        data:unpack(data,"counts")


                    },
                    {
                        name:"Total samples (E)",
                        type:"bar",
                        yAxisIndex:1,
                        data:unpack(data,"total")
                    },
                    {
                        name:"Highly expressed ratio (HE/E)",
                        type:"scatter",
                        data:unpack(data,"ratio")
                    }
                ]
            };

            if($(window).width()>1400){
            }
            else if($(window).width()>1024){
                option.grid.left="10%"

            }
            else{

            }
            option && myChart.setOption(option);
        }
        function getboxplotSS(id,results){
            var plotwidth=$("#detail8").width();
            $("#"+id).css("width","900px")

            var xtick=$.unique(unpack(results,"Cell_standard").sort())
            var xtick_length=0
            xtick.map(function(e){
                if(xtick_length<e.length){
                    xtick_length=e.length
                }
            })
            if(xtick_length>30){
                $("#"+id).css('height',"400px")
            }
            else if(xtick_length>20){
                $("#"+id).css('height',"300px")
            }

            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom,null,{renderer:'svg'});
            var option;

            var tissue=$.unique(unpack(results,"Tissue").sort());
            var datas=[
                ["Cell_standard","Score"]
            ]
            results.map(function(e){
                datas.push([e.Cell_standard,(e.Cell_specific_score*1).toPrecision(2)])
            })

            echarts.registerTransform(window.ecSimpleTransform.aggregate);

            option = {
                color:["#9599e2"],
                toolbox:{
                    show:true,
                    feature:{
                        saveAsImage:{
                            type:'svg'
                        }
                    }
                },
                dataset: [
                    {
                        id:"raw",
                        source:datas
                    },
                    {
                        id:"aggregate",
                        fromDatasetId:"raw",
                        transform:
                            [
                                {
                                    type: 'ecSimpleTransform:aggregate',
                                    config: {
                                        resultDimensions: [
                                            { name: 'Min', from: 'Score', method: 'min' },
                                            { name: 'Q1', from: 'Score', method: 'Q1' },
                                            { name: 'Median', from: 'Score', method: 'median' },
                                            { name: 'Q3', from: 'Score', method: 'Q3' },
                                            { name: 'Max', from: 'Score', method: 'max' },
                                            { name: 'Cell_standard', from: 'Cell_standard' }
                                        ],
                                        groupBy: 'Cell_standard'
                                    }
                                },
                                {
                                    type: 'sort',
                                    config: {
                                        dimension: 'Median',
                                        order: 'desc'
                                    }
                                }
                            ]
                    },
                ],
                legend: {
                    show:false,
                    top: '10%'
                },
                title:{
                    text:[[${markername}]]+" expression specificity in cell types across samples",
                    right:'center',
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:15
                    }
                },
                tooltip: {
                    trigger: 'item',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '7%',
                    right: '5%',
                    height:'40%'
                },
                xAxis: {
                    type: 'category',
                    axisLabel:{
                        interval:0,
                        rotate: 45,
                        fontFamily:"Arial",
                        fontSize:11

                    },
                    boundaryGap: true,
                    splitLine: {
                        show: false
                    }
                },
                dataZoom:{
                    type:"slider",
                    show:false,
                    endValue:19
                },
                yAxis: {
                    type: 'value',
                    name: 'Cell specificity score',
                    nameTextStyle:{
                        fontFamily:"Arila",
                        fontSize:11,
                        fontWeight:'bold'
                    },
                    axisLabel:{
                        fontFamily:"Arial",
                        fontSize:11

                    },
                    splitArea: {
                        show: true,
                        areaStyle:{
                            color:["#ffffff","#f7fdff"]
                        }
                    },
                    splitLine:{
                        show:false
                    },
                    max:1,
                    min:0
                },
                series: [
                    {
                        name: 'Cell specificity score',
                        type: 'boxplot',
                        datasetId: "aggregate",
                        encode: {
                            y: ['Min', 'Q1', 'Median', 'Q3', 'Max'],
                            x: 'Tissue',
                            itemName: ['Tissue'],
                            tooltip: ['Max', 'Q3', 'Median', 'Q1', 'Min']
                        }
                    }
                ]
            };
            if($(window).width()>1400){
            }
            else if($(window).width()>1024){
                option.grid.left="10%"

            }
            else{

            }
            option && myChart.setOption(option);
        }


        function getecharts(id,xtick,ytick,data,title,xtitle,ytitle){
            var plotwidth=$("#width").width();
            $("#"+id).css("width","900px")
            var ytick_length=0
            ytick.map(function(e){
                if(ytick_length<e.length){
                    ytick_length=e.length
                }
            })
            var xtick_length=0
            xtick.map(function(e){
                if(xtick_length<e.length){
                    xtick_length=e.length
                }
            })
            if(xtick_length>40){
                $("#"+id).css('height',"800px")
            }
            else if(xtick_length>30){
                $("#"+id).css('height',"700px")
            }
            var chartDom = document.getElementById(id);
            var myChart = echarts.init(chartDom,null,{renderer:'svg'});
            var app = {};
            title=title.replace(/ [a-z][a-z] All/g,"")

            var option;
            var max_legend=0;
            for(i=0;i<data.length;i++){

                max_legend=Math.max(data[i][2],max_legend)
            }
            data = data.map(function (item) {
                return [item[0], item[1], item[2] || '-'];
            });

            option = {
                title:{
                    text:title,
                    right:'center',
                    textStyle:{
                        fontSize:15,
                        fontFamily:"Arial"
                    }
                },
                tooltip: {
                    trigger:'item',
                    axisPointer:{
                        type:"cross"
                    },
                    position: 'top',
                },
                toolbox:{
                    show:true,
                    feature:{
                        saveAsImage:{
                            type:'svg'
                        }
                    }
                },
                grid:{
                    height:'30%',
                    right:"7%",
                    left:"12%",
                    top:'30%',
                },
                xAxis: {
                    type: 'category',
                    data: xtick,
                    splitArea: {
                        show: true
                    },
                    axisTick:{
                        show:false
                    },
                    axisLabel:{
                        interval:0,
                        rotate: 90,
                        fontSize:11,
                        fontFamily: "Arial"

                    },
                    name:xtitle,
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily: "Arial"

                    },
                },
                yAxis: {
                    type: 'category',
                    data: ytick,
                    splitArea: {
                        show: true
                    },
                    axisTick:{
                      show:false,

                    },
                    axisLabel:{
                        interval:0,
                        fontFamily: "Arial",
                        fontSize:11,
                    },
                    name:ytitle,
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily: "Arial"
                    },


                },
                label:{
                    fontFamily:"Arial",
                    fontSize:10
                },
                visualMap: {
                    min: 0,
                    max:max_legend,
                    calculable: true,
                    right: '0',
                    top:'5%',
                    show:true,
                    inRange:{
                        color:["#d8eafc","#82c2ec","#b0b6fa","#9599e2"]
                    }
                },
                series: [{
                    type: 'heatmap',
                    data: data,
                    label: {
                        show: true,
                        fontSize:10
                    },
                    itemStyle:{
                        borderColor:"Black",
                        borderWidth:0.3
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            if(ytick.length>5){
                option.grid.height='60%'
                option.grid.top='10%'

            }
            if(ytick_length>35){
                option.grid.left='27%'

            }
            else if(ytick_length>30){
                option.grid.left='20%'
            }
            if (option && typeof option === 'object') {
                myChart.setOption(option);
            }
        }
        function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; });
        }
        function cteLS(data){
            var results=data;

            var newdata=[];
            for(i=0;i<results.length;i++){
                if($.inArray(results[i].Cell_standard,barplot_ytick)>=0){
                    newdata.push(results[i])
                }
            }
            results=newdata;
            var n=0;
            var len=barplot_ytick.length;
            for(i=0;i<len;i++){
                var temp=eval(results).filter(function(e){
                    return e.Cell_standard==barplot_ytick[i-n]
                });
                if(temp.length==0){
                    barplot_ytick.splice(i-n,1)
                    n+=1
                }

            }
            var y=barplot_ytick.reverse();


            var x=$.unique(unpack(results, 'Tissue_standard').sort());

            var z = new Array();

            for (i=0;i<results.length;i++){
                z.push([$.inArray(results[i].Tissue_standard,x),$.inArray(results[i].Cell_standard,y),results[i].supported_paper_number])

            }
            if(y.length<=5){
                $("#cell_tissue_enrichment_LS_heatmap").css('height',"300px")
            }
            getecharts("cell_tissue_enrichment_LS_heatmap",x,y,z,[[${markername}]]+": number of supported publications in tissues","Tissue","Cell type")
        }
        var cell_list=[];
        var DE;
        var DE_plot;
        var DE_bar;
        var DE_score;
        var summary_celltype=""
        var cell_id_list=[];
        $(document).ready(function() {
            $.ajax({
                url:"/celltaxonomy/cell_type_enrichment",
                type:"post",
                dataType:'json',
                data:{
                    marker:[[${markerid}]],
                },
                success:function(results){
                    if(results.length>0){
                        var tissue=$.unique(unpack(results,"Tissue_standard").sort())
                        tissue.map(function(e){
                            if(e=="All"){
                                $("#cell_tissue_enrichment_select optgroup").eq(1).append(
                                    "<option value='All'>All</option>"
                                )
                            }
                            else{
                                $("#cell_tissue_enrichment_select optgroup").eq(0).append(
                                    "<option value='"+e+"'>"+e+"</option>"
                                )
                            }

                        })
                        $("#cell_tissue_enrichment_select").find("option").eq(-1).attr("selected",true)


                        results=eval(results).filter(function(e){
                            return e.Tissue_standard==$("#cell_tissue_enrichment_select").val()
                        })
                        getbarplot("cell_enrichment_literature_support",results,[[${markername}]]+": number of supported publications","No. of publications","","Cell_standard","supported_paper_number")

                        var data=results.slice(0,30)
                        cell_list=$.unique(unpack(data,"Cell_standard").sort())
                        cell_id_list=$.unique(unpack(data,"CT_ID").sort())

                        $.ajax({
                            url:"/celltaxonomy/marker_cell_markerDE_bar",
                            type:"post",
                            dataType:'json',

                            data:{
                                "marker":[[${markerid}]],
                                "tissue":"All",
                                "threshold":"0.25",
                                "fdr":$("#cell_markerDE_barplot_FDR").val()
                            },
                            success:function(data){
                                if(data.length==0){

                                }
                                else{
                                    DE_bar=data
                                    var results={}
                                    var de=0
                                    var ee=0
                                    results["result"]=eval(data["result"]).filter(function(e){
                                        if(e.Cell_standard===summary_celltype){
                                            de=e.counts*1
                                        }
                                        return cell_id_list.indexOf(e.CT_ID)>=0
                                    })
                                    results["total"]=eval(data["total"]).filter(function(e){
                                        if(e.Cell_standard===summary_celltype){
                                            ee=e.counts*1
                                        }
                                        return cell_id_list.indexOf(e.Cell_id)>=0
                                    })

                                    if(results["result"].length>0){
                                        getbarplotDE("cell_markerDE_barplot",results)
                                    }
                                    else{
                                        $("input[type='checkbox'].switch2").attr("checked",false)
                                        $("input[type='checkbox'].switch2").attr("disabled","disabled")
                                        getbarplotDE("cell_markerDE_barplot",data)
                                    }

                                }

                            }
                        });
                        $.ajax({
                            url:"/celltaxonomy/marker_cell_markerDE",
                            type:"post",
                            dataType:'json',
                            data:{
                                "marker":[[${markerid}]]
                            },
                            success:function(result) {

                                var results=result['plot']

                                if(results.length==0){
                                    $("#detail8").css("display","none")
                                }
                                else{
                                    DE_plot=results
                                    var temp=eval(results).filter(function(e){
                                        return cell_id_list.indexOf(e.CT_ID)>=0
                                    })

                                    if(temp.length>0){

                                        DE=temp
                                        var temp2=eval(temp).filter(function(e){
                                            return e.p_val_adj*1<$("#cell_markerDE_fdr").val()*1
                                        })

                                        getboxplot("cell_markerDE_plot",temp2)
                                        $("#cell_marker_DE_table").DataTable({
                                            data:temp,
                                            columns:
                                                [
                                                    {data:"Species"},

                                                    {
                                                        data:"ID",
                                                        render:function(data,type,row){
                                                            if(data.indexOf("_SRS")>=0){
                                                                if(row.PubmedID.indexOf("doi")>=0){
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data.split("_")[1]+'</a>'

                                                                }
                                                                else{
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data.split("_")[1]+'</a>'
                                                                }
                                                            }
                                                            else if (data.indexOf("_")>=0){
                                                                var name=data.split("_")
                                                                if(data.indexOf("Tabula")>=0){
                                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                                }
                                                                else{
                                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                                }
                                                            }
                                                            else{
                                                                if(row.PubmedID.indexOf("doi")>=0){
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data+'</a>'
                                                                }
                                                                else{
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data+'</a>'
                                                                }

                                                            }
                                                        }
                                                    },
                                                    {
                                                        data:"Conditions",
                                                        render:function(data,type,row){
                                                            if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                                                return data
                                                            }
                                                            else if(row.Condition_ID!="-"){
                                                                return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                                            }
                                                            else{
                                                                return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        data:"Cell_standard",
                                                        render:function(data,type,row){
                                                            if(row.CT_ID!="-" && row.CT_ID!=null && row.CT_ID!="NA"){
                                                                return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                                            }
                                                            else{
                                                                return data
                                                            }
                                                        }
                                                    },

                                                    {
                                                        data:"avg_log2FC",
                                                        render:function(data,type,row){
                                                            return (data*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"pct_1",
                                                        render:function(data,type,row){
                                                            return (row.pct_1*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"pct_2",
                                                        render:function(data,type,row){
                                                            return (row.pct_2*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"p_val",
                                                        render:function(data,type,row){
                                                            return (row.p_val*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"p_val_adj",
                                                        render:function(data,type,row){
                                                            return (row.p_val_adj*1).toPrecision(2)
                                                        }
                                                    },

                                                ],
                                            destroy:true,
                                            iDisplayLength:5,
                                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                                            order:[3,'desc']

                                        })
                                    }
                                    else{

                                        var temp2=eval(results).filter(function(e){
                                            return e.p_val_adj*1<$("#cell_markerDE_fdr").val()*1
                                        })

                                        getboxplot("cell_markerDE_plot",temp2)
                                        $("#cell_marker_DE_table").DataTable({
                                            data:temp2,
                                            columns:
                                                [
                                                    {data:"Species"},

                                                    {
                                                        data:"ID",
                                                        render:function(data,type,row){
                                                            if(data.indexOf("_SRS")>=0){
                                                                if(row.PubmedID.indexOf("doi")>=0){
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data.split("_")[1]+'</a>'

                                                                }
                                                                else{
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data.split("_")[1]+'</a>'
                                                                }
                                                            }
                                                            else if (data.indexOf("_")>=0){
                                                                var name=data.split("_")
                                                                if(data.indexOf("Tabula")>=0){
                                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                                }
                                                                else{
                                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                                }
                                                            }
                                                            else{
                                                                if(row.PubmedID.indexOf("doi")>=0){
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data+'</a>'
                                                                }
                                                                else{
                                                                    return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data+'</a>'
                                                                }

                                                            }
                                                        }
                                                    },
                                                    {
                                                        data:"Conditions",
                                                        render:function(data,type,row){
                                                            if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                                                return data
                                                            }
                                                            else if(row.Condition_ID!="-"){
                                                                return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                                            }
                                                            else{
                                                                return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                                            }
                                                        }
                                                    },
                                                    {
                                                        data:"Cell_standard",
                                                        render:function(data,type,row){
                                                            if(row.CT_ID!="-" && row.CT_ID!=null && row.CT_ID!="NA"){
                                                                return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                                            }
                                                            else{
                                                                return data
                                                            }
                                                        }
                                                    },

                                                    {
                                                        data:"avg_log2FC",
                                                        render:function(data,type,row){
                                                            return (data*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"pct_1",
                                                        render:function(data,type,row){
                                                            return (row.pct_1*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"pct_2",
                                                        render:function(data,type,row){
                                                            return (row.pct_2*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"p_val",
                                                        render:function(data,type,row){
                                                            return (row.p_val*1).toPrecision(2)
                                                        }
                                                    },
                                                    {
                                                        data:"p_val_adj",
                                                        render:function(data,type,row){
                                                            return (row.p_val_adj*1).toPrecision(2)
                                                        }
                                                    },

                                                ],
                                            destroy:true,
                                            iDisplayLength:5,
                                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                                            order:[3,'desc']

                                        })

                                    }


                                }



                            }
                        });
                        $.ajax({
                            url:"/celltaxonomy/marker_cell_ss",
                            type:"post",
                            data:{
                                marker:[[${markerid}]],
                                species:"All",
                                tissue:"All"
                            },
                            success:function(result){
                                var score=result["score"]
                                if (score.length==0){
                                    $("#cell_marker_ss_plot").parent().parent().parent().css("display","none")
                                    $("#cell_marker_ss_plot").parent().parent().parent().next().next().css("display","none")
                                    $("#cell_marker_ss_plot").parent().parent().parent().next().css("display","none")

                                }
                                else{
                                    DE_score=score
                                    var ss=[]
                                    var results=eval(score).filter(function(e){
                                        if(e.Cell_standard===summary_celltype){
                                            ss.push(e.Cell_specific_score)
                                        }
                                        return cell_id_list.indexOf(e.CT_ID)>=0
                                    })

                                    ss=ss.sort()

                                    if(results.length>0){
                                        $("#cell_marker_se_table").DataTable({
                                            data:results,
                                            columns:[
                                                {data:"Species"},
                                                {
                                                    data:"ID",
                                                    render:function(data,type,row){
                                                        if(data.indexOf("_SRS")>=0){
                                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                                        }
                                                        else if (data.indexOf("_")>=0){
                                                            var name=data.split("_")
                                                            if(data.indexOf("Tabula")>=0){
                                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                            }
                                                            else{
                                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                            }
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Conditions",
                                                    render:function(data,type,row){
                                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                                            return data
                                                        }
                                                        else if(row.Condition_ID!="-"){
                                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Cell_standard",
                                                    render:function(data,type,row){
                                                        if(row.CT_ID==null){
                                                            return data
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+data+"</a>"
                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Cell_specific_score",
                                                    render:function(data){
                                                        return (data*1).toPrecision(2)
                                                    }

                                                }
                                            ],
                                            destroy:true,
                                            iDisplayLength:5,
                                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                                            order:[3,"desc"]
                                        })
                                        getboxplotSS("cell_marker_ss_plot",results)
                                    }
                                    else{
                                        $("#cell_marker_se_table").DataTable({
                                            data:score,
                                            columns:[
                                                {data:"Species"},
                                                {
                                                    data:"ID",
                                                    render:function(data,type,row){
                                                        if(data.indexOf("_SRS")>=0){
                                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                                        }
                                                        else if (data.indexOf("_")>=0){
                                                            var name=data.split("_")
                                                            if(data.indexOf("Tabula")>=0){
                                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                            }
                                                            else{
                                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                            }
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Conditions",
                                                    render:function(data,type,row){
                                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                                            return data
                                                        }
                                                        else if(row.Condition_ID!="-"){
                                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Cell_standard",
                                                    render:function(data,type,row){
                                                        if(row.CT_ID==null){
                                                            return data
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+data+"</a>"
                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Cell_specific_score",
                                                    render:function(data){
                                                        return (data*1).toPrecision(2)
                                                    }

                                                }
                                            ],
                                            destroy:true,
                                            iDisplayLength:5,
                                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                                            order:[3,"desc"]
                                        })

                                        getboxplotSS("cell_marker_ss_plot",score)

                                    }

                                }

                            }
                        })

                    }
                    else{
                        $("#cell_tissue_enrichment").css("display","none")
                        $("#table1").addClass("in")
                        $("#table1").prev().css("display","none")
                    }



                },
                error:function(){
                    console.log("error")
                }
            });

            $.ajax({
                url:"/celltaxonomy/cell_tissue_enrichment",
                type:"post",
                dataType:'json',
                data:{
                    marker:$(".marker-description").find("span").text(),
                    entrezid:[[${markerid}]]
                },
                success:function(data){
                    var results=data["results"];
                    results=eval(results).filter(function(e){
                        return e.Tissue_standard!="All"
                    })
                    if(results.length==0){
                        $("#cell_tissue_enrichment_LS_heatmap").css("display","none")
                    }
                    else{
                        cteLS(results)
                    }







                },
                error:function(){
                    console.log("error")
                }
            });
            $.ajax({
                url:'/celltaxonomy/marker_table',
                type:'post',
                data:{
                  "marker":[[${markerid}]]
                },
                success:function(results){
                    var celltypes=$.unique(unpack(results,"Cell_standard").sort()).length
                    // $("#celltype_count").text(celltypes)

                    var conditions;
                    if($.unique(unpack(results,"Disease_Type").sort()).indexOf("-")>-1){
                        conditions=$.unique(unpack(results,"Disease_Type").sort()).length-1
                    }
                    else{
                        conditions=$.unique(unpack(results,"Disease_Type").sort()).length
                    }
                    var tissues;
                    if($.unique(unpack(results,"Tissue_standard").sort()).indexOf("-")>-1){
                        tissues=$.unique(unpack(results,"Tissue_standard").sort()).length-1
                    }
                    else{
                        tissues=$.unique(unpack(results,"Tissue_standard").sort()).length
                    }
                    var publications;
                    if($.unique(unpack(results,"PMID").sort()).indexOf("-")>-1){
                        publications=$.unique(unpack(results,"PMID").sort()).length-1
                    }
                    else{
                        publications=$.unique(unpack(results,"PMID").sort()).length
                    }

                    if(celltypes===1){celltypes=celltypes.toString()+" cell type"}else{celltypes=celltypes.toString()+" cell types"}
                    if(conditions===1){conditions=" in "+conditions.toString()+" condition"}else if(conditions==0){conditions=""}else{conditions=" in "+conditions.toString()+" conditions"}
                    if(tissues===1){tissues=" and "+tissues.toString()+" tissue"}else if(tissues==0){tissues=""}else{tissues=" and "+tissues.toString()+" tissues"}
                    if(publications===1){publications=", supported by "+publications.toString()+" publication"}else if(publications==0){publications=""}else{publications=", supported by "+publications.toString()+" publications"}
                    $("#summary1").html(
                        "<strong>"+[[${markername}]]+"</strong> is associated with "+celltypes+conditions+tissues+publications+"."
                    )

                    $("#table-marker").DataTable({
                        initComplete: function () {
                            var r = $('#table-marker tfoot tr');
                            r.find('th').each(function(){
                                $(this).css('padding', '8px 0')
                            });
                            $('#table-marker thead').append(r);
                            $('#search_0').css('text-align', 'center');

                            this.api().columns([1,2,3,4,6,8]).every( function () {
                                var column = this;
                                var select = $('<select class="table-select"><option value="">Show All</option></select>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                        );

                                        column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                    } );

                                column.data().unique().sort().each( function ( d, j ) {
                                    select.append( '<option value="'+d+'">'+d+'</option>' )
                                } );
                            } );
                        },
                        data:results,
                        columns:[
                            {
                                data:"CT_ID",
                                render:function(data,type,row){
                                    // return "<a class='ctid'>"+row.CT_ID+"</a>"
                                    return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.CT_ID+"</a>"

                                }
                            },
                            {
                                data:"Cell_standard",
                                render:function(data,type,row){
                                    // return "<a class='celltype'>"+row.Cell_standard+"</a>"
                                    return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Cell_standard+"</a>"

                                }
                            },
                            {
                                data:"Specific_Cell_Ontology_ID",
                                bVisible: false
                            },
                            {
                                data:"Species",
                                render:function(data,type,row){
                                    return "<a target='_blank' href='/celltaxonomy/species/"+row.Species_ID+"'>"+data+"</a>"
                                }
                            },
                            {
                                data:"Tissue_standard",
                                render:function(data,type,row){
                                    if(row.Tissue_UberonOntology_ID!="-"){
                                        return "<a class='tissue' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID+"'>"+row.Tissue_standard+"</a>"
                                    }
                                    else{
                                        return row.Tissue_standard
                                    }
                                }
                            },
                            {
                                data:"Tissue_UberonOntology_ID",
                                bVisible: false
                            },
                            {
                                data:"Disease_Type",
                                render:function(data,type,row){
                                    if(data!="-"){
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+row.Disease_Ontology_ID2+"'>"+data+"</a>"
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },
                            {
                                data:"Disease_Ontology_ID",
                                bVisible: false
                            },
                            {
                                data:"Additional_Information2",
                                render:function(data,type,row){
                                    if(row.Additional_Information2=="CellMarker"){
                                        return "<a target='_blank' href='http://xteam.xbio.top/CellMarker/search.jsp?quickSearchInfo="+[[${markername}]]+"'>CellMarker</a>"
                                    }

                                    else if(row.Additional_Information2=="PanglaoDB"){
                                        return "<a target='_blank' href='https://panglaodb.se/search.html?query="+[[${markername}]]+"'>PanglaoDB</a>"
                                    }

                                    // else if(row.Additional_Information2=="SHOGoiN"){
                                    //     return "<a class='SHOGoiN'>SHOGoiN</a>"
                                    // }

                                    else{

                                        if($.isNumeric(row.Additional_Information2*1)){
                                            return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+row.Additional_Information2+"'>"+row.Additional_Information2+"</a>"
                                        }
                                        else{
                                            return row.Additional_Information2
                                        }
                                    }
                                }
                            },
                            {
                                data:"PMID",
                                render:function(data,type,row){
                                    if(row.PMID!="-"){
                                        return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+row.PMID+"/'>"+row.PMID+"</a>"
                                    }
                                    else{
                                        return row.PMID
                                    }
                                }
                            }


                        ],
                        destroy: true,
                        iDisplayLength:5,
                        deferRender:true,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    });

                },
                error:function(){
                    console.log("error")
                }
            });

            if($("#geneensemblid").text()!="Not available" && $("#geneensemblid").text()!="-"){
                var text=$("#geneensemblid").text().split(/,|;/);
                $("#geneensemblid").empty();
                for (i=0;i<text.length;i++){
                    $("#geneensemblid").append(
                        "<a class='idlink' target='_blank' href='https://www.ensembl.org/id/"+text[i]+"'>"+text[i]+"</a><br>"
                    )
                }

            }

            if($("#entrezid").text()!="Not available" && $("#entrezid").text()!="-") {
                text = $("#entrezid").text().split(/,|;/);
                $("#entrezid").empty();

                for (i = 0; i < text.length; i++) {
                    $("#entrezid").append(
                        "<a class='idlink' id='entrez_id' target='_blank' href='https://www.ncbi.nlm.nih.gov/gene/" + text[i] + "'>" + text[i] + "</a><br>"
                    )
                }
            }
            if($("#uniprot").text()!="Not available" && $("#uniprot").text()!="-") {

                text = $("#uniprot").text().split(/,|;/);
                $("#uniprot").empty();

                for (i = 0; i < text.length; i++) {
                    $("#uniprot").append(
                        "<a class='idlink' target='_blank' href='https://www.uniprot.org/uniprot/" + text[i] + "'>" + text[i] + "</a><br>"
                    )
                }
            }
            if($("#PFAM").text()!="Not available" && $("#PFAM").text()!="-") {

                text = $("#PFAM").text().split(/,|;/);
                $("#PFAM").empty();

                for (i = 0; i < text.length; i++) {
                    $("#PFAM").append(
                        "<a class='idlink' target='_blank' href='https://pfam.xfam.org/family/" + text[i] + "'>" + text[i] + "</a><br>"
                    )
                }
            }
            if($("#HomoloGene").text()!="Not available" && $("#HomoloGene").text()!="-") {

                text = $("#HomoloGene").text().split("), ");
                $("#HomoloGene").empty();
                var len=text.length
                var n=1;
                text.map(function(e){
                    var content=e.split(/, | \(/)
                    $("#HomoloGene").append(
                        "<a target='_blank' href='/celltaxonomy/marker/"+content[1]+"'>"+content[0]+"</a>"
                    )
                    if(n<len){
                        $("#HomoloGene").append(
                            "<span> (" + content[1] + ", "+content[2]+"), </span>"
                        )
                    }
                    else{
                        $("#HomoloGene").append(
                            "<span> (" + content[1] + ", "+content[2]+"</span>"
                        )
                    }

                    n=n+1
                })
            }


            $.ajax({
                url:"/celltaxonomy/recommend_cells",
                type:'post',
                data:{
                    id:[[${markerid}]],
                    species:"All"
                },
                success:function(results){
                    results=eval(results).filter(function(e){
                        return e.supported_paper_number*1 >= $("#filter_search1").val() || e.FC_median*1 >=$("#filter_search2").val() || e.specificity_median*1 >=$("#filter_search3").val() || e.n_ortholog*1 >=$("#filter_search4").val()
                    })
                    if(results.length>0){
                        $("#cell_recom").DataTable({
                            data:results,
                            columns:[
                                {
                                    data:'Cell_standard',
                                    render:function(data,type,row){
                                        return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+data+"</a>"
                                    }
                                },
                                {
                                    data:'supported_paper_number',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search1").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+row.supported_paper_number*1+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                return '<span class="summary_value" style="display: none">'+row.supported_paper_number*1+'</span>'
                                            }
                                        }
                                        else{
                                            return data
                                        }

                                    }
                                },
                                {
                                    data:'FC_median',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search2").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.FC_median*1).toPrecision(2)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                if(isNaN(data)){
                                                    return '<span class="summary_value" style="display: none">-</span>'
                                                }
                                                else{
                                                    return '<span class="summary_value" style="display: none">'+(row.FC_median*1).toPrecision(2)+'</span>'
                                                }
                                            }
                                        }

                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:'DE_ratio',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search5").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.DE_ratio*1).toPrecision(2)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                if(isNaN(data)){
                                                    return '<span class="summary_value" style="display: none">-</span>'

                                                }
                                                else{
                                                    return '<span class="summary_value" style="display: none">'+(row.DE_ratio*1).toPrecision(2)+'</span>'
                                                }
                                            }
                                        }
                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:'specificity_median',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search3").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.specificity_median*1).toPrecision(2)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                if(isNaN(data)){
                                                    return '<span class="summary_value" style="display: none">-</span>'
                                                }
                                                else{
                                                    return '<span class="summary_value" style="display: none">'+(row.specificity_median*1).toPrecision(2)+'</span>'
                                                }
                                            }
                                        }

                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:'n_ortholog',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search4").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.n_ortholog*1)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                return "-"
                                            }
                                        }

                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:"total",
                                    render:function(data,type,row){
                                        var n=0
                                        if(row.supported_paper_number*1>=$("#filter_search1").val()){
                                            n+=1
                                        }
                                        if(row.FC_median*1>=$("#filter_search2").val()){
                                            n+=1
                                        }
                                        if(row.specificity_median*1>=$("#filter_search3").val()){
                                            n+=1
                                        }
                                        if(row.n_ortholog*1>=$("#filter_search4").val()){
                                            n+=1
                                        }
                                        if(row.DE_ratio*1>=$("#filter_search5").val()){
                                            n+=1
                                        }
                                        return n
                                    },
                                    visible:false
                                }
                            ],
                            order:[
                                [6,'desc'],[1,'desc'],[2,'desc'],[3,'desc'],[4,'desc']
                            ],
                            destroy:true,
                            iDisplayLength:5,
                            lengthChange:false,
                            searching:false,
                            responsive: true,

                        })
                    }
                    else{
                        $("#summary5").css("display","none")
                        $("#summary5-1").css("display","none")
                        $("#summary5").next().css("display","none")
                        $("#summary5").next().next().css("display","none")

                    }

                }
            })

            $.ajax({
                url:"/celltaxonomy/marker_species_similarity",
                type:"post",
                data:{"id":[[${markerid}]]},
                success:function(results) {

                    if(results.length==0){
                        $("#detail9").css("display","none")
                        $("#summary3").css("display","none")
                    }
                    else{
                        $("#summary3").html("<strong>"+[[${markername}]]+"</strong> is the conserved cell marker for "+$.unique(unpack(results,"Cell_standard").sort()).length+" cell types across species.")
                        var namelist=[];
                        var idlist=[];
                        results.map(function(e){
                            if($.inArray(e["Tissue_standard"],namelist)<0){
                                namelist.push(e["Tissue_standard"])
                                idlist.push(e["Tissue_UberonOntology_ID2"])
                            }
                        })
                        var tissue=namelist

                        tissue.map(function(d){
                            if(d!="All"){
                                $("#cell_similarity_species_tissue_select optgroup").eq(0).append("<option value='"+idlist[$.inArray(d,namelist)]+"'>"+d+"</option>")
                            }
                            else{
                                $("#cell_similarity_species_tissue_select optgroup").eq(1).append("<option value='"+"All"+"'>"+d+"</option>")
                            }
                        })

                        results=eval(results).filter(function(e){
                            return e.Tissue_UberonOntology_ID2==$("#cell_similarity_species_tissue_select").val()
                        })
                        $("#common_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species2"},

                                {
                                    data:"Cell_standard",
                                    render:function(data,type,row){
                                        return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                    }
                                },
                                {
                                    data:"Ortholog",
                                    render:function(data,type,row){
                                        return '<a target="_blank" href="/celltaxonomy/marker/'+row.Ortholog_ID+'">'+data+'</a>'
                                    }
                                },
                                {
                                    data:"Ortholog_ID",
                                    render:function(data,type,row){
                                        return '<a target="_blank" href="https://www.ncbi.nlm.nih.gov/gene/'+data+'">'+data+'</a>'
                                    }
                                },
                                {
                                    data:"Ortholog_publication",
                                    render:function(data){
                                        return "<a class='conserved_pub'>"+data+"</a>"
                                    }
                                }
                            ],
                            iDisplayLength:5,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            destroy:true

                        })

                    }

                }


            })

            $.ajax({
                url:"/celltaxonomy/marker_surface_marker",
                type:"post",
                data:{
                    "id":[[${markerid}]]
                },
                success:function(results){

                    if(results.length>0){
                        $("#cell_surface_marker_table").DataTable({
                            data:results,
                            columns:[
                                {
                                    data:"Species",

                                },
                                {data:"Evidence_summary"},
                                {data:"Antibody"},
                                {
                                    data:"Protein_class"
                                }

                            ],
                            order:[1,"desc"],
                            iDisplayLength:5,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>'
                        })
                        $("#summary4").html("<strong>"+[[${markername}]]+"</strong> is predicted to be cell surface marker which codes for membrane-bound protein products.")
                    }
                    else{
                        $("#detail11").css("display","none")
                        $("#summary4").css("display","none")
                    }

                }
            })






            setTimeout(function(){
                if([[${type}]]!=null){
                    var a = document.createElement('a');
                    a.href = "#"+[[${type}]];
                    a.click();
                }
            },1000)
            $("#cell_tissue_enrichment_LS_heatmap").css("width",$("#width").width())

        });
        function sortLS(a,b){
            return b.marker_cell_number-a.marker_cell_number
        }
        $(document).ajaxStop(function(){

            if($("#nav-side").children().length==1){
                nav_side_bar_set()
            }


        })
        window.onscroll=function(){
            nav_side_bar_scroll()
        }

        $("input[type='checkbox'].switch2").change(function(){
            if(!$("input[type='checkbox']").is(":checked")){
                $.ajax({
                    url:"/celltaxonomy/marker_cell_markerDE_bar",
                    type:"post",
                    dataType:'json',
                    async:false,

                    data:{
                        "marker":[[${markername}]],
                        "threshold":$("#cell_markerDE_barplot_threshold").val(),
                        "fdr":$("#cell_markerDE_barplot_FDR").val()
                    },
                    success:function(data){

                        if(data["result"].length==0){
                            $("#cell_markerDE_barplot").css("display","none")
                            $("#warn").css("display","block")
                        }
                        else{
                            $("#cell_markerDE_barplot").css("display","block")
                            $("#warn").css("display","none")

                            getbarplotDE("cell_markerDE_barplot",data)

                        }
                    }
                });


                var results=eval(DE_plot).filter(function(e){
                    return e.p_val_adj*1<$("#cell_markerDE_fdr").val()*1
                })

                $("#cell_marker_DE_table").DataTable({
                    data:results,
                    columns:
                        [
                            {data:"Species"},
                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        if(row.PubmedID.indexOf("doi")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data.split("_")[1]+'</a>'

                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data.split("_")[1]+'</a>'
                                        }
                                    }
                                    else if (data.indexOf("_")>=0){
                                        var name=data.split("_")
                                        if(data.indexOf("Tabula")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+name[0]+" ("+name[1]+")</a>"
                                        }
                                    }
                                    else{
                                        if(row.PubmedID.indexOf("doi")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data+'</a>'
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data+'</a>'
                                        }

                                    }
                                }
                            },
                            {
                                data:"Conditions",
                                render:function(data,type,row){
                                    if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                        return data
                                    }
                                    else if(row.Condition_ID!="-"){
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {
                                data:"Cell_standard",
                                render:function(data,type,row){
                                    if(row.CT_ID!="-" && row.CT_ID!=null && row.CT_ID!="NA"){
                                        return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },
                            {
                                data:"avg_log2FC",
                                render:function(data,type,row){
                                    return (data*1).toPrecision(2)
                                }
                            },
                            {
                                data:"pct_1",
                                render:function(data,type,row){
                                    return (row.pct_1*1).toPrecision(2)
                                }
                            },
                            {
                                data:"pct_2",
                                render:function(data,type,row){
                                    return (row.pct_2*1).toPrecision(2)
                                }
                            },
                            {
                                data:"p_val",
                                render:function(data,type,row){
                                    return (row.p_val*1).toPrecision(2)
                                }
                            },
                            {
                                data:"p_val_adj",
                                render:function(data,type,row){
                                    return (row.p_val_adj*1).toPrecision(2)
                                }
                            },

                        ],
                    destroy:true,
                    iDisplayLength:5,
                    dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    order:[3,'desc'],

                })
                getboxplot("cell_markerDE_plot",results)
                $("#cell_marker_se_table").DataTable({
                    data:DE_score,
                    columns:[
                        {data:"Species"},
                        {
                            data:"ID",
                            render:function(data,type,row){
                                if(data.indexOf("_SRS")>=0){
                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                }
                                else if (data.indexOf("_")>=0){
                                    var name=data.split("_")
                                    if(data.indexOf("Tabula")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                    }
                                }
                                else{
                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                }
                            }
                        },
                        {
                            data:"Conditions",
                            render:function(data,type,row){
                                if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                    return data
                                }
                                else if(row.Condition_ID!="-"){
                                    return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                }
                                else{
                                    return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                }
                            }
                        },
                        {data:"Cell_standard"},
                        {
                            data:"Cell_specific_score",
                            render:function(data){
                                return (data*1).toPrecision(2)
                            }

                        }
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    order:[3,"desc"]
                })

                getboxplotSS("cell_marker_ss_plot",DE_score)
            }
            else{
                var data=DE_bar
                var results={}
                results["result"]=eval(data["result"]).filter(function(e){
                    return cell_id_list.indexOf(e.CT_ID)>=0
                })
                results["total"]=eval(data["total"]).filter(function(e){
                    return cell_id_list.indexOf(e.Cell_id)>=0
                })
                getbarplotDE("cell_markerDE_barplot",results)


                results=eval(DE).filter(function(e){
                    return e.p_val_adj*1<$("#cell_markerDE_fdr").val()*1
                })
                $("#cell_marker_DE_table").DataTable({
                    data:results,
                    columns:
                        [
                            {data:"Species"},

                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        if(row.PubmedID.indexOf("doi")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data.split("_")[1]+'</a>'

                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data.split("_")[1]+'</a>'
                                        }
                                    }
                                    else if (data.indexOf("_")>=0){
                                        var name=data.split("_")
                                        if(data.indexOf("Tabula")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+name[0]+" ("+name[1]+")</a>"
                                        }
                                    }
                                    else{
                                        if(row.PubmedID.indexOf("doi")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data+'</a>'
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data+'</a>'
                                        }

                                    }
                                }
                            },
                            {
                                data:"Conditions",
                                render:function(data,type,row){
                                    if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                        return data
                                    }
                                    else if(row.Condition_ID!="-"){
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {
                                data:"Cell_standard",
                                render:function(data,type,row){
                                    if(row.CT_ID!="-" && row.CT_ID!=null && row.CT_ID!="NA"){
                                        return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },

                            {
                                data:"avg_log2FC",
                                render:function(data,type,row){
                                    return (data*1).toPrecision(2)
                                }
                            },
                            {
                                data:"pct_1",
                                render:function(data,type,row){
                                    return (row.pct_1*1).toPrecision(2)
                                }
                            },
                            {
                                data:"pct_2",
                                render:function(data,type,row){
                                    return (row.pct_2*1).toPrecision(2)
                                }
                            },
                            {
                                data:"p_val",
                                render:function(data,type,row){
                                    return (row.p_val*1).toPrecision(2)
                                }
                            },
                            {
                                data:"p_val_adj",
                                render:function(data,type,row){
                                    return (row.p_val_adj*1).toPrecision(2)
                                }
                            },

                        ],
                    destroy:true,
                    iDisplayLength:5,
                    dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    order:[3,'desc']
                })

                getboxplot("cell_markerDE_plot",results)


                var score=eval(DE_score).filter(function(e){
                    return cell_id_list.indexOf(e.CT_ID)>=0
                })
                $("#cell_marker_se_table").DataTable({
                    data:score,
                    columns:[
                        {data:"Species"},
                        {
                            data:"ID",
                            render:function(data,type,row){
                                if(data.indexOf("_SRS")>=0){
                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                }
                                else if (data.indexOf("_")>=0){
                                    var name=data.split("_")
                                    if(data.indexOf("Tabula")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                    }
                                }
                                else{
                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                }
                            }
                        },
                        {
                            data:"Conditions",
                            render:function(data,type,row){
                                if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                    return data
                                }
                                else if(row.Condition_ID!="-"){
                                    return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                }
                                else{
                                    return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                }
                            }
                        },
                        {data:"Cell_standard"},
                        {
                            data:"Cell_specific_score",
                            render:function(data){
                                return (data*1).toPrecision(2)
                            }

                        }
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    order:[3,"desc"]
                })

                getboxplotSS("cell_marker_ss_plot",score)



            }


        })

        $("#cell_similarity_species_tissue_select").change(function(){
            $.ajax({
                url:"/celltaxonomy/marker_species_similarity",
                type:"post",
                data:{"id":[[${markerid}]]},
                success:function(results) {
                        results=eval(results).filter(function(e){
                            return e.Tissue_UberonOntology_ID2==$("#cell_similarity_species_tissue_select").val()
                        })
                        $("#common_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species2"},

                                {
                                    data:"Cell_standard",
                                    render:function(data,type,row){
                                        return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                    }
                                },
                                {
                                    data:"Ortholog",
                                    render:function(data,type,row){
                                        return '<a target="_blank" href="/celltaxonomy/marker/'+row.Ortholog_ID+'">'+data+'</a>'
                                    }
                                },
                                {
                                    data:"Ortholog_ID",
                                    render:function(data,type,row){
                                        return '<a target="_blank" href="https://www.ncbi.nlm.nih.gov/gene/'+data+'">'+data+'</a>'
                                    }
                                },
                                {
                                    data:"Ortholog_publication",
                                    render:function(data){
                                        return "<a class='conserved_pub'>"+data+"</a>"
                                    }
                                }
                            ],
                            iDisplayLength:5,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            destroy:true

                        })
                }


            })


        })


        $("#cell_markerDE_fdr").change(function(){
            var results;
            if($("input[type='checkbox']").is(":checked")){
                results=eval(DE).filter(function(e){
                    return e.p_val_adj*1<$("#cell_markerDE_fdr").val()*1
                })
            }
            else{
                results=eval(DE_plot).filter(function(e){
                    return e.p_val_adj*1<$("#cell_markerDE_fdr").val()*1
                })
            }



            getboxplot("cell_markerDE_plot",results)

            $("#cell_marker_DE_table").DataTable({
                data:results,
                columns:
                    [
                        {data:"Species"},

                        {
                            data:"ID",
                            render:function(data,type,row){
                                if(data.indexOf("_SRS")>=0){
                                    if(row.PubmedID.indexOf("doi")>=0){
                                        return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data.split("_")[1]+'</a>'

                                    }
                                    else{
                                        return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data.split("_")[1]+'</a>'
                                    }
                                }
                                else if (data.indexOf("_")>=0){
                                    var name=data.split("_")
                                    if(data.indexOf("Tabula")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+name[0]+" ("+name[1]+")</a>"
                                    }
                                }
                                else{
                                    if(row.PubmedID.indexOf("doi")>=0){
                                        return '<a target="_blank" href="/celltaxonomy/study/'+row.ID+'">'+data+'</a>'
                                    }
                                    else{
                                        return '<a target="_blank" href="/celltaxonomy/study/'+row.PubmedID+'">'+data+'</a>'
                                    }

                                }
                            }
                        },
                        {
                            data:"Conditions",
                            render:function(data,type,row){
                                if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                    return data
                                }
                                else if(row.Condition_ID!="-"){
                                    return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                }
                                else{
                                    return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                }
                            }
                        },
                        {
                            data:"Cell_standard",
                            render:function(data,type,row){
                                if(row.CT_ID!="-" && row.CT_ID!=null && row.CT_ID!="NA"){
                                    return '<a target="_blank" href="/celltaxonomy/celltype/'+row.CT_ID+'">'+data+'</a>'
                                }
                                else{
                                    return data
                                }
                            }
                        },

                        {
                            data:"avg_log2FC",
                            render:function(data,type,row){
                                return (data*1).toPrecision(2)
                            }
                        },
                        {
                            data:"pct_1",
                            render:function(data,type,row){
                                return (row.pct_1*1).toPrecision(2)
                            }
                        },
                        {
                            data:"pct_2",
                            render:function(data,type,row){
                                return (row.pct_2*1).toPrecision(2)
                            }
                        },
                        {
                            data:"p_val",
                            render:function(data,type,row){
                                return (row.p_val*1).toPrecision(2)
                            }
                        },
                        {
                            data:"p_val_adj",
                            render:function(data,type,row){
                                return (row.p_val_adj*1).toPrecision(2)
                            }
                        },

                    ],
                destroy:true,
                iDisplayLength:5,
                dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                order:[3,'desc'],

            })

        })
        $("#cell_tissue_enrichment_select").change(function(){
            $.ajax({
                url:"/celltaxonomy/cell_type_enrichment",
                type:"post",
                dataType:'json',
                data:{
                    marker:[[${markerid}]],
                    tissue:$("#cell_tissue_enrichment_select").val()
                },
                success:function(result){
                    getbarplot("cell_enrichment_literature_support",result,[[${markername}]]+": number of supported publications","No. of publications","","Cell_standard","supported_paper_number")

                },
                error:function(){
                    console.log("error")
                }

            })

        })







        $("#cell_markerDE_barplot_threshold,#cell_markerDE_barplot_FDR").change(function(){
            $("input[type='checkbox'].switch4").prop("checked",false)
            $.ajax({
                url:"/celltaxonomy/marker_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "marker":[[${markerid}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    DE_bar=data
                    if(data["result"].length==0){
                        $("#cell_markerDE_barplot").css("display","none")
                        $("#warn").css("display","block")
                    }
                    else{
                        var results={}
                        $("#cell_markerDE_barplot").css("display","block")
                        $("#warn").css("display","none")
                        // if($("input[type='checkbox'].switch2").is(":checked")){

                            results["result"]=eval(data["result"]).filter(function(e){
                                return cell_id_list.indexOf(e.CT_ID)>=0
                            })
                            results["total"]=eval(data["total"]).filter(function(e){
                                return cell_id_list.indexOf(e.Cell_id)>=0
                            })
                            if (results["result"].length>0){
                                getbarplotDE("cell_markerDE_barplot",results)
                            }
                            else{
                                getbarplotDE("cell_markerDE_barplot",data)
                            }




                    }
                }
            });



        })

        $("input[type='checkbox'].switch4").change(function(){
            if($(this).is(":checked")){
                var results={};
                results["result"]=eval(DE_bar["result"]).filter(function(e){
                    return cell_id_list.indexOf(e.CT_ID)>=0
                })
                results["total"]=eval(DE_bar["total"]).filter(function(e){
                    return cell_id_list.indexOf(e.Cell_id)>=0
                })
                if(results["result"].length>0){
                    getbarplotDE2("cell_markerDE_barplot",results)
                }
                else{
                    getbarplotDE2("cell_markerDE_barplot",DE_bar)
                }

            }
            else{
                var results={};

                results["result"]=eval(DE_bar["result"]).filter(function(e){
                    return cell_id_list.indexOf(e.CT_ID)>=0
                })
                results["total"]=eval(DE_bar["total"]).filter(function(e){
                    return cell_id_list.indexOf(e.Cell_id)>=0
                })
                if(results["result"].length>0){
                    getbarplotDE("cell_markerDE_barplot",results)
                }
                else{
                    getbarplotDE("cell_markerDE_barplot",DE_bar)
                }
            }
        })


        $(".figure-li").click(function(){
            $(this).siblings().removeClass("active");
            $(this).addClass("active");
            let params1 = {
                "tissue":$("#select1").val(),
                "value_type":$(".figure-li.active").text(),
                "marker":"TNFSF13"
            };
            let params2 = {
                "tissue":$("#select2").val(),
                "value_type":$(".figure-li.active").text(),
                "marker":"TNFSF13"
            };
            $.ajax({
                url:"/celltaxonomy/marker_figure",
                data:params1,
                type:"post",
                success:function(marker_figure){
                    function unpack(rows, key) {
                        return rows.map(function(row) { return row[key]; });
                    };
                    var data = [{
                        type: 'violin',
                        x: unpack(marker_figure, 'cell_type'),
                        y: unpack(marker_figure, 'value'),
                        points: 'none',
                        box: {
                            visible: true
                        },
                        line: {
                            color: 'green',
                        },
                        meanline: {
                            visible: true
                        },
                        transforms: [{
                            type: 'groupby',
                            groups: unpack(marker_figure, 'cell_type'),
                            styles: [
                                {target: 'type1', value: {line: {color: 'blue'}}},
                                {target: 'type2', value: {line: {color: 'orange'}}}
                            ]
                        }]
                    }];

                    var layout = {
                        title: "Multiple Traces Violin Plot",
                        yaxis: {
                            zeroline: false
                        }
                    };

                    Plotly.newPlot('Tissue1', data, layout);
                },
                error:function(){
                    console.log("error")
                }
            });
            $.ajax({
                url:"/celltaxonomy/marker_figure",
                data:params2,
                type:"post",
                success:function(marker_figure){
                    function unpack(rows, key) {
                        return rows.map(function(row) { return row[key]; });
                    };
                    var data = [{
                        type: 'violin',
                        x: unpack(marker_figure, 'cell_type'),
                        y: unpack(marker_figure, 'value'),
                        points: 'none',
                        box: {
                            visible: true
                        },
                        line: {
                            color: 'green',
                        },
                        meanline: {
                            visible: true
                        },
                        transforms: [{
                            type: 'groupby',
                            groups: unpack(marker_figure, 'cell_type'),
                            styles: [
                                {target: 'type1', value: {line: {color: 'blue'}}},
                                {target: 'type2', value: {line: {color: 'orange'}}}
                            ]
                        }]
                    }];

                    var layout = {
                        title: "Multiple Traces Violin Plot",
                        yaxis: {
                            zeroline: false
                        }
                    };

                    Plotly.newPlot('Tissue2', data, layout);
                },
                error:function(){
                    console.log("error")
                }
            });
        });

        $(".filter_search").bind('input propertychange',function(){
            if($("#filter_search1").val()==''){
                $("#filter_search1").val(1)
            }
            if($("#filter_search2").val()==""){
                $("#filter_search2").val(0.25)
            }
            if($("#filter_search3").val()==''){
                $("#filter_search3").val(0.3)
            }
            if($("#filter_search4").val()==''){
                $("#filter_search4").val(1)
            }
            if($("#filter_search5").val()==''){
                $("#filter_search5").val(0.3)
            }


            $.ajax({
                url:"/celltaxonomy/marker_summary_filter",
                type:'post',
                data:{
                    id:[[${markerid}]],
                    fc:$("#filter_search2").val()*1,
                    ss:$("#filter_search3").val()*1,
                    tc:$("#filter_search4").val()*1,
                    dr:$("#filter_search5").val()*1,
                    pc:$("#filter_search1").val()*1
                },
                success:function(results){

                    if(results.length>0){
                        $("#cell_recom").DataTable({
                            data:results,
                            columns:[
                                {
                                    data:'Cell_standard',
                                    render:function(data,type,row){
                                        return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+data+"</a>"
                                    }
                                },
                                {
                                    data:'supported_paper_number',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search1").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+row.supported_paper_number*1+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                return '<span class="summary_value" style="display: none">'+row.supported_paper_number*1+'</span>'
                                            }
                                        }
                                        else{
                                            return data
                                        }

                                    }
                                },
                                {
                                    data:'FC_median',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search2").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.FC_median*1).toPrecision(2)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                if(isNaN(data)){
                                                    return '<span class="summary_value" style="display: none">-</span>'
                                                }
                                                else{
                                                    return '<span class="summary_value" style="display: none">'+(row.FC_median*1).toPrecision(2)+'</span>'
                                                }
                                            }
                                        }

                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:'DE_ratio',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search5").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.DE_ratio*1).toPrecision(2)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                if(isNaN(data)){
                                                    return '<span class="summary_value" style="display: none">-</span>'

                                                }
                                                else{
                                                    return '<span class="summary_value" style="display: none">'+(row.DE_ratio*1).toPrecision(2)+'</span>'
                                                }
                                            }
                                        }
                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:'specificity_median',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search3").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.specificity_median*1).toPrecision(2)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                if(isNaN(data)){
                                                    return '<span class="summary_value" style="display: none">-</span>'
                                                }
                                                else{
                                                    return '<span class="summary_value" style="display: none">'+(row.specificity_median*1).toPrecision(2)+'</span>'
                                                }
                                            }
                                        }

                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:'n_ortholog',
                                    render:function(data,type,row){
                                        if(type=="display"){
                                            if(data*1>=$("#filter_search4").val()){
                                                return '<div style="display:flex;justify-content: flex-start">' +
                                                    '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                    '<span class="summary_value" style="display: none"> ('+(row.n_ortholog*1)+')</span>' +
                                                    '</div>'
                                            }
                                            else{
                                                return "-"
                                            }
                                        }

                                        else{
                                            return data*1
                                        }

                                    }
                                },
                                {
                                    data:"total",
                                    render:function(data,type,row){
                                        var n=0
                                        if(row.supported_paper_number*1>=$("#filter_search1").val()){
                                            n+=1
                                        }
                                        if(row.FC_median*1>=$("#filter_search2").val()){
                                            n+=1
                                        }
                                        if(row.specificity_median*1>=$("#filter_search3").val()){
                                            n+=1
                                        }
                                        if(row.n_ortholog*1>=$("#filter_search4").val()){
                                            n+=1
                                        }
                                        if(row.DE_ratio*1>=$("#filter_search5").val()){
                                            n+=1
                                        }
                                        return n
                                    },
                                    visible:false
                                }
                            ],
                            order:[
                                [6,'desc'],[1,'desc'],[2,'desc'],[3,'desc'],[4,'desc']
                            ],
                            destroy:true,
                            iDisplayLength:5,
                            lengthChange:false,
                            searching:false,
                            responsive: true
                        })
                    }
                    else{
                        $("#summary5").css("display","none")
                        $("#summary5-1").css("display","none")
                        $("#summary5").next().css("display","none")
                        $("#summary5").next().next().css("display","none")

                    }

                }
            })
        })

        function post(URL,params) {
            var temp_form = document.createElement("form");
            temp_form .action = URL;
            temp_form .target = "_blank";
            temp_form .method = "post";
            temp_form .style.display = "none";
            for (var x in params){
                var opt = document.createElement("textarea");
                opt.name = x;
                opt.value = params[x];
                temp_form .appendChild(opt);
            }


            document.body.appendChild(temp_form);
            temp_form .submit();
        };
        $("#table-marker").on("click",".SHOGoiN",function(){
            var row = $(this).closest("tr");
            var data = $('#table-marker').DataTable().row(row).data();
            post("https://stemcellinformatics.org/cell_marker/literatures",{"keyword":data["Cell_standard"],"marker_name":[[${markername}]]})
        })
        $("#table-marker").on("click",".celltype",function(){
            var row = $(this).closest("tr");
            var data = $('#table-marker').DataTable().row(row).data();
            post("/celltaxonomy/celltype",{"name":$(this).text(),"id":data["Specific_Cell_Ontology_ID"]})
        })
        $("#table-marker").on("click",".ctid",function(){
            var row = $(this).closest("tr");
            var data = $('#table-marker').DataTable().row(row).data();
            post("/celltaxonomy/celltype",{"name":data["Cell_standard"],"id":data["Specific_Cell_Ontology_ID"]})
        })
        $("#table-marker").on("click",".tissue",function(){
            var row = $(this).closest("tr");
            var data = $('#table-marker').DataTable().row(row).data();
            post("/celltaxonomy/tissue",{"name":data["Tissue_standard"],"id":data["Tissue_UberonOntology_ID"]})
        });
        $("#cell_tissue_marker_table").on("click",".celltype",function(){
            var row = $(this).closest("tr");
            var data = $('#cell_tissue_marker_table').DataTable().row(row).data();
            post("/celltaxonomy/celltype",{"name":data["Cell_standard"],"id":data["Specific_Cell_Ontology_ID"]})
        })
        $("#cell_tissue_marker_table").on("click",".tissue",function(){
            var row = $(this).closest("tr");
            var data = $('#cell_tissue_marker_table').DataTable().row(row).data();
            post("/celltaxonomy/tissue",{"name":data["Tissue_standard"],"id":data["Tissue_UberonOntology_ID2_x"]})
        });
        $("#cell_marker_table").on("click",".celltype",function(){
            var row = $(this).closest("tr");
            var data = $('#cell_marker_table').DataTable().row(row).data();
            post("/celltaxonomy/celltype",{"name":data["Cell_standard"],"id":data["Specific_Cell_Ontology_ID"]})
        })

        $(".icon").hover(function(){
            var X = $(this).position().top;
            var Y = $(this).offset().left;
            var height=$(this).height();
            var delta=$(window).width()-Y-35;
            var span_x=$(this).siblings("span").offset().left
            var icon_width=$(this).width()
            $(this).siblings(".tooltiptext").css("top",X+height+5)
            if($(this).siblings("span").text().length>100){
                $(this).siblings("span").css("width",350)

                if(delta<180){

                    $(this).siblings(".tooltiptext").css("margin-left",-1*(180+180-delta+icon_width))
                }
                else{
                    $(this).siblings(".tooltiptext").css("margin-left",-(180))
                }
            }
            if(Y<200){
                $(this).siblings(".tooltiptext").css("margin-left",-20)
            }

        })
        $(".details").click(function(){
            if($(this).children("i").hasClass("ion-plus-round")){
                $(this).children("i").removeClass("ion-plus-round")
                $(this).children("i").addClass("ion-minus-round")
            }
            else{
                $(this).children("i").removeClass("ion-minus-round")
                $(this).children("i").addClass("ion-plus-round")
            }

        })
        $("input[type='checkbox'].switch1").change(function(){
            if($("input[type='checkbox'].switch1").is(":checked")){
                $(".summary_value").css("display","block")
            }
            else{
                $(".summary_value").css("display","none")
            }

        })
        $('#cell_recom').on('DOMNodeInserted',function(){
            if($("input[type='checkbox'].switch1").is(":checked")){
                $(".summary_value").css("display","block")
            }
            else{
                $(".summary_value").css("display","none")
            }
        })

        $("#common_table").on("click",".conserved_pub",function(){
            var row = $(this).closest("tr");

            if(row.next().hasClass("table_append")){
                $(".table_append").remove()
            }
            else{
                var data = $('#common_table').DataTable().row(row).data();
                $.ajax({
                    url:"/celltaxonomy/conserved_pub",
                    type:'post',
                    data:{
                        species:data['Ortholog_species'],
                        tissue:$("#cell_similarity_species_tissue_select option:selected").text(),
                        marker:data['Ortholog_ID'],
                        cellid:data['Specific_Cell_Ontology_ID']
                    },
                    success:function(results){
                        $(".table_append").remove()
                        row.after(
                            "<tr class='table_append'>"+
                            "<td colspan='5' id='append_td'>" +
                            '<div id="pub_div" >'+
                            '<div>'+
                            '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                            '<thead>'+
                            '<tr>'+
                            '<th>PMID</th>'+
                            '<th>Title</th>'+
                            '<th>Journal</th>'+
                            '</tr>'+
                            '</thead>'+
                            '</table>'+
                            '</div>'+
                            '</div>'+
                            "</td>"+
                            "</tr>"
                        )
                        $("#pub").DataTable({
                            data:results,
                            columns:[
                                {
                                    data:"PMID",
                                    render:function(data){
                                        return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+data+"'>"+data+"</a>"
                                    }

                                },
                                {data:"title"},
                                {data:"journal"},

                            ],
                            destroy:true,
                            "iDisplayLength":5,

                            dom: '<"row">t<"row"<"col-lg-12"p>>',

                        })

                    }
                })
            }



        })


        jQuery.extend( jQuery.fn.dataTableExt.oSort, {
            "num-html-pre": function ( a ) {
                if(isNaN(a)){
                    a=-10000000000
                }
                else{
                    a=a*1
                }
                return a
            },

            "num-html-asc": function ( a, b ) {
                return ((a < b) ? -1 : ((a > b) ? 1 : 0));
            },

            "num-html-desc": function ( a, b ) {
                return ((a < b) ? 1 : ((a > b) ? -1 : 0));
            }});

    </script>
</body>
</html>