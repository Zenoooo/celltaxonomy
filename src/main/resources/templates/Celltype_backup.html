<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cell type - Cell Taxonomy - CNCB-NGDC</title>

    <link rel="stylesheet" href="/celltaxonomy/static/css/demo.css" type="text/css">
    <link rel="icon" href="/celltaxonomy/static/img/CellTaxonomy v3.png">

    <link rel="stylesheet" href="/celltaxonomy/static/css/ionicons.min.css">

    <link rel="stylesheet" href="/celltaxonomy/static/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script src="/celltaxonomy/static/js/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->


    <script src="/celltaxonomy/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/jquery.ztree.core.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/jquery.ztree.exhide.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/fuzzysearch.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/headerfooter-full.js"></script>


    <link rel="stylesheet" href="/celltaxonomy/static/css/bootstrap.min.css" >
    <link rel="stylesheet" href="/celltaxonomy/static/css/dataTables.bootstrap.min.css" >
    <script src="/celltaxonomy/static/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet"  href="/celltaxonomy/static/css/buttons.bootstrap.min.css">
    <script src="/celltaxonomy/static/js/dataTables.buttons.min.js"></script>
    <script src="/celltaxonomy/static/js/jszip.min.js"></script>
    <script src="/celltaxonomy/static/js/buttons.html5.min.js"></script>
    <script src="/celltaxonomy/static/js/buttons.bootstrap.min.js"></script>

    <script src="/celltaxonomy/static/js/dataTables.bootstrap.min.js"></script>
    <link href="/celltaxonomy/static/css/bow.ui.min.css" rel="stylesheet">

    <script type="text/javascript" src="/celltaxonomy/static/js/echarts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-simple-transform/dist/ecSimpleTransform.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/my/my.js"></script>

    <link rel="stylesheet" type="text/css" href="/celltaxonomy/static/css/my/my.css">



    <style>

        input[type='radio']{
            margin-left: 5px;
        }

        select.input-sm{
            line-height:20px;
            margin-bottom: 5px;
        }
        input.input-sm{
            margin-left: 10px;
            margin-bottom: 0;

        }
        .curSelectedNode{
            background: #c4c4c4 !important;
            border:1px solid #bdbdbd !important;

        }
        #statistic_table_filter{
            display: flex;
            justify-content: flex-end;
        }
        .node_name::first-letter{
            text-transform: capitalize;
        }

        #treeDemo{
            width:100%
        }
        /* 小屏幕（平板，大于等于 768px） */
        @media (max-width: 1024px) {

        }

        /* 中等屏幕（桌面显示器，大于等于 992px） */
        @media screen and (max-width: 1400px) and (min-width: 1024px) {
            #statistic label,#statistic .btn ,#statistic select{
                font-size: 13px;
            }
        }
        @media screen and (min-width: 1400px) {
            #statistic select{
                font-size: 14px;
            }
        }

        .affix{
            top:0;
            width:270px;
        }
        .ztree li span.button.ico_docu{
            background-image: url("/celltaxonomy/static/img/germs.png");
            background-position: 50%;
            background-size:100% 100%;
        }
        .ztree li span.button.ico_close{
            background-image: url("/celltaxonomy/static/img/germs.png");
            background-position: 50%;
            background-size:100% 100%;

        }
        .ztree li span.button.ico_open{
            background-image: url("/celltaxonomy/static/img/germs.png");
            background-position: 50%;
            background-size:100% 100%;

        }



        #treeDemo::-webkit-scrollbar,.table-region::-webkit-scrollbar,#statistic::-webkit-scrollbar {
            /*滚动条整体样式*/
            width : 15px;  /*高宽分别对应横竖滚动条的尺寸*/
            height: 12px;
        }
        #treeDemo::-webkit-scrollbar-thumb,.table-region::-webkit-scrollbar-thumb,#statistic::-webkit-scrollbar-thumb{
            /*滚动条里面小方块*/
            border-radius   : 10px;
            background-color: #2487ce;
            background-image: -webkit-linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.2) 75%,
                    transparent 75%,
                    transparent
            );
        }
        #treeDemo::-webkit-scrollbar-track,.table-region::-webkit-scrollbar-track,#statistic::-webkit-scrollbar-track {
            /*滚动条里面轨道*/
            box-shadow   : 0 0 1px rgba(0, 0, 0, 0.2);
            background   : #ededed;
            border-radius: 10px;
        }



        #cell_marker_table tbody tr td:nth-child(2){
            word-break: break-all;
            width: 10%;
        }
        #tissue_enrichment_table tbody tr td:nth-child(1){
            text-transform: capitalize;
        }
        .cellstandard::first-letter{
            text-transform: capitalize;
        }
        .table-title{
            font-size: 20px;
            font-weight: 700;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
        }
        .table-title a{
            text-decoration: none;
        }
        .ytick text{
            text-transform: capitalize;
        }
        .xtick text{
            text-transform: capitalize;
        }
        #similarity_table_filter{
            display: flex;
            justify-content: flex-end;
        }
        .table-change{
            border: 1px solid #2487ce;
            color: #2487ce;
            padding:5px 8px;
            margin-right: 5px;
            border-radius: 5px;
        }
        .table-change.active, .table-change:hover{
            background: #2487ce;
            color: white;
            border-bottom: 1px solid white;
        }
        .ion-checkmark-round{
            color:#8bc6ec;
            margin-right: 5px;

        }

        .ion-plus-round{
            cursor: pointer;
        }
        #marker_recom>thead>tr>th, #dataset_recom>thead>tr>th{
            white-space: normal;
            word-wrap: break-word;
            width: 100px;
        }

        #filter_panel{
            margin-top:20px;
            visibility: hidden;
            transition:0.3s;
            position: absolute;
            z-index: 999;
            background: #ffffff;
            opacity: 0;
            padding:15px 20px;
            border-radius: 4px;
            box-shadow: 0 0 0 1px #2185d0 inset!important;

        }
        .filter_search{
            height:30px;
            margin-top:5px;
            display: inline-block;
            width:55px;
            padding:5px 10px;
            text-align: center !important;
            font-size: 14px;


        }
        .filter_search::placeholder{
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>

<body >
<header>
    <nav th:replace="common/topbar::topbar"></nav>
</header>
<!--<div style="overflow: hidden;height:150px;width: 100%;background-image: url(/celltaxonomy/static/img/B1415360227.jpeg)">-->
<!--    <div class="col-lg-offset-1" style="display: flex;align-items: center;height: 100%;">-->
<!--        <h1 style="text-align: left;color: white;width:100%;font-size: 76px">Cell Type Browser</h1>-->
<!--    </div>-->
<!--</div>-->
<div class="container" style="background: #f4f7f6" >

    <div class="row">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/celltaxonomy/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Cell type</li>
            </ol>
        </nav>

        <div>
            <div class="col-lg-2 col-sm-3" style="width:300px;margin-left: 30px;margin-right: 10px;transition:0.3s" >
                <button id="browse_btn2"  style="padding:0;color:rgba(0,0,0,.6);align-self: center;font-size: 25px;height: 100%;display: none">
                    <i class="ion-arrow-right-a"></i>
                </button>
                <div class="mypanel">
                    <div id="browse" class="mypanel-body">
                        <div class="mypanel-title" style="display: flex">
                            <h2>Browse</h2>

                            <div class="wrapper" style="margin-left: 5px">
                                <i class="icon ion-help-circled" style="color:#16507b;line-height: 40px;"></i>
                                <span class="tooltiptext">Underlined ("-") indicates the presence of data</span>
                            </div>
                        </div>
                        <div>
                            <ul style="margin-bottom: 0">
                                <li style="display: inline-block;text-decoration: underline ">
                                    Cell types with available markers
                                </li>

                            </ul>
                        </div>
                        <div style="padding:10px 20px 20px 20px;margin-top:10px;border-bottom:1px solid rgba(34,36,38,.15)">
                            <input style="border-radius: 5px" type="text" id="key" value="" class="empty" placeholder="Search"/>
                            <ul id="treeDemo"   class="ztree" style="height:370px;border:0;background: #ffffff;margin-top: 0;"></ul>
                        </div>
                        <div style="display: flex;justify-content: center;height:50px">
                            <button id="browse_btn" style="color:rgba(0,0,0,.6);align-self: center;font-size: 25px;width: 100%;display: block">
                                <i class="ion-arrow-left-a"></i>
                            </button>
                        </div>
                    </div>


                </div>

            </div>
            <div class="col-lg-9 col-sm-9" style="transition:0.3s">

                <div class="mypanel">
                    <div class="mypanel-body" style="padding: 10px 20px 0 20px;margin-bottom:20px">

                        <div id="statistic" >
                            <div>
                                <div style="padding: 10px 0;">
                                    <ul id="myTab" class="nav nav-tabs" style="margin:0">
                                        <li class="active">
                                            <a href="#statistic1" data-toggle="tab">Cell types with available markers (<span id="tab1"></span>)</a>
                                        </li>
                                        <li>
                                            <a href="#statistic2" data-toggle="tab">Cell types without available markers (<span id="tab2"></span>)</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>


                            <div id="myTabContent" class="tab-content" >
                                <div id="statistic1" class="tab-pane fade in active">
                                    <table id="statistic_table" class="table table-hover table-striped" style="width: 100%">
                                        <thead>
                                        <tr style="height: 20px">
                                            <th >Cell Taxonomy ID</th>
                                            <th >Cell type</th>
                                            <th >Cell Ontology ID</th>
                                            <th >#Species</th>
                                            <th >#Tissues</th>
                                            <th >#Conditions</th>
                                            <th >#Markers</th>
                                            <th >#Publications</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div id="statistic2" class="tab-pane fade">
                                    <table id="statistic_table2" class="table table-hover table-striped" style="width:100%">
                                        <thead>
                                        <tr>
                                            <th >Cell Taxonomy ID</th>
                                            <th >Cell type</th>
                                            <th >Cell Ontology ID</th>
                                            <th >Tissue ID</th>
                                            <th >Tissue</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>

                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div id="nav_side_bar" class="col-lg-2 col-sm-3" style="background: #f4f7f6;padding:0;display:none">

                <ul id="nav-side">
                    <li style="border-bottom: 1px solid #777777;pointer-events: none">
                        <span style="font-size: 22px"  th:text="${name}"></span>
                    </li>
                </ul>
            </div>
            <div class="col-lg-10 col-sm-9">
                <div class="mypanel" style="display: none">
                    <div class="mypanel-body" style="padding: 10px 20px 0 20px">
                        <div style="display: none" id="detail1">
                            <!--                            <a href="/celltaxonomy/Cell_type">-->
                            <!--                                <button id="reload" class="btn btn-primary" style="padding: 5px 10px">-->
                            <!--                                    <i class="icon ion-arrow-left-a" style="color: white"></i>-->
                            <!--                                     <span>Back</span>-->
                            <!--                                </button>-->
                            <!--                            </a>-->

                            <div style="display: flex;justify-content: space-between;padding-bottom: 20px">
                                <div>
                                    <h4 id="name" style="color: #16507b;font-size: 28px;">Cell name</h4>
                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Cell Taxonomy ID: </span>
                                        <span id="ct_id"></span>
                                    </div>
                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Cell Ontology ID: </span>
                                        <span>
                                        <a style="font-size: 14px;padding: 20px 0 20px 0" id="id" target="_blank" >Cell ID</a>
                                    </span>
                                    </div>

                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Cell type description: </span>
                                        <span id="new_cell_type_annotation">Here is the description of this cell type</span>
                                    </div>

                                </div>
                                <div style="margin-right: 50px;">
                                    <a target="_blank" style="display: none">
                                        <img id="cell_pic"  style="min-width: 75px;;max-width:200px;">
                                    </a>

                                    <div class="wrapper" style="height: 18px;display: none;text-align: center">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span id="pic_annotation" class="tooltiptext" style="font-size: 10px;margin-left: -255px;display: block;white-space: normal">
                                        </span>
                                    </div>
                                    <div style="text-align: center">
                                    </div>

                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <div class="mypanel">
                    <div class="mypanel-body" id="detail10" style="display:none;margin-top:10px;padding: 10px 20px 20px 20px">
                        <div>
                            <div id="width" class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#summary_region">
                                    <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                    <span style="font-size:20px;font-weight: 700;"  id="summary/">Summary</span>

                                </a>
                            </div>
                            <div id="summary_region" class="collapse in">

                                <ul style="margin-top: 20px">
                                    <li class="summary"  id="summary1"></li>
                                    <li class="summary"  id="summary2"></li>
                                    <li class="summary"  id="summary3"></li>
                                    <li class="summary"  id="summary4"></li>
                                    <li class="summary"  id="summary5">
                                        The recommended cell markers for <span th:text="${name}"></span> are summarized below based on jointly evaluation by supported literature, expression enrichment and conservation.
                                    </li>

                                    <li style="margin-top: 20px;display: flex;justify-content: flex-start">
                                        <div>
                                            <label>Species</label>
                                            <select id="summary_species" style="width: 200px">

                                            </select>
                                        </div>
                                        <div style="padding-top: 30px;margin-left: 20px">
                                            <input type="checkbox" class="switch switch1">Show value
                                        </div>
                                        <div style="padding-top:30px;margin-left:20px">
                                            <button id="hover_button" class="filter_button" style="color:#2c75c9">
                                                <i class="ion-funnel" style="font-size: 17px" ></i>
                                                <span>Filter</span>
                                            </button>
                                            <div id="filter_panel" >
                                                <ul>
                                                    <li style="list-style: disc">
                                                        <span>No. of publications >=</span>
                                                        <input id="filter_search1" class="filter_search" type="search" style="margin-left:10px;margin-right: 10px"  value="10" oninput = "value=value.replace(/[^\d]/g,'')*1">
                                                    </li>
                                                    <li style="list-style: disc">
                                                        <span style="display: inline">Median log2FC >=</span>
                                                        <input id="filter_search2" class="filter_search" type="search" style="margin-left: 10px" value="2" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                    </li>
                                                    <li style="list-style: disc">
                                                        <span style="display: inline">Median specificity score >=</span>
                                                        <input id="filter_search3" class="filter_search" type="search" style="margin-left: 10px" value="0.5" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                    </li>
                                                    <li style="list-style: disc">
                                                        <span style="display: inline">Tissue counts >=</span>
                                                        <input id="filter_search4" class="filter_search" type="search" style="margin-left: 10px" value="4" oninput = "value=value.replace(/[^\d]/g,'')*1">
                                                    </li>
                                                    <li style="display: flex;justify-content: flex-end">
                                                        <button id="confirm_button" class="filter_button" style="color:#2c75c9">
                                                            <i class="ion-funnel" style="font-size: 17px" ></i>
                                                            <span>Filter</span>
                                                        </button>
                                                    </li>
                                                </ul>

                                            </div>
                                        </div>

                                    </li>
                                    <li style="list-style: none;margin-left: 10px">
                                        <table id="marker_recom" class="table table-striped table-hover" style="table-layout: fixed">
                                            <thead>
                                            <tr>
                                                <th></th>
                                                <th id="th1">No. of publications >= 10</th>
                                                <th id="th2">Median log2FC >= 2</th>
                                                <th id="th3">Median specificity score >= 0.5</th>
                                                <th id="th4">Tissue counts >= 4</th>
                                                <th >Conserved</th>
                                                <th>Total</th>
                                            </tr>

                                            </thead>
                                            <tbody>
                                            <tr>

                                            </tr>
                                            </tbody>
                                        </table>
                                    </li>
                                    <li class="summary" id="summary6">
                                        The recommended expression datasets for <span th:text="${name}"></span> are summarized below based on quality evaluation of cell clusters.
                                    </li>
                                    <li style="margin-top: 20px;display: flex;justify-content: flex-start">
                                        <div>
                                            <label>Species</label>
                                            <select id="summary_species2" style="width: 200px">

                                            </select>
                                        </div>
                                        <div style="padding-top: 30px;margin-left: 20px">
                                            <input type="checkbox" class="switch switch3">Show value
                                        </div>

                                    </li>
                                    <li style="list-style: none;margin-left: 10px">
                                        <table id="dataset_recom" class="table table-striped table-hover" style="table-layout: fixed">
                                            <thead>
                                            <tr>
                                                <th>Dataset</th>
                                                <th>Top 25% Cell Number</th>
                                                <th>Top 25% Silhoutte coefficient</th>
                                                <th>Top 25% Average Silhoutte coefficient</th>
                                                <th>Top 25% ROGUE score</th>
                                                <th>Top 25% Average ROGUE score</th>
                                            </tr>

                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </li>
                                </ul>
                            </div>
                    </div>
                </div>

                <div class="mypanel">
                    <div class="mypanel-body" id="detail7" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div id="gte" class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#gte_region">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="publication_supported_cell_markers/">Publication-supported cell markers</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the top publication-supported gene markers of this cell type in various tissues. The '*' means if this cell marker is significantly associated with this cell type: *** for < 0.001, ** for [0.001, 0.01) and * for [0.01, 0.05)
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="gte_region" class="collapse in">

                                <div style="display: flex;justify-content: space-between">


                                    <div style="display: flex;justify-content: space-between">
                                        <div >
                                            <label>Species</label>
                                            <select style="width: 200px;text-transform: capitalize" id="cell_marker_heatmap_LS_select">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>

                                            <label>Tissue</label>
                                            <select id="cell_marker_tissue_LS_select" style="width: 200px;">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>

                                        </div>
                                    </div>

                                    <div>
                                        <div id="cell_marker_single" style="height: 250px">

                                        </div>
                                        <div id="cell_marker_heatmap" style="height: 300px;">

                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <a data-toggle="collapse" class="details" href="#description" style="text-decoration: none">
                                        <i class="icon ion-plus-round"></i>
                                        Show details
                                    </a>
                                </div>
                                <div class="table-region collapse" id="description" style="margin-top: 20px">
                                    <table id="table-description"  class="table table-striped table-hover" style="width: 100%">
                                        <thead>
                                        <tr>
                                            <th>Species</th>
                                            <th>Tissue</th>
                                            <th>Tissue ID</th>
                                            <th>Condition</th>
                                            <th>Disease ID</th>
                                            <th>Cell marker</th>
                                            <th>Source</th>
                                            <th>PMID</th>

                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tfoot>
                                    </table>

                                </div>


                            </div>

                        </div>
                    </div>
                </div>
                <div class="mypanel">
                    <div class="mypanel-body" id="detail8" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#cell_markerDE">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_marker_expression_enrichment/">Cell marker expression enrichment</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the top cell markers highly and specifically expressed in this cell type.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="cell_markerDE" class="collapse in">
                                <div>
                                    <input type="checkbox" class="switch switch2" checked>
                                    <span>Show Publication-supported cell markers</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            Show Publication-supported cell markers or rank cell markers by the y-axis value
                                        </span>
                                    </div>
                                </div>
                                <div>
                                    <div style="border-bottom: 1px solid rgba(34,36,38,.15);margin-top:20px;display: flex;justify-content: space-between">
                                        <div>
                                            <div>
                                                <label>Species</label>
                                                <select id="cell_markerDE_barplot_species_select" style="width:200px;text-transform: capitalize">

                                                </select>
                                            </div>

                                            <div>
                                                <label>log2FC greater than</label>
                                                <select id="cell_markerDE_barplot_threshold" style="width:200px;">
                                                    <option value="0.25">0.25</option>
                                                    <option value="0.5">0.5</option>
                                                    <option value="1">1</option>
                                                    <option value="1.5">1.5</option>
                                                    <option value="2">2</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label>FDR less than</label>
                                                <select id="cell_markerDE_barplot_FDR" style="width:200px;">
                                                    <option value="0.001">0.001</option>
                                                    <option value="0.01">0.01</option>
                                                    <option value="0.05" selected>0.05</option>
                                                </select>
                                            </div>



                                        </div>
                                        <div style="display: flex;justify-content: center;margin: 10px 0">
                                            <p id="warn" style="display: none;font-size: 25px">No results</p>
                                        </div>
                                        <div style="display: flex;justify-content: center">
                                            <div id="cell_markerDE_barplot" style="height: 250px">

                                            </div>
                                        </div>
                                    </div>

                                    <div id="DE" style="display: flex;justify-content: space-between;margin-top: 10px">
                                        <div>
                                            <label>Species</label>
                                            <select id="cell_markerDE_species_select" style="width: 200px;text-transform: capitalize">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>

                                        <div>
                                            <div style="display: flex;justify-content: center">
                                                <div id="cell_markerDE_plot" style="height: 250px">

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <a data-toggle="collapse" class="details" href="#DE_table" style="text-decoration: none">
                                            <i class="icon ion-plus-round"></i>
                                            Show details
                                        </a>
                                    </div>
                                    <div id="DE_table" class="collapse" style="margin-top: 20px">
                                        <table style="width:100%" class="table table-striped table-hover" id="cell_marker_DE_table">
                                            <thead>
                                            <tr>
                                                <th>Species</th>

                                                <th>Dataset</th>
                                                <th>Marker</th>
                                                <th>log2FC</th>
                                                <th>
                                                    Pct.cell type
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The expression percentage of this gene in this cell type
                                                    </span>
                                                    </div>
                                                </th>
                                                <th>
                                                    Pct.others
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The expression percentage of this gene in other cell types
                                                    </span>
                                                    </div>
                                                </th>
                                                <th>P value</th>

                                                <th>P value adjusted</th>
                                            </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>

                                        </table>
                                    </div>

                                    <div style="border-top: 1px solid rgba(34,36,38,.15);padding-top:10px;margin-top:20px;display: flex;justify-content: space-between">
                                        <div>
                                            <div>
                                                <label>Species</label>
                                                <select id="specificity_score_species_select" style="width:200px" >
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------------------">
                                                        <option value="All" selected>All</option>
                                                    </optgroup>
                                                </select>
                                            </div>

                                        </div>
                                        <div>
                                            <div>
                                                <p id="ss_tag" style="display: none">No results</p>
                                            </div>
                                            <div id="cell_marker_ss_plot" style="height: 250px">

                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <a data-toggle="collapse" class="details" href="#ss_table" style="text-decoration: none">
                                            <i class="icon ion-plus-round"></i>
                                            Show details
                                        </a>
                                    </div>
                                    <div class="collapse" id="ss_table" style="margin-top: 20px">
                                        <table style="width: 100%;" class="table table-hover table-striped" id="cell_marker_se_table">
                                            <thead>
                                            <tr>
                                                <th>Species</th>
                                                <th>Dataset</th>
                                                <th>Marker</th>
                                                <th>
                                                    Specificity score
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                            Jensen-Shannon (JS) divergence score (0-1) is calculated to quantify the cell type specificity of one marker gene (Cabili MN et al., 2011 ).
                                                        </span>
                                                    </div>
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="mypanel">
                    <div class="mypanel-body" id="detail11" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div  class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#cell_surface_marker_region">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_surface_marker/">Cell surface marker</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the cell surface markers of this cell type predicted to have a membrane-bound protein product.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="cell_surface_marker_region" class="collapse in">

                                <div>
                                    <table id="cell_surface_marker_table" class="table table-hover table-striped" style="width: 100%">
                                        <thead>
                                        <tr>
                                            <th>Cell marker</th>
                                            <th>No. of publications</th>
                                            <th>FDR</th>
                                            <th>Species</th>
                                            <th>Evidence</th>
                                            <th>Antibody</th>
                                            <th>Subcellular location</th>
                                            <th>Protein class</th>
                                        </tr>

                                        </thead>
                                        <tbody>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mypanel">
                    <div class="mypanel-body" id="detail9" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div  class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#cell_similarity_species">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="conserved_and_species_specific_cell_markers/">Conserved and species-specific cell markers</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the conserved cell markers across species as well as cell markers specifically reported in one species.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="cell_similarity_species" class="collapse in">
                                <div>
                                    <label>Tissue</label>
                                    <select  id="cell_similarity_species_tissue_select" style="width: 20%;">
                                        <optgroup>

                                        </optgroup>
                                        <optgroup label="----------------------">

                                        </optgroup>
                                    </select>
                                </div>

                                <div>
                                    <table id="cell_similarity_species_table" class="table table-hover table-striped" style="width: 100%">
                                        <thead>
                                        <tr>
                                            <th>Species1</th>
                                            <th>Species2</th>
                                            <th>
                                                Conservation score
                                                <div class="wrapper" style="height: 18px">
                                                    <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                    <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The (0-1) is calculated by the number of conserved orthologous markers normalized by the union size of cell markers.
                                                    </span>
                                                </div>
                                            </th>
                                            <th>
                                                #Conserved markers
                                            </th>
                                            <th>
                                                #Species1-specific markers
                                            </th>
                                            <th>
                                                #Species2-specific markers
                                            </th>
                                        </tr>

                                        </thead>
                                        <tbody>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mypanel">
                    <div class="mypanel-body" id="detail5" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div  class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#similarity">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cellular_similarity_based_on_markers/">Cellular similarity based on markers</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the similarity between this cell type and other cell types in marker composition. The more similar the cell types based on markers, the shorter the distance on the map.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="similarity" class="collapse in">
                                <div style="display: flex;justify-content: space-between">
                                    <div>
                                        <div id="similarity_species_select">
                                            <label>Species</label>
                                            <select style="width: 200px;text-transform: capitalize">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>
                                        <div >
                                            <label>Tissue</label>
                                            <select id="similarity_tissue_select" style="width:200px">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <div id="similarity_score" style="height:500px">

                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <a data-toggle="collapse" class="details" href="#similarity_region" style="text-decoration: none">
                                        <i class="icon ion-plus-round"></i>
                                        Show details
                                    </a>
                                </div>
                                <div class="collapse" id="similarity_region" style="margin-top: 20px">
                                    <table id="similarity_table" class="table table-hover table-striped" style="width: 100%">
                                        <thead>
                                        <tr>
                                            <th>Species</th>
                                            <th>Tissue</th>
                                            <th>Other cell types</th>
                                            <th>
                                                Marker similarity score
                                                <div class="wrapper" style="height: 18px">
                                                    <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                    <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The similarity score (0-1) is calculated between two cell types by the number of common markers normalized by union of marker set sizes. One represents the same marker sets of two cell types and zero means the two cell types share no common markers.
                                                    </span>
                                                </div>
                                            </th>
                                        </tr>

                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>

                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>





                <div class="mypanel">
                    <div class="mypanel-body" id="detail6" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div  class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#study">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_cluster_evaluation_in_scrna_seq_datasets/">Cell cluster evaluation in scRNA-seq datasets</span>
                                    <div class="wrapper" style="height: 18px">
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the evaluation of cell clusters of this cell type in available scRNA-seq datasets. You can select datasets of higher ROGUE index and Silhouette coefficient indicating less expression heterogeneity and larger difference between intra-cluster distance and inter-cluster, respectively.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="study" class="collapse in">
                                <div>
                                    <label>Species</label>
                                    <select id="study_species_select" style="width: 200px;">

                                    </select>
                                </div>
                                <div style="display: flex;justify-content: space-between">
                                    <div>
                                        <h4 style="font-size:14px;margin-top: 20px">Cell number</h4>
                                        <div>
                                            <input id="cn" type="range" value="1" min="0.25" max="1" step="0.25" style="background: -webkit-linear-gradient(#FAC858, #FAC858) no-repeat #ececec; background-size: 100% 100%;">
                                            <span id="cn_range">1</span>
                                        </div>
                                        <h4 style="font-size:14px;margin-top: 20px">ROGUE score</h4>
                                        <div>
                                            <input id="rs" type="range" value="1" min="0.25" max="1" step="0.25" style="background: -webkit-linear-gradient(#82c2ec, #82c2ec) no-repeat #ececec; background-size: 100% 100%;">
                                            <span id="rs_range">1</span>
                                        </div>
                                        <h4 style="font-size:14px;margin-top: 20px">Average ROGUE score</h4>
                                        <div>
                                            <input id="ars" type="range" value="1" min="0.25" max="1" step="0.25" style="background: -webkit-linear-gradient(#d8eafc, #d8eafc) no-repeat #ececec; background-size: 100% 100%;">
                                            <span id="ars_range">1</span>
                                        </div><h4 style="font-size:14px;margin-top: 20px">Silhoutte coefficient</h4>
                                        <div>
                                            <input id="sc" type="range" value="1" min="0.25" max="1" step="0.25" style="background: -webkit-linear-gradient(#9599e2, #9599e2) no-repeat #ececec; background-size: 100% 100%;">
                                            <span id="sc_range">1</span>
                                        </div>
                                        <h4 style="font-size:14px;margin-top: 20px">Average Silhoutte coefficient</h4>
                                        <div>
                                            <input id="asc" type="range" value="1" min="0.25" max="1" step="0.25" style="background: -webkit-linear-gradient(#b0b6fa, #b0b6fa) no-repeat #ececec; background-size: 100% 100%;">
                                            <span id="asc_range">1</span>
                                        </div>

                                    </div>
                                    <div>
                                        <div id="study_plot" style="height: 350px"></div>
                                    </div>

                                </div>
                                <div style="margin-top:10px">
                                    <a data-toggle="collapse" class="details" href="#cluster_evaluation" style="text-decoration: none">
                                        <i class="icon ion-plus-round"></i>
                                        Show details
                                    </a>
                                </div>
                                <div class="collapse" id="cluster_evaluation" style="margin-top: 20px">
                                    <div style="overflow: scroll">
                                        <table id="study_table" class="table table-hover table-striped" style="width: 100%;">
                                            <thead>
                                            <tr>
                                                <th>Species</th>
                                                <th>Accession Number</th>
                                                <th>Dataset</th>
                                                <th>PMID</th>
                                                <th>Tissue</th>
                                                <th>Cell number</th>
                                                <th>
                                                    ROGUE index
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                        ROGUE is calculated to accurately quantify the purity of identified cell clusters. A ROGUE value greater than 0.9 indicates a cell cluster with high purity.
                                                    </span>
                                                    </div>
                                                </th>
                                                <th>
                                                    Silhouette coefficient
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The Silhouette coefficient ranges from -1 to 1, and 1 means clusters are well apart from each other, 0 means clusters are indifferent, and -1 means clusters are defined in the wrong way.
                                                    </span>
                                                    </div>
                                                </th>
                                                <th>
                                                    Average ROGUE index
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                        Mean ROGUE index of all cell clusters in the dataset.
                                                    </span>
                                                    </div>
                                                </th>
                                                <th>
                                                    Average silhouette coefficient
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                        Mean silhouette coefficient of all cell clusters in the dataset.
                                                    </span>
                                                    </div>
                                                </th>
                                            </tr>

                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
    </div>
</div>





<script type="text/javascript" th:inline="javascript">
    var similarity;
    var ytick;
    var ytickLS;
    var DE_plot;
    var DE_score;
    var DE_bar;
    var CE;


    function getlineplot(id,data){
        // prettier-ignore
        var plotwidth=$("#width").width();
        if($(window).width()>1400){
            $("#"+id).css("width",plotwidth*0.8)

        }
        else if($(window).width()>1024){
            $("#"+id).css("width",plotwidth*0.75)

        }
        else{

        }
        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom);
        data=data.sort(sortROGUE)
        var dateList1 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList1=dateList1.slice(0,dateList1.length*$("#rs").val())


        data=data.sort(sortSilhoutte)
        var dateList2 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList2=dateList2.slice(0,dateList2.length*$("#sc").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList2.indexOf(v) > -1
        })

        data=data.sort(sortCellNumber)
        var dateList3 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList3=dateList3.slice(0,dateList3.length*$("#cn").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList3.indexOf(v) > -1
        })

        data=data.sort(sortAverageROGUE)
        var dateList4 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList4=dateList4.slice(0,dateList4.length*$("#ars").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList4.indexOf(v) > -1
        })
        data=data.sort(sortAverageSilhoutte)
        var dateList5 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList5=dateList5.slice(0,dateList5.length*$("#asc").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList5.indexOf(v) > -1
        })

        data=eval(data).filter(function(e){
            if(e.Dataset.indexOf("_SRS")>=0) {
                return dateList1.indexOf(e.Dataset.split("_")[1])>-1
            }
            else{
                return dateList1.indexOf(e.Dataset)>-1

            }
        })

        data=data.sort(sortSilhoutte)
        dateList1 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        $("#study_table").DataTable({
            data:data,

            columns:[
                {
                    data:"Species2",
                    render:function(data,type,row){

                        return row.Species2
                    }
                },
                {
                    data:"Acession_Number",
                    render:function(data,type,row){
                        if(row.PMID.indexOf("doi")>=0){
                            return "<a target='_blank' href='/celltaxonomy/study/"+row.Acession_Number+"'>"+row.Acession_Number+"</a>"
                        }
                        else{
                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+row.Acession_Number+"</a>"
                        }
                    }
                },
                {
                    data:"Dataset",
                    render:function(data,type,row){
                        if(row.Dataset.indexOf("_SRS")>=0){
                            return row.Dataset.split("_")[1]
                        }
                        else{
                            return row.Dataset
                        }
                    }
                },
                {
                    data:"PMID",
                    render:function(data,type,row){
                        if(row.PMID!="-" && row.PMID.indexOf("doi")>=0){
                            return "<a target='_blank' href='https://doi.org/"+row.PMID.split(": ")[1]+"'>"+row.PMID.split(": ")[1]+"</a>"
                        }
                        else if(row.PMID!="-"){
                            return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+row.PMID+"'>"+row.PMID+"</a>"
                        }
                        else{
                            return row.PMID
                        }
                    }
                },
                {data:"Tissue2"},
                {data:"Cell_Numbers"},
                {
                    data:"ROGUE_index",
                    render:function(data,type,row){
                        return (row.ROGUE_index*1).toPrecision(2)
                    }
                },
                {
                    data:"mean_silhouette",
                    render:function(data,type,row){
                        return (row.mean_silhouette*1).toPrecision(2)
                    }
                },
                {
                    data:"mean_se",
                    render:function(data,type,row){
                        return (row.mean_se*1).toPrecision(2)
                    }
                },
                {
                    data:"avg_silhouette",
                    render:function(data,type,row){
                        return (row.avg_silhouette*1).toPrecision(2)
                    }
                }
            ],
            destroy:true,
            dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
            buttons: [
                'excel'
            ]
        })

        var cellnumber1 = data.map(function (item) {
            return (item.Cell_Numbers*1);
        });
        var valueList1 = data.map(function (item) {
            return (item.ROGUE_index*1).toPrecision(2);
        });
        var avg_rogue1=data.map(function (item) {
            return (item.mean_se*1).toPrecision(2);
        });
        var valueList2 = data.map(function (item) {
            return (item.mean_silhouette*1).toPrecision(2);
        });

        var avg_silhoutte2=data.map(function (item) {
            return (item.avg_silhouette*1).toPrecision(2);
        });

        var option = {
            title: [
                {
                    top:'1%',
                    left: 'center',
                    text: 'Title',
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:15
                    }
                }
            ],
            tooltip: {
                trigger: 'axis'
            },
            xAxis: [
                {
                    data: dateList1,
                    axisLabel:{
                        show:false
                    },
                    name:"Datasets",
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"
                    },
                    nameLocation:"center",
                    nameGap:30,
                    axisLine:{
                        show:false
                    },
                    axisTick:{
                        show:false
                    }
                }
            ],
            yAxis: [
                {
                    name:"Cell number",
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    type:"log",

                },
                {
                    name:"Score",
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    type:"value"

                }
            ],
            grid: {
                left:'6%',
                height:'70%'
            },
            legend:[
                {
                    left:'center',
                    top:'10%',
                    data:[
                        {
                            name:"Cell number",
                            itemStyle:{
                                color:"#FAC858"
                            },
                            lineStyle:{
                                color:"#FAC858"
                            }
                        },
                        {
                            name:"ROGUE",
                            itemStyle:{
                                color:"#82c2ec"
                            },
                            lineStyle:{
                                color:"#82c2ec"
                            }
                        },
                        {
                            name:"Average ROGUE",
                            itemStyle:{
                                color:"#d8eafc"
                            },
                            lineStyle:{
                                color:"#d8eafc"
                            }
                        },
                        {
                            name:"Silhoutte coefficient",
                            itemStyle:{
                                color:"#9599e2"
                            },
                            lineStyle:{
                                color:"#9599e2"
                            }
                        },
                        {
                            name:"Average silhouette coefficient",

                            itemStyle:{
                                color:"#b0b6fa"
                            },
                            lineStyle:{
                                color:"#b0b6fa"

                            }
                        }
                    ],
                    // selected:{
                    //     "Average ROGUE":false,
                    //     "Average silhouette coefficient":false
                    // },
                    textStyle:{
                        fontSize:11,
                        fontFamily:"Arial"
                    }
                }

            ],
            series: [
                {
                    name:"Cell number",

                    type: 'scatter',
                    showSymbol: false,
                    color:'#FAC858',
                    symbol:"diamond",

                    data: cellnumber1,

                },
                {
                    name:"ROGUE",

                    type: 'scatter',
                    showSymbol: false,
                    data: valueList1,
                    color:"#82c2ec",
                    symbol:"triangle",

                    yAxisIndex: 1,

                },
                {
                    name:"Average ROGUE",

                    type: 'scatter',
                    showSymbol: false,
                    data: avg_rogue1,
                    color:"#d8eafc",

                    yAxisIndex: 1,

                },
                {
                    name:"Silhoutte coefficient",
                    type: 'scatter',
                    showSymbol: false,
                    data: valueList2,
                    color:"#9599e2",
                    symbol:"triangle",
                    yAxisIndex: 1
                },
                {
                    name:"Average silhouette coefficient",
                    type: 'scatter',
                    showSymbol: false,
                    data: avg_silhoutte2,
                    color:"#b0b6fa",
                    yAxisIndex: 1
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.top="30%"
            option.grid.height="50%"

            option.grid.left="10%"


        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getbarplot(id,data,title,xtitle,ytitle,name,value){
        var plotwidth=$("#width").width();
        title=title.replace(/ [a-z][a-z] All/g,"")

        $("#"+id).css("width",plotwidth*0.8)

        data=data.sort(sortLS)
        data=data.slice(0,30)
        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom);

        var app = {};
        if(name=="Tissue_standard"){
            ytick=unpack(data.sort(sortTELS),name)
        }
        else{
            ytick=unpack(data.sort(sortLS),name)
            ytickLS=unpack(data.sort(sortLS),name)
        }
        var datas=[];
        var a={}
        a.name="No. of publications"
        a.type="bar"
        a.itemStyle={}
        a.itemStyle.borderRadius=[5,5,0,0]
        a.markPoint={}
        a.markPoint.data=[]
        a.markPoint.silent=true
        a.markPoint.itemStyle={}
        a.markPoint.itemStyle.color="transparent"
        a.markPoint.label={}
        a.markPoint.label.color="black"
        a.markPoint.label.offset=[0,20]

        var tempdata= new Array(ytick.length)
        for (var j=0;j<data.length;j++){
            tempdata[$.inArray(data[j][name],ytick)]=data[j][value]*1
            if(data[j].FDR<0.001){
                a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"***"})
            }
            else if(data[j].FDR<0.01 && data[j].FDR>0.001){
                a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"**"})
            }
            else if(data[j].FDR<0.05 && data[j].FDR>0.01){
                a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"*"})
            }

        }
        a.data=tempdata
        datas.push(a)



        var option;
        option = {

            color:{
                type: 'linear',
                    x: 0,
                    y: 0,
                    x2: 0,
                    y2: 1,
                    colorStops: [{
                    offset: 0, color: '#8bc6ec' // 0% 处的颜色
                }, {
                    offset: 1, color: '#9599e2' // 100% 处的颜色
                }],
                    global: false // 缺省为 false
            },
            title:{
                text:title,
                left:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name:xtitle,

                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    splitNumber:4,
                    position: 'left',
                }

            ],
            tooltip:{
                textStyle:{
                    fontStyle:"Arial"
                }
            },
            grid:{
                height:"60%",
                right:"5%",
                left:"6%"
            },
            xAxis: {
                type: 'category',
                name:ytitle,
                data: ytick,
                axisTick:{
                    show:false
                },
                axisLabel:{
                    rotate:35,
                    fontFamily:"Arial",
                    fontSize:11,
                    formatter:function(value){
                        if(value.length>30){
                            let list=value.split("");
                            let result="";
                            if(list[Math.floor(value.length/2)]==" "){
                                result+=value.slice(0,Math.floor(value.length/2)+1)+"\n";
                                result+=value.slice(Math.floor(value.length/2)+1,value.length)
                                return result
                            }
                            else{
                                result+=value.slice(0,Math.floor(value.length/2)+1)+"-\n";
                                result+=value.slice(Math.floor(value.length/2)+1,value.length)

                                return result
                            }
                        }
                        else{
                            return value
                        }
                    },


                }
            },
            series: datas
        };
        if(ytick.length<=5){
            option.series[0].barWidth='10%'
        }
        else if(ytick.length<=10){
            option.series[0].barWidth='30%'
        }
        else{
            option.series[0].barWidth='90%'

        }
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getbarplotDE(id,data){
        var plotwidth=$("#width").width();
        var title=""

        $("#"+id).css("width",plotwidth*0.8)

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom);
        var total=[]
        var ytick=unpack(data["result"],"markers")
        for(var i=0;i<ytick.length;i++){
            var temp=eval(data["total"]).filter(function(e){
                return e.Gene==ytick[i]

            })
            if(temp.length>0){
                total.push(
                    temp[0].counts
                )
            }

        }

        var app = {};


        var ratio=[]
        data=data['result']
        for(var i=0;i<ytick.length;i++){
            ratio.push((data[i].counts/total[i]).toPrecision(2))
        }

        var option;
        option = {
            color:["#8bc6ec",'#9599e2',"#FAC858"],
            title:{
                text:"Differential expression of cell markers",
                left:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            legend: {
                right:'center',
                top:'14%',
                data:["Differentially expressed datasets (DE)","Expressed datasets (E)","Ratio (DE/E)"],
                textStyle:{
                    fontFamily:"Arial"
                },
                width:"90%"
            },
            yAxis: [
                {
                    type: 'value',
                    name:"Number of datasets",
                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    },
                    splitLine:{
                        show:false
                    },
                    position: 'left',
                },
                {
                    type: 'value',
                    name:"Ratio",
                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    }
                }

            ],
            tooltip:{},
            grid:{
                height:"50%",
                right:"5%",
                left:'6%',
            },
            xAxis: {
                type: 'category',
                data: ytick,
                axisLabel:{
                    fontSize:10,
                    rotate:45,
                    // formatter:function(value,index){
                    //     if(cell_list.indexOf(value)>=0){
                    //         return value+"*"
                    //     }
                    //     else{
                    //         return value
                    //     }
                    // }
                }
            },
            series: [
                {
                    name:"Differentially expressed datasets (DE)",
                    type:"bar",
                    data:unpack(data,"counts")
                },
                {
                    name:"Expressed datasets (E)",
                    type:"bar",
                    data:total
                },
                {
                    name:"Ratio (DE/E)",
                    type:"scatter",
                    yAxisIndex:1,
                    data:ratio
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }

    function getboxplot(id,results){
        var plotwidth=$("#width").width();
        $("#"+id).css("width",plotwidth*0.8)

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom);
        var option;

        var marker=$.unique(unpack(results,"markers").sort());
        var tissue=$.unique(unpack(results,"Tissue").sort());

        var datas = [
            ["markers","avg_log2FC"]
        ];
        results.map(function(e){
            datas.push([e.markers,(e.avg_log2FC*1).toPrecision(2)])
        })
        echarts.registerTransform(window.ecSimpleTransform.aggregate);





        option = {
            color:["#9599e2"],
            dataset: [
                {
                    id:"raw",
                    source:datas
                },
                {
                    id:"aggregate",
                    fromDatasetId:"raw",
                    transform:
                        [
                            {
                                type: 'ecSimpleTransform:aggregate',
                                config: {
                                    resultDimensions: [
                                        { name: 'Min', from: 'avg_log2FC', method: 'min' },
                                        { name: 'Q1', from: 'avg_log2FC', method: 'Q1' },
                                        { name: 'Median', from: 'avg_log2FC', method: 'median' },
                                        { name: 'Q3', from: 'avg_log2FC', method: 'Q3' },
                                        { name: 'Max', from: 'avg_log2FC', method: 'max' },
                                        { name: 'markers', from: 'markers' }
                                    ],
                                    groupBy: 'markers'
                                }
                            },
                            {
                                type: 'sort',
                                config: {
                                    dimension: 'Median',
                                    order: 'desc'
                                }
                            }
                        ]
                },
            ],

            title:{
                text:"Expression fold-change of cell markers between "+$("#name").text()+" and others across datasets (FDR<0.05)",
                right:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            tooltip: {
                trigger: 'item',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '6%',
                top: '20%',
                right: '5%',
                bottom: '15%',
                height:'50%'
            },
            xAxis: {
                type: 'category',
                axisLabel:{
                    interval:0,
                    rotate: 45,
                    fontFamily:"Arial",
                    fontSize:11
                },
                boundaryGap: true,
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                name: 'log2FC',
                splitArea: {
                    show: true,
                    areaStyle:{
                        color:["#ffffff","#f7fdff"]
                    }
                },
                splitLine:{
                    show:false
                },

                nameTextStyle:{
                    fontFamily:"Arial",
                    fontSize:12,
                    fontWeight:'bold'
                },
            },

            series: [
                {
                    name: 'log2FC',
                    type: 'boxplot',
                    datasetId: "aggregate",
                    encode: {
                        y: ['Min', 'Q1', 'Median', 'Q3', 'Max'],
                        x: 'markers',
                        itemName: ['markers'],
                        tooltip: ['Max', 'Q3', 'Median', 'Q1', 'Min']
                    },
                    itemStyle:{
                        borderWidth:1.5
                    }
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getboxplotSS(id,results){
        var plotwidth=$("#width").width();
        $("#"+id).css("width",plotwidth*0.8)

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom);
        var option;

        var tissue=$.unique(unpack(results,"Tissue").sort());
        var datas=[
            ["Marker","Score"]
        ]
        results.map(function(e){
            var temp=e.Cell_specific_score.split(",")
            temp.map(function(f){
                datas.push([e.Gene,(f*1).toPrecision(2)])
            })
        })

        echarts.registerTransform(window.ecSimpleTransform.aggregate);

        option = {
            color:["#9599e2"],
            dataset: [
                {
                    id:"raw",
                    source:datas
                },
                {
                    id:"aggregate",
                    fromDatasetId:"raw",
                    transform:
                        [
                            {
                                type: 'ecSimpleTransform:aggregate',
                                config: {
                                    resultDimensions: [
                                        { name: 'Min', from: 'Score', method: 'min' },
                                        { name: 'Q1', from: 'Score', method: 'Q1' },
                                        { name: 'Median', from: 'Score', method: 'median' },
                                        { name: 'Q3', from: 'Score', method: 'Q3' },
                                        { name: 'Max', from: 'Score', method: 'max' },
                                        { name: 'Marker', from: 'Marker' }
                                    ],
                                    groupBy: 'Marker'
                                }
                            },
                            {
                                type: 'sort',
                                config: {
                                    dimension: 'Median',
                                    order: 'desc'
                                }
                            }
                        ]
                },
            ],
            legend: {
                show:false,
                top: '10%'
            },
            title:{
                text:"Cell marker expression specificity in "+$("#name").text()+" across datasets",
                right:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            tooltip: {
                trigger: 'item',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '6%',
                top: '20%',
                right: '5%',
                bottom: '15%',
                height:'50%'
            },
            xAxis: {
                type: 'category',
                axisLabel:{
                    interval:0,
                    rotate: 45,
                    fontSize:11
                },
                boundaryGap: true,
                splitArea: {
                    show: false
                },
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                name: 'Specificity score',
                nameTextStyle:{
                    fontFamily:"Arial",
                    fontSize:12,
                    fontWeight:'bold'
                },
                splitArea: {
                    show: true,
                    areaStyle:{
                        color:["#ffffff","#f7fdff"]
                    }
                },
                splitLine:{
                    show:false
                }
            },
            series: [
                {
                    name: 'Specificity score',
                    type: 'boxplot',
                    datasetId: "aggregate",
                    encode: {
                        y: ['Min', 'Q1', 'Median', 'Q3', 'Max'],
                        x: 'Tissue',
                        itemName: ['Tissue'],
                        tooltip: ['Max', 'Q3', 'Median', 'Q1', 'Min']
                    },
                    itemStyle:{
                        borderWidth:1.5
                    }
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }

    function getgraph(results){
        var plotwidth=$("#width").width();
        $("#similarity_score").css("width",plotwidth*0.8)
        var chartDom = document.getElementById("similarity_score");
        var myChart = echarts.init(chartDom);
        var option;
        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })
        results=results.slice(0,30);
        var graph={
            categories:[{name:'Cell type'}],
            links:[],
            nodes:[]
        }
        for (var i=0;i<results.length;i++){
            graph.nodes.push({id:i,name:results[i].Other_Cell_standard,value:results[i].score})
            graph.links.push({source:i,target:results.length,value:results[i].score})
        }
        graph.nodes.push({id:results.length,name:results[0].Cell_standard,value:null,itemStyle: {color:'#9599e2'}})

        var title = $("#name").text()+": similarity score in "+$("#similarity_tissue_select").val()+" of "+$("#similarity_species_select select").val()
        title=title.replace(/ [a-z][a-z] All/g,"")

        option = {
            color:["#8bc6ec"],
            title: {
                text: title,
                top: 'top',
                left: 'left',
                textStyle:{
                    fontSize:15,
                    fontFamily:"Arial"
                }
            },
            tooltip: {},

            series: [
                {
                    name: 'Similarity',
                    type: 'graph',
                    layout: 'force',
                    data: graph.nodes,
                    links: graph.links,
                    categories: graph.categories,
                    roam: true,
                    label: {
                        show:true,
                        position: 'top'
                    },
                    zoom:2.5,
                    draggable:true,
                    force: {
                        repulsion: [50,10],
                        edgeLength: [10, 50]
                    }
                }
            ]
        };
        option && myChart.setOption(option);

    }
    function getecharts(id,xtick,ytick,data,title,xtitle,ytitle){
        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom);
        var app = {};
        title=title.replace(/ [a-z][a-z] All/g,"")
        myChart.resize()

        var option;
        var max_legend=0;
        for(i=0;i<data.length;i++){

            max_legend=Math.max(data[i][2],max_legend)
        }
        data = data.map(function (item) {
            return [item[0], item[1], item[2] || '-'];
        });
        option = {
            title:{
                text:title,
                right:'center',
                top:'2%',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            tooltip: {
                trigger:'item',
                axisPointer:{
                    type:"cross"
                },
                position: 'top'
            },
            grid:{
                height:'30%',
                right:"5%",
                left:"6%",
                top:"30%"
            },
            xAxis: {
                type: 'category',
                data: xtick,
                splitArea: {
                    show: true
                },
                axisTick:{
                    show:false
                },
                axisLabel:{
                    interval:0,
                    rotate: 30,
                    fontFamily:"Arial",
                    fontSize:11

                },
                // name:xtitle,
                // nameLocation:'center',
                // nameTextStyle:{
                //     fontWeight:'bold',
                //     fontSize:18
                // },
                // nameGap:110
            },
            yAxis: {
                type: 'category',
                data: ytick,
                splitArea: {
                    show: true
                },
                axisTick:{
                    show:false,

                },
                axisLabel:{
                    interval:0,
                    width:100,
                    overflow:"break",
                    fontFamily:"Arial",
                    fontSize:11
                },
                // name:ytitle,
                // nameLocation:'center',
                // nameTextStyle:{
                //     fontWeight:'bold',
                //     fontSize:18
                // },
                // nameGap:110

            },
            visualMap: {
                min: 0,
                max:max_legend,
                calculable: true,
                right: '0%',
                top:'10%',
                itemWidth:'15',
                itemHeight:70,
                show:false,
                inRange:{
                    color:["#d8eafc","#82c2ec","#b0b6fa","#9599e2"]
                }
            },
            label:{
                fontFamily:"Arial",
                fontSize:10
            },
            series: [{
                type: 'heatmap',
                data: data,
                label: {
                    show: true
                },
                itemStyle:{
                    borderColor:"Black",
                    borderWidth:0.3
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        };
        if(ytick.length>5){
            option.grid.height='70%'
            option.grid.top='10%'
        }
        else{
            option.visualMap.top='10%'
        }
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }

        myChart.setOption(option,true);

    }
    $(document).ready(function(){
        if([[${name}]]!=null){
            getCelltypeDetail([[${name}]],[[${id}]])
        }
        else{
            $.ajax({
                url:'/celltaxonomy/cell_type_statistic',
                type:'post',
                success:function(results){
                    $("#tab1").text(results.length)
                    $("#statistic_table").DataTable({
                        data:results,
                        initComplete: function () {
                            var r = $('#statistic_table tfoot tr')
                            r.find('th').each(function(){
                                $(this).css('padding', '8px 0')
                                // $(this).css('border-top', '1px solid #ddd');
                                // $(this).css('border-bottom', '1px solid #ddd');
                            });
                            $('#statistic_table thead').append(r);
                            $('#search_0').css('text-align', 'center');

                            this.api().columns([1]).every( function () {
                                var column = this;
                                var select = $('<select class="table-select"><option value="">Show All</option></select>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                        );

                                        column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                    } );
                                var n=0;
                                column.data().unique().sort().each( function ( d, j ) {

                                    if(d.toString().indexOf(".")>0 && n==0){
                                        select.append( '<option value="-">-</option>' )
                                        n=1
                                    }
                                    else if(d.toString().indexOf(".")>0){

                                    }
                                    else{
                                        select.append( '<option value="'+d+'">'+d+'</option>' )
                                    }
                                } );
                            } );
                        },

                        columns:[
                            {
                                data:"CT_ID",
                                render:function(data,type,row){
                                    // return "<a class='ctid'>"+row.CT_ID+"</a>"
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.CT_ID+"</a>"

                                }
                            },
                            {
                                data:"Cell_standard",
                                render:function(data,type,row){
                                    // return "<a class='cellstandard'>"+row.Cell_standard+"</a>"
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Cell_standard+"</a>"

                                }
                            },
                            {
                                data:"Specific_Cell_Ontology_ID",
                                render:function(data,type,row){
                                    if(row.Specific_Cell_Ontology_ID.indexOf("_")<0){
                                        if(row.Specific_Cell_Ontology_ID.indexOf(".")>0){
                                            return "-"
                                        }
                                        else{
                                            return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/cl/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Specific_Cell_Ontology_ID.replace(/:/,"_")+"' class='cellontology'>"+row.Specific_Cell_Ontology_ID+"</a>"
                                        }

                                    }
                                    else{
                                        return row.Specific_Cell_Ontology_ID
                                    }
                                }
                            },
                            // {data:"Is_New_Cell_Type"},
                            {
                                data:"Species_num",
                                render:function(data,type,row){
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Species_num+"</a>"
                                }
                            },
                            {
                                data:"Tissue_num",
                                render:function(data,type,row){
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"#tissue_enrichment/'>"+row.Tissue_num+"</a>"
                                }

                            },
                            {
                                data:"Disease_num",
                                render:function(data,type,row){
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Disease_num+"</a>"
                                }
                            },
                            {
                                data:"Marker_num",
                                render:function(data,type,row){
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"#cell_marker_enrichment/' >"+row.Marker_num+"</a>"
                                }
                            },
                            {
                                data:"PMID_num",
                                render:function(data,type,row){
                                    return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"#publication-supported_markers' >"+row.PMID_num+"</a>"
                                }
                            }



                        ],
                        destroy: true,
                        deferRender:true,
                        responsive: true,
                        order:[7,'desc'],
                        dom: '<"row"<"col-lg-4 col-sm-4"l><"col-lg-4 col-sm-4"B><"col-lg-4 col-sm-4"f>>t<"row"<"col-lg-6 col-sm-5"i><"col-lg-6 col-sm-7"p>>',
                        buttons: [
                            'excel'
                        ]

                    });
                    $("#browse").css("height",$("#statistic").parent().parent().height())


                },
                error:function(){
                    console.log("error")
                }
            });
            $.ajax({
                url:'/celltaxonomy/cell_type_statistic2',
                type:'post',
                success:function(results){
                    $("#tab2").text(results.length)

                    $("#statistic_table2").DataTable({
                        data:results,
                        initComplete: function () {
                            var r = $('#statistic_table2 tfoot tr');
                            r.find('th').each(function(){
                                $(this).css('padding', '8px 0')
                                // $(this).css('border-top', '1px solid #ddd');
                                // $(this).css('border-bottom', '1px solid #ddd');
                            });
                            $('#statistic_table2 thead').append(r);
                            $('#search_0').css('text-align', 'center');

                            this.api().columns([1,4]).every( function () {
                                var column = this;
                                var select = $('<select class="table-select"><option value="">Show All</option></select>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                        );

                                        column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                    } );
                                var n=0;
                                column.data().unique().sort().each( function ( d, j ) {

                                    if(d.toString().indexOf(".")>0 && n==0){
                                        select.append( '<option value="-">-</option>' )
                                        n=1
                                    }
                                    else if(d.toString().indexOf(".")>0){

                                    }
                                    else{
                                        select.append( '<option value="'+d+'">'+d+'</option>' )
                                    }
                                } );
                            } );
                        },

                        columns:[
                            {
                                data:"CT_ID"
                            },
                            {
                                data:"Cell_standard"
                            },
                            {
                                data:"Specific_Cell_Ontology_ID",
                                render:function(data,type,row){
                                    if(row.Specific_Cell_Ontology_ID.indexOf("_")<0){
                                        if(row.Specific_Cell_Ontology_ID.indexOf(".")>0){
                                            return "-"
                                        }
                                        else{
                                            return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/cl/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Specific_Cell_Ontology_ID.replace(/:/,"_")+"' class='cellontology'>"+row.Specific_Cell_Ontology_ID+"</a>"
                                        }

                                    }
                                    else{
                                        return row.Specific_Cell_Ontology_ID
                                    }
                                }
                            },
                            {
                                data:"Tissue_ID",
                                render:function(data,type,row){
                                    if(row.Tissue_ID!="-"){
                                        return "<a href='https://www.ebi.ac.uk/ols/ontologies/uberon/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Tissue_ID.replace(/:/,"_")+"'>"+row.Tissue_ID+"</a>"
                                    }
                                    else{
                                        return row.Tissue_ID
                                    }
                                }
                            },
                            {
                                data:"Tissue"
                            }

                        ],
                        destroy: true,
                        deferRender:true,
                        order:[3,"desc"],
                        dom: '<"row"<"col-lg-4 col-sm-4"l><"col-lg-4 col-sm-4"B><"col-lg-4 col-sm-4"f>>t<"row"<"col-lg-6 col-sm-5"i><"col-lg-6 col-sm-7"p>>',
                        buttons: [
                            'excel'
                        ]

                    });

                },
                error:function(){
                    console.log("error")
                }
            });

        }


    });
    function unpack(rows, key) {
        return rows.map(function(row) { return row[key]; });
    }
    function cellmarkerOR(results){
        var plotwidth=$("#width").width();
        results=eval(results).filter(function(e){
            return e.FDR<0.05
        })
        results=eval(results).filter(function(e){
            return e.marker_tissue_number>1
        })
        var results1=eval(results).filter(function(e){
            return e.Tissue_standard==$("#cell_marker_single_select").val()
        })
        results1=results1.slice(0,30);

        cellmarkerORheatmap(results,unpack(results1.sort(sortOR), 'Cell_Marker'))

    }
    function sortOR(a,b){
        return a.OR2-b.OR2
    }
    function sortORasc(a,b){
        return b.OR2-a.OR2
    }
    function sortLS(a,b){
        return b.marker_tissue_number-a.marker_tissue_number
    }
    function sortLSasc(a,b){
        return a.marker_tissue_number-b.marker_tissue_number
    }
    function sortTELS(a,b){
        return b.cell_tissue_number-a.cell_tissue_number
    }
    function sortROGUE(a,b){
        return b.ROGUE_index-a.ROGUE_index
    }
    function sortSilhoutte(a,b){
        return b.mean_silhouette-a.mean_silhouette
    }
    function sortCellNumber(a,b){
        return b.Cell_Numbers-a.Cell_Numbers
    }
    function sortAverageROGUE(a,b){
        return b.mean_se-a.mean_se
    }
    function sortAverageSilhoutte(a,b){
        return b.avg_silhouette-a.avg_silhouette
    }
    function cellmarkerplot(results){
        var plotwidth=$("#width").width();

        // var results2=eval(results).filter(function(e){
        //     return e.Tissue_standard==$("#cell_marker_single_select2").val()
        // })
        var results1=eval(results).filter(function(e){
            return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
        })
        results1=results1.slice(0,30);
        cellmarkerheatmap(results,unpack(results1.sort(sortLSasc), 'Cell_Marker'))


    }
    function cellmarkerheatmap(data,genelist){
        var plotwidth=$("#width").width();
        $("#cell_marker_heatmap").css("width",plotwidth*0.8)
        var results;
        var newdata=[];
        results=eval(data).filter(function(e){
            return e.Species==$("#cell_marker_heatmap_LS_select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard!="All"
        })
        if(results.length==0){
            $("#cell_marker_heatmap").css("display","none")
        }
        else{
            $("#cell_marker_heatmap").css("display","block")
            for(var i=0;i<results.length;i++){
                if($.inArray(results[i].Cell_Marker,ytickLS)>=0){
                    newdata.push(results[i])
                }
            }
            results=newdata;
            var x=$.unique(unpack(results, 'Tissue_standard').sort());
            var n=0;
            var len=ytickLS.length;
            for(i=0;i<len;i++){
                var temp=eval(results).filter(function(e){
                    return e.Cell_Marker==ytickLS[i-n]
                })

                if(temp.length==0){
                    ytickLS.splice(i-n,1)
                    n+=1
                }
            }
            var y=ytickLS.reverse();
            var z=new Array();
            for (i=0;i<results.length;i++){
                z.push([$.inArray(results[i].Tissue_standard,x),$.inArray(results[i].Cell_Marker,y),results[i].marker_tissue_number])

            }
            if(y.length<=5){
                $("#cell_marker_heatmap").css('height',"300px")
            }
            else{
                $("#cell_marker_heatmap").css('height',"450px")
            }

            getecharts("cell_marker_heatmap",x,y,z,"Number of supported publications of top markers for "+$("#name").text()+" in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"Tissue","Gene")

        }
    }

    function getTEplot(id,results,xdata,xtitle,title,hover){


        var plotwidth=$("#width").width();

        var pvalue=unpack(results, 'P_value');
        var FDR=unpack(results, 'FDR');
        var customdata=[];
        for (i=0;i<pvalue.length;i++){
            customdata.push([pvalue[i],FDR[i]])
        }
        var data = [{
            type: 'scatter',
            y: unpack(results, 'Tissue_standard'),
            x: unpack(results, xdata),
            customdata:customdata,
            marker:{
                cmax:1,
                cmin:0,
                color:unpack(results, $("#tissue_enrichment_select select").val().replace(/ /,"_")),
                colorscale:"YlOrRd",
                colorbar:{
                    title:{
                        text:$("#tissue_enrichment_select select").val(),
                        font:{
                            family:"Arial"
                        }
                    },
                    titleside:"Top",
                    len:0.3,
                    thickness:15,
                    y:0.9

                }


            },
            mode:'markers',
            hovertemplate:
                '<i>'+hover+'</i>: %{x}<br>'+
                '<i>P value</i>: %{customdata[0]}<br>'+
                '<i>FDR</i>: %{customdata[1]}'
        }];
        var shapes=[];
        for (i=0;i<results.length;i++){
            var shape={
                y0: data[0].y[i],
                y1: data[0].y[i],
                x0: 0,
                x1: data[0].x[i],
                line: {
                    color: 'grey',
                    width: 1
                },
                type: 'line',
                xref: 'y',
                yref: 'x'
            }
            shapes.push(shape);
        }
        var layout = {
            yaxis: {
                zeroline: false,
                automargin:true,
                categoryorder:"total ascending",
                tickmode:"linear",
                tickvals:unpack(results, 'Tissue_standard'),
                tickfont:{
                    size:14,
                    family:"Arial"
                }

            },
            xaxis:{
                title:{
                    text:xtitle,
                    font:{
                        family:"Arial"
                    }
                }
            },
            title: {
                text:$("#name").text()+": "+title+" in "+$("#tissue_enrichment_species_select select").val(),
                font:{
                    family:"Arial"
                }
            },
            legend:{
                font:{
                    family:"Arial"
                }
            },
            width:plotwidth-40,
            height:450,
            shapes:shapes,
            hovermode:'closest'
        };

        if(unpack(results, 'Tissue_standard').length>40){
            layout.yaxis.tickfont.size=9
            layout.height=700;
        }
        else if(unpack(results, 'Tissue_standard').length>20){
            layout.yaxis.tickfont.size=12;
            layout.height=600;
        }
        Plotly.newPlot(id, data, layout);
    }
    function Similarityplot(results){
        var plotwidth=$("#width").width();

        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })

        results=results.slice(0,30);
        var data = [{
            type: 'scatter',
            y: unpack(results, 'Other_Cell_standard'),
            x: unpack(results, 'score'),
            mode:'markers',
            hovertemplate:
                '<i>Cell type</i>: %{y}<br>'+
                '<i>Score</i>: %{x}'

        }];
        var shapes=[];
        for (i=0;i<results.length;i++){
            var shape={
                y0: data[0].y[i],
                y1: data[0].y[i],
                x0: 0,
                x1: data[0].x[i],
                line: {
                    color: 'grey',
                    width: 1
                },
                type: 'line',
                xref: 'y',
                yref: 'x'
            }
            shapes.push(shape);
        }
        var layout = {
            yaxis: {
                zeroline: false,
                automargin:true,
                categoryorder:"total ascending",
                tickmode:"linear",
                tickvals:unpack(results, 'Other_Cell_standard'),
                tickfont:{
                    size:12,
                    family:"Arial"

                }
            },
            xaxis:{
                title:{
                    text:"Marker similarity score",
                    font:{
                        family:"Arial"
                    }
                }
            },
            title:{
                text:$("#name").text()+": Similarity Score in "+$("#similarity_tissue_select").val()+" of "+$("#similarity_species_select select").val(),
                font:{
                    family:"Arial"
                }
            },
            width:plotwidth-40,
            height:450,
            shapes:shapes
        };

        if(unpack(results, 'Other_Cell_standard').length>40){
            layout.yaxis.tickfont.size=9
            layout.height=700;
        }
        else if(unpack(results, 'Other_Cell_standard').length>20){
            layout.yaxis.tickfont.size=12;
            layout.height=600;
        }
        Plotly.newPlot('similarity_score', data, layout);
    }
    function getCelltypeDetail(name,id){
        $(".breadcrumb").append("<li class='breadcrumb-item active'>"+name+"</li>")
        $(".breadcrumb").children("li").eq(1).html("<a href='/celltaxonomy/celltype'>Cell type</a>")
        $("#statistic").parent().parent().css("display","none");
        $("#browse").parent().parent().css("display","none")
        $("#detail1").parent().parent().css("display","block");
        $("#detail1").css("display","block");
        $("#detail2").css("display","block");
        $("#detail3").css("display","block");
        $("#detail4").css("display","block");
        $("#detail6").css("display","block");
        $("#detail7").css("display","block");
        $("#detail8").css("display","block");
        $("#detail9").css("display","block");
        $("#detail10").css("display","block");
        $("#detail11").css("display","block");
        $("#nav_side_bar").css("display","block");
        name=name.replace(/<[^>]*>/g,"");
        $("#name").text(name);
        if(id.indexOf(".")>0){
            $("#id").text("-");
            $("#id").css("pointer-events","none");
            $("#id").css("color","black");

        }
        else{
            $("#id").text(id);
        }

        $.ajax({
            url:"/celltaxonomy/static/file/cell_name_ID_for_yunf.txt",
            type:'get',
            success:function(results){
                var list=results.replace(/\r/g,"").split("\n");
                var line;
                for(var i=0;i<list.length;i++){
                    line=list[i].split("\t");

                    if(line[1].replace(/_/,":")===$("#id").text()){
                        $("#cell_pic").parent().css("display","block");
                        $("#cell_pic").parent().siblings("div").css("display","block");
                        $("#cell_pic").attr("src","/celltaxonomy/static/img/cell_pic/"+id.replace(/:/,"_")+".jpg");
                        $("#pic_annotation").html("Author: "+line[2]+"</br>Public Domain: This image is in the public domain and thus free of any copyright restrictions. However, as is the norm in scientific publishing and as a matter of courtesy, any user should credit the content provider for any public or private use of this image whenever possible.")
                        $("#cell_pic").parent().attr("href",line[4]);

                        return false
                    }
                }


            }
        });
        $.ajax({
            url:"/celltaxonomy/celltype_summary",
            type:'post',
            data:{
                "id":id
            },
            success:function(results){
                var markers=results[0].Marker_num
                var conditions=results[0].Disease_num
                var tissues=results[0].Tissue_num
                var species=results[0].Species_num
                var publications=results[0].PMID_num
                if(markers===1){markers=markers.toString()+" cell marker"}else{markers=markers.toString()+" cell markers"}
                if(conditions===0 && tissues===0){
                    conditions=""
                    tissues=""
                }
                else if(conditions===0){
                    conditions=""
                    tissues=" in "+tissues.toString()+" tissues"
                }
                else if(tissues===0){
                    tissues=""
                    conditions=" in "+conditions.toString()+" conditions"
                }
                else{
                    if(conditions===1){conditions=" in "+conditions.toString()+" condition"}else{conditions=" in "+conditions.toString()+" conditions"}
                    if(tissues===1){tissues=" and "+tissues.toString()+" tissue"}else{tissues=" and "+tissues.toString()+" tissues"}
                }

                if(publications===1){publications=", supported by "+publications.toString()+" publication"}else if(publications===0){publications=""}else{publications=", supported by "+publications.toString()+" publications"}

                $("#summary1").text(
                    name+" is associated with "+markers+conditions+tissues+" across "+species+" species"+publications+"."
                )
            }
        })
        $.ajax({
            url:"/celltaxonomy/description",
            type:"post",
            dataType:'json',
            data:{"id":id},
            success:function(descriptions){

                $("#table-description").DataTable({
                    data:descriptions,
                    initComplete: function () {
                        var r = $('#table-description tfoot tr');
                        r.find('th').each(function(){
                            $(this).css('padding', '8px 0')
                            // $(this).css('border-top', '1px solid #ddd');
                            // $(this).css('border-bottom', '1px solid #ddd');
                        });
                        $('#table-description thead').append(r);
                        $('#search_0').css('text-align', 'center');

                        this.api().columns([0,1,3,5]).every( function () {
                            var column = this;
                            var select = $('<select class="table-select"><option value="">Show All</option></select>')
                                .appendTo( $(column.footer()).empty() )
                                .on( 'change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );

                                    column
                                        .search( val ? '^'+val+'$' : '', true, false )
                                        .draw();
                                } );

                            column.data().unique().sort().each( function ( d, j ) {
                                select.append( '<option value="'+d+'">'+d+'</option>' )
                            } );
                        } );
                    },

                    columns:[
                        {data:"Species"},
                        {
                            data:"Tissue_standard",
                            render:function(data,type,row){
                                if(row.Tissue_standard!="-"){
                                    // return "<a class='tissue'>"+row.Tissue_standard+"</a>"
                                    return "<a target='_blank' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID2+"'>"+row.Tissue_standard+"</a>"

                                }
                                else{
                                    return row.Tissue_standard
                                }
                            }
                        },
                        {
                            data:"Tissue_UberonOntology_ID",
                            render:function(data,type,row){
                                if(data!="-"){
                                    return "<a style='color: #2c75c9;text-decoration: none' target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/uberon/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+data.replace(/:/,"_")+"'>"+data+"</a>"
                                }
                                else{
                                    return data
                                }
                            }
                        },
                        {data:"Disease_Type"},
                        {
                            data:"Disease_Ontology_ID",
                            render:function(data,type,row){
                                if(row.Disease_Ontology_ID!="-"){
                                    return "<a style='color: #2c75c9;text-decoration: none' target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/doid/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Disease_Ontology_ID.replace(/:/,"_")+"'>"+row.Disease_Ontology_ID+"</a>"
                                }
                                else{
                                    return row.Disease_Ontology_ID
                                }
                            }
                        },
                        {
                            data:"Cell_Marker",
                            render:function(data,type,row){
                                return '<a target="_blank" href="/celltaxonomy/marker/'+row.Gene_ENTREZID2+'">'+data+'</a>'
                            }
                        },
                        {
                            data:"Additional_Information2",
                            render:function(data,type,row){
                                if(row.Additional_Information2=="CellMarker"){
                                    return "<a target='_blank' href='http://bio-bigdata.hrbmu.edu.cn/CellMarker/search.jsp?quickSearchInfo="+$("#name").text()+"'>CellMarker</a>"
                                }

                                // else if(row.Additional_Information2=="PanglaoDB"){
                                //     return "<a target='_blank' href='https://panglaodb.se/search.html?query="+$("#name").text()+"'>PanglaoDB</a>"
                                // }

                                else if(row.Additional_Information2=="SHOGoiN"){
                                    return "<a class='SHOGoiN'>SHOGoiN</a>"
                                }
                                else{

                                    if($.isNumeric(row.Additional_Information2*1)){
                                        return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+row.Additional_Information2+"'>"+row.Additional_Information2+"</a>"
                                    }
                                    else{
                                        return row.Additional_Information2
                                    }
                                }
                            }
                        },
                        {
                            data:"PMID",
                            render:function(data,type,row){
                                if(data!="-"){
                                    return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+data+"'>"+data+"</a>"
                                }
                                else{
                                    return data
                                }
                            }
                        }

                    ],
                    destroy: true,
                    dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    buttons: [
                        'excel'
                    ],
                    order:[2,'desc']

                });


            },
            error:function(){
                console.log("error")
            }
        })
        $.ajax({
            url:"/celltaxonomy/idcard",
            type:"post",
            dataType:'json',
            data:{"id":id},
            success:function(descriptions){
                if(descriptions[0].New_Cell_Type_Annotation=="Not available"){
                    $("#new_cell_type_annotation").text("-")

                }
                else{
                    $("#new_cell_type_annotation").text(descriptions[0].New_Cell_Type_Annotation.split("|")[0])

                }
                $("#ct_id").text(descriptions[0].CT_ID)
                $("#id").attr("href","https://www.ebi.ac.uk/ols/ontologies/cl/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+$("#id").text().replace(/:/g,"_"))


            },
            error:function(){
                console.log("error")
            }
        })


        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            async:false,

            data:{
                "id":id
            },
            success:function(data){
                var result=data["results"];
                if(result.length==0){
                    $("#detail7").css("display","none")
                }
                else{
                    var species;

                    $("#cell_marker_heatmap_LS_select optgroup").empty();
                    species=$.unique(unpack(result,"Species").sort());
                    for(i=0;i<species.length;i++){
                        if(species[i]!="All"){
                            $("#cell_marker_heatmap_LS_select optgroup").eq(0).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                            // $("#cell_markerE_species_select").append(
                            //     "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            // )
                        }
                        else{
                            $("#cell_marker_heatmap_LS_select optgroup").eq(1).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )

                        }
                    }
                    $("#cell_marker_heatmap_LS_select").find("option").eq(0).attr("selected","true");

                    var results=eval(result).filter(function(e){
                        return e.Species==$("#cell_marker_heatmap_LS_select").val()
                    })

                    var tissues = $.unique(unpack(results, "Tissue_standard").sort());
                    $("#cell_marker_tissue_LS_select optgroup").empty()

                    for (var i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#cell_marker_tissue_LS_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                        else{
                            $("#cell_marker_tissue_LS_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                    }
                    $("#cell_marker_tissue_LS_select").find("option").eq(-1).attr("selected",true);

                    results=eval(results).filter(function(e){
                        return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                    })
                    cell_list=$.unique(unpack(results,"Cell_Marker").sort())
                    getbarplot("cell_marker_single",results,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","marker_tissue_number")



                    results=eval(result).filter(function(e){
                        return e.Species==$("#cell_marker_heatmap_LS_select").val()
                    })
                    cellmarkerplot(results);
                    results=eval(results).filter(function(e){
                        return e.Tissue_standard=="All"
                    })
                    results=results.sort(sortLS)
                    results=results.slice(0,10)
                    var genelist=unpack(results,"Cell_Marker")
                    genelist.map(function(e){
                        $("#cell_markerE_marker_select").append(
                            "<option value='"+e+"'>"+e+"</option>"
                        )
                    })
                }




            }
        });
        $.ajax({
            url:"/celltaxonomy/celltype_cell_markerDE",
            type:"post",
            dataType:'json',
            async:false,
            data:{
                "id":id,
                "name":name,
                "species":"All"
            },
            success:function(result) {
                var score=result["score"]

                if (score!="[]"){
                    var species=$.unique(unpack(score,"Species").sort())
                    species.map(function(e){
                        $("#specificity_score_species_select optgroup").eq(0).append(
                            "<option value='"+e+"'>"+e+"</option>"
                        )
                    })

                    $("#specificity_score_species_select").find("option").eq(0).attr("selected","true");
                    var results=[]
                    score.map(function(e){
                        if(e.Species==$("#specificity_score_species_select").val()){
                            var dataset=e.ID.split(",")
                            var ss=e.Cell_specific_score.split(",")
                            var pmid=e.PMID.split(",")
                            for(i=0;i<dataset.length;i++){
                                if(ss[i]!="-"){
                                    results.push(
                                        {
                                            Species:e.Species,
                                            ID:dataset[i],
                                            Gene:e.Gene,
                                            Cell_specific_score:ss[i],
                                            PMID:pmid[i]
                                        }
                                    )
                                }

                            }
                        }

                    })
                    DE_score=results

                    $("#cell_marker_se_table").DataTable({
                        data:results,
                        columns:[
                            {data:"Species"},
                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {data:"Gene"},
                            {data:"Cell_specific_score"}
                        ],
                        destroy:true,
                        dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                        buttons: [
                            'excel'
                        ],
                        order:[3,"desc"]
                    })
                    getboxplotSS("cell_marker_ss_plot",results)
                }
                else{
                }




                var results=result["plot"]
                if(results.length==0 || results=="[]"){
                    $("#detail8").css("display","none")
                }
                else{
                    var species=$.unique(unpack(results,"Species").sort())
                    for(i=0;i<species.length;i++){
                            $("#cell_markerDE_species_select optgroup").eq(0).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                            $("#cell_markerDE_barplot_species_select").eq(0).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                    }
                    $("#cell_markerDE_species_select optgroup").eq(1).append(
                        "<option value='All'>All</option>"
                    )
                    // $("#cell_markerDE_species_select").find("option").eq(-1).attr("selected","true");

                    var plot=[]
                    results.map(function(e){
                        if(e.Species==$("#cell_markerDE_species_select").val()){
                            var dataset=e.ID.split(",")
                            var fc=e.avg_log2FC.split(",")
                            var pct1=e.pct_1.split(",")
                            var pct2=e.pct2.split(",")
                            var pval=e.p_val.split(",")
                            var fdr=e.p_val_adj.split(",")
                            var pmid=e.PMID.split(",")
                            for(i=0;i<dataset.length;i++){
                                if(fdr[i]<0.05){
                                    plot.push(
                                        {
                                            Species:e.Species,
                                            ID:dataset[i],
                                            markers:e.markers,
                                            avg_log2FC:fc[i],
                                            pct_1:pct1[i],
                                            pct_2:pct2[i],
                                            p_val:pval[i],
                                            p_val_adj:fdr[i],
                                            PMID:pmid[i]
                                        }
                                    )
                                }
                            }
                        }

                    })
                    DE_plot=plot
                    getboxplot("cell_markerDE_plot",plot)

                    $("#cell_marker_DE_table").DataTable({
                        data:plot,
                        columns:
                            [
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                        }
                                    }
                                },

                                {
                                    data:"markers",
                                    // render:function(data,type,row){
                                    //     if(row.ENTREZID2!="-"){
                                    //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                    //     }
                                    //     else{
                                    //         return data
                                    //     }
                                    // }
                                },

                                {
                                    data:"avg_log2FC",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_1",
                                    render:function(data,type,row){
                                        return (row.pct_1*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_2",
                                    render:function(data,type,row){
                                        return (row.pct_2*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val_adj",
                                    render:function(data,type,row){
                                        return (row.p_val_adj*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val",
                                    render:function(data,type,row){
                                        return (row.p_val*1).toPrecision(2)
                                    }
                                },


                            ],
                        destroy:true,
                        dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                        buttons: [
                            'excel'
                        ],
                    })
                    $.ajax({
                        url:"/celltaxonomy/celltype_cell_markerDE_bar",
                        type:"post",
                        dataType:'json',
                        async:false,

                        data:{
                            "id":id,
                            "name":name,
                            "species":$("#cell_markerDE_barplot_species_select").val(),
                            "threshold":"0.25",
                            "fdr":$("#cell_markerDE_barplot_FDR").val()
                        },
                        success:function(data){

                            DE_bar=data

                            getbarplotDE("cell_markerDE_barplot",data)
                        }
                    });

                }
            }
        });
        $.ajax({
            url:"/celltaxonomy/surface_marker",
            type:"post",
            data:{
                "id":id
            },
            success:function(results){

                if(results.length>0){
                    var evidence=eval(results).filter(function(e){
                        return e.Evidence_summary=="Evidence at protein level"
                    })
                    evidence=$.unique(unpack(evidence,"Cell_Marker").sort()).length

                    var antibody=eval(results).filter(function(e){
                        return e.Antibody.length>0
                    })
                    antibody=$.unique(unpack(antibody,"Cell_Marker").sort()).length

                    if(evidence===1){evidence=evidence.toString()+" is"}else{evidence=evidence.toString()+" are"}
                    if(antibody===1){antibody=antibody.toString()+" is"}else{antibody=antibody.toString()+" are"}
                    var number=""
                    if(results.length===1){number=results.length.toString()+" cell marker is"}else{number=results.length.toString()+" cell markers are"}
                    $("#summary2").text(
                        number+" predicted to be cell surface markers which code for membrane-bound protein products, in which "+evidence+" supported by evidence at protein level and "+antibody+" annotated with well-characterized antibodies."
                    )


                    $("#cell_surface_marker_table").DataTable({
                        data:results,
                        columns:[
                            {
                                data:"Cell_Marker",
                                render:function(data,type,row){
                                    return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID2+"'>"+data+"</a>"
                                }
                            },
                            {
                                data:"marker_cell_number",
                                render:function(data){
                                    if (data==null){
                                        return "NA"
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },
                            {
                                data:"FDR",
                                render:function(data){
                                    return (data*1).toPrecision(2)
                                }
                            },
                            {
                                data:"Cell_Marker",
                                render:function(){
                                    return "Homo sapiens"
                                }
                            },
                            {data:"Evidence_summary"},
                            {data:"Antibody"},
                            {data:"Subcellular_location"},
                            {
                                data:"Protein_class",
                                render:function(data){
                                    return "<span>"+data.slice(0,30)+" ...</span>"+
                                        "<span class='hover_text' style='display: none'>"+data+"</span>"

                                }
                            }

                        ],
                        order:[1,"desc"],
                        iDisplayLength:5,
                        aLengthMenu:[5,10,15,20]
                    })
                }
                else{
                    $("#detail11").css("display","none")
                    $("#summary2").css("display","none")
                }

            }
        })
        $.ajax({
            url:"/celltaxonomy/similarity",
            type:"post",
            data:{"id":id},
            success:function(results) {
                if(results.length>0){
                    $("#detail5").css("display","block")
                    var temp=eval(results).filter(function(e){
                        return e.Species=="All" && e.Tissue_standard=="All"
                    })
                    var score=0
                    var similar=""
                    temp.map(function(e){
                        if(e.score>score){
                            score=e.score
                            similar=e.Other_Cell_standard
                        }
                    })

                    $("#summary4").text(
                        "Based on reported cell markers, the similarity score between "+name+" and "+similar+" is "+score+"."
                    )
                    similarity=results;
                    $("#similarity_table").DataTable({
                        data:results,
                        initComplete: function () {
                            var r = $('#similarity_table tfoot tr');
                            r.find('th').each(function(){
                                $(this).css('padding', '8px 0')
                                // $(this).css('border-top', '1px solid #ddd');
                                // $(this).css('border-bottom', '1px solid #ddd');
                            });
                            $('#similarity_table thead').append(r);
                            $('#search_0').css('text-align', 'center');

                            this.api().columns([0,1,2]).every( function () {
                                var column = this;
                                var select = $('<select class="table-select" ><optgroup><option value="">Show All</option></optgroup><optgroup label="--------------"></optgroup></select>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                        );

                                        column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                    } );

                                column.data().unique().sort().each( function ( d, j ) {
                                    if(d==="All"){
                                        select.children("optgroup").eq(1).append( '<option value="'+d+'">'+d+'</option>' )
                                    }
                                    else{
                                        select.children("optgroup").eq(0).append( '<option value="'+d+'">'+d+'</option>' )

                                    }
                                } );
                            } );
                        },

                        columns:[
                            {data:"Species"},
                            {
                                data:"Tissue_standard",
                                render:function(data,type,row){
                                    if(row.Tissue_standard!="All"){
                                        // return "<a class='tissue'>"+row.Tissue_standard+"</a>"
                                        return "<a target='_blank' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID2+"'>"+row.Tissue_standard+"</a>"

                                    }
                                    else{
                                        return row.Tissue_standard
                                    }
                                }
                            },
                            {
                                data:"Other_Cell_standard",
                                render:function(data,type,row){
                                    // return "<a class='celltype'>"+row.Other_Cell_standard.replace(/_/g," ")+"</a>"
                                    return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID_y+"'>"+row.Other_Cell_standard.replace(/_/g," ")+"</a>"
                                }
                            },
                            {data:"score"},
                            {data:"Tissue_UberonOntology_ID2",visible:false},
                            {data:"other_cell_ID",visible:false}
                        ],
                        destroy:true,
                        dom: '<"row"<"col-lg-6"l><"col-lg-6"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>'
                    });

                    var species=$.unique(unpack(results,"Species").sort());

                    for(i=0;i<species.length;i++){
                        if(species[i]!="All"){
                            $("#similarity_species_select select optgroup").eq(0).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                        }
                        else{
                            $("#similarity_species_select select optgroup").eq(1).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                        }

                    }
                    $("#similarity_species_select select").find("option").eq(0).attr("selected","true");

                    results=eval(results).filter(function(e){
                        return e.Species==$("#similarity_species_select select").val()
                    })
                    var tissues = $.unique(unpack(results, "Tissue_standard").sort());

                    for (i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#similarity_tissue_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                        else{
                            $("#similarity_tissue_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                    }
                    $("#similarity_tissue_select").find("option").eq(-1).attr("selected","true");


                    getgraph(results)
                }
                else{
                    $("#detail5").css("display","none")
                    $("#summary4").css("display","none")
                }


            },


        })
        $.ajax({
            url:"/celltaxonomy/species_similarity",
            type:"post",
            data:{"id":id},
            success:function(results) {


                if(results.length==0){
                    $("#detail9").css("display","none")
                    $("#summary3").css("display","none")
                }
                else{
                    var conserved=results[0].common_marker_number
                    if(conserved*1===0){
                        $("#summary3").css("display","none")
                    }
                    else{
                        $("#summary3").text(
                            conserved+" cell markers are conserved across various species."
                        )
                    }

                    var namelist=[];
                    var idlist=[];
                    results.map(function(e){
                        if($.inArray(e["Tissue_standard"],namelist)<0){
                            namelist.push(e["Tissue_standard"])
                            idlist.push(e["Tissue_UberonOntology_ID2"])
                        }
                    })
                    var tissue=namelist
                    tissue.map(function(d){
                        if(d!="All"){
                            $("#cell_similarity_species_tissue_select optgroup").eq(0).append("<option value='"+idlist[$.inArray(d,namelist)]+"'>"+d+"</option>")
                        }
                        else{
                            $("#cell_similarity_species_tissue_select optgroup").eq(1).append("<option value='"+"-"+"'>"+d+"</option>")
                        }
                    })
                    results=eval(results).filter(function(e){
                        return e.Tissue_standard==$("#cell_similarity_species_tissue_select option:selected").text()
                    })
                    $("#cell_similarity_species_table").DataTable({
                        data:results,
                        columns:[
                            {data:"Species1"},
                            {
                                data:"Species2"

                            },
                            {
                                data:"score",
                                render:function(data){
                                    return (data*1).toPrecision(2)
                                }
                            },
                            {
                                data:"common_marker_number",
                                render:function(data,type,row){
                                    if(data!="0"){
                                        return '<a target="_blank" href="/celltaxonomy/species_similarity?cell='+$("#ct_id").text()+'&type=common&species1='+row.Species1+'&species2='+row.Species2+'&tissue='+row.Tissue_UberonOntology_ID2+'">'+data+'</a>'
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },
                            {
                                data:"species1_specific_marker_num",
                                render:function(data,type,row){
                                    if(data!="0"){
                                        return '<a target="_blank" href="/celltaxonomy/species_similarity?cell='+$("#ct_id").text()+'&type=species1&species1='+row.Species1+'&species2='+row.Species2+'&tissue='+row.Tissue_UberonOntology_ID2+'">'+data+'</a>'
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },
                            {
                                data:"species2_specific_marker_num",
                                render:function(data,type,row){
                                    if(data!="0"){
                                        return '<a target="_blank" href="/celltaxonomy/species_similarity?cell='+$("#ct_id").text()+'&type=species2&species1='+row.Species1+'&species2='+row.Species2+'&tissue='+row.Tissue_UberonOntology_ID2+'">'+data+'</a>'
                                    }
                                    else{
                                        return data
                                    }
                                }
                            }
                        ],
                        destroy:true,
                        dom: '<"row"<"col-lg-6"l><"col-lg-6"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>'

                    });
                }

            }


        })

        $.ajax({
            url:'/celltaxonomy/study_table',
            type:"post",
            data:{"id":id},
            success:function(results){

                if(results.length==0){
                    $("#detail6").css("display","none")
                }
                else{
                    CE=results

                    var species=$.unique(unpack(results,"Species2").sort())
                    species.map(function(e){
                        $("#study_species_select").append(
                            "<option value='"+e+"'>"+e+"</option>"
                        )
                    })
                    results=eval(results).filter(function(e){
                        return e.Species2==$("#study_species_select").val()
                    })

                    getlineplot("study_plot",results)
                }
            }
        })
        $.ajax({
            url:"/celltaxonomy/recommend_datasets",
            type:'post',
            data:{
                id:id,
                species:"All"
            },
            success:function(results){
                if(results.length>0){
                    var species=$.unique(unpack(results,"Species").sort())
                    species.map(function(e){
                        $("#summary_species2").append(
                            "<option value='"+e+"'>"+e+"</option>"
                        )
                    })

                    results=eval(results).filter(function(e){
                        return e.Species==$("#summary_species2").val()
                    })
                    results=results.slice(0,10)
                    $("#dataset_recom").DataTable({
                        data:results,
                        columns:[
                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data.split("_")[1]+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {
                                data:"Cell_number_c",
                                render:function(data,type,row){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+row.Cell_number+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+row.Cell_number+'</span>'

                                    }
                                }
                            },
                            {
                                data:"silhoutte_c",
                                render:function(data,type,row){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+(row.silhoutte*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+(row.silhoutte*1).toPrecision(2)+'</span>'

                                    }
                                }
                            },
                            {
                                data:"Mean_silhoutte_c",
                                render:function(data,type,row){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+(row.Mean_silhoutte*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+(row.Mean_silhoutte*1).toPrecision(2)+'</span>'

                                    }
                                }
                            },
                            {
                                data:"ROGUE_c",
                                render:function(data,type,row){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+(row.ROGUE*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+(row.ROGUE*1).toPrecision(2)+'</span>'

                                    }
                                }
                            },
                            {
                                data:"Mean_ROGUE_c",
                                render:function(data,type,row){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+(row.Mean_ROGUE*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+(row.Mean_ROGUE*1).toPrecision(2)+'</span>'

                                    }
                                }
                            }

                        ],
                        ordering:false,
                        destroy:true,
                        iDisplayLength:5,
                        lengthChange:false,
                        searching:false
                    })
                }
                else{
                    $("#summary6").css("display","none")
                    $("#summary6").next().css("display","none")
                    $("#summary6").next().next().css("display","none")

                }



            }
        })
        $.ajax({
            url:"/celltaxonomy/recommend_markers",
            type:'post',
            data:{
                id:id,
                name:name,
                species:"All"
            },
            success:function(results){
                if(results.length>0){
                    var species=$.unique(unpack(results,"Species").sort())
                    species.map(function(e){
                        $("#summary_species").append(
                            "<option value='"+e+"'>"+e+"</option>"
                        )
                    })

                    results=eval(results).filter(function(e){
                        return e.Species==$("#summary_species").val()
                    })
                    results=eval(results).filter(function(e){
                        return e.top10_ps*1 >= $("#filter_search1").val() || e.fc >=$("#filter_search2").val() || e.specificity >=$("#filter_search3").val() || e.tc >=$("#filter_search4").val()
                    })
                    $("#marker_recom").DataTable({
                        data:results,
                        columns:[
                            {
                                data:'Marker',
                                render:function(data,type,row){
                                    return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ID+"'>"+data+"</a>"
                                }
                            },
                            {
                                data:'top10_ps',
                                render:function(data,type,row){
                                    if(data>=$("#filter_search1").val()){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+row.top10_ps+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value" style="display: none">'+row.top10_ps+'</span>'
                                    }
                                }
                            },
                            {
                                data:'fc',
                                render:function(data,type,row){
                                    if(data>=$("#filter_search2").val()){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.fc*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value" style="display: none">'+(row.fc*1).toPrecision(2)+'</span>'
                                    }
                                }
                            },
                            {
                                data:'specificity',
                                render:function(data,type,row){
                                    if(data*1>=$("#filter_search3").val()){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.specificity*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value" style="display: none">'+(row.specificity*1).toPrecision(2)+'</span>'
                                    }
                                }
                            },
                            {
                                data:'tc',
                                render:function(data,type,row){
                                    if(data*1>=$("#filter_search4").val()){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>'+
                                            '<span class="summary_value" style="display: none"> ('+(row.tc*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value" style="display: none">'+(row.tc*1).toPrecision(2)+'</span>'
                                    }
                                }
                            },
                            {
                                data:'conserved',
                                render:function(data){
                                    if(data==="1"){
                                        return '<i class="icon ion-checkmark-round"></i>'
                                    }
                                    else{
                                        return ""
                                    }
                                }
                            },
                            {
                                data:"total",
                                render:function(data,type,row){
                                    var n=0
                                    if(row.top10_ps*1>=$("#filter_search1").val()){
                                        n+=1
                                    }
                                    if(row.fc*1>=$("#filter_search2").val()){
                                        n+=1
                                    }
                                    if(row.specificity*1>=$("#filter_search3").val()){
                                        n+=1
                                    }
                                    if(row.tc*1>=$("#filter_search4").val()){
                                        n+=1
                                    }
                                    if(row.conserved===1){
                                        n+=1
                                    }
                                    return n
                                },
                                visible:false
                            }
                        ],
                        order:[
                            [6,'desc'],[1,'desc']
                        ],
                        destroy:true,
                        iDisplayLength:5,
                        lengthChange:false,
                        searching:false,
                        responsive: true
                    })
                }
                else{
                    $("#summary5").css("display","none")
                    $("#summary5").next().css("display","none")
                    $("#summary5").next().next().css("display","none")

                }

            }
        })


    }
    $("#cell_surface_marker_table tbody").on("mouseenter","tr",function(){
        $(this).find(".hover_text").siblings().css("display","none")

        $(this).find(".hover_text").css("display","block")
    })
    $("#cell_surface_marker_table tbody").on("mouseleave","tr",function(){
        $(this).find(".hover_text").css("display","none")
        $(this).find(".hover_text").siblings().css("display","block")

    })
    function icon(){
        $(".icon").each(function(){
            if($(this).parent().parent().next().hasClass("in")){
                $(this).removeClass("ion-chevron-right")
                $(this).addClass("ion-chevron-down")
            }
            else{
                $(this).removeClass("ion-chevron-down")
                $(this).addClass("ion-chevron-right")
            }
        })
    }
    function zTreeOnClick(event, treeId, treeNode){
        $.ajax({
            url:"/celltaxonomy/idcard",
            type:"post",
            dataType:'json',
            data:{"id":treeNode.id},
            success:function(descriptions){
                var a=document.createElement('a')
                a.href="/celltaxonomy/celltype/"+descriptions[0].CT_ID;
                a.click()
            },
            error:function(){
                console.log("error")
            }
        })


    };
    $.ajax({
        url:"/celltaxonomy/static/json/celltype.json",
        type:'GET',
        dataType: 'json',
        async:false,
        success:function(data){
            var zTreeObj;
            // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
            var setting = {
                data: {
                    simpleData: {
                        enable: true
                    }
                },
                callback:{
                    onClick:zTreeOnClick
                },
                check: {
                    enable: true//checkbox
                },
                view: {
                    nameIsHTML: true, //允许name支持html
                    selectedMulti: false
                },
                edit: {
                    enable: false,
                    editNameSelectAll: false
                }
            };
            // zTree 的数据属性，深入使用请参考 API 文档（zTreeNode 节点数据详解）
            var zNodes = data;
            $(document).ready(function(){
                zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes);
                fuzzySearch('treeDemo','#key',null,true); //初始化模糊搜索方法
            });
        }
    });
    var list;
    var plotwidth=$("#width").width();

    window.onload=function(){
        setTimeout(
            "nav_side_bar_set()",
            2000
        )
    }
    window.onscroll=function(){
        nav_side_bar_scroll()
    }
    $.ajax({
        url:"/celltaxonomy/static/file/marker_cell_type_list",
        type:'get',
        success:function(results){
            list=results.replace(/\r/g,"").toLowerCase().split("\n");
            $(".node_name").each(function(){
                if($.inArray($(this).text().toLowerCase(),list)!=-1){
                    // $(this).css("background","#ffe6b0")
                    $(this).css("text-decoration","underline")
                }
                else{
                    $(this).parent().css("pointer-events","none")
                }
            })
        }
    });
    $(".mypanel-body").on("click",".switch",function(){
        $(".node_name").each(function(){
            if($.inArray($(this).text().toLowerCase(),list)!=-1){
                // $(this).css("background","#ffe6b0")
                $(this).css("text-decoration","underline")

            }
            else{
                $(this).parent().css("pointer-events","none")
            }
        })
    });

    $("#key").change(function(){
        $(".node_name").each(function(){
            if($.inArray($(this).text().toLowerCase(),list)!=-1){
                $(this).css("background","#ffe6b0")
            }
        })
    });
    $("#study_species_select").change(function(){
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })

        getlineplot("study_plot",results)
    })
    $("#summary_species").change(function(){
        $.ajax({
            url:"/celltaxonomy/recommend_markers",
            type:'post',
            data:{
                id:[[${id}]],
                name:[[${name}]],
                species:$("#summary_species").val()
            },
            success:function(results){
                $("#marker_recom").DataTable({
                    data:results,
                    columns:[
                        {
                            data:'Marker',
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ID+"'>"+data+"</a>"
                            }
                        },
                        {
                            data:'top10_ps',
                            render:function(data,type,row){
                                if(data>=$("#filter_search1").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value" style="display: none"> ('+row.top10_ps+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+row.top10_ps+'</span>'
                                }
                            }
                        },
                        {
                            data:'fc',
                            render:function(data,type,row){
                                if(data>=$("#filter_search2").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value" style="display: none"> ('+(row.fc*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+(row.fc*1).toPrecision(2)+'</span>'
                                }
                            }
                        },
                        {
                            data:'specificity',
                            render:function(data,type,row){
                                if(data*1>=$("#filter_search3").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value" style="display: none"> ('+(row.specificity*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+(row.specificity*1).toPrecision(2)+'</span>'
                                }
                            }
                        },
                        {
                            data:'tc',
                            render:function(data,type,row){
                                if(data*1>=$("#filter_search4").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>'+
                                        '<span class="summary_value" style="display: none"> ('+(row.tc*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+(row.tc*1).toPrecision(2)+'</span>'
                                }
                            }
                        },
                        {
                            data:'conserved',
                            render:function(data){
                                if(data==="1"){
                                    return '<i class="icon ion-checkmark-round"></i>'
                                }
                                else{
                                    return ""
                                }
                            }
                        },
                        {
                            data:"total",
                            render:function(data,type,row){
                                var n=0
                                if(row.top10_ps*1>=$("#filter_search1").val()){
                                    n+=1
                                }
                                if(row.fc*1>=$("#filter_search2").val()){
                                    n+=1
                                }
                                if(row.specificity*1>=$("#filter_search3").val()){
                                    n+=1
                                }
                                if(row.tc*1>=$("#filter_search4").val()){
                                    n+=1
                                }
                                if(row.conserved===1){
                                    n+=1
                                }
                                return n
                            },
                            visible:false
                        }
                    ],
                    order:[
                        [6,'desc'],[1,'desc']
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    lengthChange:false,
                    searching:false,
                    responsive: true
                })
            }
        })

    })
    $("#summary_species2").change(function(){
        $.ajax({
            url:"/celltaxonomy/recommend_datasets",
            type:'post',
            data:{
                id:[[${id}]],
                species:$("#summary_species2").val()
            },
            success:function(results){
                results=results.slice(0,10)
                $("#dataset_recom").DataTable({
                    data:results,
                    columns:[

                        {
                            data:"ID",
                            render:function(data,type,row){
                                if(data.indexOf("_SRS")>=0){
                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data.split("_")[1]+"</a>"
                                }
                                else{
                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data+"</a>"
                                }
                            }
                        },
                        {
                            data:"Cell_number_c",
                            render:function(data,type,row){
                                if(data==="1"){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value3" style="display: none"> ('+row.Cell_number+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value3" style="display: none">'+row.Cell_number+'</span>'

                                }
                            }
                        },
                        {
                            data:"silhoutte_c",
                            render:function(data,type,row){
                                if(data==="1"){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value3" style="display: none"> ('+(row.silhoutte*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value3" style="display: none">'+(row.silhoutte*1).toPrecision(2)+'</span>'

                                }
                            }
                        },
                        {
                            data:"Mean_silhoutte_c",
                            render:function(data,type,row){
                                if(data==="1"){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value3" style="display: none"> ('+(row.Mean_silhoutte*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value3" style="display: none">'+(row.Mean_silhoutte*1).toPrecision(2)+'</span>'

                                }
                            }
                        },
                        {
                            data:"ROGUE_c",
                            render:function(data,type,row){
                                if(data==="1"){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value3" style="display: none"> ('+(row.ROGUE*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value3" style="display: none">'+(row.ROGUE*1).toPrecision(2)+'</span>'

                                }
                            }
                        },
                        {
                            data:"Mean_ROGUE_c",
                            render:function(data,type,row){
                                if(data==="1"){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value3" style="display: none"> ('+(row.Mean_ROGUE*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value3" style="display: none">'+(row.Mean_ROGUE*1).toPrecision(2)+'</span>'

                                }
                            }
                        }
                    ],
                    ordering:false,
                    destroy:true,
                    iDisplayLength:5,
                    lengthChange:false,
                    searching:false
                })
            }
        })

    })

    $("#tissue_enrichment_species_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_tissue_pie",
            type:"post",
            dataType:'json',
            data:{"id":$("#id").text()},
            success:function(results){
                results=eval(results).filter(function(e){
                    return e.Species==$("#tissue_enrichment_species_select select").val()
                })
                if(results.length>0){
                    $("#or_tag").css("display","none")
                    $("#tissue_enrichment_or").css("display","block")
                    getpie("tissue_enrichment_or",results,"Tissue_standard")
                }
                else{
                    $("#tissue_enrichment_or").css("display","none")
                    $("#or_tag").css("display","block")
                }
            },
            error:function(){
                console.log("error")
            }
        })
        $.ajax({
            url:"/celltaxonomy/cell_condition_pie",
            type:"post",
            dataType:'json',
            data:{"id":[[${id}]]},
            success:function(results){
                results=eval(results).filter(function(e){
                    return e.Species==$("#tissue_enrichment_species_select select").val()
                })
                if(results.length>0){
                    $("#stat_tag").css("display","none")
                    $("#tissue_enrichment_stat").css("display","block")
                    getpie("tissue_enrichment_stat",results,"Disease_Type")
                }
                else{
                    $("#stat_tag").css("display","block")
                    $("#tissue_enrichment_stat").css("display","none")
                }
            },
            error:function(){
                console.log("error")
            }
        })

    })

    $("#cell_marker_species_select").change(function() {
        $.ajax({
            url: "/celltaxonomy/cell_marker_single",
            type: "post",
            dataType: 'json',
            data: {"id": $("#id").text()},
            success: function (data) {
                var results=data["results"];

                if(results.length>0){
                    results = eval(results).filter(function (e) {
                        return e.Species == $("#cell_marker_species_select select").val()
                    });
                    results=eval(results).filter(function(e){
                        return e.FDR<0.05
                    })
                    results=eval(results).filter(function(e){
                        return e.marker_tissue_number>1
                    })
                    var tissues = $.unique(unpack(results, "Tissue_standard").sort());

                    $("#cell_marker_single_select optgroup").empty()
                    // $("#cell_marker_single_select2 optgroup").empty()
                    for (var i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#cell_marker_single_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                        else{
                            $("#cell_marker_single_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                    }
                    for (var i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#cell_marker_single_select2 optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                        else{
                            $("#cell_marker_single_select2 optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                    }
                    $("#cell_marker_single_select").find("option").eq(-1).attr("selected",true);

                    cellmarkerOR(results);


                }
                else{
                    $("#detail7").css("display","none")
                }

            },

            error: function () {
                console.log("error")
            }
        })
    })

    $("#cell_marker_single_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                id:$("#id").text()
            },
            success:function(results){
                results=eval(results["results"]).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                });
                cellmarkerOR(results);

                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_single_select").val()
                })

                results=eval(results).filter(function(e){
                    return e.FDR<0.05
                })
                results=eval(results).filter(function(e){
                    return e.marker_tissue_number>1
                })



            }
        })


    })
    $("#cell_marker_tissue_LS_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                id:[[${id}]]
            },
            success:function(results){


                var result=eval(results["results"]).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                });
                result=eval(result).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                })

                getbarplot("cell_marker_single",result,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","marker_tissue_number")

                results=eval(results["results"]).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                });
                cellmarkerplot(results)


            }
        })


    })


    $("#cell_marker_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                "id":$("#id").text()
            },
            success:function(data){
                var result=data["results"];
                var results;
                results=eval(result).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                })
                cellmarkerOR(results);
                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_single_select").val()
                })



            }
        });

    })
    $("#cell_marker_LS_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                "id":$("#id").text()
            },
            success:function(data){
                var result=data["results"];
                var results;
                results=eval(result).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                })
                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                })


                getbarplot("cell_marker_single",results,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","marker_tissue_number")

                results=eval(result).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                })
                cellmarkerplot(results);




            }
        });

    })

    $("#cell_marker_heatmap_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{"id":$("#id").text()},
            success:function(data) {
                cellmarkerheatmap(data)

            },
            error:function(){
                console.log("error")
            }
        })

    })
    $("#cell_marker_heatmap_LS_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{"id":[[${id}]]},
            success:function(data) {
                var results=data["results"]
                results=eval(results).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                })

                $("#cell_marker_tissue_LS_select optgroup").empty()
                var tissues = $.unique(unpack(results, "Tissue_standard").sort());

                for (var i = 0; i < tissues.length; i++) {
                    if(tissues[i]!="All"){
                        $("#cell_marker_tissue_LS_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                    }
                    else{
                        $("#cell_marker_tissue_LS_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                    }
                }
                $("#cell_marker_tissue_LS_select").find("option").eq(-1).attr("selected",true);
                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                })
                getbarplot("cell_marker_single",results,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","marker_tissue_number")

                results=data["results"]
                results=eval(results).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                })


                cellmarkerplot(results)


            },
            error:function(){
                console.log("error")
            }
        })

    })
    $("#similarity_species_select").change(function(){
        var results=similarity;
        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })

        var tissues = $.unique(unpack(results, "Tissue_standard").sort());


        $("#similarity_tissue_select optgroup").empty();
        for (i = 0; i < tissues.length; i++) {
            if(tissues[i]!="All"){
                $("#similarity_tissue_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
            }
            else{
                $("#similarity_tissue_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
            }
        }
        $("#similarity_tissue_select").find("option").eq(-1).attr("selected","true");

        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })

        getgraph(results)
    })
    $("#similarity_tissue_select").change(function(){
        var results=similarity;
        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })

       getgraph(results)
    })

    $("#cell_markerDE_species_select").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {
                    var results=result['plot']

                    var plot=[]
                    results.map(function(e){
                        var dataset=e.ID.split(",")
                        var fc=e.avg_log2FC.split(",")
                        var pct1=e.pct_1.split(",")
                        var pct2=e.pct2.split(",")
                        var pval=e.p_val.split(",")
                        var fdr=e.p_val_adj.split(",")
                        var pmid=e.PMID.split(",")
                        for(i=0;i<dataset.length;i++){
                            if(fdr[i]<0.05){
                                plot.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        markers:e.markers,
                                        avg_log2FC:fc[i],
                                        pct_1:pct1[i],
                                        pct_2:pct2[i],
                                        p_val:pval[i],
                                        p_val_adj:fdr[i],
                                        PMID:pmid[i]
                                    }
                                )
                            }

                        }
                    })
                    getboxplot("cell_markerDE_plot",plot)

                    $("#cell_marker_DE_table").DataTable({
                        data:plot,
                        columns:
                            [
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                        }
                                    }
                                },

                                {
                                    data:"markers",
                                    // render:function(data,type,row){
                                    //     if(row.ENTREZID2!="NA"){
                                    //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                    //     }
                                    //     else{
                                    //         return data
                                    //     }
                                    // }
                                },

                                {
                                    data:"avg_log2FC",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_1",
                                    render:function(data,type,row){
                                        return (row.pct_1*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_2",
                                    render:function(data,type,row){
                                        return (row.pct_2*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val",
                                    render:function(data,type,row){
                                        return (row.p_val*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val_adj",
                                    render:function(data,type,row){
                                        return (row.p_val_adj*1).toPrecision(2)
                                    }
                                },



                            ],
                        destroy:true,
                        dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                        buttons: [
                            'excel'
                        ],
                    })

                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {
                    var results=result["plot"]
                    if(results=="[]" || results.length==0){
                        $("#detail8").css("display","none")
                    }
                    else{
                        var plot=[]
                        results.map(function(e){
                            var dataset=e.ID.split(",")
                            var fc=e.avg_log2FC.split(",")
                            var pct1=e.pct1.split(",")
                            var pct2=e.pct2.split(",")
                            var pval=e.p_val.split(",")
                            var fdr=e.p_val_adj.split(",")
                            var pmid=e.PMID.split(",")
                            for(i=0;i<dataset.length;i++){
                                if(fdr[i]<0.05){
                                    plot.push(
                                        {
                                            Species:e.Species,
                                            ID:dataset[i],
                                            markers:e.markers,
                                            avg_log2FC:fc[i],
                                            pct_1:pct1[i],
                                            pct_2:pct2[i],
                                            p_val:pval[i],
                                            p_val_adj:fdr[i],
                                            PMID:pmid[i]
                                        }
                                    )
                                }
                            }
                        })

                        getboxplot("cell_markerDE_plot",plot)

                        $("#cell_marker_DE_table").DataTable({
                            data:plot,
                            columns:
                                [
                                    {data:"Species"},
                                    {
                                        data:"ID",
                                        render:function(data,type,row){
                                            if(data.indexOf("_SRS")>=0){
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                            }
                                            else{
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                            }
                                        }
                                    },

                                    {
                                        data:"markers",
                                        // render:function(data,type,row){
                                        //     if(row.ENTREZID2!="-"){
                                        //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                        //     }
                                        //     else{
                                        //         return data
                                        //     }
                                        // }
                                    },

                                    {
                                        data:"avg_log2FC",
                                        render:function(data,type,row){
                                            return (data*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_1",
                                        render:function(data,type,row){
                                            return (row.pct_1*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_2",
                                        render:function(data,type,row){
                                            return (row.pct_2*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val_adj",
                                        render:function(data,type,row){
                                            return (row.p_val_adj*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val",
                                        render:function(data,type,row){
                                            return (row.p_val*1).toPrecision(2)
                                        }
                                    },


                                ],
                            destroy:true,
                            dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            buttons: [
                                'copy', 'excel', 'pdf'
                            ],
                        })


                    }
                }
            });

        }

    })
    $("#cell_markerDE_barplot_species_select").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){

                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
        }

    })

    $("#cell_markerDE_barplot_threshold").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    var tempdata=data["result"]
                    if(tempdata.length==0) {
                        $("#cell_markerDE_barplot").css("display","none")
                        $("#warn").css("display","block")
                    }
                    else{
                        $("#cell_markerDE_barplot").css("display","block")
                        $("#warn").css("display","none")
                        getbarplotDE("cell_markerDE_barplot",data)

                    }
                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });

        }

    })
    $("#cell_markerDE_barplot_FDR").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    var tempdata=data["result"]
                    if(tempdata.length==0) {
                        $("#cell_markerDE_barplot").css("display","none")
                        $("#warn").css("display","block")
                    }
                    else{
                        $("#cell_markerDE_barplot").css("display","block")
                        $("#warn").css("display","none")
                        getbarplotDE("cell_markerDE_barplot",data)

                    }
                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });

        }
    })

    $("#specificity_score_species_select").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_SS",
                type:"post",
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val(),
                },
                success:function(result){
                    if(result["score"].length>0){
                        $("#cell_marker_ss_plot").css("display","block")
                        $("#ss_tag").css("display","none")
                        var results=[]
                        result["score"].map(function(e){
                            var dataset=e.ID.split(",")
                            var ss=e.Cell_specific_score.split(",")
                            var pmid=e.PMID.split(",")
                            for(i=0;i<dataset.length;i++){
                                results.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        Gene:e.Gene,
                                        Cell_specific_score:ss[i],
                                        PMID:pmid[i]
                                    }
                                )
                            }
                        })
                        $("#cell_marker_se_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                        }
                                    }
                                },
                                {data:"Gene"},
                                {data:"Cell_specific_score"}
                            ],
                            destroy:true,
                            order:[3,"desc"]
                        })
                        getboxplotSS("cell_marker_ss_plot",result["score"])
                    }
                    else{
                        $("#ss_tag").css("display","block")
                        $("#cell_marker_ss_plot").css("display","none")
                    }

                }
            })
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerSS_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val()
                },
                success:function(result) {
                    var score=result["score"]
                    var results=[]
                    score.map(function(e){
                        var dataset=e.ID.split(",")
                        var ss=e.Cell_specific_score.split(",")
                        var pmid=e.PMID.split(",")
                        for(i=0;i<dataset.length;i++){
                            results.push(
                                {
                                    Species:e.Species,
                                    ID:dataset[i],
                                    Gene:e.Gene,
                                    Cell_specific_score:ss[i],
                                    PMID:pmid[i]
                                }
                            )
                        }
                    })
                    $("#cell_marker_se_table").DataTable({
                        data:results,
                        columns:[
                            {data:"Species"},
                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {data:"Gene"},
                            {data:"Cell_specific_score"}
                        ],
                        destroy:true,
                        order:[3,"desc"]
                    })
                    getboxplotSS("cell_marker_ss_plot",result["score"])
                }
            });

        }
    })
    $("#cell_similarity_species_tissue_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/species_similarity",
            type:"post",
            data:{"id":[[${id}]]},
            success:function(results) {

                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_similarity_species_tissue_select option:selected").text()
                })
                $("#cell_similarity_species_table").DataTable({
                    data:results,


                    columns:[
                        {data:"Species1"},
                        {
                            data:"Species2"

                        },
                        {
                            data:"score",
                            render:function(data){
                                return (data*1).toPrecision(2)
                            }
                        },
                        {
                            data:"common_marker_number",
                            render:function(data,type,row){
                                if(data!="0"){
                                    return '<a target="_blank" href="/celltaxonomy/species_similarity?cell='+$("#ct_id").text()+'&type=common&species1='+row.Species1+'&species2='+row.Species2+'&tissue='+row.Tissue_UberonOntology_ID2+'">'+data+'</a>'
                                }
                                else{
                                    return data
                                }
                            }
                        },
                        {
                            data:"species1_specific_marker_num",
                            render:function(data,type,row){
                                if(data!="0"){
                                    return '<a target="_blank" href="/celltaxonomy/species_similarity?cell='+$("#ct_id").text()+'&type=species1&species1='+row.Species1+'&species2='+row.Species2+'&tissue='+row.Tissue_UberonOntology_ID2+'">'+data+'</a>'
                                }
                                else{
                                    return data
                                }
                            }
                        },
                        {
                            data:"species2_specific_marker_num",
                            render:function(data,type,row){
                                if(data!="0"){
                                    return '<a target="_blank" href="/celltaxonomy/species_similarity?cell='+$("#ct_id").text()+'&type=species2&species1='+row.Species1+'&species2='+row.Species2+'&tissue='+row.Tissue_UberonOntology_ID2+'">'+data+'</a>'
                                }
                                else{
                                    return data
                                }
                            }
                        }
                    ],
                    destroy:true,
                    dom: '<"row"<"col-lg-6"l><"col-lg-6"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>'

                });
            }


        })

    })

    $('#marker_recom').on('DOMNodeInserted',function(){
        if($("input[type='checkbox'].switch1").is(":checked")){
            $(".summary_value").css("display","block")
        }
        else{
            $(".summary_value").css("display","none")
        }
    })
    $('#dataset_recom').on('DOMNodeInserted',function(){
        if($("input[type='checkbox'].switch3").is(":checked")){
            $(".summary_value3").css("display","block")
        }
        else{
            $(".summary_value3").css("display","none")
        }
    })

    $("input[type='checkbox'].switch1").change(function(){
        if($("input[type='checkbox'].switch1").is(":checked")){
            $(".summary_value").css("display","block")
        }
        else{
            $(".summary_value").css("display","none")
        }

    })
    $("input[type='checkbox'].switch3").change(function(){
        if($("input[type='checkbox'].switch3").is(":checked")){
            $(".summary_value3").css("display","block")
        }
        else{
            $(".summary_value3").css("display","none")
        }

    })
    $("input[type='checkbox'].switch2").change(function(){
        if(!$("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {
                    var results=result["plot"]
                    if(results=="[]" || results.length==0){

                    }
                    else{


                        var plot=[]
                        results.map(function(e){
                            var dataset=e.ID.split(",")
                            var fc=e.avg_log2FC.split(",")
                            var pct1=e.pct1.split(",")
                            var pct2=e.pct2.split(",")
                            var pval=e.p_val.split(",")
                            var fdr=e.p_val_adj.split(",")
                            var pmid=e.PMID.split(",")
                            for(i=0;i<dataset.length;i++){
                                if(fdr[i]<0.05){
                                    plot.push(
                                        {
                                            Species:e.Species,
                                            ID:dataset[i],
                                            markers:e.markers,
                                            avg_log2FC:fc[i],
                                            pct_1:pct1[i],
                                            pct_2:pct2[i],
                                            p_val:pval[i],
                                            p_val_adj:fdr[i],
                                            PMID:pmid[i]
                                        }
                                    )
                                }
                            }
                        })

                        getboxplot("cell_markerDE_plot",plot)

                        $("#cell_marker_DE_table").DataTable({
                            data:plot,
                            columns:
                                [
                                    {data:"Species"},
                                    {
                                        data:"ID",
                                        render:function(data,type,row){
                                            if(data.indexOf("_SRS")>=0){
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                            }
                                            else{
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                            }
                                        }
                                    },

                                    {
                                        data:"markers",
                                        // render:function(data,type,row){
                                        //     if(row.ENTREZID2!="-"){
                                        //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                        //     }
                                        //     else{
                                        //         return data
                                        //     }
                                        // }
                                    },

                                    {
                                        data:"avg_log2FC",
                                        render:function(data,type,row){
                                            return (data*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_1",
                                        render:function(data,type,row){
                                            return (row.pct_1*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_2",
                                        render:function(data,type,row){
                                            return (row.pct_2*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val_adj",
                                        render:function(data,type,row){
                                            return (row.p_val_adj*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val",
                                        render:function(data,type,row){
                                            return (row.p_val*1).toPrecision(2)
                                        }
                                    },


                                ],
                            destroy:true,
                            dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            buttons: [
                                'copy', 'excel', 'pdf'
                            ],
                        })


                    }



                }
            });
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerSS_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val()
                },
                success:function(result) {
                    var score=result["score"]
                    var results=[]
                    score.map(function(e){
                        var dataset=e.ID.split(",")
                        var ss=e.Cell_specific_score.split(",")
                        var pmid=e.PMID.split(",")
                        for(i=0;i<dataset.length;i++){
                            results.push(
                                {
                                    Species:e.Species,
                                    ID:dataset[i],
                                    Gene:e.Gene,
                                    Cell_specific_score:ss[i],
                                    PMID:pmid[i]
                                }
                            )
                        }
                    })
                    $("#cell_marker_se_table").DataTable({
                        data:results,
                        columns:[
                            {data:"Species"},
                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {data:"Gene"},
                            {data:"Cell_specific_score"}
                        ],
                        destroy:true,
                        order:[3,"desc"]
                    })
                    getboxplotSS("cell_marker_ss_plot",result["score"])
                }
            });

        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){

                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {

                    var results=result['plot']

                    var plot=[]
                    results.map(function(e){
                        var dataset=e.ID.split(",")
                        var fc=e.avg_log2FC.split(",")
                        var pct1=e.pct_1.split(",")
                        var pct2=e.pct2.split(",")
                        var pval=e.p_val.split(",")
                        var fdr=e.p_val_adj.split(",")
                        var pmid=e.PMID.split(",")
                        for(i=0;i<dataset.length;i++){
                            if(fdr[i]<0.05){
                                plot.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        markers:e.markers,
                                        avg_log2FC:fc[i],
                                        pct_1:pct1[i],
                                        pct_2:pct2[i],
                                        p_val:pval[i],
                                        p_val_adj:fdr[i],
                                        PMID:pmid[i]
                                    }
                                )
                            }

                        }
                    })
                    getboxplot("cell_markerDE_plot",plot)

                    $("#cell_marker_DE_table").DataTable({
                        data:plot,
                        columns:
                            [
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                        }
                                    }
                                },

                                {
                                    data:"markers",
                                    // render:function(data,type,row){
                                    //     if(row.ENTREZID2!="NA"){
                                    //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                    //     }
                                    //     else{
                                    //         return data
                                    //     }
                                    // }
                                },

                                {
                                    data:"avg_log2FC",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_1",
                                    render:function(data,type,row){
                                        return (row.pct_1*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_2",
                                    render:function(data,type,row){
                                        return (row.pct_2*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val",
                                    render:function(data,type,row){
                                        return (row.p_val*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val_adj",
                                    render:function(data,type,row){
                                        return (row.p_val_adj*1).toPrecision(2)
                                    }
                                },



                            ],
                        destroy:true,
                        dom: '<"row"<"col-lg-4"l><"col-lg-4"B><"col-lg-4"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                        buttons: [
                            'copy', 'excel', 'pdf'
                        ],
                    })

                }
            });

            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_SS",
                type:"post",
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val(),
                },
                success:function(result){
                    if(result["score"].length>0){
                        $("#cell_marker_ss_plot").css("display","block")
                        $("#ss_tag").css("display","none")
                        var results=[]
                        result["score"].map(function(e){
                            var dataset=e.ID.split(",")
                            var ss=e.Cell_specific_score.split(",")
                            var pmid=e.PMID.split(",")
                            for(i=0;i<dataset.length;i++){
                                results.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        Gene:e.Gene,
                                        Cell_specific_score:ss[i],
                                        PMID:pmid[i]
                                    }
                                )
                            }
                        })
                        $("#cell_marker_se_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                        }
                                    }
                                },
                                {data:"Gene"},
                                {data:"Cell_specific_score"}
                            ],
                            destroy:true,
                            order:[3,"desc"]
                        })
                        getboxplotSS("cell_marker_ss_plot",result["score"])
                    }
                    else{
                        $("#ss_tag").css("display","block")
                        $("#cell_marker_ss_plot").css("display","none")
                    }

                }
            })



        }


    })


    $("#cn").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#cn_range").text($("#cn").val())
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#sc").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#sc_range").text($("#sc").val())
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#asc").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#asc_range").text($("#asc").val())
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#rs").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#rs_range").text($("#rs").val())
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#ars").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#ars_range").text($("#ars").val())
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })

    $(".icon").parent().click(function(){
        if($(this).find("i").hasClass("ion-chevron-down")){
            $(this).find("i").removeClass("ion-chevron-down");
            $(this).find("i").addClass("ion-chevron-right")
        }
        else{
            $(this).find("i").addClass("ion-chevron-down");
            $(this).find("i").removeClass("ion-chevron-right")
        }
    })
    $("#statistic_table").on("click",".cellstandard",function(){
        var row = $(this).closest("tr");
        var data = $('#statistic_table').DataTable().row(row).data();
        getCelltypeDetail(data["Cell_standard"],data["Specific_Cell_Ontology_ID"])

    })
    $("#statistic_table").on("click",".ctid",function(){
        var row = $(this).closest("tr");
        var data = $('#statistic_table').DataTable().row(row).data();
        getCelltypeDetail(data["Cell_standard"],data["Specific_Cell_Ontology_ID"])

    })


    
    
    $("#table-description").on("click",".SHOGoiN",function(){

        post("https://stemcellinformatics.org/cell_marker/literatures",{"keyword":$("#name").text()})
    })
    $("#browse_btn").click(function(){
        $("#browse").css("visibility","hidden")
        $("#browse").css("width",0)
        $("#browse").parent().parent().css("width","40px")
        $("#browse").parent().parent().css("margin","0")
        $("#browse").parent().parent().css("background","#ffffff")
        $("#browse").parent().parent().css("display","flex")



        $("#statistic").parent().parent().parent().css("width","96%")
        $("#browse_btn2").css("display","block")

    })
    $("#browse_btn2").click(function(){
        $("#browse_btn2").css("display","none")

        $("#browse").parent().parent().css("width","300px")

        if($(window).width()>1400){
            $("#browse").parent().parent().css("margin-left","30px")
            $("#browse").parent().parent().css("margin-right","10px")
        }

        $("#browse").parent().parent().css("background","transparent")
        $("#browse").parent().parent().css("display","block")

        $("#browse").css("width","auto")
        $("#browse").css("visibility","visible")

        $("#statistic").parent().parent().parent().css("width","75%")


    })
    $(".details").click(function(){
        if($(this).children("i").hasClass("ion-plus-round")){
            $(this).children("i").removeClass("ion-plus-round")
            $(this).children("i").addClass("ion-minus-round")
        }
        else{
            $(this).children("i").removeClass("ion-minus-round")
            $(this).children("i").addClass("ion-plus-round")
        }

    })
    $("#confirm_button").click(function(){
        if($("#filter_search1").val()==null){
            $("#th1").text(
                "No. of publications >= "+"10"
            )
            $("#filter_search1").val(10)
        }
        else{
            $("#th1").text(
                "No. of publications >= "+$("#filter_search1").val()
            )
        }
        if($("#filter_search2").val()==""){
            $("#th2").text(
                "Median log2FC >= "+"2"
            )
            $("#filter_search2").val(2)
        }
        else{
            $("#th2").text(
                "Median log2FC >= "+$("#filter_search2").val()
            )
        }
        if($("#filter_search3").val()==null){
            $("#th3").text(
                "Median specificity score >= "+"0.5"
            )
            $("#filter_search3").val(0.5)
        }
        else{
            $("#th3").text(
                "Median specificity score >= "+$("#filter_search3").val()
            )
        }
        if($("#filter_search4").val()==null){
            $("#th4").text(
                "Tissue counts >= "+"4"
            )
            $("#filter_search4").val(4)
        }
        else{
            $("#th4").text(
                "Tissue counts >= "+$("#filter_search4").val()
            )
        }

        $.ajax({
            url:"/celltaxonomy/summary_filter",
            type:'post',
            data:{
                species:$("#summary_species").val(),
                cell:[[${name}]],
                fc:$("#filter_search2").val()*1,
                ss:$("#filter_search3").val()*1,
                tc:$("#filter_search4").val()*1,
                pc:$("#filter_search1").val()*1
            },
            success:function(results){
                $("#marker_recom").DataTable({
                    data:results,
                    columns:[
                        {
                            data:'Marker',
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ID+"'>"+data+"</a>"
                            }
                        },
                        {
                            data:'top10_ps',
                            render:function(data,type,row){
                                if(data>=$("#filter_search1").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value" style="display: none"> ('+row.top10_ps+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+row.top10_ps+'</span>'
                                }
                            }
                        },
                        {
                            data:'fc',
                            render:function(data,type,row){
                                if(data>=$("#filter_search2").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value" style="display: none"> ('+(row.fc*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+(row.fc*1).toPrecision(2)+'</span>'
                                }
                            }
                        },
                        {
                            data:'specificity',
                            render:function(data,type,row){
                                if(data*1>$("#filter_search3").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>' +
                                        '<span class="summary_value" style="display: none"> ('+(row.specificity*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+(row.specificity*1).toPrecision(2)+'</span>'
                                }
                            }
                        },
                        {
                            data:'tc',
                            render:function(data,type,row){
                                if(data*1>=$("#filter_search4").val()){
                                    return '<div style="display:flex;justify-content: flex-start">' +
                                        '<i class="icon ion-checkmark-round checkmark"></i>'+
                                        '<span class="summary_value" style="display: none"> ('+(row.tc*1).toPrecision(2)+')</span>' +
                                        '</div>'
                                }
                                else{
                                    return '<span class="summary_value" style="display: none">'+(row.tc*1).toPrecision(2)+'</span>'
                                }
                            }
                        },
                        {
                            data:'conserved',
                            render:function(data){
                                if(data==="1"){
                                    return '<i class="icon ion-checkmark-round"></i>'
                                }
                                else{
                                    return ""
                                }
                            }
                        },
                        {
                            data:"total",
                            render:function(data,type,row){
                                var n=0
                                if(row.top10_ps*1>=$("#filter_search1").val()){
                                    n+=1
                                }
                                if(row.fc*1>=$("#filter_search2").val()){
                                    n+=1
                                }
                                if(row.specificity*1>=$("#filter_search3").val()){
                                    n+=1
                                }
                                if(row.tc*1>=$("#filter_search4").val()){
                                    n+=1
                                }
                                if(row.conserved==1){
                                    n+=1
                                }
                                return n
                            },
                            visible:false
                        }
                    ],
                    order:[
                        [6,'desc'],[1,'desc']
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    lengthChange:false,
                    searching:false,
                    responsive: true
                })
            }
        })
    })


    $(".icon").hover(function(){
        var X = $(this).position().top;
        var Y = $(this).offset().left;
        var height=$(this).height();
        var delta=$(window).width()-Y;
        $(this).siblings(".tooltiptext").css("top",X+height+5)
        if($(this).siblings("span").text().length>100){
            $(this).siblings("span").css("width",350)
            if(delta<175){
                $(this).siblings(".tooltiptext").css("margin-left",-1*(180+175-delta+20))
            }
            else{
                $(this).siblings(".tooltiptext").css("margin-left",-180)
            }
        }
        if(Y<200){
            $(this).siblings(".tooltiptext").css("margin-left",-20)
        }

    })
    $("#hover_button").hover(function(){
        $("#filter_panel").css("visibility","visible")
        $("#filter_panel").css("opacity","1")
        $("#filter_panel").css("margin-top","10px")

    })
    $("#hover_button").mouseleave(function(){
        setTimeout(
            function(){
                if(!$("#filter_panel").is(":hover")){
                    $("#filter_panel").css("visibility","hidden")
                    $("#filter_panel").css("opacity","0")
                    $("#filter_panel").css("margin-top","20px")

                }
            },
            100
        )

    })
    $("#filter_panel").mouseleave(function(){
        $("#filter_panel").css("visibility","hidden")
        $("#filter_panel").css("opacity","0")
        $("#filter_panel").css("margin-top","20px")

    })


    if($(window).width()>1400){

    }
    else if($(window).width()>1024){
        $(".col-sm-3").css("margin-left","0")
        $(".col-sm-3").css("margin-right","0")

        $(".col-lg-3").css("padding-left",0)
        $(".col-lg-9").css("padding",0)
        // $(".col-lg-9").addClass("col-lg-10")
        // $(".col-lg-9").removeClass("col-lg-9")

        $("#statistic").css("font-size","13px")

    }
    else{
        $("#statistic").css("overflow","auto")
        $("#browse").parent().parent().css("margin","0")
        $("#browse").parent().parent().css("padding","0")
        $("#browse").parent().parent().css("width","25%")
        $(".col-lg-4").addClass("col-sm-4")
        $("#statistic").css("font-size","11px")

    }
    function tissuelink(data){
        var temp="";
        $.ajax({
            url:'/celltaxonomy/tissueid',
            type:'post',
            async:false,
            data:{"id":data},
            success:function(results){

                if(results.length>0){
                    temp="<a target='_blank' href='/celltaxonomy/tissue/"+results[0].Tissue_UberonOntology_ID+"'>"+data+"</a>"
                }
                else{
                    temp=data
                }
            }
        });
        return temp
    }
    function markerlink(data){
        var temp=data
        $.ajax({
            url:'/celltaxonomy/markerid',
            type:'post',
            async:false,

            data:{"marker":data},
            success:function(results){
                if(results.length>0){
                    temp="<a target='_blank' href='/celltaxonomy/marker/"+results[0].Gene_ENTREZID2+"'>"+data+"</a>"
                }
                else{
                    temp=data
                }
            }
        })
        return temp
    }

    jQuery.extend( jQuery.fn.dataTableExt.oSort, {
        "num-html-pre": function ( a ) {
            if(a=="Inf"){
                a=10000000000
            }
            else{
                a=a*1
            }
            return a
        },

        "num-html-asc": function ( a, b ) {
            return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        },

        "num-html-desc": function ( a, b ) {
            return ((a < b) ? 1 : ((a > b) ? -1 : 0));
        }});
</script>
</body>
</html>