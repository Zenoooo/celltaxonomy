<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cell type - Cell Taxonomy - CNCB-NGDC</title>

    <link rel="stylesheet" href="/celltaxonomy/static/css/demo.css" type="text/css">
    <link rel="icon" href="/celltaxonomy/static/img/CellTaxonomy v3.png ">

    <link rel="stylesheet" href="/celltaxonomy/static/css/ionicons.min.css">

    <link rel="stylesheet" href="/celltaxonomy/static/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script src="/celltaxonomy/static/js/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->


    <script src="/celltaxonomy/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/jquery.ztree.core.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/jquery.ztree.exhide.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/fuzzysearch.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/headerfooter-full.js"></script>


    <link rel="stylesheet" href="/celltaxonomy/static/css/bootstrap.min.css" >
    <link rel="stylesheet" href="/celltaxonomy/static/css/dataTables.bootstrap.min.css" >
    <script src="/celltaxonomy/static/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet"  href="/celltaxonomy/static/css/buttons.bootstrap.min.css">
    <script src="/celltaxonomy/static/js/dataTables.buttons.min.js"></script>
<!--    <script src="/celltaxonomy/static/js/jszip.min.js"></script>-->
    <script src="/celltaxonomy/static/js/buttons.html5.min.js"></script>
    <script src="/celltaxonomy/static/js/buttons.bootstrap.min.js"></script>

    <script src="/celltaxonomy/static/js/dataTables.bootstrap.min.js"></script>
    <link href="/celltaxonomy/static/css/bow.ui.min.css" rel="stylesheet">

    <script type="text/javascript" src="/celltaxonomy/static/js/echarts.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/ecSimpleTransform.min.js"></script>
    <script type="text/javascript" src="/celltaxonomy/static/js/my/my.js"></script>

    <link rel="stylesheet" type="text/css" href="/celltaxonomy/static/css/my/my.css">



    <style>

        input[type='radio']{
            margin-left: 5px;
        }

        select.input-sm{
            line-height:20px;
            margin-bottom: 5px;
        }
        input.input-sm{
            margin-left: 10px;
            margin-bottom: 0;

        }
        .curSelectedNode{
            background: #c4c4c4 !important;
            border:1px solid #bdbdbd !important;

        }
        #statistic_table_filter{
            display: flex;
            justify-content: flex-end;
            border-radius: 5px;
        }
        .node_name::first-letter{
            text-transform: capitalize;
        }

        #treeDemo{
            width:100%
        }
        /* 小屏幕（平板，大于等于 768px） */
        @media (max-width: 1024px) {

        }

        /* 中等屏幕（桌面显示器，大于等于 992px） */
        @media screen and (max-width: 1400px) and (min-width: 1024px) {
            #statistic label,#statistic .btn ,#statistic select{
                font-size: 13px;
            }
            .affix{
                top:0;
                width:220px;
            }
        }
        @media screen and (min-width: 1400px) {
            #statistic select{
                font-size: 14px;
            }
            .affix{
                top:0;
                width:270px;
            }
        }


        .ztree li span.button.ico_docu{
            background-image: url("/celltaxonomy/static/img/germs.png");
            background-position: 50%;
            background-size:100% 100%;
        }
        .ztree li span.button.ico_close{
            background-image: url("/celltaxonomy/static/img/germs.png");
            background-position: 50%;
            background-size:100% 100%;

        }
        .ztree li span.button.ico_open{
            background-image: url("/celltaxonomy/static/img/germs.png");
            background-position: 50%;
            background-size:100% 100%;

        }



        #treeDemo::-webkit-scrollbar,.table-region::-webkit-scrollbar,#statistic::-webkit-scrollbar,div::-webkit-scrollbar {
            /*滚动条整体样式*/
            width : 15px;  /*高宽分别对应横竖滚动条的尺寸*/
            height: 12px;
        }
        #treeDemo::-webkit-scrollbar-thumb,.table-region::-webkit-scrollbar-thumb,#statistic::-webkit-scrollbar-thumb,div::-webkit-scrollbar-thumb{
            /*滚动条里面小方块*/
            border-radius   : 10px;
            background-color: #2487ce;
            background-image: -webkit-linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.2) 75%,
                    transparent 75%,
                    transparent
            );
        }
        #treeDemo::-webkit-scrollbar-track,.table-region::-webkit-scrollbar-track,#statistic::-webkit-scrollbar-track,div::-webkit-scrollbar-track{
            /*滚动条里面轨道*/
            box-shadow   : 0 0 1px rgba(0, 0, 0, 0.2);
            background   : #ededed;
            border-radius: 10px;
        }


        #tissue_enrichment_table tbody tr td:nth-child(1){
            text-transform: capitalize;
        }
        .cellstandard::first-letter{
            text-transform: capitalize;
        }
        .table-title{
            font-size: 20px;
            font-weight: 700;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
        }
        .table-title a{
            text-decoration: none;
        }
        .table-title a span{
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
        }

        .tooltiptext {
            visibility: hidden;
            width: 200px;
            top:90%;
            left: 50%;
            margin-left: -100px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px 5px;
            font-family: Arial,serif !important;
            font-size: 15px;
            font-weight: 100;
            /* 定位 */
            position: absolute;
            z-index: 1;
        }
        .ion-help-circled:hover::after {
            content: " ";
            position: absolute;
            top: 70%; /* 提示工具底部 */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color:  transparent transparent black transparent;
        }


        .ytick text{
            text-transform: capitalize;
        }
        .xtick text{
            text-transform: capitalize;
        }
        #similarity_table_filter{
            display: flex;
            justify-content: flex-end;
        }
        .table-change{
            border: 1px solid #2487ce;
            color: #2487ce;
            padding:5px 8px;
            margin-right: 5px;
            border-radius: 5px;
        }
        .table-change.active, .table-change:hover{
            background: #2487ce;
            color: white;
            border-bottom: 1px solid white;
        }
        .ion-checkmark-round{
            color:#8bc6ec;
            margin-right: 5px;

        }

        .ion-plus-round{
            cursor: pointer;
        }
        #marker_recom>thead>tr>th, #dataset_recom>thead>tr>th{
            white-space: normal;
            word-wrap: break-word;
            width: 100px;
        }


        .filter_search{
            height:30px;
            margin-top:5px;
            display: inline-block;
            width:55px;
            padding:5px 10px;
            text-align: center !important;
            font-size: 14px;
        }
        .filter_search::placeholder{
            font-size: 14px;
            text-align: center;
        }

        .circle_svg {
            float: left;
            width: 40px;
            height: 40px;
            fill: none;
            stroke-width: 1;
            cursor:pointer;
            transform: rotate(-90deg);
        }
        .circle:before{
            content: attr(data-note);
            text-align: center;
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            font-size: 14px;
            transform: translateY(-50%);
        }
        .circle{
            position:relative;
            float: left;
        }
        table{
            word-break: keep-all;
        }
        .table>tbody>tr>td{
            vertical-align: middle;
        }
        table.dataTable thead .sorting_desc::after,
        table.dataTable thead .sorting_asc::after,
        table.dataTable thead .sorting::after{
             opacity: 0.5;
             content: "";
        }





        .pagination>.active>a,
        .pagination>.active>a:hover,
        .pagination>.active>a:focus,
        .pagination>.active>span,
        .pagination>.active>span:focus,
        .pagination>.active>span:hover{
            color:black;
            border:none !important;
            box-shadow: none;
            outline:none;
            background: #f4f7f6;
            text-decoration: underline;
            font-weight: 600;

        }
        .pagination>li>a,.pagination>.disabled>a,.pagination>.disabled>a:hover{
            background: transparent;
        }
        .pagination>li>a,
        .pagination>li>a:focus,
        .pagination>li>a:hover
        {
            border:none;
            color: black;
            box-shadow: none;
            outline:none;
        }
        .pagination>li>a:focus,
        .pagination>li>a:hover
        {
            background: #f4f7f6;
        }
        .table-hover>tbody>tr:hover{
            background-color:#f4f7f6;
        }
        .table-hover>tbody>tr:hover td{
            background:none;
        }
        .table>tbody>tr>td, .table>thead>tr>th {
            vertical-align: middle;
            background: white;
            border-bottom: 3px solid #f4f7f6;
        }

        .table>tbody>tr>td:last-child{
            border-bottom-right-radius: 5px;
            border-top-right-radius: 5px;
        }
        #statistic_table_filter{
            background: white;
            padding: 10px 15px 5px 15px;
        }
        #statistic_table2_filter{
            background: white;
            padding: 10px 15px 5px 15px;
        }
        table.dataTable thead .sorting_desc::after,
        table.dataTable thead .sorting_asc::after,
        table.dataTable thead .sorting::after{
            opacity: 0.5;
            content: "";
        }
        table.dataTable thead .sorting_desc,
        table.dataTable thead .sorting_asc,
        table.dataTable thead .sorting,
        table.dataTable thead .sorting_disabled,
        table.dataTable thead span
        {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
            font-size: 14px;
        }
        #confirm_button{
            color:white;
            font-weight: 600;
            border-radius: 5px;
            border:2px solid black;
            padding:8px 15px;
            display: block;
            text-decoration: none;
            background: black;
        }
        #cell_similarity_species_table>thead>tr>th{
            white-space: normal;
        }
        .surface{
            margin-left:5px;
            cursor: pointer;
            color: #d44848;
        }
        #common_table>thead>tr>th,#cell_surface_marker_table>thead>tr>th,#study_table>thead>tr>th{
            white-space:normal;
        }
        #id{
            font-weight: 500;
        }
        #silhouette_coefficient,#average_silhouette_coefficient,#rogue,#average_rogue,#cell_number{
            transition: 0.7s;
            z-index: 999;
            background: white;
            padding:10px 20px;
            border-radius: 5px;
            box-shadow   : 0 0 5px rgba(0, 0, 0, 0.2);
        }
    </style>


    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6b352b313257516a97fd9d0db0276208";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>

<body >
<header>
    <nav th:replace="common/topbar::topbar"></nav>
</header>
<!--<div style="overflow: hidden;height:150px;width: 100%;background-image: url(/celltaxonomy/static/img/B1415360227.jpeg)">-->
<!--    <div class="col-lg-offset-1" style="display: flex;align-items: center;height: 100%;">-->
<!--        <h1 style="text-align: left;color: white;width:100%;font-size: 76px">Cell Type Browser</h1>-->
<!--    </div>-->
<!--</div>-->
<div class="container" style="background: #f4f7f6" >

    <div class="row">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/celltaxonomy/">Home</a></li>
                <li class="breadcrumb-item active">Browse</li>
                <li class="breadcrumb-item active" aria-current="page">Cell types</li>
            </ol>
        </nav>

        <div>
            <div class="col-lg-2 col-sm-3" style="width:300px;margin-left: 30px;margin-right: 10px;transition:0.3s" >
                <button id="browse_btn2"  style="padding:0;color:rgba(0,0,0,.6);align-self: center;font-size: 25px;height: 100%;display: none">
                    <i class="ion-arrow-right-a"></i>
                </button>
                <div class="mypanel" data-spy="affix" data-offset-top="200">
                    <div id="browse" class="mypanel-body">
                        <div class="mypanel-title" style="display: flex">
                            <h2>Browse tree</h2>

                            <div class="wrapper" style="margin-left: 5px">
                                <i class="icon ion-help-circled" style="line-height: 32px;"></i>
                                <span class="tooltiptext">Cell types with available cell markers are underlined</span>
                            </div>
                        </div>
                        <div class="mypanel-title">

                            <div style="margin-top:10px;">
                                <input style="border-radius: 5px" type="text" id="key" value="" class="empty" placeholder="Search"/>
                                <ul id="treeDemo"   class="ztree" style="height:370px;border:0;background: #ffffff;margin-top: 0;"></ul>
                            </div>
                        </div>

                        <div class="mypanel-title" style="display: flex;justify-content: center;height:50px">
                            <button id="browse_btn" style="color:rgba(0,0,0,.6);align-self: center;font-size: 25px;width: 100%;display: block">
                                <i class="ion-arrow-left-a"></i>
                            </button>
                        </div>
                    </div>


                </div>

            </div>
            <div class="col-lg-9 col-sm-9" style="transition:0.3s">

                <div class="mypanel">
                    <div class="mypanel-body" style="background: transparent;padding: 0 20px 20px 20px">

                        <div id="statistic" >
                            <div>
                                <div style="padding: 4px 0;background: white;margin-bottom: 5px;border-radius: 5px">
                                    <ul id="myTab" class="nav nav-tabs" style="margin:0">
                                        <li class="active">
                                            <a href="#statistic1" data-toggle="tab">Cell types with available markers (<span id="tab1"></span>)</a>
                                        </li>
                                        <li>
                                            <a href="#statistic2" data-toggle="tab">Cell types without available markers (<span id="tab2"></span>)</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>


                            <div id="myTabContent" class="tab-content" >
                                <div id="statistic1" class="tab-pane fade in active">
                                    <table id="statistic_table" class="table table-hover" style="width: 100%">
                                        <thead>
                                        <tr style="height: 20px">
                                            <th >Cell type</th>
                                            <th >#Species</th>
                                            <th >#Tissues</th>
                                            <th >#Conditions</th>
                                            <th >#Cell markers</th>
                                            <th >#Publications</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div id="statistic2" class="tab-pane fade">
                                    <table id="statistic_table2" class="table table-hover table-striped" style="width:100%">
                                        <thead>
                                        <tr>
                                            <th >Cell Taxonomy ID</th>
                                            <th >Cell type</th>
                                            <th >Cell Ontology ID</th>
                                            <th >Tissue ID</th>
                                            <th >Tissue</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>

                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-12" style="padding-right: 0">
            <div id="nav_side_bar" class="col-lg-2 col-sm-3" style="background: #f4f7f6;padding:0;display:none">
                <div data-spy="affix" data-offset-top="150">
                    <ul id="nav-side">
                        <li style="border-bottom: 1px solid #777777;pointer-events: none">
                            <span style="font-size: 22px"  th:text="${name}"></span>
                        </li>
                    </ul>
                </div>

            </div>
            <div class="col-lg-10 col-sm-9">
                <div class="mypanel" style="display: none">
                    <div class="mypanel-body" style="padding: 10px 20px 0 20px">
                        <div style="display: none" id="detail1">
                            <!--                            <a href="/celltaxonomy/Cell_type">-->
                            <!--                                <button id="reload" class="btn btn-primary" style="padding: 5px 10px">-->
                            <!--                                    <i class="icon ion-arrow-left-a" style="color: white"></i>-->
                            <!--                                     <span>Back</span>-->
                            <!--                                </button>-->
                            <!--                            </a>-->

                            <div style="display: flex;justify-content: space-between;padding-bottom: 20px">
                                <div>
                                    <h4 id="name" style="color: #16507b;font-size: 28px;">Cell name</h4>
                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Cell Taxonomy ID: </span>
                                        <span id="ct_id"></span>
                                    </div>
                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Cell Ontology ID: </span>
                                        <span>
                                        <a style="font-size: 14px;padding: 20px 0 20px 0" id="id" target="_blank" >Cell ID</a>
                                    </span>
                                    </div>
                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Synonyms: </span>
                                        <span>
                                        <span style="font-size: 14px;padding: 20px 0 20px 0" id="alias" ></span>
                                    </span>
                                    </div>
                                    <div style="margin-top: 20px">
                                        <span style="font-weight: 700">Cell type description: </span>
                                        <span id="new_cell_type_annotation">Here is the description of this cell type</span>
                                    </div>

                                </div>
                                <div>
                                    <a target="_blank" style="display: none">
                                        <img id="cell_pic"  style="min-width: 75px;;max-width:200px;">
                                    </a>

                                    <div class="wrapper" style="height: 18px;display: none;text-align: center">
                                        <i class="icon ion-ios-information" style="line-height: 8px"></i>
                                        <span id="pic_annotation" class="tooltiptext" style="font-size: 10px;margin-left: -255px;display: block;white-space: normal">
                                        </span>
                                    </div>
                                    <div style="text-align: center">
                                    </div>

                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <div class="mypanel">
                    <div class="mypanel-body" id="detail10" style="display:none;margin-top:10px;padding: 10px 20px 20px 20px">
                        <div>
                            <div id="width" class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#summary_region">
                                    <i style="font-size:20px" class="icon ion-chevron-down"></i>
                                    <span style="font-size:20px;font-weight: 700;"  id="summary/">Summary</span>

                                </a>
                            </div>
                            <div id="summary_region" class="collapse in">

                                <ul style="margin-top: 20px">
                                    <li class="summary"  id="summary1"></li>
                                    <li class="summary"  id="summary2"></li>
                                    <li class="summary"  id="summary4"></li>
                                    <li class="summary" id="summary3">
                                        <strong th:text="${name}"></strong> is distributed in <span id="sapiens"></span><span id="muris"></span>.
                                    </li>
                                    <li class="summary" id="summary7">
                                        For <strong th:text="${name}"></strong>, there are <span id="conserved_marker"></span> conserved cell markers whose orthologs are also reported as cell markers for this cell type.
                                    </li>
                                    <li class="summary"  id="summary5">
                                        The relevant cell markers of <strong th:text="${name}"></strong> are ranked in terms of supported literature, expression enrichment and conservation.
                                    </li>

                                    <li style="margin-top: 30px;margin-bottom: 30px;list-style: none">
                                        <div style="display: flex;justify-content: flex-start">
                                            <div style="margin-right: 20px">
                                                <select id="summary_species" style="width: 200px;margin:0">

                                                </select>
                                            </div>
                                            <div>
                                                    <input type="checkbox" class="switch switch1">Show value
                                            </div>


                                        </div>
                                        <div style="padding:0 1.5rem;overflow: auto">
                                            <div style="width: 95%">
                                                <table id="marker_recom" class="table table-striped table-hover" style="width:100%;">
                                                    <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th id="th1">
                                                            <div style="list-style: none;margin-top:5px">
                                                                <span>No. of publications</br>>=</span>
                                                                <input id="filter_search1" class="filter_search" type="search"  value="1" oninput = "value=value.replace(/[^\d]/g,'')*1">
                                                            </div>
                                                        </th>
                                                        <th id="th2">
                                                            <div style="list-style: none;margin-top:5px">
                                                                <span style="display: inline">log2FC
                                                                    <div class="wrapper" style="height: 18px">
                                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                                            The median log2 fold-change of expression (FDR < 0.05) in a cell cluster to that in all other cells among the available scRNA-seq samples
                                                                        </span>
                                                                    </div>
                                                                    </br>>=
                                                                </span>
                                                                <input id="filter_search2" class="filter_search" type="search"  value="0.25" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                            </div>
                                                        </th>
                                                        <th id="th5">
                                                            <div style="list-style: none;margin-top:5px">
                                                                <span style="display: inline">Highly expressed ratio
                                                                    <div class="wrapper" style="height: 18px">
                                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                                            Number of samples in which genes are more highly expressed in this cell type compared to other cell types (log2FC > 0.25, FDR < 0.05) divided by number of total samples for the cell type
                                                                        </span>
                                                                    </div>
                                                                    </br>>=</span>
                                                                <input id="filter_search5" class="filter_search" type="search"  value="0.3" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                            </div>
                                                        </th>
                                                        <th id="th3">
                                                            <div style="list-style: none;margin-top:5px">
                                                                <span style="display: inline">Specificity score
                                                                    <div class="wrapper" style="height: 18px">
                                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                                            The median cell specificity score (calculated by Jensen-Shannon divergence score, ranging from 0 to 1) among available scRNA-seq samples
                                                                        </span>
                                                                    </div>

                                                                    </br>>=</span>
                                                                <input id="filter_search3" class="filter_search" type="search"  value="0.3" oninput = "value=value.replace(/[^\d.]/g,'').replace(/\.\./g,'.').slice(0,4)">
                                                            </div>
                                                        </th>
                                                        <th id="th4">
                                                            <div style="list-style: none;margin-top:5px">
                                                            <span style="display: inline">Conservation score
                                                                <div class="wrapper" style="height: 18px">
                                                                    <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                    <span class="tooltiptext" style="display: block;white-space: normal">
                                                                        Number of ortholog genes which are also reported as cell markers for this cell type in other species
                                                                    </span>
                                                                </div>
                                                                </br>>=</span>
                                                                <input id="filter_search4" class="filter_search" type="search"  value="1" oninput = "value=value.replace(/[^\d]/g,'')*1">
                                                            </div>

                                                        </th>
                                                        <th>Total</th>
                                                    </tr>

                                                    </thead>
                                                    <tbody>
                                                    <tr>

                                                    </tr>
                                                    </tbody>
                                                </table>

                                            </div>
                                        </div>

                                    </li>

<!--                                    <li class="summary" id="summary6" >-->
<!--                                        The available single-cell sequencing samples for <span th:text="${name}"></span> are ranked by quality evaluation of cell clusters.-->
<!--                                    </li>-->
<!--                                    <li style="margin-top: 20px;list-style: none">-->
<!--                                        <div style="display: flex;justify-content: flex-start">-->
<!--                                            <div style="margin-right: 20px">-->
<!--                                                <select id="summary_species2" style="width: 200px;margin:0">-->

<!--                                                </select>-->
<!--                                            </div>-->
<!--                                            <div>-->
<!--                                                <input type="checkbox" class="switch switch3">Show value-->
<!--                                            </div>-->


<!--                                        </div>-->
<!--                                        <div style="padding: 0 1.5rem;overflow: auto">-->
<!--                                            <div style="width: 95%">-->
<!--                                                <table id="dataset_recom" class="table table-striped table-hover" style="width:100%;">-->
<!--                                                    <thead>-->
<!--                                                    <tr>-->
<!--                                                        <th>Sample</th>-->
<!--                                                        <th>Top 25% cell number</th>-->
<!--                                                        <th>Top 25% silhouette coefficient-->
<!--                                                            <div class="wrapper" style="height: 18px" >-->
<!--                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>-->
<!--                                                                <span class="tooltiptext" style="display: block;white-space: normal">-->
<!--                                                                The Silhouette coefficient ranges from -1 to 1, and 1 means clusters are well apart from each other, 0 means clusters are indifferent, and -1 means clusters are defined in the wrong way.-->
<!--                                                            </span>-->
<!--                                                            </div>-->
<!--                                                        </th>-->
<!--                                                        <th>Top 25% average silhouette coefficient-->
<!--                                                            <div class="wrapper" style="height: 18px">-->
<!--                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>-->
<!--                                                                <span class="tooltiptext" style="display: block;white-space: normal">-->
<!--                                                                Mean silhouette coefficient of all cell clusters in the sample.-->
<!--                                                            </span>-->
<!--                                                            </div>-->
<!--                                                        </th>-->
<!--                                                        <th>Top 25% ROGUE index-->
<!--                                                            <div class="wrapper" style="height: 18px">-->
<!--                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>-->
<!--                                                                <span class="tooltiptext" style="display: block;white-space: normal">-->
<!--                                                        ROGUE is calculated to accurately quantify the purity of identified cell clusters. A ROGUE value greater than 0.9 indicates a cell cluster with high purity.-->
<!--                                                    </span>-->
<!--                                                            </div>-->
<!--                                                        </th>-->
<!--                                                        <th>Top 25% average ROGUE index-->
<!--                                                            <div class="wrapper" style="height: 18px">-->
<!--                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>-->
<!--                                                                <span class="tooltiptext" style="display: block;white-space: normal">-->
<!--                                                                Mean ROGUE index of all cell clusters in the sample.-->
<!--                                                            </span>-->
<!--                                                            </div>-->
<!--                                                        </th>-->
<!--                                                        <th>Total</th>-->
<!--                                                    </tr>-->

<!--                                                    </thead>-->
<!--                                                    <tbody>-->
<!--                                                    </tbody>-->
<!--                                                </table>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </li>-->

                                </ul>
                            </div>
                    </div>
                </div>

                <div class="mypanel">
                    <div class="mypanel-body" id="detail7" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div id="gte" class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#gte_region">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_marker/">Cell marker</span>
                                    <div class="wrapper" >
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the cell markers of the cell type in various tissues. Fisher’s exact test is performed to test if cell markers are specifically associated with this cell type by publication number: *** for < 0.001, ** for [0.001, 0.01) and * for [0.01, 0.05).
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="gte_region" class="collapse in">
                                <div id="gte_plot">
                                    <div >
                                        <div style="display: flex;justify-content: flex-start">
                                            <div>
                                                <label>Species</label>
                                                <select style="width: 200px;text-transform: capitalize" id="cell_marker_heatmap_LS_select">
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------------------">

                                                    </optgroup>
                                                </select>
                                            </div>
                                            <div style="margin-left:20px">
                                                <label>Tissue</label>
                                                <select id="cell_marker_tissue_LS_select" style="width: 200px;">
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------------------">

                                                    </optgroup>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div >
                                        <div style="overflow:auto">
                                            <div id="cell_marker_single" style="height: 250px;margin:0 auto">

                                            </div>
                                        </div>

                                        <div style="overflow: auto">
                                            <div id="cell_marker_heatmap" style="height: 300px;margin:0 auto">

                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div>
                                    <a data-toggle="collapse" class="details" href="#description" style="text-decoration: none">
                                        <i class="icon ion-plus-round"></i>
                                        Show details
                                    </a>
                                </div>
                                <div class="table-region collapse" id="description" style="margin-top: 20px;overflow: auto">
                                    <div style="width: 95%">
                                        <table id="table-description"  class="table table-striped table-hover" style="width: 100%">
                                            <thead>
                                            <tr>
                                                <th>Species</th>
                                                <th>Tissue</th>
                                                <th>Tissue ID</th>
                                                <th>Condition</th>
                                                <th>Disease ID</th>
                                                <th>Cell marker</th>
                                                <th>Source</th>
                                                <th>PMID</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                            <tr>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>

                                </div>


                            </div>

                        </div>
                    </div>
                </div>
                <div class="mypanel">
                    <div class="mypanel-body" id="detail8" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#cell_markerDE">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_marker_expression_enrichment/">Cell marker expression enrichment</span>
                                    <div class="wrapper" >
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the top cell markers highly and specifically expressed in this cell type.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="cell_markerDE" class="collapse in">
                                <div style="display: none">
                                    <input type="checkbox" class="switch switch2" checked>
                                    <span>Show publication-supported cell markers</span>
                                    <div class="wrapper" >
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            Show publication-supported cell markers or rank cell markers by the y-axis value
                                        </span>
                                    </div>
                                </div>
                                <div>
                                    <div id="DE_bar_region">
                                        <div style="margin-top:20px;">
                                            <div style="display: flex;justify-content: flex-start">

                                                <div >
                                                    <label>Species</label>
                                                    <select id="cell_markerDE_barplot_species_select" style="width:200px;text-transform: capitalize">

                                                    </select>
                                                </div>

                                                <div style="margin-left: 20px">
                                                    <label>log2FC greater than</label>
                                                    <select id="cell_markerDE_barplot_threshold" style="width:200px;">
                                                        <option value="0.25">0.25</option>
                                                        <option value="0.5">0.5</option>
                                                        <option value="1">1</option>
                                                        <option value="1.5">1.5</option>
                                                        <option value="2">2</option>
                                                    </select>
                                                </div>
                                                <div style="margin-left: 20px;display: table">
                                                    <div style="display: table-cell;vertical-align: middle">
                                                        <input type="checkbox" class="switch switch4" style="margin-right: 10px">Rank by highly expressed ratio
                                                    </div>
                                                </div>

                                                <div style="display:none;">
                                                    <label>FDR less than</label>
                                                    <select id="cell_markerDE_barplot_FDR" style="width:200px;">
                                                        <option value="0.001">0.001</option>
                                                        <option value="0.01">0.01</option>
                                                        <option value="0.05" selected>0.05</option>
                                                    </select>
                                                </div>



                                            </div>
                                            <div style="display: flex;justify-content: center;margin: 10px 0">
                                                <p id="warn" style="display: none;font-size: 25px">No results</p>
                                            </div>
                                            <div style="display: flex;justify-content: center">
                                                <div id="cell_markerDE_barplot" style="height: 300px">

                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <a data-toggle="collapse" class="details" href="#DE_bar_table" style="text-decoration: none">
                                                <i class="icon ion-plus-round"></i>
                                                Show details
                                            </a>
                                        </div>
                                        <div id="DE_bar_table" class="collapse" style="margin-top: 20px;overflow: auto">
                                            <div style="width: 95%">
                                                <table style="width:100%" class="table table-striped table-hover" id="cell_marker_DE_bar_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Cell marker</th>
                                                        <th>No. of total samples (E)</th>
                                                        <th>No. of highly expressed samples (HE, FDR<0.05)</th>
                                                        <th>Highly expressed ratio (HE/E)</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>

                                                </table>

                                            </div>
                                        </div>
                                    </div>
                                    <div id="DE_region">
                                        <div id="DE" style="border-top: 1px solid rgba(34,36,38,.15);margin-top: 20px">
                                            <div style="margin-top: 10px">
                                                <label>Species</label>
                                                <select id="cell_markerDE_species_select" style="width: 200px;text-transform: capitalize">
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------------------">

                                                    </optgroup>
                                                </select>
                                            </div>
                                            <div>
                                                <div style="display: flex;justify-content: center">
                                                    <div id="cell_markerDE_plot" style="height: 250px">

                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <a data-toggle="collapse" class="details" href="#DE_table" style="text-decoration: none">
                                                <i class="icon ion-plus-round"></i>
                                                Show details
                                            </a>
                                        </div>
                                        <div id="DE_table" class="collapse" style="margin-top: 20px;overflow: auto">
                                            <div style="width:95%">
                                                <table style="width:100%" class="table table-striped table-hover" id="cell_marker_DE_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Species</th>

                                                        <th>Sample</th>
                                                        <th>Condition</th>
                                                        <th>Cell marker</th>
                                                        <th>log2FC</th>
                                                        <th>
                                                            Pct.cell type
                                                            <div class="wrapper" style="height: 18px">
                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The expression percentage of this gene in this cell type
                                                    </span>
                                                            </div>
                                                        </th>
                                                        <th>
                                                            Pct.others
                                                            <div class="wrapper" style="height: 18px">
                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The expression percentage of this gene in other cell types
                                                    </span>
                                                            </div>
                                                        </th>
                                                        <th>P value</th>

                                                        <th>FDR</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>

                                                </table>

                                            </div>
                                        </div>
                                    </div>

                                    <div id="specificity_region">
                                        <div style="border-top: 1px solid rgba(34,36,38,.15);margin-top:20px;">
                                            <div style="margin-top: 10px">
                                                <div>
                                                    <label>Species</label>
                                                    <select id="specificity_score_species_select" style="width:200px" >
                                                        <optgroup>

                                                        </optgroup>
                                                        <optgroup label="----------------------">
                                                        </optgroup>
                                                    </select>
                                                </div>

                                            </div>
                                            <div>
                                                <div>
                                                    <p id="ss_tag" style="display: none">No results</p>
                                                </div>
                                                <div id="cell_marker_ss_plot" style="height: 250px;margin:0 auto">

                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <a data-toggle="collapse" class="details" href="#ss_table" style="text-decoration: none">
                                                <i class="icon ion-plus-round"></i>
                                                Show details
                                            </a>
                                        </div>
                                        <div class="collapse" id="ss_table" style="margin-top: 20px;overflow: auto">
                                            <div style="width:95%">
                                                <table style="width: 100%;" class="table table-hover table-striped" id="cell_marker_se_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Species</th>
                                                        <th>Sample</th>
                                                        <th>Condition</th>
                                                        <th>Cell marker</th>
                                                        <th>
                                                            Cell specificity score
                                                            <div class="wrapper" >
                                                                <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                                <span class="tooltiptext" style="display: block;white-space: normal">
                                                            Jensen-Shannon (JS) divergence score (0-1) is calculated to quantify the cell type specificity of one cell marker (Cabili MN et al., 2011 ).
                                                        </span>
                                                            </div>
                                                        </th>
                                                    </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="mypanel">
                    <div class="mypanel-body" id="detail11" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div  class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#cell_surface_marker_region">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_surface_marker/">Cell surface marker</span>
                                    <div class="wrapper" >
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the cell surface markers of this cell type predicted to have a membrane-bound protein product.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="cell_surface_marker_region" class="collapse in">

                                <div style="overflow: auto">
                                    <div style="width: 95%">
                                        <table id="cell_surface_marker_table" class="table table-hover table-striped" style="width: 100%">
                                            <thead>
                                            <tr>
                                                <th>Cell marker</th>
                                                <th>No. of publications</th>
                                                <th>
                                                    FDR
                                                    <div class="wrapper" style="height: 18px">
                                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                                            The FDR is calculated by fisher’s exact test to see if this cell marker is specifically associated with this cell type by publication.
                                                        </span>
                                                    </div>
                                                </th>
                                                <th>Species</th>
                                                <th>Evidence</th>
                                                <th>Antibody</th>
                                                <th>Protein class</th>
                                            </tr>

                                            </thead>
                                            <tbody>
                                            </tbody>

                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mypanel">
                    <div class="mypanel-body" id="detail9" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">
                        <div >
                            <div class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#cell_similarity_species">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cellular_comparison_across_species/">Cellular comparison across species</span>
                                    <div class="wrapper" >
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel compares marker composition of cell types across species. The cell markers and their orthologous genes which are also reported as cell markers for the same cell type are showed.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="cell_similarity_species" class="collapse in" >
                                <div>
                                    <ul>
                                        <li style="list-style: disc">
                                            For <strong th:text="${name}"></strong>, the similarity of reported cell marker composition between different species is shown below.
                                        </li>
                                    </ul>
                                    <div>
                                        <select id="same_cell_similarity_select" style="width: 200px">

                                        </select>
                                    </div>
                                    <div>
                                        <table class="table table-hover table-striped" id="same_cell_similarity_table">
                                            <thead>
                                                <tr>
                                                    <th>Species in comparison</th>
                                                    <th>Tissue</th>
                                                    <th>
                                                        Cell-type similarity across species
                                                        <div class="wrapper" style="height: 18px">
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                                The cell-type similarity across species is evaluated by the number of orthologous cell markers divided by the union of cell markers in the two species
                                                            </span>
                                                        </div>
                                                    </th>
                                                    <th>No. of orthologous cell markers</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                                <div style="margin-top:30px">
                                    <ul>
                                        <li style="list-style: disc">
                                            The conserved cell markers and their orthologous genes which are also reported as cell markers for the same cell type are showed below.
                                        </li>
                                    </ul>

                                    <div style="display: flex;justify-content: flex-start">
                                        <div style="margin-right: 10px">
                                            <label>Species</label>
                                            <select  id="cell_similarity_species_species_select" style="width: 200px;">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>
                                        <div style="margin-right: 10px">
                                            <label>Tissue</label>
                                            <select  id="cell_similarity_species_tissue_select" style="width: 200px;">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Cell marker</label>
                                            <select  id="cell_similarity_species_marker_select" style="width: 200px;">
                                                <optgroup>

                                                </optgroup>
                                                <optgroup label="----------------------">

                                                </optgroup>
                                            </select>
                                        </div>

                                    </div>
                                    <div style="padding:0 1.5rem;overflow: auto">
                                        <div>
                                            <table id="common_table" class="table table-hover table-striped" style="width:100%" >
                                                <thead>
                                                <tr>
                                                    <th>Cell marker</th>
                                                    <th>Species (ortholog)</th>
                                                    <th>Ortholog</th>
                                                    <th>Gene ID (ortholog)</th>
                                                    <th>No. of publications (ortholog cell markers)</th>
                                                </tr>
                                                </thead>
                                                <tbody>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                </div>


                            </div>
                        </div>
                    </div>
                </div>
                    <div class="mypanel">
                        <div class="mypanel-body" id="detail5" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">
                            <div>
                                <div  class="table-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#similarity">
                                        <i class="icon ion-chevron-down"></i>
                                        <span id="cellular_similarity_based_on_cell_marker/">Cellular similarity based on cell marker</span>
                                        <div class="wrapper" >
                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the similarity between this cell type and other cell types in marker composition. The more similar the cell types based on markers, the shorter the distance on the map.
                                        </span>
                                        </div>
                                    </a>
                                </div>
                                <div id="similarity" class="collapse in">
                                    <div >
                                        <div style="display: flex;justify-content: flex-start">
                                            <div id="similarity_species_select">
                                                <label>Species</label>
                                                <select style="width: 200px;text-transform: capitalize">
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------------------">

                                                    </optgroup>
                                                </select>
                                            </div>
                                            <div style="margin-left: 20px">
                                                <label>Tissue</label>
                                                <select id="similarity_tissue_select" style="width:200px">
                                                    <optgroup>

                                                    </optgroup>
                                                    <optgroup label="----------------------">

                                                    </optgroup>
                                                </select>
                                            </div>
                                        </div>
                                        <div style="overflow: auto">
                                            <div id="similarity_score" style="height:600px;margin:0 auto">

                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <a data-toggle="collapse" class="details" href="#similarity_region" style="text-decoration: none">
                                            <i class="icon ion-plus-round"></i>
                                            Show details
                                        </a>
                                    </div>
                                    <div class="collapse" id="similarity_region" style="margin-top: 20px;overflow: auto">
                                        <div style="width: 95%">
                                            <table id="similarity_table" class="table table-hover table-striped" style="width: 100%">
                                                <thead>
                                                <tr>
                                                    <th>Species</th>
                                                    <th>Tissue</th>
                                                    <th>Cell type in comparison</th>
                                                    <th>
                                                        Marker similarity score
                                                        <div class="wrapper" >
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The similarity score (0-1) is calculated between two cell types by the number of common markers normalized by union of marker set sizes. One represents the same marker sets of two cell types and zero means the two cell types share no common markers.
                                                    </span>
                                                        </div>
                                                    </th>
                                                </tr>

                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                </tr>

                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mypanel">
                        <div class="mypanel-body" id="detail12" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                            <div>
                                <div  class="table-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#similarity">
                                        <i class="icon ion-chevron-down"></i>
                                        <span id="cellular_composition_of_tissues/">Cellular composition of tissues</span>
                                        <div class="wrapper" >
                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                This panel shows cell-type composition across human and mouse tissues in representative large-scale scRNA-seq studies (Tabula Sapiens Consortium and Tabula Muris Consortium).
                                            </span>
                                        </div>
                                    </a>
                                </div>
                                <div id="distribution" class="collapse in">
                                    <div >
                                        <div>
                                            <div >
                                                <label>Single-cell RNA-seq study</label>
                                                <select id="tissue_distribution_select" style="width: 200px;text-transform: capitalize">
                                                    <optgroup label="Homo sapiens">

                                                    </optgroup>
                                                    <optgroup label="Mus musculus">

                                                    </optgroup>
                                                </select>
                                            </div>
                                        </div>
                                        <div style="display: flex;justify-content: center">
                                            <div id="tissue_distribution_plot" style="height:300px">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>





                <div class="mypanel">
                    <div class="mypanel-body" id="detail6" style="display: none;margin-top:10px;padding: 10px 20px 20px 20px">

                        <div>
                            <div  class="table-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#study">
                                    <i class="icon ion-chevron-down"></i>
                                    <span id="cell_cluster_evaluation_in_scrna_seq_studies/">Cell cluster evaluation in scRNA-seq studies</span>
                                    <div class="wrapper" >
                                        <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                        <span class="tooltiptext" style="display: block;white-space: normal">
                                            This panel shows the evaluation of cell clusters of this cell type in available scRNA-seq samples. You can select samples of higher ROGUE index and Silhouette coefficient indicating less expression heterogeneity and larger difference between intra-cluster distance and inter-cluster, respectively.
                                        </span>
                                    </div>
                                </a>
                            </div>
                            <div id="study" class="collapse in" >
                                <div >
                                    <div>
                                        <label>Species</label>
                                        <select id="study_species_select" style="width: 200px;">

                                        </select>
                                    </div>
                                    <div>
                                        <i>Set the filters of cell number, ROGUE, silhouette coefficient, and their averaged estimates by adjusting the hover cursors of the legends.</i>
                                    </div>
                                    <div style="margin-bottom: 20px">
                                        <div style="overflow: auto">
                                            <div style="display: flex;justify-content: flex-start;width: 100%">
                                                <div style="opacity: 0;display:none;position:fixed" id="cell_number">
                                                    <h4 style="font-size:13px;">Cell number</h4>
                                                    <div>
                                                        <input id="cn" type="range" value="1" min="0.25" max="1" step="0.25" style="width:150px;background: -webkit-linear-gradient(#FAC858, #FAC858) no-repeat #ececec; background-size: 100% 100%;">
                                                        <span>Top </span>
                                                        <span id="cn_range">100%</span>
                                                    </div>
                                                </div>
                                                <div style="opacity: 0;display:none;position:fixed" id="rogue">
                                                    <h4 style="font-size:13px;">ROGUE index</h4>
                                                    <div>
                                                        <input id="rs" type="range" value="1" min="0.25" max="1" step="0.25" style="width:150px;background: -webkit-linear-gradient(#82c2ec, #82c2ec) no-repeat #ececec; background-size: 100% 100%;">
                                                        <span>Top </span>
                                                        <span id="rs_range">100%</span>
                                                    </div>
                                                </div>
                                                <div style="opacity: 0;display:none;position:fixed" id="average_rogue">
                                                    <h4 style="font-size:13px;">Average ROGUE index</h4>
                                                    <div>
                                                        <input id="ars" type="range" value="1" min="0.25" max="1" step="0.25" style="width:150px;background: -webkit-linear-gradient(#d8eafc, #d8eafc) no-repeat #ececec; background-size: 100% 100%;">
                                                        <span>Top </span>
                                                        <span id="ars_range">100%</span>
                                                    </div>
                                                </div>
                                                <div style="opacity: 0;display:none;position:fixed" id="silhouette_coefficient">
                                                    <div >
                                                        <h4 style="font-size:13px;">Silhouette coefficient</h4>
                                                        <div style="margin:0 auto">
                                                            <input id="sc" type="range" value="1" min="0.25" max="1" step="0.25" style="width:150px;background: -webkit-linear-gradient(#9599e2, #9599e2) no-repeat #ececec; background-size: 100% 100%;">
                                                            <span>Top </span>
                                                            <span id="sc_range">100%</span>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div style="opacity: 0;display:none;position:fixed" id="average_silhouette_coefficient">
                                                    <h4 style="font-size:13px;white-space: nowrap">Average Silhouette coefficient</h4>
                                                    <div>
                                                        <input id="asc" type="range" value="1" min="0.25" max="1" step="0.25" style="width:150px;background: -webkit-linear-gradient(#b0b6fa, #b0b6fa) no-repeat #ececec; background-size: 100% 100%;">
                                                        <span>Top </span>
                                                        <span id="asc_range">100%</span>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div id="study_plot" style="height: 350px;margin:0 auto"></div>
                                </div>
                                <div style="margin-top:10px">
                                    <a data-toggle="collapse" class="details" href="#cluster_evaluation" style="text-decoration: none">
                                        <i class="icon ion-plus-round"></i>
                                        Show details
                                    </a>
                                </div>
                                <div class="collapse" id="cluster_evaluation" style="margin-top: 20px">
                                    <div style="overflow: auto">
                                        <div style="width: 95%">
                                            <table id="study_table" class="table table-hover table-striped" style="width: 100%;word-break: keep-all">
                                                <thead>
                                                <tr>
                                                    <th>Species</th>
                                                    <th>Accession number</th>
                                                    <th>Sample</th>
                                                    <th>PMID</th>
                                                    <th>Cell number</th>
                                                    <th>
                                                        ROGUE index
                                                        <div class="wrapper" style="height: 18px">
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                                ROGUE is calculated to accurately quantify the purity of identified cell clusters. A ROGUE value greater than 0.9 indicates a cell cluster with high purity.
                                                            </span>
                                                        </div>
                                                    </th>
                                                    <th>
                                                        Silhouette coefficient
                                                        <div class="wrapper" style="height: 18px">
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                        The Silhouette coefficient ranges from -1 to 1, and 1 means clusters are well apart from each other, 0 means clusters are indifferent, and -1 means clusters are defined in the wrong way.
                                                    </span>
                                                        </div>
                                                    </th>
                                                    <th>
                                                        Average ROGUE index
                                                        <div class="wrapper" style="height: 18px">
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                                Mean ROGUE index of all cell clusters in the sample.
                                                            </span>
                                                        </div>
                                                    </th>
                                                    <th>
                                                        Average silhouette coefficient
                                                        <div class="wrapper" style="height: 18px">
                                                            <i class="icon ion-help-circled" style="line-height: 8px"></i>
                                                            <span class="tooltiptext" style="display: block;white-space: normal">
                                                                Mean silhouette coefficient of all cell clusters in the sample.
                                                            </span>
                                                        </div>
                                                    </th>
                                                </tr>

                                                </thead>
                                                <tbody>

                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
    </div>
</div>





<script type="text/javascript" th:inline="javascript">
    var similarity;
    var ytick;
    var ytickLS;
    var DE_plot;
    var DE_score;
    var DE_bar;
    var CE;
    var cell_list_json=[]
    var distribution;
    var conserved;
    var same_cell_similarity;
    function getlineplot(id,data){
        // prettier-ignore
        var plotwidth=$("#width").width();
        $("#"+id).css("width","900px")

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        data=data.sort(sortROGUE)
        var dateList1 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList1=dateList1.slice(0,dateList1.length*$("#rs").val())


        data=data.sort(sortSilhoutte)
        var dateList2 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList2=dateList2.slice(0,dateList2.length*$("#sc").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList2.indexOf(v) > -1
        })

        data=data.sort(sortCellNumber)
        var dateList3 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList3=dateList3.slice(0,dateList3.length*$("#cn").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList3.indexOf(v) > -1
        })

        data=data.sort(sortAverageROGUE)
        var dateList4 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList4=dateList4.slice(0,dateList4.length*$("#ars").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList4.indexOf(v) > -1
        })
        data=data.sort(sortAverageSilhoutte)
        var dateList5 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        dateList5=dateList5.slice(0,dateList5.length*$("#asc").val())
        dateList1 = dateList1.filter(function (v) {
            return dateList5.indexOf(v) > -1
        })

        data=eval(data).filter(function(e){
            if(e.Dataset.indexOf("_SRS")>=0) {
                return dateList1.indexOf(e.Dataset.split("_")[1])>-1
            }
            else{
                return dateList1.indexOf(e.Dataset)>-1

            }
        })

        data=data.sort(sortSilhoutte)
        dateList1 = data.map(function (item) {
            if(item.Dataset.indexOf("_SRS")>=0){
                return item.Dataset.split("_")[1];
            }
            else{
                return item.Dataset
            }
        });
        $("#study_table").DataTable({
            data:data,
            columns:[
                {
                    data:"Species2",
                    render:function(data,type,row){
                        return row.Species2
                    }
                },
                {
                    data:"Acession_Number",
                    render:function(data,type,row){
                        if(row.PMID.indexOf("doi")>=0){
                            return "<a target='_blank' href='/celltaxonomy/study/"+row.Acession_Number+"'>"+row.Acession_Number+"</a>"
                        }
                        else{
                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+row.Acession_Number+"</a>"
                        }
                    }
                },
                {
                    data:"Dataset",
                    render:function(data,type,row){
                        if(row.Dataset.indexOf("_SRS")>=0){
                            return row.Dataset.split("_")[1]
                        }
                        else if(data.replace("\r","")=="Tabula_mouse_10x"){
                            return "Tabula mouse (10x)"
                        }
                        else if(data.replace("\r","")=="Tabula_mouse_SMART-Seq"){
                            return "Tabula mouse (SMART-Seq)"
                        }
                        else{
                            return row.Dataset
                        }
                    }
                },
                {
                    data:"PMID",
                    render:function(data,type,row){
                        if(row.PMID!="-" && row.PMID.indexOf("doi")>=0){
                            return "<a target='_blank' href='https://doi.org/"+row.PMID.split(": ")[1]+"'>"+row.PMID.split(": ")[1]+"</a>"
                        }
                        else if(row.PMID!="-"){
                            return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+row.PMID+"'>"+row.PMID+"</a>"
                        }
                        else{
                            return row.PMID
                        }
                    }
                },
                {data:"Cell_Numbers"},
                {
                    data:"ROGUE_index",
                    render:function(data,type,row){
                        if(data!="-"){
                            return (data*1).toPrecision(2)
                        }
                        else{
                            return data
                        }
                    }
                },
                {
                    data:"mean_silhouette",
                    render:function(data,type,row){
                        if(data!="-"){
                            return (data*1).toPrecision(2)
                        }
                        else{
                            return data
                        }
                    }
                },
                {
                    data:"mean_se",
                    render:function(data,type,row){
                        if(data!="-"){
                            return (data*1).toPrecision(2)
                        }
                        else{
                            return data
                        }
                    }
                },
                {
                    data:"avg_silhouette",
                    render:function(data,type,row){
                        if(data!="-"){
                            return (data*1).toPrecision(2)
                        }
                        else{
                            return data
                        }
                    }
                }
            ],
            destroy:true,
            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
            iDisplayLength:5

        })

        var cellnumber1 = data.map(function (item) {
            return (item.Cell_Numbers*1);
        });
        var valueList1 = data.map(function (item) {
            return (item.ROGUE_index*1).toPrecision(2);
        });
        var avg_rogue1=data.map(function (item) {
            return (item.mean_se*1).toPrecision(2);
        });
        var valueList2 = data.map(function (item) {
            return (item.mean_silhouette*1).toPrecision(2);
        });

        var avg_silhoutte2=data.map(function (item) {
            return (item.avg_silhouette*1).toPrecision(2);
        });

        var option = {
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            title: [
                {
                    top:'1%',
                    left: 'center',
                    text: 'Quality evaluation of cell clusters in samples',
                    textStyle:{
                        fontFamily:"Arial",
                        fontSize:15
                    }
                }
            ],
            tooltip: {
                trigger: 'axis'
            },
            xAxis: [
                {
                    data: dateList1,
                    axisLabel:{
                        show:false
                    },
                    name:"Sample",
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"
                    },
                    nameLocation:"center",
                    nameGap:30,
                    axisLine:{
                        show:false
                    },
                    axisTick:{
                        show:false
                    }
                }
            ],
            yAxis: [
                {
                    name:"Cell number",
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    type:"log",
                    alignTicks:true
                },
                {
                    name:"Score",
                    nameTextStyle:{
                        fontWeight:'bold',
                        fontSize:12,
                        fontFamily:"Arial"
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    type:"value"

                }
            ],
            grid: {
                left:'6%',
                height:'70%'
            },
            legend:[
                {
                    left:'center',
                    top:'10%',
                    id:"legend",

                    data:[
                        {
                            name:"Cell number",
                            itemStyle:{
                                color:"#FAC858"
                            },
                            lineStyle:{
                                color:"#FAC858"
                            }
                        },
                        {
                            name:"ROGUE",
                            itemStyle:{
                                color:"#82c2ec"
                            },
                            lineStyle:{
                                color:"#82c2ec"
                            }
                        },
                        {
                            name:"Average ROGUE",
                            itemStyle:{
                                color:"#d8eafc"
                            },
                            lineStyle:{
                                color:"#d8eafc"
                            }
                        },
                        {
                            name:"Silhouette coefficient",
                            itemStyle:{
                                color:"#9599e2"
                            },
                            lineStyle:{
                                color:"#9599e2"
                            },
                        },
                        {
                            name:"Average silhouette coefficient",

                            itemStyle:{
                                color:"#b0b6fa"
                            },
                            lineStyle:{
                                color:"#b0b6fa"

                            }
                        }
                    ],
                    // selected:{
                    //     "Average ROGUE":false,
                    //     "Average silhouette coefficient":false
                    // },
                    textStyle:{
                        fontSize:11,
                        fontFamily:"Arial"
                    }
                }

            ],
            series: [
                {
                    name:"Cell number",

                    type: 'scatter',
                    showSymbol: false,
                    color:'#FAC858',
                    symbol:"diamond",

                    data: cellnumber1,

                },
                {
                    name:"ROGUE",

                    type: 'scatter',
                    showSymbol: false,
                    data: valueList1,
                    color:"#82c2ec",
                    symbol:"triangle",

                    yAxisIndex: 1,

                },
                {
                    name:"Average ROGUE",

                    type: 'scatter',
                    showSymbol: false,
                    data: avg_rogue1,
                    color:"#d8eafc",

                    yAxisIndex: 1,

                },
                {
                    name:"Silhouette coefficient",
                    type: 'scatter',
                    showSymbol: false,
                    data: valueList2,
                    color:"#9599e2",
                    symbol:"triangle",
                    yAxisIndex: 1
                },
                {
                    name:"Average silhouette coefficient",
                    type: 'scatter',
                    showSymbol: false,
                    data: avg_silhoutte2,
                    color:"#b0b6fa",
                    yAxisIndex: 1
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.top="30%"
            option.grid.height="50%"

            option.grid.left="10%"


        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getbarplot(id,data,title,xtitle,ytitle,name,value){
        var plotwidth=$("#width").width();
        title=title.replace(/ [a-z][a-z] All/g,"")

        $("#"+id).css("width","900px")

        data=data.sort(sortLS)
        data=data.slice(0,30)
        cell_list=$.unique(unpack(data,"Gene_ENTREZID2").sort())




        var app = {};
        if(name=="Tissue_standard"){
            ytick=unpack(data.sort(sortTELS),name)
        }
        else{
            ytick=unpack(data.sort(sortLS),name)
            ytickLS=unpack(data.sort(sortLS),name)
        }
        var xtick_length=0
        ytick.map(function(e){
            if(xtick_length<ytick.length){
                xtick_length=ytick.length
            }
        })
        if(xtick_length>10){
            $("#"+id).css("height","300px")
        }
        else{
            $("#"+id).css("height","250px")
        }
        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        myChart.resize()

        var datas=[];
        var a={}


        a.name="No. of publications"
        a.type="bar"
        a.itemStyle={}
        a.itemStyle.borderRadius=[5,5,0,0]
        a.markPoint={}
        a.markPoint.data=[]
        a.markPoint.silent=true
        a.markPoint.itemStyle={}
        a.markPoint.itemStyle.color="transparent"
        a.markPoint.label={}
        a.markPoint.label.color="black"
        a.markPoint.label.offset=[0,20]
        var tempdata= new Array(ytick.length)
        for (var j=0;j<data.length;j++){
            tempdata[$.inArray(data[j][name],ytick)]=data[j][value]*1
            if(data[j].FDR<0.001){
                a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"***"})
            }
            else if(data[j].FDR<0.01 && data[j].FDR>0.001){
                a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"**"})
            }
            else if(data[j].FDR<0.05 && data[j].FDR>0.01){
                a.markPoint.data.push({coord:[data[j][name],data[j][value]*1],value:"*"})
            }

        }
        a.data=tempdata
        datas.push(a)



        var option;
        option = {
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            color:{
                type: 'linear',
                x: 0,
                y: 0,
                x2: 0,
                y2: 1,
                colorStops: [{
                    offset: 0, color: '#8bc6ec' // 0% 处的颜色
                }, {
                    offset: 1, color: '#9599e2' // 100% 处的颜色
                }],
                global: false // 缺省为 false
            },
            title:{
                text:title,
                left:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name:xtitle,

                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    splitNumber:4,
                    position: 'left',
                    minInterval: 1

                }

            ],
            tooltip:{
                textStyle:{
                    fontStyle:"Arial"
                }
            },
            grid:{
                height:"50%",
                right:"5%",
                left:"6%"
            },
            xAxis: {
                type: 'category',
                name:ytitle,
                data: ytick,
                axisTick:{
                    show:false
                },
                axisLabel:{
                    rotate:45,
                    fontFamily:"Arial",
                    fontSize:11
                }
            },
            series: datas
        };
        if(ytick.length<=5){
            option.series[0].barWidth='10%'
        }
        else if(ytick.length<=10){
            option.series[0].barWidth='30%'
        }
        else{
            option.series[0].barWidth='90%'

        }
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getbarplot2(id,data,title,xtitle,ytitle){
        var plotwidth=$("#width").width();
        title=title.replace(/ [a-z][a-z] All/g,"")
        $("#"+id).css("width","900px")

        var xtick =unpack(data,"Tissue")
        var xtick_length=0
        xtick.map(function(e){
            if(e.length>xtick_length){
                xtick_length=e.length
            }

        })
        if(xtick_length>15){
            $("#"+id).css("height","400px")
        }
        else{
            $("#"+id).css("height","300px")
        }
        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        myChart.resize()
        var app = {};

        function sortCellNumber(a,b){
            return b.Number_of_cells - a.Number_of_cells
        }

        data.sort(sortCellNumber)
        var cell_number=unpack(data,"Number_of_cells")
        var total_cell_number=0
        cell_number.map(function(e){
            total_cell_number=total_cell_number+e
        })
        for (var i=0;i<cell_number.length;i++){
            cell_number[i]=(cell_number[i]/total_cell_number*100).toFixed(2)

        }

        var option;
        option = {
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            color:{
                type: 'linear',
                x: 0,
                y: 0,
                x2: 0,
                y2: 1,
                colorStops: [{
                    offset: 0, color: '#8bc6ec' // 0% 处的颜色
                }, {
                    offset: 1, color: '#9599e2' // 100% 处的颜色
                }],
                global: false // 缺省为 false
            },
            title:{
                text:title,
                left:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name:"Percentage (%)",

                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    },
                    axisLabel:{
                        fontSize:11,
                        fontFamily:"Arial"
                    },
                    position: 'left',

                }

            ],
            tooltip:{
                textStyle:{
                    fontStyle:"Arial"
                },
                formatter:'{b}: {c}%'
            },
            grid:{
                height:"60%",
                right:"6%",
                left:"6%",
                width:"90%"
            },
            xAxis: {
                type: 'category',
                data: xtick,
                axisTick:{
                    show:false
                },
                axisLabel:{
                    rotate:45,
                    fontFamily:"Arial",
                    fontSize:11
                }
            },
            series: [{
                data:cell_number,
                type:"bar",
                itemStyle:{
                    borderRadius:[5,5,0,0]
                }
            }]
        };


        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }

        if (unpack(data,"Tissue").length>50){
            option.xAxis.axisLabel.fontSize=8
        }
        else if(unpack(data,"Tissue").length<=5){
            option.series[0].barWidth='10%'

        }
        option && myChart.setOption(option);
    }
    function getbarplotDE(id,data){
        var plotwidth=$("#width").width();
        var title=""
        $("#"+id).css("width","900px")



        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        var total=[]
        var ytick=unpack(data["result"],"markers")
        var geneid=unpack(data["result"],"Gene_id")

        for(var i=0;i<ytick.length;i++){
            var temp=eval(data["total"]).filter(function(e){

                // return e.Gene==ytick[i].replace(/\r/,"")
                return e.Gene.replace(/\r/,"")==ytick[i].replace(/\r/,"")

            })
            if(temp.length>0){
                total.push(
                    temp[0].counts
                )
            }

        }
        var app = {};

        var ratio=[]
        var counts=unpack(data['result'],"counts")
        for(var i=0;i<ytick.length;i++){
            ratio.push((counts[i]/total[i]).toPrecision(2))
        }


        data=[]
        for(var i=0;i<ytick.length;i++){

            if(ytick[i]=="PECAM"){
                ytick[i]="PECAM1"
            }
            data.push(
                {"total":total[i],"ratio":ratio[i],"counts":counts[i],"marker":ytick[i],'Gene_id':geneid[i]}
            )
        }
        $("#cell_marker_DE_bar_table").DataTable({
            data:data,
            columns:
                [
                    {
                        data:"marker",
                        render:function(data,type,row){
                            return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_id+"'>"+data+"</a>"
                        }
                    },
                    {data:"total"},
                    {data:"counts"},
                    {data:"ratio"}
                ],
            destroy:true,
            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
            "iDisplayLength":5,
            order:[2,"desc"]

        })

        var option;
        option = {
            color:["#8bc6ec",'#9599e2',"#FAC858"],
            title:{
                text:"Highly expressed ratio of cell markers",
                left:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            legend: {
                right:'center',
                top:'30',
                data:["Highly expressed samples (HE, FDR less than 0.05)","Total samples (E)","Highly expressed ratio (HE/E)"],
                textStyle:{
                    fontFamily:"Arial"
                },
                width:"90%"
            },
            yAxis: [
                {
                    type: 'value',
                    name:"Ratio",
                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    },
                    min:0,
                    max:1
                },
                {
                    type: 'value',
                    name:"Number of samples",
                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold',
                    },
                    position: 'right',
                    minInterval: 1,
                    alignTicks:true

                },


            ],
            tooltip:{},
            grid:{
                height:"40%",
                right:"10%",
                left:'6%',
                top:'100'
            },
            xAxis: {
                type: 'category',
                data: ytick,
                axisLabel:{
                    fontSize:10,
                    rotate:45,
                    // formatter:function(value,index){
                    //     if(cell_list.indexOf(value)>=0){
                    //         return value+"*"
                    //     }
                    //     else{
                    //         return value
                    //     }
                    // }
                }
            },
            series: [
                {
                    name:"Highly expressed samples (HE, FDR less than 0.05)",
                    type:"bar",
                    yAxisIndex:1,

                    data:counts
                },
                {
                    name:"Total samples (E)",
                    type:"bar",
                    yAxisIndex:1,

                    data:total
                },
                {
                    name:"Highly expressed ratio (HE/E)",
                    type:"scatter",
                    data:ratio
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getbarplotDE2(id,data){
        var plotwidth=$("#width").width();
        var title=""

        $("#"+id).css("width","900px")

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        var total=[]
        var ytick=unpack(data["result"],"markers")
        var geneid=unpack(data["result"],"Gene_id")

        for(var i=0;i<ytick.length;i++){
            var temp=eval(data["total"]).filter(function(e){
                return e.Gene.replace(/\r/,"")==ytick[i].replace(/\r/,"")

            })
            if(temp.length>0){
                total.push(
                    temp[0].counts
                )
            }

        }
        var app = {};


        var ratio=[]
        var counts=unpack(data["result"],"counts")
        var data=[]
        for(var i=0;i<ytick.length;i++){
            ratio.push((counts[i]/total[i]).toPrecision(2))

        }
        for(var i=0;i<ytick.length;i++){
            if(ytick[i]=="PECAM"){
                ytick[i]="PECAM1"
            }
            data.push(
                {"total":total[i],"ratio":ratio[i],"counts":counts[i],"marker":ytick[i],'Gene_id':geneid[i]}
            )
        }
        function sortDEratio(a,b){
            return b.ratio-a.ratio
        }
        data.sort(sortDEratio)
        $("#cell_marker_DE_bar_table").DataTable({
            data:data,
            columns:
                [
                    {
                        data:"marker",
                        render:function(data,type,row){
                            return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_id+"'>"+data+"</a>"
                        }
                    },
                    {data:"total"},
                    {data:"counts"},
                    {data:"ratio"}
                ],
            destroy:true,
            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
            "iDisplayLength":5,
            order:[3,"desc"]

        })
        var option;
        option = {
            color:["#8bc6ec",'#9599e2',"#FAC858"],
            title:{
                text:"Highly expressed ratio of cell markers",
                left:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            legend: {
                right:'center',
                top:'30',
                data:["Highly expressed samples (HE, FDR less than 0.05)","Total samples (E)","Highly expressed ratio (HE/E)"],
                textStyle:{
                    fontFamily:"Arial"
                },
                width:"90%"
            },
            yAxis: [
                {
                    type: 'value',
                    name:"Ratio",
                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    }
                },
                {
                    type: 'value',
                    name:"Number of samples",
                    nameTextStyle:{
                        fontFamily:"Arial",
                        fontSize:12,
                        fontWeight:'bold'
                    },
                    splitLine:{
                        show:false
                    },
                },


            ],
            tooltip:{},
            grid:{
                height:"40%",
                right:"10%",
                left:'6%',
                top:'100'
            },
            xAxis: {
                type: 'category',
                data: unpack(data,"marker"),
                axisLabel:{
                    fontSize:10,
                    rotate:45,
                    // formatter:function(value,index){
                    //     if(cell_list.indexOf(value)>=0){
                    //         return value+"*"
                    //     }
                    //     else{
                    //         return value
                    //     }
                    // }
                }
            },
            series: [
                {
                    name:"Highly expressed samples (HE, FDR less than 0.05)",
                    type:"bar",
                    data:unpack(data,"counts"),
                    yAxisIndex:1,

                },
                {
                    name:"Total samples (E)",
                    type:"bar",
                    data:unpack(data,"total"),
                    yAxisIndex:1,

                },
                {
                    name:"Highly expressed ratio (HE/E)",
                    type:"scatter",
                    data:unpack(data,"ratio")
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }

    function getboxplot(id,results){
        var plotwidth=$("#width").width();
        $("#"+id).css("width","900px")

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        var option;

        var datas = [
            ["markers","avg_log2FC"]
        ];
        results.map(function(e){
            datas.push([e.markers,(e.avg_log2FC*1).toPrecision(2)])
        })
        echarts.registerTransform(window.ecSimpleTransform.aggregate);





        option = {
            color:["#9599e2"],
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            dataset: [
                {
                    id:"raw",
                    source:datas
                },
                {
                    id:"aggregate",
                    fromDatasetId:"raw",
                    transform:
                        [
                            {
                                type: 'ecSimpleTransform:aggregate',
                                config: {
                                    resultDimensions: [
                                        { name: 'Min', from: 'avg_log2FC', method: 'min' },
                                        { name: 'Q1', from: 'avg_log2FC', method: 'Q1' },
                                        { name: 'Median', from: 'avg_log2FC', method: 'median' },
                                        { name: 'Q3', from: 'avg_log2FC', method: 'Q3' },
                                        { name: 'Max', from: 'avg_log2FC', method: 'max' },
                                        { name: 'markers', from: 'markers' }
                                    ],
                                    groupBy: 'markers'
                                }
                            },
                            {
                                type: 'sort',
                                config: {
                                    dimension: 'Median',
                                    order: 'desc'
                                }
                            }
                        ]
                },
            ],

            title:{
                text:"Cell marker differential expression pattern (FDR less than 0.05) in "+$("#name").text()+" across samples",
                right:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            tooltip: {
                trigger: 'item',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '6%',
                top: '25%',
                right: '5%',
                bottom: '15%',
                height:'50%'
            },
            xAxis: {
                type: 'category',
                axisLabel:{
                    interval:0,
                    rotate: 45,
                    fontFamily:"Arial",
                    fontSize:11
                },
                boundaryGap: true,
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                name: 'log2FC',
                splitArea: {
                    show: true,
                    areaStyle:{
                        color:["#ffffff","#f7fdff"]
                    }
                },
                splitLine:{
                    show:false
                },

                nameTextStyle:{
                    fontFamily:"Arial",
                    fontSize:12,
                    fontWeight:'bold'
                },
            },

            series: [
                {
                    name: 'log2FC',
                    type: 'boxplot',
                    datasetId: "aggregate",
                    encode: {
                        y: ['Min', 'Q1', 'Median', 'Q3', 'Max'],
                        x: 'markers',
                        itemName: ['markers'],
                        tooltip: ['Max', 'Q3', 'Median', 'Q1', 'Min']
                    },
                    itemStyle:{
                        borderWidth:1.5
                    }
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }
    function getboxplotSS(id,results){
        var plotwidth=$("#width").width();
        $("#"+id).css("width","900px")

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        var option;

        var tissue=$.unique(unpack(results,"Tissue").sort());
        var datas=[
            ["Marker","Score"]
        ]
        results.map(function(e){
            var temp=e.Cell_specific_score.split(",")
            temp.map(function(f){
                datas.push([e.Gene,(f*1).toPrecision(2)])
            })
        })

        echarts.registerTransform(window.ecSimpleTransform.aggregate);

        option = {
            color:["#9599e2"],
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            dataset: [
                {
                    id:"raw",
                    source:datas
                },
                {
                    id:"aggregate",
                    fromDatasetId:"raw",
                    transform:
                        [
                            {
                                type: 'ecSimpleTransform:aggregate',
                                config: {
                                    resultDimensions: [
                                        { name: 'Min', from: 'Score', method: 'min' },
                                        { name: 'Q1', from: 'Score', method: 'Q1' },
                                        { name: 'Median', from: 'Score', method: 'median' },
                                        { name: 'Q3', from: 'Score', method: 'Q3' },
                                        { name: 'Max', from: 'Score', method: 'max' },
                                        { name: 'Marker', from: 'Marker' }
                                    ],
                                    groupBy: 'Marker'
                                }
                            },
                            {
                                type: 'sort',
                                config: {
                                    dimension: 'Median',
                                    order: 'desc'
                                }
                            }
                        ]
                },
            ],
            legend: {
                show:false,
                top: '10%'
            },
            title:{
                text:"Cell marker expression specificity in "+$("#name").text()+" across samples",
                right:'center',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            tooltip: {
                trigger: 'item',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '6%',
                top: '20%',
                right: '5%',
                bottom: '15%',
                height:'50%'
            },
            xAxis: {
                type: 'category',
                axisLabel:{
                    interval:0,
                    rotate: 45,
                    fontSize:11
                },
                boundaryGap: true,
                splitArea: {
                    show: false
                },
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                name: 'Specificity score',
                nameTextStyle:{
                    fontFamily:"Arial",
                    fontSize:12,
                    fontWeight:'bold'
                },
                splitArea: {
                    show: true,
                    areaStyle:{
                        color:["#ffffff","#f7fdff"]
                    }
                },
                splitLine:{
                    show:false
                }
            },
            series: [
                {
                    name: 'Specificity score',
                    type: 'boxplot',
                    datasetId: "aggregate",
                    encode: {
                        y: ['Min', 'Q1', 'Median', 'Q3', 'Max'],
                        x: 'Tissue',
                        itemName: ['Tissue'],
                        tooltip: ['Max', 'Q3', 'Median', 'Q1', 'Min']
                    },
                    itemStyle:{
                        borderWidth:1.5
                    }
                }
            ]
        };
        if($(window).width()>1400){
        }
        else if($(window).width()>1024){
            option.grid.left="10%"

        }
        else{

        }
        option && myChart.setOption(option);
    }

    function getgraph(results){
        var plotwidth=$("#width").width();
        $("#similarity_score").css("width","600px")
        var chartDom = document.getElementById("similarity_score");
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        var option;
        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })
        results=results.slice(0,30);
        var graph={
            categories:[{name:'Cell type'}],
            links:[],
            nodes:[]
        }
        for (var i=0;i<results.length;i++){
            graph.nodes.push({id:i,name:results[i].Other_Cell_standard,value:results[i].score})
            graph.links.push({source:i,target:results.length,value:results[i].score})
        }
        graph.nodes.push({id:results.length,name:results[0].Cell_standard,value:null,itemStyle: {color:'#9599e2'}})

        var title = $("#name").text()+": similarity score in "+$("#similarity_tissue_select").val()+" of "+$("#similarity_species_select select").val()
        title=title.replace(/ [a-z][a-z] All/g,"")

        option = {
            color:["#8bc6ec"],
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            title: {
                text: title,
                top: 'top',
                left: 'left',
                textStyle:{
                    fontSize:15,
                    fontFamily:"Arial"
                }
            },
            tooltip: {},

            series: [
                {
                    name: 'Similarity',
                    type: 'graph',
                    layout: 'force',
                    data: graph.nodes,
                    links: graph.links,
                    categories: graph.categories,
                    roam: true,
                    label: {
                        show:true,
                        position: 'top'
                    },
                    zoom:2.5,
                    draggable:true,
                    force: {
                        repulsion: [50,10],
                        edgeLength: [10, 50]
                    }
                }
            ]
        };
        option && myChart.setOption(option);

    }
    function getecharts(id,xtick,ytick,data,title,xtitle,ytitle){
        var xtick_length=0
        xtick.map(function(e){
            if(xtick_length<e.length){
                xtick_length=e.length
            }
        })

        if(xtick_length>30){
            $("#"+id).css('height',"700px")
        }
        else if(xtick_length>20){
            $("#"+id).css('height',"650px")
        }
        var ytick_length=0
        ytick.map(function(e){
            if(ytick_length<ytick.length){
                ytick_length=ytick.length
            }
        })

        var chartDom = document.getElementById(id);
        var myChart = echarts.init(chartDom,null,{renderer:'svg'});
        var app = {};
        title=title.replace(/ [a-z][a-z] All/g,"")
        myChart.resize()



        var option;
        var max_legend=0;
        for(i=0;i<data.length;i++){
            max_legend=Math.max(data[i][2],max_legend)
        }
        data = data.map(function (item) {
            return [item[0], item[1], item[2] || '-'];
        });
        option = {

            title:{
                text:title,
                right:'center',
                top:'2%',
                textStyle:{
                    fontFamily:"Arial",
                    fontSize:15
                }
            },
            toolbox:{
                show:true,
                feature:{
                    saveAsImage:{
                        type:'svg'
                    }
                }
            },
            tooltip: {
                trigger:'item',
                axisPointer:{
                    type:"cross"
                },
                position: 'top'
            },
            grid:{
                height:'30%',
                right:"50",
                left:"8%",
                top:"10%"
            },
            xAxis: {
                type: 'category',
                data: xtick,
                splitArea: {
                    show: true
                },
                axisTick:{
                    show:false
                },
                axisLabel:{
                    interval:0,
                    rotate: 70,
                    fontFamily:"Arial",
                    fontSize:11

                },
                // name:xtitle,
                // nameLocation:'center',
                // nameTextStyle:{
                //     fontWeight:'bold',
                //     fontSize:18
                // },
                // nameGap:110
            },
            yAxis: {
                type: 'category',
                data: ytick,
                splitArea: {
                    show: true
                },
                axisTick:{
                    show:false,

                },
                axisLabel:{
                    interval:0,
                    width:100,
                    overflow:"break",
                    fontFamily:"Arial",
                    fontSize:11
                },
                // name:ytitle,
                // nameLocation:'center',
                // nameTextStyle:{
                //     fontWeight:'bold',
                //     fontSize:18
                // },
                // nameGap:110

            },
            visualMap: {
                min: 0,
                max:max_legend,
                calculable: true,
                right: '0',
                top:'10%',
                itemWidth:'15',
                itemHeight:70,
                show:true,
                padding:0,
                inRange:{
                    color:["#d8eafc","#82c2ec","#b0b6fa","#9599e2"]
                },
                textStyle:{
                    fontSize:12
                }
            },
            label:{
                fontFamily:"Arial",
                fontSize:10
            },
            series: [{
                type: 'heatmap',
                data: data,
                label: {
                    show: true
                },
                itemStyle:{
                    borderColor:"Black",
                    borderWidth:0.3
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        };
        if(ytick.length>5){
            option.grid.height='70%'
        }
        else{

        }
        if(ytick_length>10){
            option.grid.left="12%"
        }
        if(xtick_length>30){
            option.grid.height='50%'
        }
        else if(xtick_length>10){
            option.grid.height='60%'
        }

        else{
            option.grid.height="70%"
        }

        if($(window).width()>1500){
        }
        else if($(window).width()>1024){
            option.grid.left="15%"
        }
        else{

        }
        myChart.setOption(option,true);

    }
    $(document).ready(function(){
        if([[${name}]]!=null){
            getCelltypeDetail([[${name}]],[[${id}]])


        }
        else{
            $.ajax({
                url:'/celltaxonomy/cell_type_statistic',
                type:'post',
                success:function(results){
                    $("#tab1").text(results.length)
                    $("#statistic_table").DataTable({
                        data:results,
                        columns:[
                            {
                                data:"CT_ID",
                                render:function(data,type,row){
                                    if(type!="filter"){
                                        if(row.Specific_Cell_Ontology_ID.indexOf("_")<0){
                                            if(row.Specific_Cell_Ontology_ID.indexOf(".")>0){
                                                return "<div>" +
                                                    "<a class='main_item' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Cell_standard+"</a>"+
                                                    "<div class='sub_item'><span >Cell Taxonomy ID: </span><a class='sub_content' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.CT_ID+"</a></div>"+
                                                    "<div class='sub_item'><span>Cell Ontology ID: -</span></div>"+
                                                    "</div>"
                                            }
                                            else{
                                                return "<div>" +
                                                    "<a class='main_item' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Cell_standard+"</a>"+
                                                    "<div class='sub_item'><span>Cell Taxonomy ID: </span><a class='sub_content' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.CT_ID+"</a></div>"+
                                                    "<div class='sub_item'><span>Cell Ontology ID: </span><a class='sub_content' target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/cl/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Specific_Cell_Ontology_ID.replace(/:/,"_")+"' class='cellontology'>"+row.Specific_Cell_Ontology_ID+"</a></div>"+
                                                    "</div>"
                                            }

                                        }
                                        else{
                                            return "<div>" +
                                                "<a class='main_item' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Cell_standard+"</a>"+
                                                "<span>Cell Taxonomy ID: </span><a class='sub_item' href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.CT_ID+"</a>"+
                                                "<span>Cell Ontology ID: </span><span>"+row.Specific_Cell_Ontology_ID+"</span>"+
                                                "</div>"
                                        }
                                    }
                                    else{
                                        return row.Cell_standard+row.Specific_Cell_Ontology_ID+row.CT_ID
                                    }

                                }
                            },
                            {
                                data:"Species_num",
                                render:function(data,type,row){
                                    return "<div style='width:50%;'>"+
                                        "<div class='circle' data-note='"+row.Species_num+"' data-size='40'>" +
                                        "<svg class='circle_svg' value='species' style='width: 40px; height: 40px;'>"+
                                        "<circle r='19' cy='20' cx='20' style='stroke: #46cbb7; stroke-dashoffset: 23.8761;'></circle>"+
                                        "</svg>"+
                                        "<span style='display: none'>"+row.Species_num+"</span>"+
                                        "</div>"+
                                        "</div>"
                                    // return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Species_num+"</a>"
                                }
                            },
                            {
                                data:"Tissue_num",
                                render:function(data,type,row){
                                    if(data!=0){
                                        return "<div style='width:50%;'>"+
                                            "<div class='circle' data-note='"+row.Tissue_num+"' data-size='40'>" +
                                            "<svg class='circle_svg' value='tissue' style='width: 40px; height: 40px;'>"+
                                            "<circle r='19' cy='20' cx='20' style='stroke: #ecd06f; stroke-dashoffset: 23.8761;'></circle>"+
                                            "</svg>"+
                                            "<span style='display: none'>"+row.Tissue_num+"</span>"+
                                            "</div>"+
                                            "</div>"
                                    }
                                    else{
                                        return "<div style='width:50%;'>"+
                                            "<div class='circle' data-note='"+row.Tissue_num+"' data-size='40'>" +
                                            "<svg class='circle_svg' style='cursor:auto;width: 40px; height: 40px;'>"+
                                            "<circle r='19' cy='20' cx='20' style='stroke: #ecd06f; stroke-dashoffset: 23.8761;'></circle>"+
                                            "</svg>"+
                                            "<span style='display: none'>"+row.Tissue_num+"</span>"+
                                            "</div>"+
                                            "</div>"
                                    }

                                    // return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"#tissue_enrichment/'>"+row.Tissue_num+"</a>"
                                }

                            },
                            {
                                data:"Disease_num",
                                render:function(data,type,row){
                                    if(data!=0){
                                        return "<div style='width:50%;'>"+
                                            "<div class='circle' data-note='"+row.Disease_num+"' data-size='40'>" +
                                            "<svg class='circle_svg' value='condition' style='width: 40px; height: 40px;'>"+
                                            "<circle r='19' cy='20' cx='20' style='stroke: #9158e2; stroke-dashoffset: 23.8761;'></circle>"+
                                            "</svg>"+
                                            "<span style='display: none'>"+row.Disease_num+"</span>"+
                                            "</div>"+
                                            "</div>"
                                    }
                                    else{
                                        return "<div style='width:50%;'>"+
                                            "<div class='circle' data-note='"+row.Disease_num+"' data-size='40'>" +
                                            "<svg class='circle_svg' style='cursor:auto;width: 40px; height: 40px;'>"+
                                            "<circle r='19' cy='20' cx='20' style='stroke: #9158e2; stroke-dashoffset: 23.8761;'></circle>"+
                                            "</svg>"+
                                            "<span style='display: none'>"+row.Disease_num+"</span>"+
                                            "</div>"+
                                            "</div>"
                                    }

                                    // return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"'>"+row.Disease_num+"</a>"
                                }
                            },
                            {
                                data:"Marker_num",
                                render:function(data,type,row){
                                    return "<div style='width:50%;'>"+
                                        "<div class='circle' data-note='"+row.Marker_num+"' data-size='40'>" +
                                        "<svg class='circle_svg' value='marker' style='width: 40px; height: 40px;'>"+
                                        "<circle r='19' cy='20' cx='20' style='stroke: #df6c4f; stroke-dashoffset: 23.8761;'></circle>"+
                                        "</svg>"+
                                        "<span style='display: none'>"+row.Marker_num+"</span>"+
                                        "</div>"+
                                        "</div>"
                                    // return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"#cell_marker_enrichment/' >"+row.Marker_num+"</a>"
                                }
                            },
                            {
                                data:"PMID_num",
                                render:function(data,type,row){
                                    if(data!=0){
                                        return "<div style='width:50%;'>"+
                                            "<div class='circle' data-note='"+row.PMID_num+"' data-size='40'>" +
                                            "<svg class='circle_svg' value='PMID' style='width: 40px; height: 40px;'>"+
                                            "<circle r='19' cy='20' cx='20' style='stroke: #52d554; stroke-dashoffset: 23.8761;'></circle>"+
                                            "</svg>"+
                                            "<span style='display: none'>"+row.PMID_num+"</span>"+
                                            "</div>"+
                                            "</div>"
                                    }
                                    else{
                                        return "<div style='width:50%;'>"+
                                            "<div class='circle' data-note='"+row.PMID_num+"' data-size='40'>" +
                                            "<svg class='circle_svg' style='cursor:auto;width: 40px; height: 40px;'>"+
                                            "<circle r='19' cy='20' cx='20' style='stroke: #52d554; stroke-dashoffset: 23.8761;'></circle>"+
                                            "</svg>"+
                                            "<span style='display: none'>"+row.PMID_num+"</span>"+
                                            "</div>"+
                                            "</div>"
                                    }

                                    // return "<a href='/celltaxonomy/celltype/"+row.CT_ID+"#publication-supported_markers' >"+row.PMID_num+"</a>"
                                }
                            }



                        ],

                        destroy: true,
                        deferRender:true,
                        responsive: true,
                        // dom: '<"row"<"col-lg-4 col-sm-4"l><"col-lg-4 col-sm-4"B><"col-lg-4 col-sm-4"f>>t<"row"<"col-lg-6 col-sm-5"i><"col-lg-6 col-sm-7"p>>',
                        dom: '<"row"<"col-lg-12 col-sm-12"f>>t<"row"<"col-lg-6 col-sm-5"i><"col-lg-6 col-sm-7"p>>',
                        order:[5,"desc"],
                        'iDisplayLength':5,
                        'oSearch':{'bSmart':false}
                        // buttons: [
                        //     'excel'
                        // ]

                    });


                },
                error:function(){
                    console.log("error")
                }
            });
            $.ajax({
                url:'/celltaxonomy/cell_type_statistic2',
                type:'post',
                success:function(results){
                    $("#tab2").text(results.length)

                    $("#statistic_table2").DataTable({
                        data:results,
                        initComplete: function () {
                            var r = $('#statistic_table2 tfoot tr');
                            r.find('th').each(function(){
                                $(this).css('padding', '8px 0')
                                // $(this).css('border-top', '1px solid #ddd');
                                // $(this).css('border-bottom', '1px solid #ddd');
                            });
                            $('#statistic_table2 thead').append(r);
                            $('#search_0').css('text-align', 'center');

                            this.api().columns([1,4]).every( function () {
                                var column = this;
                                var select = $('<select class="table-select"><option value="">Show All</option></select>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                        );

                                        column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                    } );
                                var n=0;
                                column.data().unique().sort().each( function ( d, j ) {

                                    if(d.toString().indexOf(".")>0 && n==0){
                                        select.append( '<option value="-">-</option>' )
                                        n=1
                                    }
                                    else if(d.toString().indexOf(".")>0){

                                    }
                                    else{
                                        select.append( '<option value="'+d+'">'+d+'</option>' )
                                    }
                                } );
                            } );
                        },

                        columns:[
                            {
                                data:"CT_ID"
                            },
                            {
                                data:"Cell_standard"
                            },
                            {
                                data:"Specific_Cell_Ontology_ID",
                                render:function(data,type,row){
                                    if(row.Specific_Cell_Ontology_ID.indexOf("_")<0){
                                        if(row.Specific_Cell_Ontology_ID.indexOf(".")>0){
                                            return "-"
                                        }
                                        else{
                                            return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/cl/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Specific_Cell_Ontology_ID.replace(/:/,"_")+"' class='cellontology'>"+row.Specific_Cell_Ontology_ID+"</a>"
                                        }

                                    }
                                    else{
                                        return row.Specific_Cell_Ontology_ID
                                    }
                                }
                            },
                            {
                                data:"Tissue_ID",
                                render:function(data,type,row){
                                    if(row.Tissue_ID!="-"){
                                        return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/uberon/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Tissue_ID.replace(/:/,"_")+"'>"+row.Tissue_ID+"</a>"
                                    }
                                    else{
                                        return row.Tissue_ID
                                    }
                                }
                            },
                            {
                                data:"Tissue"
                            }

                        ],
                        destroy: true,
                        deferRender:true,
                        order:[3,"desc"],
                        iDisplayLength:5,
                        dom: '<"row"<"col-lg-12 col-sm-12"f>>t<"row"<"col-lg-6 col-sm-5"i><"col-lg-6 col-sm-7"p>>',


                    });

                },
                error:function(){
                    console.log("error")
                }
            });
            $.ajax({
                url:"/celltaxonomy/static/json/celltype.json",
                type:'GET',
                dataType: 'json',
                async:false,
                success:function(data){
                    var zTreeObj;
                    // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
                    var setting = {
                        data: {
                            simpleData: {
                                enable: true
                            }
                        },
                        callback:{
                            onClick:zTreeOnClick
                        },
                        check: {
                            enable: true//checkbox
                        },
                        view: {
                            nameIsHTML: true, //允许name支持html
                            selectedMulti: false
                        },
                        edit: {
                            enable: false,
                            editNameSelectAll: false
                        }
                    };
                    // zTree 的数据属性，深入使用请参考 API 文档（zTreeNode 节点数据详解）
                    var zNodes = data;
                    $(document).ready(function(){
                        zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes);
                        fuzzySearch('treeDemo','#key',null,true); //初始化模糊搜索方法
                    });
                }
            });
            $.ajax({
                url:"/celltaxonomy/static/file/marker_cell_type_list",
                type:'get',
                success:function(results){
                    list=results.replace(/\r/g,"").toLowerCase().split("\n");
                    $(".node_name").each(function(){
                        if($.inArray($(this).text().toLowerCase(),list)!=-1){
                            // $(this).css("background","#ffe6b0")
                            $(this).css("text-decoration","underline")
                        }
                        else{
                            $(this).parent().css("pointer-events","none")
                        }
                    })
                }
            });

        }
    });
    $(document).ajaxStop(function(){
        if($("#nav-side").children().length==1){
            nav_side_bar_set()
        }
    })
    function unpack(rows, key) {
        return rows.map(function(row) { return row[key]; });
    }
    function cellmarkerOR(results){
        var plotwidth=$("#width").width();
        results=eval(results).filter(function(e){
            return e.FDR<0.05
        })
        results=eval(results).filter(function(e){
            return e.marker_tissue_number>1
        })
        var results1=eval(results).filter(function(e){
            return e.Tissue_standard==$("#cell_marker_single_select").val()
        })
        results1=results1.slice(0,30);

        cellmarkerORheatmap(results,unpack(results1.sort(sortOR), 'Cell_Marker'))

    }
    function sortOR(a,b){
        return a.OR2-b.OR2
    }
    function sortORasc(a,b){
        return b.OR2-a.OR2
    }
    function sortLS(a,b){
        return b.marker_tissue_number-a.marker_tissue_number
    }
    function sortLSasc(a,b){
        return a.marker_tissue_number-b.marker_tissue_number
    }
    function sortTELS(a,b){
        return b.cell_tissue_number-a.cell_tissue_number
    }
    function sortROGUE(a,b){
        return b.ROGUE_index-a.ROGUE_index
    }
    function sortSilhoutte(a,b){
        return b.mean_silhouette-a.mean_silhouette
    }
    function sortCellNumber(a,b){
        return b.Cell_Numbers-a.Cell_Numbers
    }
    function sortAverageROGUE(a,b){
        return b.mean_se-a.mean_se
    }
    function sortAverageSilhoutte(a,b){
        return b.avg_silhouette-a.avg_silhouette
    }
    function cellmarkerplot(results){
        var plotwidth=$("#width").width();

        // var results2=eval(results).filter(function(e){
        //     return e.Tissue_standard==$("#cell_marker_single_select2").val()
        // })
        var results1=eval(results).filter(function(e){
            return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
        })
        results1=results1.slice(0,30);
        cellmarkerheatmap(results,unpack(results1.sort(sortLSasc), 'Cell_Marker'))


    }
    function cellmarkerheatmap(data,genelist){
        var plotwidth=$("#width").width();
        $("#cell_marker_heatmap").css("width","900px")
        var results;
        var newdata=[];
        results=eval(data).filter(function(e){
            return e.Species==$("#cell_marker_heatmap_LS_select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard!="All"
        })
        if(results.length==0){
            $("#cell_marker_heatmap").css("display","none")
        }
        else{
            $("#cell_marker_heatmap").css("display","block")
            for(var i=0;i<results.length;i++){
                if($.inArray(results[i].Cell_Marker,ytickLS)>=0){
                    newdata.push(results[i])
                }
            }
            results=newdata;
            var x=$.unique(unpack(results, 'Tissue_standard').sort());
            var n=0;
            var len=ytickLS.length;
            for(i=0;i<len;i++){
                var temp=eval(results).filter(function(e){
                    return e.Cell_Marker==ytickLS[i-n]
                })

                if(temp.length==0){
                    ytickLS.splice(i-n,1)
                    n+=1
                }
            }
            var y=ytickLS.reverse();
            var z=new Array();
            for (i=0;i<results.length;i++){
                z.push([$.inArray(results[i].Tissue_standard,x),$.inArray(results[i].Cell_Marker,y),results[i].supported_paper_number])

            }
            if(y.length<=5){
                $("#cell_marker_heatmap").css('height',"300px")
            }
            else{
                $("#cell_marker_heatmap").css('height',"450px")
            }

            getecharts("cell_marker_heatmap",x,y,z,"Number of publications in support of cell markers for "+$("#name").text()+" in "+$("#cell_marker_heatmap_LS_select").val(),"Tissue","Gene")

        }
    }

    function getTEplot(id,results,xdata,xtitle,title,hover){


        var plotwidth=$("#width").width();

        var pvalue=unpack(results, 'P_value');
        var FDR=unpack(results, 'FDR');
        var customdata=[];
        for (i=0;i<pvalue.length;i++){
            customdata.push([pvalue[i],FDR[i]])
        }
        var data = [{
            type: 'scatter',
            y: unpack(results, 'Tissue_standard'),
            x: unpack(results, xdata),
            customdata:customdata,
            marker:{
                cmax:1,
                cmin:0,
                color:unpack(results, $("#tissue_enrichment_select select").val().replace(/ /,"_")),
                colorscale:"YlOrRd",
                colorbar:{
                    title:{
                        text:$("#tissue_enrichment_select select").val(),
                        font:{
                            family:"Arial"
                        }
                    },
                    titleside:"Top",
                    len:0.3,
                    thickness:15,
                    y:0.9

                }


            },
            mode:'markers',
            hovertemplate:
                '<i>'+hover+'</i>: %{x}<br>'+
                '<i>P value</i>: %{customdata[0]}<br>'+
                '<i>FDR</i>: %{customdata[1]}'
        }];
        var shapes=[];
        for (i=0;i<results.length;i++){
            var shape={
                y0: data[0].y[i],
                y1: data[0].y[i],
                x0: 0,
                x1: data[0].x[i],
                line: {
                    color: 'grey',
                    width: 1
                },
                type: 'line',
                xref: 'y',
                yref: 'x'
            }
            shapes.push(shape);
        }
        var layout = {
            yaxis: {
                zeroline: false,
                automargin:true,
                categoryorder:"total ascending",
                tickmode:"linear",
                tickvals:unpack(results, 'Tissue_standard'),
                tickfont:{
                    size:14,
                    family:"Arial"
                }

            },
            xaxis:{
                title:{
                    text:xtitle,
                    font:{
                        family:"Arial"
                    }
                }
            },
            title: {
                text:$("#name").text()+": "+title+" in "+$("#tissue_enrichment_species_select select").val(),
                font:{
                    family:"Arial"
                }
            },
            legend:{
                font:{
                    family:"Arial"
                }
            },
            width:plotwidth-40,
            height:450,
            shapes:shapes,
            hovermode:'closest'
        };

        if(unpack(results, 'Tissue_standard').length>40){
            layout.yaxis.tickfont.size=9
            layout.height=700;
        }
        else if(unpack(results, 'Tissue_standard').length>20){
            layout.yaxis.tickfont.size=12;
            layout.height=600;
        }
        Plotly.newPlot(id, data, layout);
    }
    function Similarityplot(results){
        var plotwidth=$("#width").width();

        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })

        results=results.slice(0,30);
        var data = [{
            type: 'scatter',
            y: unpack(results, 'Other_Cell_standard'),
            x: unpack(results, 'score'),
            mode:'markers',
            hovertemplate:
                '<i>Cell type</i>: %{y}<br>'+
                '<i>Score</i>: %{x}'

        }];
        var shapes=[];
        for (i=0;i<results.length;i++){
            var shape={
                y0: data[0].y[i],
                y1: data[0].y[i],
                x0: 0,
                x1: data[0].x[i],
                line: {
                    color: 'grey',
                    width: 1
                },
                type: 'line',
                xref: 'y',
                yref: 'x'
            }
            shapes.push(shape);
        }
        var layout = {
            yaxis: {
                zeroline: false,
                automargin:true,
                categoryorder:"total ascending",
                tickmode:"linear",
                tickvals:unpack(results, 'Other_Cell_standard'),
                tickfont:{
                    size:12,
                    family:"Arial"

                }
            },
            xaxis:{
                title:{
                    text:"Marker similarity score",
                    font:{
                        family:"Arial"
                    }
                }
            },
            title:{
                text:$("#name").text()+": Similarity Score in "+$("#similarity_tissue_select").val()+" of "+$("#similarity_species_select select").val(),
                font:{
                    family:"Arial"
                }
            },
            width:plotwidth-40,
            height:450,
            shapes:shapes
        };

        if(unpack(results, 'Other_Cell_standard').length>40){
            layout.yaxis.tickfont.size=9
            layout.height=700;
        }
        else if(unpack(results, 'Other_Cell_standard').length>20){
            layout.yaxis.tickfont.size=12;
            layout.height=600;
        }
        Plotly.newPlot('similarity_score', data, layout);
    }
    function getCelltypeDetail(name,id){


        $(".breadcrumb").append("<li class='breadcrumb-item active'>"+name+"</li>")
        $(".breadcrumb").children("li").eq(2).html("<a href='/celltaxonomy/celltype'>Cell types</a>")
        $("#statistic").parent().parent().css("display","none");
        $("#browse").parent().parent().css("display","none")
        $("#detail1").parent().parent().css("display","block");
        $("#detail1").css("display","block");
        $("#detail2").css("display","block");
        $("#detail3").css("display","block");
        $("#detail4").css("display","block");
        $("#detail6").css("display","block");
        $("#detail7").css("display","block");
        $("#detail8").css("display","block");
        $("#detail9").css("display","block");
        $("#detail10").css("display","block");
        $("#detail11").css("display","block");
        $("#detail12").css("display","block");
        $("#nav_side_bar").css("display","block");
        name=name.replace(/<[^>]*>/g,"");
        $("#name").text(name);
        if(id.indexOf(".")>0){
            $("#id").text("-");
            $("#id").css("pointer-events","none");
            $("#id").css("color","black");
            $("#id").css("text-decoration","none");

        }
        else{
            $("#id").text(id);
        }

        $.ajax({
            url:"/celltaxonomy/static/file/cell_name_ID_for_yunf.txt",
            type:'get',
            success:function(results){
                var list=results.replace(/\r/g,"").split("\n");
                var line;
                for(var i=0;i<list.length;i++){
                    line=list[i].split("\t");

                    if(line[1].replace(/_/,":")===$("#id").text()){
                        $("#cell_pic").parent().css("display","block");
                        $("#cell_pic").parent().siblings("div").css("display","block");
                        $("#cell_pic").attr("src","/celltaxonomy/static/img/cell_pic/"+id.replace(/:/,"_")+".jpg");
                        $("#pic_annotation").html("Author: "+line[2]+"</br>Public Domain: This image is in the public domain and thus free of any copyright restrictions. However, as is the norm in scientific publishing and as a matter of courtesy, any user should credit the content provider for any public or private use of this image whenever possible.")
                        $("#cell_pic").parent().attr("href",line[4]);

                        return false
                    }
                }


            }
        })
        $.ajax({
            url:"/celltaxonomy/celltype_summary",
            type:'post',
            data:{
                "id":id
            },
            success:function(results){
                var markers=results[0].Marker_num
                var conditions=results[0].Disease_num
                var tissues=results[0].Tissue_num
                var species=results[0].Species_num
                var publications=results[0].PMID_num
                if(markers===1){markers=markers.toString()+" cell marker"}else{markers=markers.toString()+" cell markers"}
                if(conditions===0 && tissues===0){
                    conditions=""
                    tissues=""
                }
                else if(conditions===0){
                    conditions=""
                    tissues=" in "+tissues.toString()+" tissues"
                }
                else if(tissues===0){
                    tissues=""
                    conditions=" in "+conditions.toString()+" conditions"
                }
                else{
                    if(conditions===1){conditions=" in "+conditions.toString()+" condition"}else{conditions=" in "+conditions.toString()+" conditions"}
                    if(tissues===1){tissues=" and "+tissues.toString()+" tissue"}else{tissues=" and "+tissues.toString()+" tissues"}
                }

                if(publications===1){publications=", supported by "+publications.toString()+" publication"}else if(publications===0){publications=""}else{publications=", supported by "+publications.toString()+" publications"}

                $("#summary1").html(
                    "<strong>"+name+"</strong> is associated with "+markers+conditions+tissues+" across "+species+" species"+publications+"."
                )
            }
        })
        $.ajax({
            url:"/celltaxonomy/description",
            type:"post",
            dataType:'json',
            data:{"id":id},
            success:function(descriptions){
                $("#table-description").DataTable({
                    data:descriptions,
                    initComplete: function () {
                        var r = $('#table-description tfoot tr');
                        r.find('th').each(function(){
                            $(this).css('padding', '8px 0')
                            // $(this).css('border-top', '1px solid #ddd');
                            // $(this).css('border-bottom', '1px solid #ddd');
                        });
                        $('#table-description thead').append(r);
                        $('#search_0').css('text-align', 'center');

                        this.api().columns([0,1,3,5,6]).every( function () {
                            var column = this;
                            var select = $('<select class="table-select"><option value="">Show All</option></select>')
                                .appendTo( $(column.footer()).empty() )
                                .on( 'change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );

                                    column
                                        .search( val ? '^'+val+'$' : '', true, false )
                                        .draw();
                                } );

                            column.data().unique().sort().each( function ( d, j ) {
                                select.append( '<option value="'+d+'">'+d+'</option>' )
                            } );
                        } );
                    },

                    columns:[
                        {data:"Species"},
                        {
                            data:"Tissue_standard",
                            render:function(data,type,row){
                                if(row.Tissue_standard!="-"){
                                    // return "<a class='tissue'>"+row.Tissue_standard+"</a>"
                                    return "<a target='_blank' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID2+"'>"+row.Tissue_standard+"</a>"

                                }
                                else{
                                    return row.Tissue_standard
                                }
                            }
                        },
                        {
                            data:"Tissue_UberonOntology_ID",
                            render:function(data,type,row){
                                if(data!="-"){
                                    return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/uberon/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+data.replace(/:/,"_")+"'>"+data+"</a>"
                                }
                                else{
                                    return data
                                }
                            }
                        },
                        {data:"Disease_Type"},
                        {
                            data:"Disease_Ontology_ID",
                            render:function(data,type,row){
                                if(row.Disease_Ontology_ID!="-"){
                                    return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/doid/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+row.Disease_Ontology_ID.replace(/:/,"_")+"'>"+row.Disease_Ontology_ID+"</a>"
                                }
                                else{
                                    return row.Disease_Ontology_ID
                                }
                            }
                        },
                        {
                            data:"Cell_Marker",
                            render:function(data,type,row){
                                return '<a target="_blank" href="/celltaxonomy/marker/'+row.Gene_ENTREZID2+'">'+data+'</a>'
                            }
                        },
                        {
                            data:"Additional_Information2",
                            render:function(data,type,row){
                                if(row.Additional_Information2=="CellMarker"){
                                    return "<a target='_blank' href='http://xteam.xbio.top/CellMarker/search.jsp?quickSearchInfo="+$("#name").text()+"'>CellMarker</a>"
                                }

                                // else if(row.Additional_Information2=="PanglaoDB"){
                                //     return "<a target='_blank' href='https://panglaodb.se/search.html?query="+$("#name").text()+"'>PanglaoDB</a>"
                                // }

                                // else if(row.Additional_Information2=="SHOGoiN"){
                                //     return "<a class='SHOGoiN'>SHOGoiN</a>"
                                // }
                                else{

                                    if($.isNumeric(row.Additional_Information2*1)){
                                        return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+row.Additional_Information2+"'>"+row.Additional_Information2+"</a>"
                                    }
                                    else{
                                        return row.Additional_Information2
                                    }
                                }
                            }
                        },
                        {
                            data:"PMID",
                            render:function(data,type,row){
                                if(data!="-"){
                                    return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+data+"'>"+data+"</a>"
                                }
                                else{
                                    return data
                                }
                            }
                        },
                        {
                            data:"n_NA",
                            visible:false
                        }

                    ],
                    destroy: true,
                    dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    "iDisplayLength":5,
                    order:[
                        [8,'asc']
                    ]

                });


            },
            error:function(){
                console.log("error")
            }
        })
        $.ajax({
            url:"/celltaxonomy/idcard",
            type:"post",
            dataType:'json',
            data:{"id":id},
            success:function(descriptions){
                if(descriptions[0].New_Cell_Type_Annotation=="Not available"){
                    $("#new_cell_type_annotation").text("-")

                }
                else{
                    $("#new_cell_type_annotation").text(descriptions[0].New_Cell_Type_Annotation.split("|")[0])

                }
                $("#ct_id").text(descriptions[0].CT_ID)
                $("#id").attr("href","https://www.ebi.ac.uk/ols/ontologies/cl/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+$("#id").text().replace(/:/g,"_"))
                $("#alias").text(descriptions[0].Cell_alias_change)

                $.ajax({
                    url:"/celltaxonomy/celltype_cell_markerDE_select",
                    type:"post",
                    dataType:'json',
                    data:{
                        "id":$("#ct_id").text(),
                        "name":name
                    },
                    success:function(result) {
                        var score=result["score"]
                        if (score.length>0){
                            var species=$.unique(unpack(score,"Species").sort())
                            species.map(function(e){
                                $("#specificity_score_species_select optgroup").eq(0).append(
                                    "<option value='"+e+"'>"+e+"</option>"
                                )
                            })
                            $("#specificity_score_species_select optgroup").eq(1).append(
                                "<option value='All'>All</option>"
                            )
                            $("#specificity_score_species_select").find("option").eq(0).attr("selected","true");

                        }
                        else{
                            // $("#specificity_region").css("display","none")
                        }

                        var results=result["plot"]
                        if(results.length==0 || results=="[]"){
                            $("#detail8").css("display","none")
                        }
                        else{
                            var species=$.unique(unpack(results,"Species").sort())
                            for(i=0;i<species.length;i++){
                                $("#cell_markerDE_species_select optgroup").eq(0).append(
                                    "<option value='"+species[i]+"'>"+species[i]+"</option>"
                                )
                                $("#cell_markerDE_barplot_species_select").eq(0).append(
                                    "<option value='"+species[i]+"'>"+species[i]+"</option>"
                                )
                            }
                            $("#cell_markerDE_species_select optgroup").eq(1).append(
                                "<option value='All'>All</option>"
                            )

                        }

                        $.ajax({
                            url:"/celltaxonomy/celltype_cell_markerDE",
                            type:"post",
                            dataType:'json',
                            async:false,
                            data:{
                                "id":$("#ct_id").text(),
                                "name":name,
                                "species":$("#specificity_score_species_select").val()
                            },
                            success:function(result) {
                                var score=result["score"]
                                if (score.length>0){

                                    var results=[]
                                    score.map(function(e){
                                        if(e.Species==$("#specificity_score_species_select").val()){

                                            var dataset=e.ID.split(",")
                                            var ss=e.Cell_specific_score.split(",")
                                            var pmid=e.PMID.split(",")
                                            var condition=e.Conditions.split(",")
                                            var conditionid=e.Condition_ID.split(",")
                                            for(var i=0;i<dataset.length;i++){
                                                if(ss[i]!="-"){
                                                    var gene=e.Gene.split(",")[0]
                                                    if(gene=="PECAM"){
                                                        gene="PECAM1"
                                                    }
                                                    results.push(
                                                        {
                                                            Species:e.Species,
                                                            ID:dataset[i],
                                                            Gene:gene,
                                                            Gene_id:e.Gene_id,
                                                            Cell_specific_score:ss[i],
                                                            PMID:pmid[i],
                                                            Condition:condition[i],
                                                            Condition_ID:conditionid[i]
                                                        }
                                                    )
                                                }
                                            }
                                        }
                                    })
                                    DE_score=results

                                    $("#cell_marker_se_table").DataTable({
                                        data:results,
                                        columns:[
                                            {data:"Species"},
                                            {
                                                data:"ID",
                                                render:function(data,type,row){
                                                    if(data.indexOf("_SRS")>=0){
                                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                                    }
                                                    else if (data.indexOf("_")>=0){
                                                        var name=data.split("_")
                                                        if(data.indexOf("Tabula")>=0){
                                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                        }
                                                    }
                                                    else{
                                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                                    }
                                                }
                                            },
                                            {
                                                data:"Condition",
                                                render:function(data,type,row){
                                                    if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                                        return data
                                                    }
                                                    else if(row.Condition_ID!="-"){
                                                        return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                                    }
                                                    else{
                                                        return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                                    }
                                                }
                                            },
                                            {
                                                data:"Gene",
                                                render:function(data,type,row){
                                                    if(row.Gene_id!="-"){
                                                        return '<a target="_blank" href="/celltaxonomy/marker/'+row.Gene_id+'">'+data+'</a>'
                                                    }
                                                    else{
                                                        return data
                                                    }
                                                }
                                            },
                                            {
                                                data:"Cell_specific_score",
                                                render:function(data,type,row){
                                                    return (data*1).toPrecision(2)
                                                }

                                            }
                                        ],
                                        destroy:true,
                                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                                        "iDisplayLength":5,

                                        order:[3,"desc"]
                                    })
                                    getboxplotSS("cell_marker_ss_plot",results)
                                }
                                else{
                                    // $("#specificity_region").css("display","none")
                                }

                                var results=result["plot"]

                                if(results.length==0 || results=="[]"){
                                    $("#detail8").css("display","none")
                                }
                                else{
                                    var plot=[]
                                    results.map(function(e){
                                        if(e.Species==$("#cell_markerDE_species_select").val()){
                                            var dataset=e.ID.split(",")
                                            var fc=e.avg_log2FC.split(",")
                                            var pct1=e.pct_1.split(",")
                                            var pct2=e.pct2.split(",")
                                            var pval=e.p_val.split(",")
                                            var fdr=e.p_val_adj.split(",")
                                            var pmid=e.PMID.split(",")
                                            var condition=e.Conditions.split(",")
                                            var conditionid=e.Condition_ID.split(",")

                                            for(i=0;i<dataset.length;i++){
                                                if(fdr[i]<0.05){
                                                    if(e.markers=="PECAM"){
                                                        e.markers="PECAM1"
                                                    }
                                                    plot.push(
                                                        {
                                                            Species:e.Species,
                                                            ID:dataset[i],
                                                            markers:e.markers,
                                                            marker_id:e.marker_id,
                                                            avg_log2FC:fc[i],
                                                            pct_1:pct1[i],
                                                            pct_2:pct2[i],
                                                            p_val:pval[i],
                                                            p_val_adj:fdr[i],
                                                            PMID:pmid[i],
                                                            Conditions:condition[i],
                                                            Condition_ID:conditionid[i]
                                                        }
                                                    )
                                                }
                                            }
                                        }

                                    })
                                    DE_plot=plot

                                    getboxplot("cell_markerDE_plot",plot)
                                    $("#cell_marker_DE_table").DataTable({
                                        data:plot,
                                        columns:
                                            [
                                                {data:"Species"},
                                                {
                                                    data:"ID",
                                                    render:function(data,type,row){
                                                        if(data.indexOf("_SRS")>=0){
                                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                                        }
                                                        else if (data.indexOf("_")>=0){
                                                            var name=data.split("_")
                                                            if(data.indexOf("Tabula")>=0){
                                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                            }
                                                            else{
                                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                            }
                                                        }
                                                        else{
                                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                                        }
                                                    }
                                                },
                                                {
                                                    data:"Conditions",
                                                    render:function(data,type,row){
                                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                                            return data
                                                        }
                                                        else if(row.Condition_ID!="-"){
                                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                                        }
                                                        else{
                                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                                        }
                                                    }
                                                },
                                                {
                                                    data:"markers",
                                                    render:function(data,type,row){
                                                        if(row.marker_id!="-"){
                                                            return '<a target="_blank" href="/celltaxonomy/marker/'+row.marker_id+'">'+data+'</a>'
                                                        }
                                                        else{
                                                            return data
                                                        }
                                                    }
                                                },

                                                {
                                                    data:"avg_log2FC",
                                                    render:function(data,type,row){
                                                        return (data*1).toPrecision(2)
                                                    }
                                                },
                                                {
                                                    data:"pct_1",
                                                    render:function(data,type,row){
                                                        return (row.pct_1*1).toPrecision(2)
                                                    }
                                                },
                                                {
                                                    data:"pct_2",
                                                    render:function(data,type,row){
                                                        return (row.pct_2*1).toPrecision(2)
                                                    }
                                                },
                                                {
                                                    data:"p_val",
                                                    render:function(data,type,row){
                                                        return (row.p_val*1).toPrecision(2)
                                                    }
                                                },
                                                {
                                                    data:"p_val_adj",
                                                    render:function(data,type,row){
                                                        return (row.p_val_adj*1).toPrecision(2)
                                                    }
                                                },


                                            ],
                                        destroy:true,
                                        "iDisplayLength":5,
                                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>'

                                    })


                                    $.ajax({
                                        url:"/celltaxonomy/celltype_cell_markerDE_bar",
                                        type:"post",
                                        dataType:'json',
                                        async:false,

                                        data:{
                                            "id":$("#ct_id").text(),
                                            "name":name,
                                            "species":$("#cell_markerDE_barplot_species_select").val(),
                                            "threshold":"0.25",
                                            "fdr":$("#cell_markerDE_barplot_FDR").val()
                                        },
                                        success:function(data){

                                            DE_bar=data
                                            getbarplotDE("cell_markerDE_barplot",data)
                                        }
                                    });

                                }
                            }
                        })

                    }
                })

                $.ajax({
                    url:'/celltaxonomy/species_similarity_marker',
                    type:'post',
                    data:{
                        id:$("#ct_id").text()
                    },
                    success:function(results){
                        console.log(results)
                        if(results.length==0){
                            $("#detail9").css("display","none")
                        }
                        else {
                            $.ajax({
                                url:'/celltaxonomy/same_cell_similarity',
                                type:'post',
                                data:{
                                    id:$("#ct_id").text()
                                },
                                success:function(results){
                                    same_cell_similarity=results
                                    var species=$.unique(unpack(results,"Species1").sort()).reverse()
                                    species.map(function(e){
                                        if(e=="Homo sapiens"||e=="Mus musculus"){
                                            $("#same_cell_similarity_select").prepend("<option value='"+e+"'>"+e+"</option>")
                                        }
                                        else{
                                            $("#same_cell_similarity_select").append("<option value='"+e+"'>"+e+"</option>")
                                        }
                                    })
                                    $("#same_cell_similarity_select").find("option").eq(0).attr("selected","true")
                                    var result=eval(results).filter(function(e){
                                        return e.Species1==$("#same_cell_similarity_select").val()
                                    })
                                    $("#same_cell_similarity_table").DataTable({
                                        data:result,
                                        columns:[
                                            {data:"Species2"},
                                            {
                                                data:"Tissue_standard",
                                                render:function(data,type,row){
                                                    if(row.Tissue_UberonOntology_ID2!="-"){
                                                        return "<a target='_blank' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID2+"'>"+data+"</a>"
                                                    }
                                                    else{
                                                        return data
                                                    }
                                                }
                                            },
                                            {data:"score"},
                                            {data:"common_marker_number"}
                                        ],
                                        "iDisplayLength":5,
                                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',

                                        destroy:true
                                    })
                                }
                            })


                            conserved=results
                            var marker_length=$.unique(unpack(results,"Gene_ENTREZID").sort()).length
                            $("#conserved_marker").text(marker_length)
                            var species=$.unique(unpack(results,"Species1").sort()).reverse()
                            species.map(function(d){
                                if(d=="Mus musculus" || d=="Homo sapiens"){
                                    $("#cell_similarity_species_species_select optgroup").eq(0).prepend("<option value='"+d+"'>"+d+"</option>")

                                }
                                else{
                                    $("#cell_similarity_species_species_select optgroup").eq(0).append("<option value='"+d+"'>"+d+"</option>")

                                }
                            })
                            $("#cell_similarity_species_species_select").find("option").eq(0).attr("selected","true")

                            var data=eval(results).filter(function(e){
                                return e.Species1==$("#cell_similarity_species_species_select").val()
                            })

                            var tissue=$.unique(unpack(data,"Tissue_standard").sort())
                            tissue.map(function(d){
                                if(d!="All"){
                                    $("#cell_similarity_species_tissue_select optgroup").eq(0).append("<option value='"+d+"'>"+d+"</option>")
                                }
                                else{
                                    $("#cell_similarity_species_tissue_select optgroup").eq(1).append("<option value='"+"All"+"'>"+d+"</option>")
                                }
                            })
                            $("#cell_similarity_species_tissue_select").find("option").eq(-1).attr("selected","true")

                            data=eval(data).filter(function(e){
                                return e.Tissue_standard==$("#cell_similarity_species_tissue_select").val()
                            })
                            var marker=$.unique(unpack(data,"Cell_Marker").sort())
                            marker.map(function(d){
                                $("#cell_similarity_species_marker_select optgroup").eq(0).append("<option value='"+d+"'>"+d+"</option>")
                            })
                            $("#cell_similarity_species_marker_select optgroup").eq(1).append("<option value='All'>All</option>")
                            $("#cell_similarity_species_marker_select").find("option").eq(-1).attr("selected","true")
                            if($("#cell_similarity_species_marker_select").val()!="All"){
                                data=eval(data).filter(function(e){
                                    return e.Cell_Marker==$("#cell_similarity_species_marker_select").val()
                                })
                            }
                            $("#common_table").DataTable({
                                data:data,
                                columns:[
                                    {
                                        data:"Cell_Marker",
                                        render:function(data,type,row){
                                            return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID+"'>"+data+"</a>"
                                        }
                                    },
                                    {data:"Species2"},
                                    {
                                        data:"Ortholog",
                                        render:function(data,type,row){
                                            return '<a target="_blank" href="/celltaxonomy/marker/'+row.Ortholog_ID+'">'+data+'</a>'
                                        }
                                    },
                                    {
                                        data:"Ortholog_ID",
                                        render:function(data,type,row){
                                            return '<a target="_blank" href="https://www.ncbi.nlm.nih.gov/gene/'+data+'">'+data+'</a>'
                                        }
                                    },
                                    {
                                        data:"Ortholog_publication",
                                        render:function(data){
                                            return "<a class='conserved_pub'>"+data+"</a>"
                                        }
                                    }
                                ],
                                iDisplayLength:5,
                                dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                                destroy:true

                            })
                        }

                    }
                })

            },
            error:function(){
                console.log("error")
            }
        })
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',

            data:{
                "id":id
            },
            success:function(data){
                var result=data["results"];
                if(result.length==0){
                    $("#gte_plot").css("display","none")
                    $("#description").addClass("in")
                    $("#description").prev().css("display","none")
                }
                else{
                    var species;

                    $("#cell_marker_heatmap_LS_select optgroup").empty();
                    species=$.unique(unpack(result,"Species").sort());
                    for(i=0;i<species.length;i++){
                        if(species[i]!="All"){
                            if(species[i]=="Homo sapiens"){
                                $("#cell_marker_heatmap_LS_select optgroup").eq(0).prepend(
                                    "<option value='"+species[i]+"'>"+species[i]+"</option>"
                                )
                            }
                            else if(species[i]=="Mus musculus"){
                                if($("#cell_marker_heatmap_LS_select").find("option").eq(0).text()=="Homo sapiens"){
                                    $("#cell_marker_heatmap_LS_select").find("option").eq(0).after(
                                        "<option value='"+species[i]+"'>"+species[i]+"</option>"
                                    )
                                }
                                else{
                                    $("#cell_marker_heatmap_LS_select optgroup").eq(0).prepend(
                                        "<option value='"+species[i]+"'>"+species[i]+"</option>"
                                    )
                                }
                            }
                            else{
                                $("#cell_marker_heatmap_LS_select optgroup").eq(0).append(
                                    "<option value='"+species[i]+"'>"+species[i]+"</option>"
                                )
                            }

                        }
                        else{
                            $("#cell_marker_heatmap_LS_select optgroup").eq(1).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )

                        }
                    }
                    $("#cell_marker_heatmap_LS_select").find("option").eq(0).attr("selected","true");

                    var results=eval(result).filter(function(e){
                        return e.Species==$("#cell_marker_heatmap_LS_select").val()
                    })

                    var tissues = $.unique(unpack(results, "Tissue_standard").sort());
                    $("#cell_marker_tissue_LS_select optgroup").empty()

                    for (var i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#cell_marker_tissue_LS_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                        else{
                            $("#cell_marker_tissue_LS_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                    }
                    $("#cell_marker_tissue_LS_select").find("option").eq(-1).attr("selected",true);

                    results=eval(results).filter(function(e){
                        return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                    })

                    getbarplot("cell_marker_single",results,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","supported_paper_number")



                    results=eval(result).filter(function(e){
                        return e.Species==$("#cell_marker_heatmap_LS_select").val()
                    })
                    cellmarkerplot(results);

                }




            }
        })
        $.ajax({
            url:"/celltaxonomy/surface_marker",
            type:"post",
            data:{
                "id":id
            },
            success:function(results){

                if(results.length>0){
                    var evidence=eval(results).filter(function(e){
                        return e.Evidence_summary=="Protein level"
                    })
                    evidence=$.unique(unpack(evidence,"Cell_Marker").sort()).length

                    var antibody=eval(results).filter(function(e){
                        return e.Antibody.length>0
                    })
                    antibody=$.unique(unpack(antibody,"Cell_Marker").sort()).length

                    var total=$.unique(unpack(results,"Gene_ENTREZID2").sort()).length

                    if(evidence===1){evidence=evidence.toString()+" is"}else{evidence=evidence.toString()+" are"}
                    if(antibody===1){antibody=antibody.toString()+" is"}else{antibody=antibody.toString()+" are"}
                    var number=""
                    if(total.length===1){number=total.toString()+" cell marker is"}else{number=total.toString()+" cell markers are"}
                    $("#summary2").text(
                        number+" predicted to be cell surface marker(s) which code for membrane-bound protein products, in which "+evidence+" supported by evidence at protein level and "+antibody+" annotated with well-characterized antibodies."
                    )


                    $("#cell_surface_marker_table").DataTable({
                        data:results,
                        columns:[
                            {
                                data:"Cell_Marker",
                                render:function(data,type,row){
                                    return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID2+"'>"+data+"</a>"
                                }
                            },
                            {
                                data:"marker_cell_number",
                                render:function(data){
                                    if (data==null){
                                        return "NA"
                                    }
                                    else{
                                        return data
                                    }
                                }
                            },
                            {
                                data:"FDR",
                                render:function(data){
                                    return (data*1).toPrecision(2)
                                }
                            },
                            {
                                data:"Cell_Marker",
                                render:function(){
                                    return "Homo sapiens"
                                }
                            },
                            {data:"Evidence_summary"},
                            {data:"Antibody"},
                            {
                                data:"Protein_class",
                                render:function(data){
                                    return "<span class='prev_text'>"+data.slice(0,30)+"...</span>"+
                                        "<span class='hover_text' style='display: none'>"+data+"</span>"+
                                        "<i class='icon ion-plus-round surface'></i>"

                                }
                            }

                        ],
                        order:[1,"desc"],
                        iDisplayLength:5,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>'
                    })
                }
                else{
                    $("#detail11").css("display","none")
                    $("#summary2").css("display","none")
                }

            }
        })
        $.ajax({
            url:"/celltaxonomy/similarity",
            type:"post",
            data:{"id":id},
            success:function(results) {
                if(results.length>0){
                    $("#detail5").css("display","block")
                    var temp=eval(results).filter(function(e){
                        return e.Species=="All" && e.Tissue_standard=="All"
                    })
                    var score=0
                    var similar=""
                    temp.map(function(e){
                        if(e.score>score){
                            score=e.score
                            similar=e.Other_Cell_standard
                        }
                    })

                    $("#summary4").html(
                        "Based on reported cell markers, the similarity score between <strong>"+name+"</strong> and <strong>"+similar+"</strong> is "+score+"."
                    )
                    similarity=results;
                    $("#similarity_table").DataTable({
                        data:results,
                        initComplete: function () {
                            var r = $('#similarity_table tfoot tr');
                            r.find('th').each(function(){
                                $(this).css('padding', '8px 0')
                                // $(this).css('border-top', '1px solid #ddd');
                                // $(this).css('border-bottom', '1px solid #ddd');
                            });
                            $('#similarity_table thead').append(r);
                            $('#search_0').css('text-align', 'center');

                            this.api().columns([0,1,2]).every( function () {
                                var column = this;
                                var select = $('<select class="table-select" ><optgroup><option value="">Show All</option></optgroup><optgroup label="--------------"></optgroup></select>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                        );

                                        column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                    } );

                                column.data().unique().sort().each( function ( d, j ) {
                                    if(d==="All"){
                                        select.children("optgroup").eq(1).append( '<option value="'+d+'">'+d+'</option>' )
                                    }
                                    else{
                                        select.children("optgroup").eq(0).append( '<option value="'+d+'">'+d+'</option>' )

                                    }
                                } );
                            } );
                        },

                        columns:[
                            {data:"Species"},
                            {
                                data:"Tissue_standard",
                                render:function(data,type,row){
                                    if(row.Tissue_standard!="All"){
                                        // return "<a class='tissue'>"+row.Tissue_standard+"</a>"
                                        return "<a target='_blank' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID2+"'>"+row.Tissue_standard+"</a>"

                                    }
                                    else{
                                        return row.Tissue_standard
                                    }
                                }
                            },
                            {
                                data:"Other_Cell_standard",
                                render:function(data,type,row){
                                    // return "<a class='celltype'>"+row.Other_Cell_standard.replace(/_/g," ")+"</a>"
                                    return "<a target='_blank' href='/celltaxonomy/celltype/"+row.CT_ID_y+"'>"+row.Other_Cell_standard.replace(/_/g," ")+"</a>"
                                }
                            },
                            {data:"score"},

                        ],
                        destroy:true,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                        iDisplayLength:5
                    });

                    var species=$.unique(unpack(results,"Species").sort());

                    for(i=0;i<species.length;i++){
                        if(species[i]!="All"){
                            $("#similarity_species_select select optgroup").eq(0).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                        }
                        else{
                            $("#similarity_species_select select optgroup").eq(1).append(
                                "<option value='"+species[i]+"'>"+species[i]+"</option>"
                            )
                        }

                    }
                    $("#similarity_species_select select").find("option").eq(0).attr("selected","true");

                    results=eval(results).filter(function(e){
                        return e.Species==$("#similarity_species_select select").val()
                    })
                    var tissues = $.unique(unpack(results, "Tissue_standard").sort());

                    for (i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#similarity_tissue_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                        else{
                            $("#similarity_tissue_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                    }
                    $("#similarity_tissue_select").find("option").eq(-1).attr("selected","true");


                    getgraph(results)
                }
                else{
                    $("#detail5").css("display","none")
                    $("#summary4").css("display","none")
                }


            },


        })
        $.ajax({
            url:"/celltaxonomy/tissue_distribution",
            type:"post",
            data:{"id":id},
            success:function(results) {
                if (results.length==0){
                    $("#detail12").css("display","none")
                    $("#summary3").css("display","none")
                }
                else{
                    distribution=results
                    var result=eval(results).filter(function(e){
                        return e.ID=="Tabula Sapiens"
                    })
                    var tissue1=$.unique(unpack(result,"Tissue").sort())
                    result=eval(results).filter(function(e){
                        return e.ID=="Tabula Muris"
                    })
                    var tissue2=$.unique(unpack(result,"Tissue").sort())

                    if(tissue1.length==1){
                        $("#sapiens").text(tissue1.length+" tissue in Tabula Sapiens (human)")
                        if(tissue2.length==1){
                            $("#muris").text(" and "+tissue2.length+" tissue in Tabula Muris (mouse)")
                        }
                        else if(tissue2.length==0){
                            $("#muris").css("display","none")
                        }
                        else{
                            $("#muris").text(" and "+tissue2.length+" tissues in Tabula Muris (mouse)")
                        }
                    }
                    else if(tissue1.length==0){
                        $("#sapiens").css("display","none")
                        if(tissue2.length==1){
                            $("#muris").text(" "+tissue2.length+" tissue in Tabula Muris (mouse)")
                        }
                        else if(tissue2.length==0){
                            $("#muris").css("display","none")
                        }
                        else{
                            $("#muris").text(" "+tissue2.length+" tissues in Tabula Muris (mouse)")
                        }
                    }
                    else{
                        $("#sapiens").text(tissue1.length+" tissues in Tabula Sapiens (human)")
                        if(tissue2.length==1){
                            $("#muris").text(" and "+tissue2.length+" tissue in Tabula Muris (mouse)")
                        }
                        else if(tissue2.length==0){
                            $("#muris").css("display","none")
                        }
                        else{
                            $("#muris").text(" and "+tissue2.length+" tissues in Tabula Muris (mouse)")
                        }
                    }




                    var dataset=$.unique(unpack(results,"ID").sort()).reverse()
                    dataset.map(function(e){
                        if(e=="GTEx" || e=="Tabula Sapiens"){
                            $("#tissue_distribution_select optgroup").eq(0).append(
                                "<option value='"+e+"'>"+e+"</option>"
                            )
                        }
                        else{
                            $("#tissue_distribution_select optgroup").eq(1).append(
                                "<option value='"+e+"'>"+e+"</option>"
                            )
                        }

                    })

                    results=eval(results).filter(function(e){
                        return e.ID==$("#tissue_distribution_select").val()
                    })
                    var title="";
                    if($("#tissue_distribution_select").val()=="Tabula Muris"){
                        title="Tissue distribution of "+[[${name}]]+" in Mus musculus ("+$("#tissue_distribution_select").val()+")"
                    }
                    else{
                        title="Tissue distribution of "+[[${name}]]+" in Homo sapiens ("+$("#tissue_distribution_select").val()+")"

                    }
                    getbarplot2("tissue_distribution_plot",results,title)

                }



            },


        })
        $.ajax({
            url:'/celltaxonomy/study_table',
            type:"post",
            data:{"id":id},
            success:function(results){

                if(results.length==0){
                    $("#detail6").css("display","none")
                }
                else{
                    CE=results

                    var species=$.unique(unpack(results,"Species2").sort())
                    species.map(function(e){
                        $("#study_species_select").append(
                            "<option value='"+e+"'>"+e+"</option>"
                        )
                    })
                    results=eval(results).filter(function(e){
                        return e.Species2==$("#study_species_select").val()
                    })

                    getlineplot("study_plot",results)
                }
            }
        })
        // $.ajax({
        //     url:"/celltaxonomy/recommend_datasets",
        //     type:'post',
        //     data:{
        //         id:id,
        //         species:"All"
        //     },
        //     success:function(results){
        //         if(results.length>0){
        //             var species=$.unique(unpack(results,"Species").sort())
        //             species.map(function(e){
        //                 $("#summary_species2").append(
        //                     "<option value='"+e+"'>"+e+"</option>"
        //                 )
        //             })
        //
        //             results=eval(results).filter(function(e){
        //                 return e.Species==$("#summary_species2").val()
        //             })
        //             // results=results.slice(0,10)
        //             $("#dataset_recom").DataTable({
        //                 data:results,
        //                 columns:[
        //                     {
        //                         data:"ID",
        //                         render:function(data,type,row){
        //                             if(data.indexOf("_SRS")>=0){
        //                                 if(row.PubmedID.indexOf("doi")>=0){
        //                                     return "<a target='_blank' href='/celltaxonomy/study/"+data+"'>"+data.split("_")[1]+"</a>"
        //                                 }
        //                                 else{
        //                                     return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data.split("_")[1]+"</a>"
        //                                 }
        //                             }
        //                             else{
        //                                 if(row.PubmedID.indexOf("doi")>=0) {
        //                                     return "<a target='_blank' href='/celltaxonomy/study/"+data+"'>"+data+"</a>"
        //
        //                                 }
        //                                 else{
        //                                     return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data+"</a>"
        //                                 }
        //
        //                             }
        //                         }
        //                     },
        //                     {
        //                         data:"Cell_number_c",
        //                         render:function(data,type,row){
        //                             if(type=="display"){
        //                                 if(data==="1"){
        //                                     return '<div style="display:flex;justify-content: flex-start">' +
        //                                         '<i class="icon ion-checkmark-round checkmark"></i>' +
        //                                         '<span class="summary_value3" style="display: none"> ('+row.Cell_number+')</span>' +
        //                                         '</div>'
        //                                 }
        //                                 else{
        //                                     return '<span class="summary_value3" style="display: none">'+row.Cell_number+'</span>'
        //
        //                                 }
        //                             }
        //                             else{
        //                                 return row.Cell_number
        //                             }
        //
        //                         }
        //                     },
        //                     {
        //                         data:"silhoutte_c",
        //                         render:function(data,type,row){
        //                             if(type=="display"){
        //                                 if(data==="1"){
        //                                     return '<div style="display:flex;justify-content: flex-start">' +
        //                                         '<i class="icon ion-checkmark-round checkmark"></i>' +
        //                                         '<span class="summary_value3" style="display: none"> ('+(row.silhoutte*1).toPrecision(2)+')</span>' +
        //                                         '</div>'
        //                                 }
        //                                 else{
        //                                     return '<span class="summary_value3" style="display: none">'+(row.silhoutte*1).toPrecision(2)+'</span>'
        //
        //                                 }
        //                             }
        //                             else{
        //                                 return row.silhoutte
        //                             }
        //
        //                         }
        //                     },
        //                     {
        //                         data:"Mean_silhoutte_c",
        //                         render:function(data,type,row){
        //                             if(type=="display") {
        //
        //                                 if (data === "1") {
        //                                     return '<div style="display:flex;justify-content: flex-start">' +
        //                                         '<i class="icon ion-checkmark-round checkmark"></i>' +
        //                                         '<span class="summary_value3" style="display: none"> (' + (row.Mean_silhoutte * 1).toPrecision(2) + ')</span>' +
        //                                         '</div>'
        //                                 } else {
        //                                     return '<span class="summary_value3" style="display: none">' + (row.Mean_silhoutte * 1).toPrecision(2) + '</span>'
        //
        //                                 }
        //                             }
        //                             else{
        //                                 return row.Mean_silhoutte
        //                             }
        //                         }
        //                     },
        //                     {
        //                         data:"ROGUE_c",
        //                         render:function(data,type,row){
        //                             if(type=="display") {
        //                                 if (data === "1") {
        //                                     return '<div style="display:flex;justify-content: flex-start">' +
        //                                         '<i class="icon ion-checkmark-round checkmark"></i>' +
        //                                         '<span class="summary_value3" style="display: none"> (' + (row.ROGUE * 1).toPrecision(2) + ')</span>' +
        //                                         '</div>'
        //                                 } else {
        //                                     return '<span class="summary_value3" style="display: none">' + (row.ROGUE * 1).toPrecision(2) + '</span>'
        //
        //                                 }
        //                             }
        //                             else{
        //                                 return row.ROGUE
        //                             }
        //                         }
        //                     },
        //                     {
        //                         data:"Mean_ROGUE_c",
        //                         render:function(data,type,row){
        //                             if(type=="display") {
        //
        //                                 if (data === "1") {
        //                                     return '<div style="display:flex;justify-content: flex-start">' +
        //                                         '<i class="icon ion-checkmark-round checkmark"></i>' +
        //                                         '<span class="summary_value3" style="display: none"> (' + (row.Mean_ROGUE * 1).toPrecision(2) + ')</span>' +
        //                                         '</div>'
        //                                 } else {
        //                                     return '<span class="summary_value3" style="display: none">' + (row.Mean_ROGUE * 1).toPrecision(2) + '</span>'
        //
        //                                 }
        //                             }
        //                             else{
        //                                 return row.Mean_ROGUE
        //                             }
        //                         }
        //                     },
        //                     {
        //                         data:"total",
        //                         visible:false
        //                     }
        //                 ],
        //                 destroy:true,
        //                 iDisplayLength:5,
        //                 order:[6,'desc'],
        //                 lengthChange:false,
        //                 searching:false
        //             })
        //         }
        //         else{
        //             $("#summary6").css("display","none")
        //             $("#summary6").next().css("display","none")
        //             $("#summary6").next().next().css("display","none")
        //
        //         }
        //
        //
        //
        //     }
        // })
        $.ajax({
            url:"/celltaxonomy/recommend_markers",
            type:'post',
            data:{
                id:id,
                species:"All"
            },
            success:function(results){
                if(results.length>0){
                    var species=$.unique(unpack(results,"Species").sort())
                    species.map(function(e){
                        if(e=="Homo sapiens"){
                            $("#summary_species").prepend(
                                "<option value='"+e+"'>"+e+"</option>"
                            )
                        }
                        else if(e=="Mus musculus"){
                            if($("#summary_species").find("option").eq(0).text()=="Homo sapiens"){
                                $("#summary_species").children().eq(0).after(
                                    "<option value='"+e+"'>"+e+"</option>"
                                )
                            }
                            else{
                                $("#summary_species").prepend(
                                    "<option value='"+e+"'>"+e+"</option>"
                                )
                            }

                        }
                        else{
                            $("#summary_species").append(
                                "<option value='"+e+"'>"+e+"</option>"
                            )
                        }

                    })
                    $("#summary_species").find("option").eq(0).attr("selected","true")
                    results=eval(results).filter(function(e){
                        return e.Species==$("#summary_species").val()
                    })
                    results=eval(results).filter(function(e){
                        return e.supported_paper_number*1 >= $("#filter_search1").val()*1 || e.FC_median*1 >=$("#filter_search2").val()*1 || e.specificity_median*1 >=$("#filter_search3").val()*1 || e.n_ortholog*1 >=$("#filter_search4").val()*1 ||e.DE_ratio*1 >=$("#filter_search5").val()*1
                    })

                    $("#marker_recom").DataTable({
                        data:results,
                        columns:[
                            {
                                data:'Cell_Marker',
                                render:function(data,type,row){
                                    return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID2+"'>"+data+"</a>"
                                }
                            },
                            {
                                data:'supported_paper_number',
                                render:function(data,type,row){
                                    if(type=="display"){
                                        if(data*1>=$("#filter_search1").val()*1 ){
                                            return '<div style="display:flex;justify-content: flex-start">' +
                                                '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                '<span class="summary_value" style="display: none"> ('+row.supported_paper_number*1+')</span>' +
                                                '</div>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+row.supported_paper_number*1+'</span>'
                                        }
                                    }

                                    else{
                                        return data
                                    }

                                }
                            },
                            {
                                data:'FC_median',
                                render:function(data,type,row){
                                    if(type=="display"){
                                        if((data*1).toPrecision(2)>=$("#filter_search2").val()*1 && !isNaN(data)){
                                            console.log($("#filter_search2").val()*1)
                                            return '<div style="display:flex;justify-content: flex-start">' +
                                                '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                '<span class="summary_value" style="display: none"> ('+(row.FC_median*1).toPrecision(2)+')</span>' +
                                                '</div>'
                                        }
                                        else{
                                            if(isNaN(data)){
                                                return '<span class="summary_value" style="display: none">-</span>'
                                            }
                                            else{
                                                return '<span class="summary_value" style="display: none">'+(row.FC_median*1).toPrecision(2)+'</span>'
                                            }
                                        }
                                    }
                                    else{
                                        return data*1
                                    }

                                }
                            },
                            {
                                data:'DE_ratio',
                                render:function(data,type,row){
                                    if(type=="display"){
                                        if((data*1).toPrecision(2)>=$("#filter_search5").val()*1 && !isNaN(data)){
                                            return '<div style="display:flex;justify-content: flex-start">' +
                                                '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                '<span class="summary_value" style="display: none"> ('+(row.DE_ratio*1).toPrecision(2)+')</span>' +
                                                '</div>'
                                        }
                                        else{
                                            if(isNaN(data)){
                                                return '<span class="summary_value" style="display: none">-</span>'
                                            }
                                            else{
                                                return '<span class="summary_value" style="display: none">'+(row.DE_ratio*1).toPrecision(2)+'</span>'
                                            }
                                        }
                                    }

                                    else{
                                        return data*1
                                    }

                                }
                            },
                            {
                                data:'specificity_median',
                                render:function(data,type,row){
                                    if(type=="display"){
                                        if((data*1).toPrecision(2)>=$("#filter_search3").val()*1 && !isNaN(data)){
                                            return '<div style="display:flex;justify-content: flex-start">' +
                                                '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                '<span class="summary_value" style="display: none"> ('+(row.specificity_median*1).toPrecision(2)+')</span>' +
                                                '</div>'
                                        }
                                        else{
                                            if(isNaN(data)){
                                                return '<span class="summary_value" style="display: none">-</span>'
                                            }
                                            else{
                                                return '<span class="summary_value" style="display: none">'+(row.specificity_median*1).toPrecision(2)+'</span>'
                                            }
                                        }
                                    }
                                    else{
                                        return data*1
                                    }

                                }
                            },
                            {
                                data:'n_ortholog',
                                render:function(data,type,row){
                                    if(type=="display"){
                                        if(data*1>=$("#filter_search4").val()*1 && !isNaN(data)){
                                            return '<div style="display:flex;justify-content: flex-start">' +
                                                '<i class="icon ion-checkmark-round checkmark"></i>' +
                                                '<span class="summary_value" style="display: none"> ('+(row.n_ortholog*1)+')</span>' +
                                                '</div>'
                                        }
                                        else{
                                            if(isNaN(data)){
                                                return '<span class="summary_value" style="display: none">-</span>'
                                            }
                                            else{
                                                return '<span class="summary_value" style="display: none">'+data+'</span>'
                                            }
                                        }
                                    }

                                    else{
                                        return data*1
                                    }

                                }
                            },
                            {
                                data:"total",
                                render:function(data,type,row){
                                    var n=0
                                    if(row.supported_paper_number*1>=$("#filter_search1").val()*1  ){
                                        n+=1
                                    }
                                    if((row.FC_median*1).toPrecision(2)>=$("#filter_search2").val()*1 && !isNaN(row.FC_median)){
                                        n+=1
                                    }
                                    if((row.specificity_median*1).toPrecision(2)>=$("#filter_search3").val()*1 && !isNaN(row.specificity_median)){
                                        n+=1
                                    }
                                    if((row.n_ortholog*1).toPrecision(2)>=$("#filter_search4").val()*1 && !isNaN(row.n_ortholog)){
                                        n+=1
                                    }
                                    if((row.DE_ratio*1).toPrecision(2)>=$("#filter_search5").val()*1 && !isNaN(row.DE_ratio)){
                                        n+=1
                                    }
                                    return n
                                },
                                visible:false
                            }
                        ],
                        order:[
                            [6,'desc'],[1,'desc'],[2,'desc'],[3,'desc'],[4,'desc']
                        ],

                        destroy:true,
                        iDisplayLength:5,
                        lengthChange:false,
                        responsive: true,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                    })

                }
                else{
                    $("#summary5").css("display","none")
                    $("#summary5").next().css("display","none")
                    $("#summary5").next().next().css("display","none")

                }

            }
        })

    }
    $("#cell_surface_marker_table").on("click",".ion-plus-round",function(){

        $(this).siblings(".prev_text").css("display","none")
        $(this).siblings(".hover_text").css("display","inline")
        $(this).removeClass("ion-plus-round")
        $(this).addClass("ion-minus-round")


    })
    $("#cell_surface_marker_table").on("click",".ion-minus-round",function(){
        $(this).siblings(".hover_text").css("display","none")
        $(this).siblings(".prev_text").css("display","inline")
        $(this).removeClass("ion-minus-round")
        $(this).addClass("ion-plus-round")

    })
    function icon(){
        $(".icon").each(function(){
            if($(this).parent().parent().next().hasClass("in")){
                $(this).removeClass("ion-chevron-right")
                $(this).addClass("ion-chevron-down")
            }
            else{
                $(this).removeClass("ion-chevron-down")
                $(this).addClass("ion-chevron-right")
            }
        })
    }
    function zTreeOnClick(event, treeId, treeNode){
        $.ajax({
            url:"/celltaxonomy/idcard",
            type:"post",
            dataType:'json',
            data:{"id":treeNode.id},
            success:function(descriptions){
                var a=document.createElement('a')
                a.href="/celltaxonomy/celltype/"+descriptions[0].CT_ID;
                a.click()
            },
            error:function(){
                console.log("error")
            }
        })


    };
    var list;
    var plotwidth=$("#width").width();

    window.onscroll=function(){
        nav_side_bar_scroll()
    }
    $(".mypanel-body").on("click",".switch",function(){
        $(".node_name").each(function(){
            if($.inArray($(this).text().toLowerCase(),list)!=-1){
                // $(this).css("background","#ffe6b0")
                $(this).css("text-decoration","underline")

            }
            else{
                $(this).parent().css("pointer-events","none")
            }
        })
    });

    $("#key").change(function(){
        $(".node_name").each(function(){
            if($.inArray($(this).text().toLowerCase(),list)!=-1){
                $(this).css("background","#ffe6b0")
            }
        })
    });
    $("#study_species_select").change(function(){
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })

        getlineplot("study_plot",results)
    })
    $("#summary_species").change(function(){
        $.ajax({
            url:"/celltaxonomy/recommend_markers",
            type:'post',
            data:{
                id:[[${id}]],
                name:[[${name}]],
                species:$("#summary_species").val()
            },
            success:function(results){
                results=eval(results).filter(function(e){
                    return e.supported_paper_number*1 >= $("#filter_search1").val()*1 || e.FC_median*1 >=$("#filter_search2").val()*1 || e.specificity_median*1 >=$("#filter_search3").val()*1 || e.n_ortholog*1 >=$("#filter_search4").val()*1 ||e.DE_ratio*1 >=$("#filter_search5").val()*1
                })
                $("#marker_recom").DataTable({
                    data:results,
                    columns:[
                        {
                            data:'Cell_Marker',
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID2+"'>"+data+"</a>"
                            }
                        },
                        {
                            data:'supported_paper_number',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if(data*1>=$("#filter_search1").val()*1 ){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+row.supported_paper_number*1+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value" style="display: none">'+row.supported_paper_number*1+'</span>'
                                    }
                                }

                                else{
                                    return data
                                }

                            }
                        },
                        {
                            data:'FC_median',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if((data*1).toPrecision(2)>=$("#filter_search2").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.FC_median*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+(row.FC_median*1).toPrecision(2)+'</span>'
                                        }
                                    }
                                }
                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:'DE_ratio',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if((data*1).toPrecision(2)>=$("#filter_search5").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.DE_ratio*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+(row.DE_ratio*1).toPrecision(2)+'</span>'
                                        }
                                    }
                                }

                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:'specificity_median',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if((data*1).toPrecision(2)>=$("#filter_search3").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.specificity_median*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+(row.specificity_median*1).toPrecision(2)+'</span>'
                                        }
                                    }
                                }
                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:'n_ortholog',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if(data*1>=$("#filter_search4").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.n_ortholog*1)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+data+'</span>'
                                        }
                                    }
                                }

                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:"total",
                            render:function(data,type,row){
                                var n=0
                                if(row.supported_paper_number*1>=$("#filter_search1").val()*1  ){
                                    n+=1
                                }
                                if((row.FC_median*1).toPrecision(2)>=$("#filter_search2").val()*1 && !isNaN(row.FC_median)){
                                    n+=1
                                }
                                if((row.specificity_median*1).toPrecision(2)>=$("#filter_search3").val()*1 && !isNaN(row.specificity_median)){
                                    n+=1
                                }
                                if((row.n_ortholog*1).toPrecision(2)>=$("#filter_search4").val()*1 && !isNaN(row.n_ortholog)){
                                    n+=1
                                }
                                if((row.DE_ratio*1).toPrecision(2)>=$("#filter_search5").val()*1 && !isNaN(row.DE_ratio)){
                                    n+=1
                                }
                                return n
                            },
                            visible:false
                        }
                    ],
                    order:[
                        [6,'desc'],[1,'desc'],[2,'desc'],[3,'desc'],[4,'desc']
                    ],

                    destroy:true,
                    iDisplayLength:5,
                    lengthChange:false,
                    searching:false,
                    responsive: true
                })
            }
        })

    })
    $("#summary_species2").change(function(){
        $.ajax({
            url:"/celltaxonomy/recommend_datasets",
            type:'post',
            data:{
                id:[[${id}]],
                species:$("#summary_species2").val()
            },
            success:function(results){
                $("#dataset_recom").DataTable({
                    data:results,
                    columns:[
                        {
                            data:"ID",
                            render:function(data,type,row){
                                if(data.indexOf("_SRS")>=0){
                                    if(row.PubmedID.indexOf("doi")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+data+"'>"+data.split("_")[1]+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data.split("_")[1]+"</a>"
                                    }
                                }
                                else{
                                    if(row.PubmedID.indexOf("doi")>=0) {
                                        return "<a target='_blank' href='/celltaxonomy/study/"+data+"'>"+data+"</a>"

                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PubmedID+"'>"+data+"</a>"
                                    }

                                }
                            }
                        },
                        {
                            data:"Cell_number_c",
                            render:function(data,type,row){
                                if(type=="display"){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+row.Cell_number+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+row.Cell_number+'</span>'

                                    }
                                }
                                else{
                                    return row.Cell_number
                                }

                            }
                        },
                        {
                            data:"silhoutte_c",
                            render:function(data,type,row){
                                if(type=="display"){
                                    if(data==="1"){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> ('+(row.silhoutte*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value3" style="display: none">'+(row.silhoutte*1).toPrecision(2)+'</span>'

                                    }
                                }
                                else{
                                    return row.silhoutte
                                }

                            }
                        },
                        {
                            data:"Mean_silhoutte_c",
                            render:function(data,type,row){
                                if(type=="display") {

                                    if (data === "1") {
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> (' + (row.Mean_silhoutte * 1).toPrecision(2) + ')</span>' +
                                            '</div>'
                                    } else {
                                        return '<span class="summary_value3" style="display: none">' + (row.Mean_silhoutte * 1).toPrecision(2) + '</span>'

                                    }
                                }
                                else{
                                    return row.Mean_silhoutte
                                }
                            }
                        },
                        {
                            data:"ROGUE_c",
                            render:function(data,type,row){
                                if(type=="display") {
                                    if (data === "1") {
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> (' + (row.ROGUE * 1).toPrecision(2) + ')</span>' +
                                            '</div>'
                                    } else {
                                        return '<span class="summary_value3" style="display: none">' + (row.ROGUE * 1).toPrecision(2) + '</span>'

                                    }
                                }
                                else{
                                    return row.ROGUE
                                }
                            }
                        },
                        {
                            data:"Mean_ROGUE_c",
                            render:function(data,type,row){
                                if(type=="display") {

                                    if (data === "1") {
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value3" style="display: none"> (' + (row.Mean_ROGUE * 1).toPrecision(2) + ')</span>' +
                                            '</div>'
                                    } else {
                                        return '<span class="summary_value3" style="display: none">' + (row.Mean_ROGUE * 1).toPrecision(2) + '</span>'

                                    }
                                }
                                else{
                                    return row.Mean_ROGUE
                                }
                            }
                        },
                        {
                            data:"total",
                            visible:false
                        }
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    lengthChange:false,
                    order:[6,'desc'],
                    searching:false
                })
            }
        })

    })

    $("#tissue_enrichment_species_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_tissue_pie",
            type:"post",
            dataType:'json',
            data:{"id":$("#id").text()},
            success:function(results){
                results=eval(results).filter(function(e){
                    return e.Species==$("#tissue_enrichment_species_select select").val()
                })
                if(results.length>0){
                    $("#or_tag").css("display","none")
                    $("#tissue_enrichment_or").css("display","block")
                    getpie("tissue_enrichment_or",results,"Tissue_standard")
                }
                else{
                    $("#tissue_enrichment_or").css("display","none")
                    $("#or_tag").css("display","block")
                }
            },
            error:function(){
                console.log("error")
            }
        })
        $.ajax({
            url:"/celltaxonomy/cell_condition_pie",
            type:"post",
            dataType:'json',
            data:{"id":[[${id}]]},
            success:function(results){
                results=eval(results).filter(function(e){
                    return e.Species==$("#tissue_enrichment_species_select select").val()
                })
                if(results.length>0){
                    $("#stat_tag").css("display","none")
                    $("#tissue_enrichment_stat").css("display","block")
                    getpie("tissue_enrichment_stat",results,"Disease_Type")
                }
                else{
                    $("#stat_tag").css("display","block")
                    $("#tissue_enrichment_stat").css("display","none")
                }
            },
            error:function(){
                console.log("error")
            }
        })

    })

    $("#cell_marker_species_select").change(function() {
        $.ajax({
            url: "/celltaxonomy/cell_marker_single",
            type: "post",
            dataType: 'json',
            data: {"id": $("#id").text()},
            success: function (data) {
                var results=data["results"];

                if(results.length>0){
                    results = eval(results).filter(function (e) {
                        return e.Species == $("#cell_marker_species_select select").val()
                    });
                    results=eval(results).filter(function(e){
                        return e.FDR<0.05
                    })
                    results=eval(results).filter(function(e){
                        return e.marker_tissue_number>1
                    })
                    var tissues = $.unique(unpack(results, "Tissue_standard").sort());

                    $("#cell_marker_single_select optgroup").empty()
                    // $("#cell_marker_single_select2 optgroup").empty()
                    for (var i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#cell_marker_single_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                        else{
                            $("#cell_marker_single_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                    }
                    for (var i = 0; i < tissues.length; i++) {
                        if(tissues[i]!="All"){
                            $("#cell_marker_single_select2 optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                        }
                        else{
                            $("#cell_marker_single_select2 optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")

                        }
                    }
                    $("#cell_marker_single_select").find("option").eq(-1).attr("selected",true);

                    cellmarkerOR(results);


                }
                else{
                    $("#detail7").css("display","none")
                }

            },

            error: function () {
                console.log("error")
            }
        })
    })

    $("#cell_marker_single_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                id:$("#id").text()
            },
            success:function(results){
                results=eval(results["results"]).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                });
                cellmarkerOR(results);

                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_single_select").val()
                })

                results=eval(results).filter(function(e){
                    return e.FDR<0.05
                })
                results=eval(results).filter(function(e){
                    return e.marker_tissue_number>1
                })



            }
        })


    })
    $("#cell_marker_tissue_LS_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                id:[[${id}]]
            },
            success:function(results){


                var result=eval(results["results"]).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                });
                result=eval(result).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                })

                getbarplot("cell_marker_single",result,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","supported_paper_number")

                results=eval(results["results"]).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                });
                cellmarkerplot(results)


            }
        })


    })


    $("#cell_marker_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                "id":$("#id").text()
            },
            success:function(data){
                var result=data["results"];
                var results;
                results=eval(result).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                })
                cellmarkerOR(results);
                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_single_select").val()
                })



            }
        });

    })
    $("#cell_marker_LS_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{
                "id":$("#id").text()
            },
            success:function(data){
                var result=data["results"];
                var results;
                results=eval(result).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                })
                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                })


                getbarplot("cell_marker_single",results,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","supported_paper_number")

                results=eval(result).filter(function(e){
                    return e.Species==$("#cell_marker_species_select select").val()
                })
                cellmarkerplot(results);




            }
        });

    })

    $("#cell_marker_heatmap_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{"id":$("#id").text()},
            success:function(data) {
                cellmarkerheatmap(data)

            },
            error:function(){
                console.log("error")
            }
        })

    })
    $("#cell_marker_heatmap_LS_select").change(function(){
        $.ajax({
            url:"/celltaxonomy/cell_marker_single",
            type:"post",
            dataType:'json',
            data:{"id":[[${id}]]},
            success:function(data) {
                var results=data["results"]
                results=eval(results).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                })

                $("#cell_marker_tissue_LS_select optgroup").empty()
                var tissues = $.unique(unpack(results, "Tissue_standard").sort());

                for (var i = 0; i < tissues.length; i++) {
                    if(tissues[i]!="All"){
                        $("#cell_marker_tissue_LS_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                    }
                    else{
                        $("#cell_marker_tissue_LS_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
                    }
                }
                $("#cell_marker_tissue_LS_select").find("option").eq(-1).attr("selected",true);
                results=eval(results).filter(function(e){
                    return e.Tissue_standard==$("#cell_marker_tissue_LS_select").val()
                })
                getbarplot("cell_marker_single",results,$("#name").text()+": top publication-supported markers in "+$("#cell_marker_tissue_LS_select").val()+" of "+$("#cell_marker_heatmap_LS_select").val(),"No. of publications","","Cell_Marker","supported_paper_number")

                results=data["results"]
                results=eval(results).filter(function(e){
                    return e.Species==$("#cell_marker_heatmap_LS_select").val()
                })


                cellmarkerplot(results)


            },
            error:function(){
                console.log("error")
            }
        })

    })

    $("#same_cell_similarity_select").change(function(){

        var result=eval(same_cell_similarity).filter(function(e){
            return e.Species1==$("#same_cell_similarity_select").val()
        })
        $("#same_cell_similarity_table").DataTable({
            data:result,
            columns:[
                {data:"Species2"},
                {
                    data:"Tissue_standard",
                    render:function(data,type,row){
                        if(row.Tissue_UberonOntology_ID2!="-"){
                            return "<a target='_blank' href='/celltaxonomy/tissue/"+row.Tissue_UberonOntology_ID2+"'>"+data+"</a>"
                        }
                        else{
                            return data
                        }
                    }
                },
                {data:"score"},
                {data:"common_marker_number"}
            ],
            "iDisplayLength":5,
            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',

            destroy:true
        })
    })

    $("#similarity_species_select").change(function(){
        var results=similarity;
        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })

        var tissues = $.unique(unpack(results, "Tissue_standard").sort());


        $("#similarity_tissue_select optgroup").empty();
        for (i = 0; i < tissues.length; i++) {
            if(tissues[i]!="All"){
                $("#similarity_tissue_select optgroup").eq(0).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
            }
            else{
                $("#similarity_tissue_select optgroup").eq(1).append("<option value='" + tissues[i] + "'>" + tissues[i] + "</option>")
            }
        }
        $("#similarity_tissue_select").find("option").eq(-1).attr("selected","true");

        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })

        getgraph(results)
    })
    $("#similarity_tissue_select").change(function(){
        var results=similarity;
        results=eval(results).filter(function(e){
            return e.Species==$("#similarity_species_select select").val()
        })
        results=eval(results).filter(function(e){
            return e.Tissue_standard==$("#similarity_tissue_select").val()
        })

       getgraph(results)
    })
    $("#tissue_distribution_select").change(function(){
        var results=eval(distribution).filter(function(e){
            return e.ID==$("#tissue_distribution_select").val()
        })
        var title="";
        if($("#tissue_distribution_select").val()=="Tabula Muris"){
            title="Tissue distribution of "+[[${name}]]+" in Mus musculus ("+$("#tissue_distribution_select").val()+")"
        }
        else{
            title="Tissue distribution of "+[[${name}]]+" in Homo sapiens ("+$("#tissue_distribution_select").val()+")"

        }

        getbarplot2("tissue_distribution_plot",results,title)
    })
    $("#cell_markerDE_species_select").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE",
                type:"post",
                dataType:'json',
                data:{
                    "id":$("#ct_id").text(),
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {
                    var results=result['plot']

                    var plot=[]
                    results.map(function(e){
                        var dataset=e.ID.split(",")
                        var fc=e.avg_log2FC.split(",")
                        var pct1=e.pct_1.split(",")
                        var pct2=e.pct2.split(",")
                        var pval=e.p_val.split(",")
                        var fdr=e.p_val_adj.split(",")
                        var pmid=e.PMID.split(",")
                        var condition=e.Conditions.split(",")
                        var conditionid=e.Condition_ID.split(",")
                        for(i=0;i<dataset.length;i++){
                            if(fdr[i]<0.05){
                                if(e.markers=="PECAM"){
                                    e.markers="PECAM1"
                                }
                                plot.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        markers:e.markers,
                                        marker_id:e.marker_id,
                                        avg_log2FC:fc[i],
                                        pct_1:pct1[i],
                                        pct_2:pct2[i],
                                        p_val:pval[i],
                                        p_val_adj:fdr[i],
                                        PMID:pmid[i],
                                        Conditions:condition[i],
                                        Condition_ID:conditionid[i]
                                    }
                                )
                            }

                        }
                    })
                    getboxplot("cell_markerDE_plot",plot)
                    $("#cell_marker_DE_table").DataTable({
                        data:plot,
                        columns:
                            [
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                        }
                                        else if (data.indexOf("_")>=0){
                                            var name=data.split("_")
                                            if(data.indexOf("Tabula")>=0){
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                            }
                                            else{
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                            }
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                        }
                                    }
                                },
                                {
                                    data:"Conditions",
                                    render:function(data,type,row){
                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                            return data
                                        }
                                        else if(row.Condition_ID!="-"){
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"
                                        }
                                    }
                                },

                                {
                                    data:"markers",
                                    render:function(data,type,row){
                                        if(row.marker_id!="-"){
                                            return '<a target="_blank" href="/celltaxonomy/marker/'+row.marker_id+'">'+data+'</a>'
                                        }
                                        else{
                                            return data
                                        }
                                    }
                                },

                                {
                                    data:"avg_log2FC",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_1",
                                    render:function(data,type,row){
                                        return (row.pct_1*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_2",
                                    render:function(data,type,row){
                                        return (row.pct_2*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val",
                                    render:function(data,type,row){
                                        return (row.p_val*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val_adj",
                                    render:function(data,type,row){
                                        return (row.p_val_adj*1).toPrecision(2)
                                    }
                                },



                            ],
                        destroy:true,
                        "iDisplayLength":5,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',

                    })

                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {
                    var results=result["plot"]
                    if(results=="[]" || results.length==0){
                        $("#detail8").css("display","none")
                    }
                    else{
                        var plot=[]
                        results.map(function(e){
                            var dataset=e.ID.split(",")
                            var fc=e.avg_log2FC.split(",")
                            var pct1=e.pct1.split(",")
                            var pct2=e.pct2.split(",")
                            var pval=e.p_val.split(",")
                            var fdr=e.p_val_adj.split(",")
                            var pmid=e.PMID.split(",")
                            var condition=e.Conditions.split(",")
                            var conditionid=e.Condition_ID.split(",")
                            for(i=0;i<dataset.length;i++){
                                if(fdr[i]<0.05){
                                    if(e.markers=="PECAM"){
                                        e.markers="PECAM1"
                                    }
                                    plot.push(
                                        {
                                            Species:e.Species,
                                            ID:dataset[i],
                                            markers:e.markers,
                                            marker_id:e.marker_id,
                                            avg_log2FC:fc[i],
                                            pct_1:pct1[i],
                                            pct_2:pct2[i],
                                            p_val:pval[i],
                                            p_val_adj:fdr[i],
                                            PMID:pmid[i],
                                            Conditions:condition[i],
                                            Condition_ID:conditionid[i]
                                        }
                                    )
                                }

                            }
                        })

                        getboxplot("cell_markerDE_plot",plot)

                        $("#cell_marker_DE_table").DataTable({
                            data:plot,
                            columns:
                                [
                                    {data:"Species"},
                                    {
                                        data:"ID",
                                        render:function(data,type,row){
                                            if(data.indexOf("_SRS")>=0){
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                            }
                                            else if (data.indexOf("_")>=0){
                                                var name=data.split("_")
                                                if(data.indexOf("Tabula")>=0){
                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                }
                                                else{
                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                }
                                            }
                                            else{
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                            }
                                        }
                                    },

                                    {
                                        data:"markers",
                                        // render:function(data,type,row){
                                        //     if(row.ENTREZID2!="-"){
                                        //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                        //     }
                                        //     else{
                                        //         return data
                                        //     }
                                        // }
                                    },

                                    {
                                        data:"avg_log2FC",
                                        render:function(data,type,row){
                                            return (data*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_1",
                                        render:function(data,type,row){
                                            return (row.pct_1*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_2",
                                        render:function(data,type,row){
                                            return (row.pct_2*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val_adj",
                                        render:function(data,type,row){
                                            return (row.p_val_adj*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val",
                                        render:function(data,type,row){
                                            return (row.p_val*1).toPrecision(2)
                                        }
                                    },


                                ],
                            destroy:true,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            "iDisplayLength":5,

                        })


                    }
                }
            });

        }

    })
    $("#cell_markerDE_barplot_species_select").change(function(){
        $("input[type='checkbox'].switch4").attr("checked",false)
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":$("#ct_id").text(),
                    "name":[[${name}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    DE_bar=data
                    $("input[type='checkbox'].switch4").prop("checked",false)

                    if($("input[type='checkbox'].switch4").is(":checked")){
                        getbarplotDE2("cell_markerDE_barplot",DE_bar)
                    }
                    else{
                        getbarplotDE("cell_markerDE_barplot",DE_bar)
                    }
                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    DE_bar=data
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
        }

    })

    $("#cell_markerDE_barplot_threshold").change(function(){
        $("input[type='checkbox'].switch4").attr("checked",false)

        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":$("#ct_id").text(),
                    "name":[[${name}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    $("input[type='checkbox'].switch4").prop("checked",false)

                    var tempdata=data["result"]
                    if(tempdata.length==0) {
                        $("#cell_markerDE_barplot").css("display","none")
                        $("#warn").css("display","block")
                    }
                    else{
                        $("#cell_markerDE_barplot").css("display","block")
                        $("#warn").css("display","none")
                        DE_bar=data
                        if($("input[type='checkbox'].switch4").is(":checked")){
                            getbarplotDE2("cell_markerDE_barplot",DE_bar)
                        }
                        else{
                            getbarplotDE("cell_markerDE_barplot",DE_bar)
                        }
                    }
                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    DE_bar=data
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });

        }

    })
    $("#cell_markerDE_barplot_FDR").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    var tempdata=data["result"]
                    if(tempdata.length==0) {
                        $("#cell_markerDE_barplot").css("display","none")
                        $("#warn").css("display","block")
                    }
                    else{
                        $("#cell_markerDE_barplot").css("display","block")
                        $("#warn").css("display","none")
                        getbarplotDE("cell_markerDE_barplot",data)

                    }
                }
            });
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });

        }
    })

    $("#specificity_score_species_select").change(function(){
        if($("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_SS",
                type:"post",
                data:{
                    "id":$("#ct_id").text(),
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val(),
                },
                success:function(result){
                    if(result["score"].length>0){
                        $("#cell_marker_ss_plot").css("display","block")
                        $("#ss_tag").css("display","none")
                        var results=[]
                        result["score"].map(function(e){
                            var dataset=e.ID.split(",")
                            var ss=e.Cell_specific_score.split(",")
                            var pmid=e.PMID.split(",")
                            var condition=e.Conditions.split(",")
                            var conditionid=e.Condition_ID.split(",")
                            for(i=0;i<dataset.length;i++){
                                var gene=e.Gene.split(",")[0]
                                if(gene=="PECAM"){
                                    gene="PECAM1"
                                }
                                results.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        Gene:gene,
                                        Gene_id:e.Gene_id,
                                        Cell_specific_score:ss[i],
                                        PMID:pmid[i],
                                        Condition:condition[i],
                                        Condition_ID:conditionid[i]
                                    }
                                )
                            }

                        })

                        $("#cell_marker_se_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                        }
                                        else if (data.indexOf("_")>=0){
                                            var name=data.split("_")
                                            if(data.indexOf("Tabula")>=0){
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                            }
                                            else{
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                            }
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                        }
                                    }
                                },
                                {
                                    data:"Condition",
                                    render:function(data,type,row){
                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                            return data
                                        }
                                        else if(row.Condition_ID!="-"){
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                        }                                   }
                                },
                                {
                                    data:"Gene",
                                    render:function(data,type,row){
                                        if(row.Gene_id!="-"){
                                            return '<a target="_blank" href="/celltaxonomy/marker/'+row.Gene_id+'">'+data+'</a>'
                                        }
                                        else{
                                            return data
                                        }
                                    }
                                },
                                {
                                    data:"Cell_specific_score",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                }
                            ],
                            destroy:true,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            "iDisplayLength":5,
                            order:[3,"desc"]
                        })
                        getboxplotSS("cell_marker_ss_plot",results)
                    }
                    else{
                        $("#ss_tag").css("display","block")
                        $("#cell_marker_ss_plot").css("display","none")
                    }

                }
            })
        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerSS_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val()
                },
                success:function(result) {
                    var score=result["score"]
                    var results=[]
                    score.map(function(e){
                        var dataset=e.ID.split(",")
                        var ss=e.Cell_specific_score.split(",")
                        var pmid=e.PMID.split(",")
                        var condition=e.Conditions.split(",")
                        var conditionid=e.Condition_ID.split(",")
                        for(i=0;i<dataset.length;i++){
                            results.push(
                                {
                                    Species:e.Species,
                                    ID:dataset[i],
                                    Gene:e.Gene,
                                    Cell_specific_score:ss[i],
                                    PMID:pmid[i],
                                    Condition:condition[i],
                                    Condition_ID:conditionid[i]
                                }
                            )
                        }
                    })
                    $("#cell_marker_se_table").DataTable({
                        data:results,
                        columns:[
                            {data:"Species"},
                            {
                                data:"ID",
                                render:function(data,type,row){
                                    if(data.indexOf("_SRS")>=0){
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                    }
                                    else if (data.indexOf("_")>=0){
                                        var name=data.split("_")
                                        if(data.indexOf("Tabula")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                        }
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                    }
                                }
                            },
                            {
                                data:"Condition",
                                render:function(data,type,row){
                                    if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                        return data
                                    }
                                    else if(row.Condition_ID!="-"){
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                    }
                                    else{
                                        return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                    }
                                }
                            },
                            {data:"Gene"},
                            {
                                data:"Cell_specific_score",
                                render:function(data,type,row){
                                    return (data*1).toPrecision(2)
                                }
                            }
                        ],
                        destroy:true,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                        "iDisplayLength":5,
                        order:[3,"desc"]
                    })
                    getboxplotSS("cell_marker_ss_plot",result["score"])
                }
            });

        }
    })
    $("#cell_similarity_species_species_select").change(function(){

        var data=eval(conserved).filter(function(e){
            return e.Species1==$("#cell_similarity_species_species_select").val()
        })
        var tissue=$.unique(unpack(data,"Tissue_standard").sort())
        $("#cell_similarity_species_tissue_select optgroup").empty()
        tissue.map(function(d){
            if(d!="All"){
                $("#cell_similarity_species_tissue_select optgroup").eq(0).append("<option value='"+d+"'>"+d+"</option>")
            }
            else{
                $("#cell_similarity_species_tissue_select optgroup").eq(1).append("<option value='"+"All"+"'>"+d+"</option>")
            }
        })
        $("#cell_similarity_species_tissue_select").find("option").eq(-1).attr("selected","true")

        data=eval(data).filter(function(e){
            return e.Tissue_standard==$("#cell_similarity_species_tissue_select").val()
        })
        var marker=$.unique(unpack(data,"Cell_Marker").sort())
        $("#cell_similarity_species_marker_select optgroup").empty()
        marker.map(function(d){
            $("#cell_similarity_species_marker_select optgroup").eq(0).append("<option value='"+d+"'>"+d+"</option>")

        })
        $("#cell_similarity_species_marker_select optgroup").eq(1).append("<option value='All'>All</option>")
        $("#cell_similarity_species_marker_select").find("option").eq(-1).attr("selected","true")
        if($("#cell_similarity_species_marker_select").val()!="All"){
            data=eval(data).filter(function(e){
                return e.Cell_Marker==$("#cell_similarity_species_marker_select").val()
            })
        }
        $("#conserve_pub").text(data[0].Cell_marker_publication)
        $("#common_table").DataTable({
            data:data,
            columns:[
                {
                    data:"Cell_Marker",
                    render:function(data,type,row){
                        return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID+"'>"+data+"</a>"
                    }
                },
                {data:"Species2"},
                {
                    data:"Ortholog",
                    render:function(data,type,row){
                        return '<a target="_blank" href="/celltaxonomy/marker/'+row.Ortholog_ID+'">'+data+'</a>'
                    }
                },
                {
                    data:"Ortholog_ID",
                    render:function(data,type,row){
                        return '<a target="_blank" href="https://www.ncbi.nlm.nih.gov/gene/'+data+'">'+data+'</a>'
                    }
                },

                {
                    data:"Ortholog_publication",
                    render:function(data){
                        return "<a class='conserved_pub'>"+data+"</a>"
                    }
                }
            ],
            destroy:true,
            iDisplayLength:5,
            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
        })




    })

    $("#cell_similarity_species_tissue_select").change(function(){

        var data=eval(conserved).filter(function(e){
            return e.Species1==$("#cell_similarity_species_species_select").val()
        })

        data=eval(data).filter(function(e){
            return e.Tissue_standard==$("#cell_similarity_species_tissue_select").val()
        })
        var marker=$.unique(unpack(data,"Cell_Marker").sort())
        $("#cell_similarity_species_marker_select optgroup").empty()
        marker.map(function(d){
            $("#cell_similarity_species_marker_select optgroup").eq(0).append("<option value='"+d+"'>"+d+"</option>")

        })
        $("#cell_similarity_species_marker_select optgroup").eq(1).append("<option value='All'>All</option>")
        $("#cell_similarity_species_marker_select").find("option").eq(-1).attr("selected","true")

        $("#common_table").DataTable({
                    data:data,
                    columns:[
                        {
                            data:"Cell_Marker",
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID+"'>"+data+"</a>"
                            }
                        },
                        {data:"Species2"},
                        {
                            data:"Ortholog",
                            render:function(data,type,row){
                                return '<a target="_blank" href="/celltaxonomy/marker/'+row.Ortholog_ID+'">'+data+'</a>'
                            }
                        },
                        {
                            data:"Ortholog_ID",
                            render:function(data,type,row){
                                return '<a target="_blank" href="https://www.ncbi.nlm.nih.gov/gene/'+data+'">'+data+'</a>'
                            }
                        },

                        {
                            data:"Ortholog_publication",
                            render:function(data){
                                return "<a class='conserved_pub'>"+data+"</a>"
                            }
                        }
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                })




    })
    $("#cell_similarity_species_marker_select").change(function(){
        var data=eval(conserved).filter(function(e){
            return e.Species1==$("#cell_similarity_species_species_select").val()
        })

        data=eval(data).filter(function(e){
            return e.Tissue_standard==$("#cell_similarity_species_tissue_select").val()
        })
        if($("#cell_similarity_species_marker_select").val()!="All"){
            data=eval(data).filter(function(e){
                return e.Cell_Marker==$("#cell_similarity_species_marker_select").val()
            })
        }
        $("#common_table").DataTable({
            data:data,
            columns:[
                {
                    data:"Cell_Marker",
                    render:function(data,type,row){
                        return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID+"'>"+data+"</a>"
                    }
                },
                {data:"Species2"},
                // {data:"score"},
                {
                    data:"Ortholog",
                    render:function(data,type,row){
                        return '<a target="_blank" href="/celltaxonomy/marker/'+row.Ortholog_ID+'">'+data+'</a>'
                    }
                },
                {
                    data:"Ortholog_ID",
                    render:function(data,type,row){
                        return '<a target="_blank" href="https://www.ncbi.nlm.nih.gov/gene/'+data+'">'+data+'</a>'
                    }
                },

                {
                    data:"Ortholog_publication",
                    render:function(data){
                        return "<a class='conserved_pub'>"+data+"</a>"
                    }
                }
            ],
            destroy:true,
            iDisplayLength:5,
            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
        })




    })

    $('#marker_recom').on('DOMNodeInserted',function(){
        if($("input[type='checkbox'].switch1").is(":checked")){
            $(".summary_value").css("display","block")
        }
        else{
            $(".summary_value").css("display","none")
        }
    })
    $('#dataset_recom').on('DOMNodeInserted',function(){
        if($("input[type='checkbox'].switch3").is(":checked")){
            $(".summary_value3").css("display","block")
        }
        else{
            $(".summary_value3").css("display","none")
        }
    })

    $("input[type='checkbox'].switch1").change(function(){
        if($("input[type='checkbox'].switch1").is(":checked")){
            $(".summary_value").css("display","block")
        }
        else{
            $(".summary_value").css("display","none")
        }

    })
    $("input[type='checkbox'].switch3").change(function(){
        if($("input[type='checkbox'].switch3").is(":checked")){
            $(".summary_value3").css("display","block")
        }
        else{
            $(".summary_value3").css("display","none")
        }

    })
    $("input[type='checkbox'].switch2").change(function(){
        if(!$("input[type='checkbox'].switch2").is(":checked")){
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar_all",
                type:"post",
                dataType:'json',

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {
                    var results=result["plot"]
                    if(results=="[]" || results.length==0){

                    }
                    else{
                        var plot=[]
                        results.map(function(e){
                            var dataset=e.ID.split(",")
                            var fc=e.avg_log2FC.split(",")
                            var pct1=e.pct1.split(",")
                            var pct2=e.pct2.split(",")
                            var pval=e.p_val.split(",")
                            var fdr=e.p_val_adj.split(",")
                            var pmid=e.PMID.split(",")
                            var condition=e.Conditions.split(",")
                            var conditionid=e.Condition_ID.split(",")
                            for(i=0;i<dataset.length;i++){
                                if(fdr[i]<0.05){
                                    if(e.markers=="PECAM"){
                                        e.markers="PECAM1"
                                    }
                                    plot.push(
                                        {
                                            Species:e.Species,
                                            ID:dataset[i],
                                            markers:e.markers,
                                            marker_id:e.marker_id,
                                            avg_log2FC:fc[i],
                                            pct_1:pct1[i],
                                            pct_2:pct2[i],
                                            p_val:pval[i],
                                            p_val_adj:fdr[i],
                                            PMID:pmid[i],
                                            Conditions:condition[i],
                                            Condition_ID:conditionid[i]
                                        }
                                    )
                                }

                            }
                        })

                        getboxplot("cell_markerDE_plot",plot)

                        $("#cell_marker_DE_table").DataTable({
                            data:plot,
                            columns:
                                [
                                    {data:"Species"},
                                    {
                                        data:"ID",
                                        render:function(data,type,row){
                                            if(data.indexOf("_SRS")>=0){
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                            }
                                            else if (data.indexOf("_")>=0){
                                                var name=data.split("_")
                                                if(data.indexOf("Tabula")>=0){
                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                                }
                                                else{
                                                    return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                                }
                                            }
                                            else{
                                                return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                            }
                                        }
                                    },

                                    {
                                        data:"markers",
                                        render:function(data,type,row){
                                            if(row.marker_id!="-"){
                                                return '<a target="_blank" href="/celltaxonomy/marker/'+row.marker_id+'">'+data+'</a>'
                                            }
                                            else{
                                                return data
                                            }
                                        }
                                    },

                                    {
                                        data:"avg_log2FC",
                                        render:function(data,type,row){
                                            return (data*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_1",
                                        render:function(data,type,row){
                                            return (row.pct_1*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"pct_2",
                                        render:function(data,type,row){
                                            return (row.pct_2*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val_adj",
                                        render:function(data,type,row){
                                            return (row.p_val_adj*1).toPrecision(2)
                                        }
                                    },
                                    {
                                        data:"p_val",
                                        render:function(data,type,row){
                                            return (row.p_val*1).toPrecision(2)
                                        }
                                    },


                                ],
                            destroy:true,
                            "iDisplayLength":5,

                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',

                        })


                    }



                }
            });
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerSS_all",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val()
                },
                success:function(result) {
                    var score=result["score"]
                    if(score=='[]'||score.length==0){

                    }
                    else{
                        var results=[]
                        score.map(function(e){
                            var dataset=e.ID.split(",")
                            var ss=e.Cell_specific_score.split(",")
                            var pmid=e.PMID.split(",")
                            var condition=e.Conditions.split(",")
                            var conditionid=e.Condition_ID.split(",")
                            for(i=0;i<dataset.length;i++){
                                results.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        Gene:e.Gene,
                                        Gene_id:e.Gene_id,
                                        Cell_specific_score:ss[i],
                                        PMID:pmid[i],
                                        Condition:condition[i],
                                        Condition_ID:conditionid[i]
                                    }
                                )
                            }
                        })
                        $("#cell_marker_se_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                        }
                                        else if (data.indexOf("_")>=0){
                                            var name=data.split("_")
                                            if(data.indexOf("Tabula")>=0){
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                            }
                                            else{
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                            }
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                        }
                                    }
                                },
                                {
                                    data:"Condition",
                                    render:function(data,type,row){
                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                            return data
                                        }
                                        else if(row.Condition_ID!="-"){
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                        }
                                    }
                                },
                                {
                                    data:"Gene",
                                    render:function(data,type,row){
                                        if(row.Gene_id!="-"){
                                            return '<a target="_blank" href="/celltaxonomy/marker/'+row.Gene_id+'">'+data+'</a>'
                                        }
                                        else{
                                            return data
                                        }
                                    }
                                },
                                {
                                    data:"Cell_specific_score",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                }
                            ],
                            destroy:true,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            "iDisplayLength":5,
                            order:[3,"desc"]
                        })
                        getboxplotSS("cell_marker_ss_plot",result["score"])
                    }

                }
            });

        }
        else{
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_bar",
                type:"post",
                dataType:'json',
                async:false,

                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_barplot_species_select").val(),
                    "threshold":$("#cell_markerDE_barplot_threshold").val(),
                    "fdr":$("#cell_markerDE_barplot_FDR").val()
                },
                success:function(data){
                    getbarplotDE("cell_markerDE_barplot",data)
                }
            });
            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE",
                type:"post",
                dataType:'json',
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#cell_markerDE_species_select").val()
                },
                success:function(result) {

                    var results=result['plot']

                    var plot=[]
                    results.map(function(e){
                        var dataset=e.ID.split(",")
                        var fc=e.avg_log2FC.split(",")
                        var pct1=e.pct_1.split(",")
                        var pct2=e.pct2.split(",")
                        var pval=e.p_val.split(",")
                        var fdr=e.p_val_adj.split(",")
                        var pmid=e.PMID.split(",")
                        var condition=e.Conditions.split(",")
                        var conditionid=e.Condition_ID.split(",")
                        for(i=0;i<dataset.length;i++){
                            if(fdr[i]<0.05){
                                if(e.markers=="PECAM"){
                                    e.markers="PECAM1"
                                }
                                plot.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        markers:e.markers,
                                        marker_id:e.marker_id,
                                        avg_log2FC:fc[i],
                                        pct_1:pct1[i],
                                        pct_2:pct2[i],
                                        p_val:pval[i],
                                        p_val_adj:fdr[i],
                                        PMID:pmid[i],
                                        Conditions:condition[i],
                                        Condition_ID:conditionid[i]
                                    }
                                )
                            }

                        }
                    })
                    getboxplot("cell_markerDE_plot",plot)

                    $("#cell_marker_DE_table").DataTable({
                        data:plot,
                        columns:
                            [
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data.split("_")[1]+'</a>'
                                        }
                                        else if (data.indexOf("_")>=0){
                                            var name=data.split("_")
                                            if(data.indexOf("Tabula")>=0){
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                            }
                                            else{
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                            }
                                        }
                                        else{
                                            return '<a target="_blank" href="/celltaxonomy/study/'+row.PMID+'">'+data+'</a>'

                                        }
                                    }
                                },

                                {
                                    data:"markers",
                                    // render:function(data,type,row){
                                    //     if(row.ENTREZID2!="NA"){
                                    //         return '<a target="_blank" href="/celltaxonomy/marker/'+row.ENTREZID2+'">'+data+'</a>'
                                    //     }
                                    //     else{
                                    //         return data
                                    //     }
                                    // }
                                },

                                {
                                    data:"avg_log2FC",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_1",
                                    render:function(data,type,row){
                                        return (row.pct_1*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"pct_2",
                                    render:function(data,type,row){
                                        return (row.pct_2*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val",
                                    render:function(data,type,row){
                                        return (row.p_val*1).toPrecision(2)
                                    }
                                },
                                {
                                    data:"p_val_adj",
                                    render:function(data,type,row){
                                        return (row.p_val_adj*1).toPrecision(2)
                                    }
                                },



                            ],
                        destroy:true,
                        "iDisplayLength":5,
                        dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',

                    })

                }
            });

            $.ajax({
                url:"/celltaxonomy/celltype_cell_markerDE_SS",
                type:"post",
                data:{
                    "id":[[${id}]],
                    "name":[[${name}]],
                    "species":$("#specificity_score_species_select").val(),
                },
                success:function(result){
                    if(result["score"].length>0){
                        $("#cell_marker_ss_plot").css("display","block")
                        $("#ss_tag").css("display","none")
                        var results=[]
                        result["score"].map(function(e){
                            var dataset=e.ID.split(",")
                            var ss=e.Cell_specific_score.split(",")
                            var pmid=e.PMID.split(",")
                            var condition=e.Conditions.split(",")
                            var conditionid=e.Condition_ID.split(",")
                            for(i=0;i<dataset.length;i++){
                                results.push(
                                    {
                                        Species:e.Species,
                                        ID:dataset[i],
                                        Gene:e.Gene,
                                        Cell_specific_score:ss[i],
                                        PMID:pmid[i],
                                        Condition:condition[i],
                                        Condition_ID:conditionid[i]
                                    }
                                )
                            }
                        })
                        $("#cell_marker_se_table").DataTable({
                            data:results,
                            columns:[
                                {data:"Species"},
                                {
                                    data:"ID",
                                    render:function(data,type,row){
                                        if(data.indexOf("_SRS")>=0){
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data.split("_")[1]+"</a>"
                                        }
                                        else if (data.indexOf("_")>=0){
                                            var name=data.split("_")
                                            if(data.indexOf("Tabula")>=0){
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>Tabula mouse ("+name[2]+", "+name[3]+")</a>"
                                            }
                                            else{
                                                return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+name[0]+" ("+name[1]+")</a>"
                                            }
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/study/"+row.PMID+"'>"+data+"</a>"
                                        }
                                    }
                                },
                                {
                                    data:"Condition",
                                    render:function(data,type,row){
                                        if(["DOID:2841","DOID:104","DOID:526","DOID:8469"].indexOf(row.Condition_ID)>=0){
                                            return data
                                        }
                                        else if(row.Condition_ID!="-"){
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+row.Condition_ID+"'>"+data+"</a>"
                                        }
                                        else{
                                            return "<a target='_blank' href='/celltaxonomy/condition/"+data+"'>"+data+"</a>"

                                        }
                                    }
                                },
                                {data:"Gene"},
                                {
                                    data:"Cell_specific_score",
                                    render:function(data,type,row){
                                        return (data*1).toPrecision(2)
                                    }
                                }
                            ],
                            destroy:true,
                            dom: '<"row"<"col-lg-12"f>>t<"row"<"col-lg-6"i><"col-lg-6"p>>',
                            "iDisplayLength":5,
                            order:[3,"desc"]
                        })
                        getboxplotSS("cell_marker_ss_plot",result["score"])
                    }
                    else{
                        $("#ss_tag").css("display","block")
                        $("#cell_marker_ss_plot").css("display","none")
                    }

                }
            })



        }


    })
    $("input[type='checkbox'].switch4").change(function(){
        if($(this).is(":checked")){
            getbarplotDE2("cell_markerDE_barplot",DE_bar)
        }
        else{
            getbarplotDE("cell_markerDE_barplot",DE_bar)
        }
    })

    $("#cn").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#cn_range").text($("#cn").val()*100+"%")
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#sc").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#sc_range").text($("#sc").val()*100+"%")
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#asc").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#asc_range").text($("#asc").val()*100+"%")
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#rs").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#rs_range").text($("#rs").val()*100+"%")
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })
    $("#ars").change(function(){
        $(this).css( 'background-size', (this.value*4/3-1/3)*100 + '% 100%' );

        $("#ars_range").text($("#ars").val()*100+"%")
        var results=eval(CE).filter(function(e){
            return e.Species2==$("#study_species_select").val()
        })
        getlineplot("study_plot",results)
    })

    $(".icon").parent().click(function(){
        if($(this).find("i").hasClass("ion-chevron-down")){
            $(this).find("i").removeClass("ion-chevron-down");
            $(this).find("i").addClass("ion-chevron-right")
        }
        else{
            $(this).find("i").addClass("ion-chevron-down");
            $(this).find("i").removeClass("ion-chevron-right")
        }
    })
    $("#statistic_table").on("click",".cellstandard",function(){
        var row = $(this).closest("tr");
        var data = $('#statistic_table').DataTable().row(row).data();
        getCelltypeDetail(data["Cell_standard"],data["Specific_Cell_Ontology_ID"])

    })
    $("#statistic_table").on("click",".ctid",function(){
        var row = $(this).closest("tr");
        var data = $('#statistic_table').DataTable().row(row).data();
        getCelltypeDetail(data["Cell_standard"],data["Specific_Cell_Ontology_ID"])

    })
    $("#common_table").on("click",".conserved_pub",function(){
        var row = $(this).closest("tr");

        if(row.next().hasClass("table_append")){
            $(".table_append").remove()
        }
        else{
            var data = $('#common_table').DataTable().row(row).data();
            console.log(data)
            $.ajax({
                url:"/celltaxonomy/conserved_pub",
                type:'post',
                data:{
                    species:data['Species2'],
                    tissue:$("#cell_similarity_species_tissue_select").val(),
                    marker:data['Ortholog_ID'],
                    cellid:[[${id}]]
                },
                success:function(results){
                    $(".table_append").remove()
                    row.after(
                        "<tr class='table_append'>"+
                        "<td colspan='5' id='append_td'>" +
                        '<div id="pub_div" >'+
                        '<div>'+
                        '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                        '<thead>'+
                        '<tr>'+
                        '<th>PMID</th>'+
                        '<th>Title</th>'+
                        '<th>Journal</th>'+
                        '</tr>'+
                        '</thead>'+
                        '</table>'+
                        '</div>'+
                        '</div>'+
                        "</td>"+
                        "</tr>"
                    )
                    $("#pub").DataTable({
                        data:results,
                        columns:[
                            {
                                data:"PMID",
                                render:function(data){
                                    return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+data+"'>"+data+"</a>"
                                }

                            },
                            {data:"title"},
                            {data:"journal"},

                        ],
                        destroy:true,
                        "iDisplayLength":5,

                        dom: '<"row">t<"row"<"col-lg-12"p>>',

                    })

                }
            })
        }



    })
    $("#statistic_table").on("click",".circle_svg",function(){
        var row = $(this).closest("tr");
        var type=$(this).attr("value")
        if(row.next().hasClass("table_append") && row.next().attr("value")==type){
            $(".table_append").remove()
        }
        else{
            var data = $('#statistic_table').DataTable().row(row).data();
            $.ajax({
                url:"/celltaxonomy/cell_statistic",
                type:'post',
                data:{
                    cellid:data['CT_ID'],
                    type:type
                },
                success:function(results){
                    $(".table_append").remove()

                    if(type=="species") {
                        row.after(
                            "<tr class='table_append' value='"+type+"'>"+
                            "<td colspan='6' id='append_td'>" +
                            '<div id="pub_div" >'+
                            '<div>'+
                            '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                            '<thead>'+
                            '<tr>'+
                            '<th>Species</th>'+
                            '<th>Species Taxonomy ID</th>'+
                            '</tr>'+
                            '</thead>'+
                            '</table>'+
                            '</div>'+
                            '</div>'+
                            "</td>"+
                            "</tr>"
                        )
                        results=eval(results).filter(function(e){
                            return e.Species!="-"
                        })
                        $("#pub").DataTable({
                            data: results,
                            columns: [
                                {
                                    data: "Species",
                                    render: function (data,type,row) {
                                        return "<a target='_blank' href='/celltaxonomy/species/" + row.Species_tax_ID + "'>" + data + "</a>"
                                    }

                                },
                                {
                                    data: "Species_tax_ID",
                                    render:function(data){
                                        return "<a target='_blank' href='https://www.ncbi.nlm.nih.gov/data-hub/taxonomy/"+data+"'>"+data+"</a>"
                                    }
                                },

                            ],
                            destroy: true,
                            "iDisplayLength": 5,

                            dom: '<"row">t<"row"<"col-lg-12"p>>',

                        })
                    }
                    else if (type=="tissue"){
                        row.after(
                            "<tr class='table_append' value='"+type+"'>"+
                            "<td colspan='6' id='append_td'>" +
                            '<div id="pub_div" >'+
                            '<div>'+
                            '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                            '<thead>'+
                            '<tr>'+
                            '<th>Tissue</th>'+
                            '<th>Tissue ID</th>'+
                            '</tr>'+
                            '</thead>'+
                            '</table>'+
                            '</div>'+
                            '</div>'+
                            "</td>"+
                            "</tr>"
                        )
                        results=eval(results).filter(function(e){
                            return e.Tissue_standard!="-"
                        })
                        $("#pub").DataTable({
                            data: results,
                            columns: [
                                {
                                    data: "Tissue_standard",
                                    render: function (data,type,row) {
                                        return "<a target='_blank' href='/celltaxonomy/tissue/" + row.Tissue_UberonOntology_ID2 + "'>" + data + "</a>"
                                    }

                                },
                                {
                                    data: "Tissue_UberonOntology_ID",
                                    render:function(data,type,row){
                                        if(data!="-"){
                                            return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/uberon/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+data.replace(/:/,"_")+"'>"+data+"</a>"
                                        }
                                        else{
                                            return data
                                        }
                                    }
                                },

                            ],
                            destroy: true,
                            "iDisplayLength": 5,

                            dom: '<"row">t<"row"<"col-lg-12"p>>',

                        })
                    }
                    else if (type=="condition"){
                        row.after(
                            "<tr class='table_append' value='"+type+"'>"+
                            "<td colspan='6' id='append_td'>" +
                            '<div id="pub_div" >'+
                            '<div>'+
                            '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                            '<thead>'+
                            '<tr>'+
                            '<th>Condition</th>'+
                            '<th>Disease ID</th>'+
                            '</tr>'+
                            '</thead>'+
                            '</table>'+
                            '</div>'+
                            '</div>'+
                            "</td>"+
                            "</tr>"
                        )
                        results=eval(results).filter(function(e){
                            return e.Disease_Type!="-"
                        })
                        $("#pub").DataTable({
                            data: results,
                            columns: [
                                {
                                    data: "Disease_Type",
                                    render: function (data,type,row) {
                                        return "<a target='_blank' href='/celltaxonomy/condition/" + row.Disease_Ontology_ID2 + "'>" + data + "</a>"
                                    }

                                },
                                {
                                    data: "Disease_Ontology_ID",
                                    render:function(data){
                                        if(data!="-"){
                                            return "<a target='_blank' href='https://www.ebi.ac.uk/ols/ontologies/doid/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2F"+data.replace(/:/,"_")+"'>"+data+"</a>"
                                        }
                                        else{
                                            return data
                                        }
                                    }
                                },

                            ],
                            destroy: true,
                            "iDisplayLength": 5,

                            dom: '<"row">t<"row"<"col-lg-12"p>>',

                        })
                    }
                    else if (type=="marker"){
                        row.after(
                            "<tr class='table_append' value='"+type+"'>"+
                            "<td colspan='6' id='append_td'>" +
                            '<div id="pub_div" >'+
                            '<div>'+
                            '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                            '<thead>'+
                            '<tr>'+
                            '<th>Cell marker</th>'+
                            '<th>ENTREZ ID</th>'+
                            '</tr>'+
                            '</thead>'+
                            '</table>'+
                            '</div>'+
                            '</div>'+
                            "</td>"+
                            "</tr>"
                        )
                        $("#pub").DataTable({
                            data: results,
                            columns: [
                                {
                                    data: "Cell_Marker",
                                    render: function (data,type,row) {
                                        return "<a target='_blank' href='/celltaxonomy/marker/" + row.Gene_ENTREZID2 + "'>" + data + "</a>"
                                    }

                                },
                                {
                                    data: "Gene_ENTREZID",
                                    render:function(data){
                                        if(data!="-"){
                                            return "<a target='_blank' href='https://www.ncbi.nlm.nih.gov/gene/"+data+"'>"+data+"</a>"
                                        }
                                        else{
                                            return data
                                        }
                                    }
                                },

                            ],
                            destroy: true,
                            "iDisplayLength": 5,

                            dom: '<"row">t<"row"<"col-lg-12"p>>',

                        })
                    }
                    else{
                        row.after(
                            "<tr class='table_append' value='"+type+"'>"+
                            "<td colspan='6' id='append_td'>" +
                            '<div id="pub_div" >'+
                            '<div>'+
                            '<table id="pub" class="table table-hover table-striped" style="width:100%">'+
                            '<thead>'+
                            '<tr>'+
                            '<th>PMID</th>'+
                            '<th>Title</th>'+
                            '<th>Journal</th>'+
                            '</tr>'+
                            '</thead>'+
                            '</table>'+
                            '</div>'+
                            '</div>'+
                            "</td>"+
                            "</tr>"
                        )
                        results=eval(results).filter(function(e){
                            return e.PMID!="-"
                        })
                        $("#pub").DataTable({
                            data: results,
                            columns: [
                                {
                                    data:"PMID",
                                    render:function(data){
                                        return "<a target='_blank' href='https://pubmed.ncbi.nlm.nih.gov/"+data+"'>"+data+"</a>"
                                    }

                                },
                                {data:"title"},
                                {data:"journalvolume"},

                            ],
                            destroy: true,
                            "iDisplayLength": 5,

                            dom: '<"row">t<"row"<"col-lg-12"p>>',

                        })
                    }

                }
            })
        }



    })


    
    
    // $("#table-description").on("click",".SHOGoiN",function(){
    //
    //     post("https://stemcellinformatics.org/cell_marker/literatures",{"keyword":$("#name").text()})
    // })
    $("#browse_btn").click(function(){
        $("#browse").css("visibility","hidden")
        $("#browse").css("width",0)
        $("#browse").parent().parent().css("width","40px")
        $("#browse").parent().parent().css("margin","0")
        $("#browse").parent().parent().css("background","#ffffff")
        $("#browse").parent().parent().css("display","flex")



        $("#statistic").parent().parent().parent().css("width","96%")
        $("#browse_btn2").css("display","block")

    })
    $("#browse_btn2").click(function(){
        $("#browse_btn2").css("display","none")

        $("#browse").parent().parent().css("width","300px")

        if($(window).width()>1400){
            $("#browse").parent().parent().css("margin-left","30px")
            $("#browse").parent().parent().css("margin-right","10px")
        }

        $("#browse").parent().parent().css("background","transparent")
        $("#browse").parent().parent().css("display","block")

        $("#browse").css("width","auto")
        $("#browse").css("visibility","visible")

        $("#statistic").parent().parent().parent().css("width","75%")


    })
    $(".details").click(function(){
        if($(this).children("i").hasClass("ion-plus-round")){
            $(this).children("i").removeClass("ion-plus-round")
            $(this).children("i").addClass("ion-minus-round")
        }
        else{
            $(this).children("i").removeClass("ion-minus-round")
            $(this).children("i").addClass("ion-plus-round")
        }

    })
    $(".filter_search").bind('input propertychange',function(){
        if($("#filter_search1").val()==''){
            $("#filter_search1").val(1)
        }

        if($("#filter_search2").val()==""){
            $("#filter_search2").val(0.25)
        }

        if($("#filter_search3").val()==''){
            $("#filter_search3").val(0.3)
        }

        if($("#filter_search4").val()==''){

            $("#filter_search4").val(1)
        }

        if($("#filter_search5").val()==''){
            $("#filter_search5").val(0.3)
        }


        $.ajax({
            url:"/celltaxonomy/summary_filter",
            type:'post',
            data:{
                species:$("#summary_species").val(),
                cell:[[${id}]],
                fc:$("#filter_search2").val()*1,
                ss:$("#filter_search3").val()*1,
                tc:$("#filter_search4").val()*1,
                dr:$("#filter_search5").val()*1,
                pc:$("#filter_search1").val()*1
            },
            success:function(results){
                $("#marker_recom").DataTable({
                    data:results,
                    columns:[
                        {
                            data:'Cell_Marker',
                            render:function(data,type,row){
                                return "<a target='_blank' href='/celltaxonomy/marker/"+row.Gene_ENTREZID2+"'>"+data+"</a>"
                            }
                        },
                        {
                            data:'supported_paper_number',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if(data*1>=$("#filter_search1").val()*1 ){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+row.supported_paper_number*1+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        return '<span class="summary_value" style="display: none">'+row.supported_paper_number*1+'</span>'
                                    }
                                }

                                else{
                                    return data
                                }

                            }
                        },
                        {
                            data:'FC_median',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if((data*1).toPrecision(2)>=$("#filter_search2").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.FC_median*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+(row.FC_median*1).toPrecision(2)+'</span>'
                                        }
                                    }
                                }
                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:'DE_ratio',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if((data*1).toPrecision(2)>=$("#filter_search5").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.DE_ratio*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+(row.DE_ratio*1).toPrecision(2)+'</span>'
                                        }
                                    }
                                }

                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:'specificity_median',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if((data*1).toPrecision(2)>=$("#filter_search3").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.specificity_median*1).toPrecision(2)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+(row.specificity_median*1).toPrecision(2)+'</span>'
                                        }
                                    }
                                }
                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:'n_ortholog',
                            render:function(data,type,row){
                                if(type=="display"){
                                    if(data*1>=$("#filter_search4").val()*1 && !isNaN(data)){
                                        return '<div style="display:flex;justify-content: flex-start">' +
                                            '<i class="icon ion-checkmark-round checkmark"></i>' +
                                            '<span class="summary_value" style="display: none"> ('+(row.n_ortholog*1)+')</span>' +
                                            '</div>'
                                    }
                                    else{
                                        if(isNaN(data)){
                                            return '<span class="summary_value" style="display: none">-</span>'
                                        }
                                        else{
                                            return '<span class="summary_value" style="display: none">'+data+'</span>'
                                        }
                                    }
                                }

                                else{
                                    return data*1
                                }

                            }
                        },
                        {
                            data:"total",
                            render:function(data,type,row){
                                var n=0
                                if(row.supported_paper_number*1>=$("#filter_search1").val()*1  ){
                                    n+=1
                                }
                                if((row.FC_median*1).toPrecision(2)>=$("#filter_search2").val()*1 && !isNaN(row.FC_median)){
                                    n+=1
                                }
                                if((row.specificity_median*1).toPrecision(2)>=$("#filter_search3").val()*1 && !isNaN(row.specificity_median)){
                                    n+=1
                                }
                                if((row.n_ortholog*1).toPrecision(2)>=$("#filter_search4").val()*1 && !isNaN(row.n_ortholog)){
                                    n+=1
                                }
                                if((row.DE_ratio*1).toPrecision(2)>=$("#filter_search5").val()*1 && !isNaN(row.DE_ratio)){
                                    n+=1
                                }
                                return n
                            },
                            visible:false
                        }
                    ],
                    order:[
                        [6,'desc'],[1,'desc'],[2,'desc'],[3,'desc'],[4,'desc']
                    ],
                    destroy:true,
                    iDisplayLength:5,
                    lengthChange:false,
                    searching:false,
                    responsive: true
                })
            }
        })
    })
    $("#key").bind('input propertychange',function(){
        setTimeout(function(){
            $.ajax({
                url:"/celltaxonomy/static/file/marker_cell_type_list",
                type:'get',
                success:function(results){
                    list=results.replace(/\r/g,"").toLowerCase().split("\n");
                    $(".node_name").each(function(){
                        if($.inArray($(this).text().toLowerCase(),list)!=-1){
                            // $(this).css("background","#ffe6b0")
                            $(this).css("text-decoration","underline")
                        }
                        else{
                            $(this).parent().css("pointer-events","none")
                        }
                    })
                }
            });

        },2000)
    })

    $(".icon").hover(function(){
        var X = $(this).position().top;
        var Y = $(this).offset().left;
        var height=$(this).height();
        var delta=$(window).width()-Y-35;
        var span_x=$(this).siblings("span").offset().left
        var icon_width=$(this).width()
        $(this).siblings(".tooltiptext").css("top",X+height+5)
        if($(this).siblings("span").text().length>100){
            $(this).siblings("span").css("width",350)

            if(delta<180){

                $(this).siblings(".tooltiptext").css("margin-left",-1*(180+180-delta+icon_width))
            }
            else{
                $(this).siblings(".tooltiptext").css("margin-left",-(180))
            }
        }
        if(Y<200){
            $(this).siblings(".tooltiptext").css("margin-left",-20)
        }

    })



    if($(window).width()>1400){

    }
    else if($(window).width()>1024){
        $(".col-sm-3").css("margin-left","0")
        $(".col-sm-3").css("margin-right","0")

        $(".col-lg-3").css("padding-left",0)
        $(".col-lg-9").css("padding",0)
        // $(".col-lg-9").addClass("col-lg-10")
        // $(".col-lg-9").removeClass("col-lg-9")

        $("#statistic").css("font-size","13px")

    }
    else{
        $("#statistic").css("overflow","auto")
        $("#browse").parent().parent().css("margin","0")
        $("#browse").parent().parent().css("padding","0")
        $("#browse").parent().parent().css("width","25%")
        $(".col-lg-4").addClass("col-sm-4")
        $("#statistic").css("font-size","11px")

    }

    jQuery.extend( jQuery.fn.dataTableExt.oSort, {
        "num-html-pre": function ( a ) {
            if(a=="Inf"){
                a=10000000000
            }
            else{
                a=a*1
            }
            return a
        },

        "num-html-asc": function ( a, b ) {
            return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        },

        "num-html-desc": function ( a, b ) {
            return ((a < b) ? 1 : ((a > b) ? -1 : 0));
        }});

    $("#study_plot").on('mouseover',"text",function(){
        var text=$(this).text()
        var left=$(this).offset().left
        var width=this.getBoundingClientRect().width
        var top=this.getBoundingClientRect().top

        $("#"+text.toLowerCase().replace(/ /g,"_")).css("opacity","0")
        $("#"+text.toLowerCase().replace(/ /g,"_")).css("display","none")

        if(["Cell number","ROGUE","Average ROGUE","Silhouette coefficient","Average silhouette coefficient"].indexOf(text)>=0){
            var scroll_width=$("#"+text.toLowerCase().replace(/ /g,"_")).innerWidth()
            $("#"+text.toLowerCase().replace(/ /g,"_")).css("top",top+15)
            $("#"+text.toLowerCase().replace(/ /g,"_")).css("left",left-(scroll_width-width)/2)

            setTimeout(function(){
                $("#"+text.toLowerCase().replace(/ /g,"_")).css("display","block")
                setTimeout(function(){
                    $("#"+text.toLowerCase().replace(/ /g,"_")).css("opacity","1")
                },100)
            },50)

        }
    })
    $("#study_plot").on('mouseout',"text",function(){
        var text=$(this).text()
        setTimeout(function(){
            if(!$("#"+text.toLowerCase().replace(/ /g,"_")).is(":hover")){
                if(["Cell number","ROGUE","Average ROGUE","Silhouette coefficient","Average silhouette coefficient"].indexOf(text)>=0){
                    $("#"+text.toLowerCase().replace(/ /g,"_")).css("opacity","0")
                    setTimeout(function(){
                        $("#"+text.toLowerCase().replace(/ /g,"_")).css("display","none")
                    },50)
                }
            }
        },50)
    })
    $("#cell_number,#rogue,#average_rogue,#silhouette_coefficient,#average_silhouette_coefficient").mouseleave(function(){
        $(this).css("opacity","0")
        setTimeout(function(){
            $(this).css("display","none")
        },50)
    })
</script>
</body>
</html>